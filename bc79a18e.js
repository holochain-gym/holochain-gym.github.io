import"./099c0a8b.js";import{h as t}from"./178f3cd5.js";import{i as e,b as o,T as i,c as n,B as r,I as s,d as a,P as l,e as c,H as u,E as h,a as _,C as p,S as d,D as g,f as E,s as T,h as R,g as f}from"./d12199c0.js";import"./962426a7.js";let v,m,y,b,I,O,C,S,D,N,A,k,L,P,M,w,B,x=t=>t;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function F(t,e,o,i){var n,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,o,s):n(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}const H=(t,e)=>"method"===e.kind&&e.descriptor&&!("value"in e.descriptor)?{...e,finisher(o){o.createProperty(e.key,t)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:e.key,initializer(){"function"==typeof e.initializer&&(this[e.key]=e.initializer.call(this))},finisher(o){o.createProperty(e.key,t)}};function U(t){return(e,o)=>void 0!==o?((t,e,o)=>{e.constructor.createProperty(o,t)})(t,e,o):H(t,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var V="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function G(t){var e={exports:{}};return t(e,e.exports),e.exports}var W,X,Y,J,K=G((function(t,e){var o;t.exports=((o={constants:{},LINE_MODE_MULTIPLIER:40,PAGE_MODE_MULTIPLIER:125,DRAG_RADIUS:5,FLYOUT_DRAG_RADIUS:10,SNAP_RADIUS:28}).CONNECTING_SNAP_RADIUS=o.SNAP_RADIUS,o.CURRENT_CONNECTION_PREFERENCE=8,o.BUMP_DELAY=250,o.BUMP_RANDOMNESS=10,o.COLLAPSE_CHARS=30,o.LONGPRESS=750,o.SOUND_LIMIT=100,o.DRAG_STACK=!0,o.HSV_SATURATION=.45,o.HSV_VALUE=.65,o.SPRITE={width:96,height:124,url:"sprites.png"},o.INPUT_VALUE=1,o.OUTPUT_VALUE=2,o.NEXT_STATEMENT=3,o.PREVIOUS_STATEMENT=4,o.DUMMY_INPUT=5,o.ALIGN_LEFT=-1,o.ALIGN_CENTRE=0,o.ALIGN_RIGHT=1,o.DRAG_NONE=0,o.DRAG_STICKY=1,o.DRAG_BEGIN=1,o.DRAG_FREE=2,o.OPPOSITE_TYPE=[],o.OPPOSITE_TYPE[o.INPUT_VALUE]=o.OUTPUT_VALUE,o.OPPOSITE_TYPE[o.OUTPUT_VALUE]=o.INPUT_VALUE,o.OPPOSITE_TYPE[o.NEXT_STATEMENT]=o.PREVIOUS_STATEMENT,o.OPPOSITE_TYPE[o.PREVIOUS_STATEMENT]=o.NEXT_STATEMENT,o.TOOLBOX_AT_TOP=0,o.TOOLBOX_AT_BOTTOM=1,o.TOOLBOX_AT_LEFT=2,o.TOOLBOX_AT_RIGHT=3,o.DELETE_AREA_NONE=null,o.DELETE_AREA_TRASH=1,o.DELETE_AREA_TOOLBOX=2,o.VARIABLE_CATEGORY_NAME="VARIABLE",o.VARIABLE_DYNAMIC_CATEGORY_NAME="VARIABLE_DYNAMIC",o.PROCEDURE_CATEGORY_NAME="PROCEDURE",o.RENAME_VARIABLE_ID="RENAME_VARIABLE_ID",o.DELETE_VARIABLE_ID="DELETE_VARIABLE_ID",o.registry={},o.registry.typeMap_={},o.registry.DEFAULT="default",o.registry.Type=function(t){this.name_=t},o.registry.Type.prototype.toString=function(){return this.name_},o.registry.Type.CONNECTION_CHECKER=new o.registry.Type("connectionChecker"),o.registry.Type.EVENT=new o.registry.Type("event"),o.registry.Type.FIELD=new o.registry.Type("field"),o.registry.Type.RENDERER=new o.registry.Type("renderer"),o.registry.Type.TOOLBOX=new o.registry.Type("toolbox"),o.registry.Type.THEME=new o.registry.Type("theme"),o.registry.Type.TOOLBOX_ITEM=new o.registry.Type("toolboxItem"),o.registry.Type.FLYOUTS_VERTICAL_TOOLBOX=new o.registry.Type("flyoutsVerticalToolbox"),o.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX=new o.registry.Type("flyoutsHorizontalToolbox"),o.registry.register=function(t,e,i,n){if(!(t instanceof o.registry.Type)&&"string"!=typeof t||""==String(t).trim())throw Error('Invalid type "'+t+'". The type must be a non-empty string or a Blockly.registry.Type.');if(t=String(t).toLowerCase(),"string"!=typeof e||""==e.trim())throw Error('Invalid name "'+e+'". The name must be a non-empty string.');if(e=e.toLowerCase(),!i)throw Error("Can not register a null value");var r=o.registry.typeMap_[t];if(r||(r=o.registry.typeMap_[t]={}),o.registry.validate_(t,i),!n&&r[e])throw Error('Name "'+e+'" with type "'+t+'" already registered.');r[e]=i},o.registry.validate_=function(t,e){switch(t){case String(o.registry.Type.FIELD):if("function"!=typeof e.fromJson)throw Error('Type "'+t+'" must have a fromJson function')}},o.registry.unregister=function(t,e){t=String(t).toLowerCase(),e=e.toLowerCase();var i=o.registry.typeMap_[t];i?i[e]?delete o.registry.typeMap_[t][e]:console.warn('No name "'+e+'" with type "'+t+'" found'):console.warn('No type "'+t+'" found')},o.registry.getItem_=function(t,e){t=String(t).toLowerCase(),e=e.toLowerCase();var i=o.registry.typeMap_[t];return i?i[e]?i[e]:(console.warn('No name "'+e+'" with type "'+t+'" found'),null):(console.warn('No type "'+t+'" found'),null)},o.registry.hasItem=function(t,e){return t=String(t).toLowerCase(),e=e.toLowerCase(),!!(t=o.registry.typeMap_[t])&&!!t[e]},o.registry.getClass=function(t,e){return o.registry.getItem_(t,e)},o.registry.getObject=function(t,e){return o.registry.getItem_(t,e)},o.registry.getClassFromOptions=function(t,e){return"function"==typeof(e=e.plugins[t.toString()]||o.registry.DEFAULT)?e:o.registry.getClass(t,e)},o.utils={},o.utils.global=function(){return"object"==typeof self?self:"object"==typeof window?window:"object"==typeof V?V:this}(),o.Msg={},o.utils.global.Blockly||(o.utils.global.Blockly={}),o.utils.global.Blockly.Msg||(o.utils.global.Blockly.Msg=o.Msg),o.utils.colour={},o.utils.colour.parse=function(t){t=String(t).toLowerCase().trim();var e=o.utils.colour.names[t];if(e)return e;if(e="#"==(e="0x"==t.substring(0,2)?"#"+t.substring(2):t)[0]?e:"#"+e,/^#[0-9a-f]{6}$/.test(e))return e;if(/^#[0-9a-f]{3}$/.test(e))return["#",e[1],e[1],e[2],e[2],e[3],e[3]].join("");var i=t.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);return i&&(t=Number(i[1]),e=Number(i[2]),i=Number(i[3]),0<=t&&256>t&&0<=e&&256>e&&0<=i&&256>i)?o.utils.colour.rgbToHex(t,e,i):null},o.utils.colour.rgbToHex=function(t,e,o){return e=t<<16|e<<8|o,16>t?"#"+(16777216|e).toString(16).substr(1):"#"+e.toString(16)},o.utils.colour.hexToRgb=function(t){return(t=o.utils.colour.parse(t))?[(t=parseInt(t.substr(1),16))>>16,t>>8&255,255&t]:[0,0,0]},o.utils.colour.hsvToHex=function(t,e,i){var n=0,r=0,s=0;if(0==e)s=r=n=i;else{var a=Math.floor(t/60),l=t/60-a;t=i*(1-e);var c=i*(1-e*l);switch(e=i*(1-e*(1-l)),a){case 1:n=c,r=i,s=t;break;case 2:n=t,r=i,s=e;break;case 3:n=t,r=c,s=i;break;case 4:n=e,r=t,s=i;break;case 5:n=i,r=t,s=c;break;case 6:case 0:n=i,r=e,s=t}}return o.utils.colour.rgbToHex(Math.floor(n),Math.floor(r),Math.floor(s))},o.utils.colour.blend=function(t,e,i){return(t=o.utils.colour.parse(t))&&(e=o.utils.colour.parse(e))?(t=o.utils.colour.hexToRgb(t),e=o.utils.colour.hexToRgb(e),o.utils.colour.rgbToHex(Math.round(e[0]+i*(t[0]-e[0])),Math.round(e[1]+i*(t[1]-e[1])),Math.round(e[2]+i*(t[2]-e[2])))):null},o.utils.colour.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},o.utils.Coordinate=function(t,e){this.x=t,this.y=e},o.utils.Coordinate.equals=function(t,e){return t==e||!(!t||!e)&&t.x==e.x&&t.y==e.y},o.utils.Coordinate.distance=function(t,e){var o=t.x-e.x;return t=t.y-e.y,Math.sqrt(o*o+t*t)},o.utils.Coordinate.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},o.utils.Coordinate.difference=function(t,e){return new o.utils.Coordinate(t.x-e.x,t.y-e.y)},o.utils.Coordinate.sum=function(t,e){return new o.utils.Coordinate(t.x+e.x,t.y+e.y)},o.utils.Coordinate.prototype.scale=function(t){return this.x*=t,this.y*=t,this},o.utils.Coordinate.prototype.translate=function(t,e){return this.x+=t,this.y+=e,this},o.utils.Rect=function(t,e,o,i){this.top=t,this.bottom=e,this.left=o,this.right=i},o.utils.Rect.prototype.contains=function(t,e){return t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom},o.utils.string={},o.utils.string.startsWith=function(t,e){return 0==t.lastIndexOf(e,0)},o.utils.string.shortestStringLength=function(t){return t.length?t.reduce((function(t,e){return t.length<e.length?t:e})).length:0},o.utils.string.commonWordPrefix=function(t,e){if(!t.length)return 0;if(1==t.length)return t[0].length;var i=0;e=e||o.utils.string.shortestStringLength(t);for(var n=0;n<e;n++){for(var r=t[0][n],s=1;s<t.length;s++)if(r!=t[s][n])return i;" "==r&&(i=n+1)}for(s=1;s<t.length;s++)if((r=t[s][n])&&" "!=r)return i;return e},o.utils.string.commonWordSuffix=function(t,e){if(!t.length)return 0;if(1==t.length)return t[0].length;var i=0;e=e||o.utils.string.shortestStringLength(t);for(var n=0;n<e;n++){for(var r=t[0].substr(-n-1,1),s=1;s<t.length;s++)if(r!=t[s].substr(-n-1,1))return i;" "==r&&(i=n+1)}for(s=1;s<t.length;s++)if((r=t[s].charAt(t[s].length-n-1))&&" "!=r)return i;return e},o.utils.string.wrap=function(t,e){t=t.split("\n");for(var i=0;i<t.length;i++)t[i]=o.utils.string.wrapLine_(t[i],e);return t.join("\n")},o.utils.string.wrapLine_=function(t,e){if(t.length<=e)return t;for(var i=t.trim().split(/\s+/),n=0;n<i.length;n++)i[n].length>e&&(e=i[n].length);n=-1/0;var r=1;do{var s=n,a=t;t=[];var l=i.length/r,c=1;for(n=0;n<i.length-1;n++)c<(n+1.5)/l?(c++,t[n]=!0):t[n]=!1;t=o.utils.string.wrapMutate_(i,t,e),n=o.utils.string.wrapScore_(i,t,e),t=o.utils.string.wrapToText_(i,t),r++}while(n>s);return a},o.utils.string.wrapScore_=function(t,e,o){for(var i=[0],n=[],r=0;r<t.length;r++)i[i.length-1]+=t[r].length,!0===e[r]?(i.push(0),n.push(t[r].charAt(t[r].length-1))):!1===e[r]&&i[i.length-1]++;for(t=Math.max.apply(Math,i),r=e=0;r<i.length;r++)e-=2*Math.pow(Math.abs(o-i[r]),1.5),e-=Math.pow(t-i[r],1.5),-1!=".?!".indexOf(n[r])?e+=o/3:-1!=",;)]}".indexOf(n[r])&&(e+=o/4);return 1<i.length&&i[i.length-1]<=i[i.length-2]&&(e+=.5),e},o.utils.string.wrapMutate_=function(t,e,i){for(var n,r=o.utils.string.wrapScore_(t,e,i),s=0;s<e.length-1;s++)if(e[s]!=e[s+1]){var a=[].concat(e);a[s]=!a[s],a[s+1]=!a[s+1];var l=o.utils.string.wrapScore_(t,a,i);l>r&&(r=l,n=a)}return n?o.utils.string.wrapMutate_(t,n,i):e},o.utils.string.wrapToText_=function(t,e){for(var o=[],i=0;i<t.length;i++)o.push(t[i]),void 0!==e[i]&&o.push(e[i]?"\n":" ");return o.join("")},o.utils.Size=function(t,e){this.width=t,this.height=e},o.utils.Size.equals=function(t,e){return t==e||!(!t||!e)&&t.width==e.width&&t.height==e.height},o.utils.style={},o.utils.style.getSize=function(t){if("none"!=o.utils.style.getStyle_(t,"display"))return o.utils.style.getSizeWithDisplay_(t);var e=t.style,i=e.display,n=e.visibility,r=e.position;e.visibility="hidden",e.position="absolute",e.display="inline";var s=t.offsetWidth;return t=t.offsetHeight,e.display=i,e.position=r,e.visibility=n,new o.utils.Size(s,t)},o.utils.style.getSizeWithDisplay_=function(t){return new o.utils.Size(t.offsetWidth,t.offsetHeight)},o.utils.style.getStyle_=function(t,e){return o.utils.style.getComputedStyle(t,e)||o.utils.style.getCascadedStyle(t,e)||t.style&&t.style[e]},o.utils.style.getComputedStyle=function(t,e){return document.defaultView&&document.defaultView.getComputedStyle&&(t=document.defaultView.getComputedStyle(t,null))&&(t[e]||t.getPropertyValue(e))||""},o.utils.style.getCascadedStyle=function(t,e){return t.currentStyle?t.currentStyle[e]:null},o.utils.style.getPageOffset=function(t){var e=new o.utils.Coordinate(0,0);t=t.getBoundingClientRect();var i=document.documentElement;return i=new o.utils.Coordinate(window.pageXOffset||i.scrollLeft,window.pageYOffset||i.scrollTop),e.x=t.left+i.x,e.y=t.top+i.y,e},o.utils.style.getViewportPageOffset=function(){var t=document.body,e=document.documentElement;return new o.utils.Coordinate(t.scrollLeft||e.scrollLeft,t.scrollTop||e.scrollTop)},o.utils.style.setElementShown=function(t,e){t.style.display=e?"":"none"},o.utils.style.isRightToLeft=function(t){return"rtl"==o.utils.style.getStyle_(t,"direction")},o.utils.style.getBorderBox=function(t){var e=o.utils.style.getComputedStyle(t,"borderLeftWidth"),i=o.utils.style.getComputedStyle(t,"borderRightWidth"),n=o.utils.style.getComputedStyle(t,"borderTopWidth");return t=o.utils.style.getComputedStyle(t,"borderBottomWidth"),{top:parseFloat(n),right:parseFloat(i),bottom:parseFloat(t),left:parseFloat(e)}},o.utils.style.scrollIntoContainerView=function(t,e,i){t=o.utils.style.getContainerOffsetToScrollInto(t,e,i),e.scrollLeft=t.x,e.scrollTop=t.y},o.utils.style.getContainerOffsetToScrollInto=function(t,e,i){var n=o.utils.style.getPageOffset(t),r=o.utils.style.getPageOffset(e),s=o.utils.style.getBorderBox(e),a=n.x-r.x-s.left;return n=n.y-r.y-s.top,r=o.utils.style.getSizeWithDisplay_(t),t=e.clientWidth-r.width,r=e.clientHeight-r.height,s=e.scrollLeft,e=e.scrollTop,i?(s+=a-t/2,e+=n-r/2):(s+=Math.min(a,Math.max(a-t,0)),e+=Math.min(n,Math.max(n-r,0))),new o.utils.Coordinate(s,e)},o.utils.userAgent={},function(t){function e(t){return-1!=i.indexOf(t.toUpperCase())}o.utils.userAgent.raw=t;var i=o.utils.userAgent.raw.toUpperCase();o.utils.userAgent.IE=e("Trident")||e("MSIE"),o.utils.userAgent.EDGE=e("Edge"),o.utils.userAgent.JAVA_FX=e("JavaFX"),o.utils.userAgent.CHROME=(e("Chrome")||e("CriOS"))&&!o.utils.userAgent.EDGE,o.utils.userAgent.WEBKIT=e("WebKit")&&!o.utils.userAgent.EDGE,o.utils.userAgent.GECKO=e("Gecko")&&!o.utils.userAgent.WEBKIT&&!o.utils.userAgent.IE&&!o.utils.userAgent.EDGE,o.utils.userAgent.ANDROID=e("Android"),o.utils.userAgent.IPAD=e("iPad"),o.utils.userAgent.IPOD=e("iPod"),o.utils.userAgent.IPHONE=e("iPhone")&&!o.utils.userAgent.IPAD&&!o.utils.userAgent.IPOD,o.utils.userAgent.MAC=e("Macintosh"),o.utils.userAgent.TABLET=o.utils.userAgent.IPAD||o.utils.userAgent.ANDROID&&!e("Mobile")||e("Silk"),o.utils.userAgent.MOBILE=!o.utils.userAgent.TABLET&&(o.utils.userAgent.IPOD||o.utils.userAgent.IPHONE||o.utils.userAgent.ANDROID||e("IEMobile"))}(o.utils.global.navigator&&o.utils.global.navigator.userAgent||""),o.utils.noEvent=function(t){t.preventDefault(),t.stopPropagation()},o.utils.isTargetInput=function(t){return"textarea"==t.target.type||"text"==t.target.type||"number"==t.target.type||"email"==t.target.type||"password"==t.target.type||"search"==t.target.type||"tel"==t.target.type||"url"==t.target.type||t.target.isContentEditable||t.target.dataset&&"true"==t.target.dataset.isTextInput},o.utils.getRelativeXY=function(t){var e=new o.utils.Coordinate(0,0),i=t.getAttribute("x");return i&&(e.x=parseInt(i,10)),(i=t.getAttribute("y"))&&(e.y=parseInt(i,10)),(i=(i=t.getAttribute("transform"))&&i.match(o.utils.getRelativeXY.XY_REGEX_))&&(e.x+=Number(i[1]),i[3]&&(e.y+=Number(i[3]))),(t=t.getAttribute("style"))&&-1<t.indexOf("translate")&&(t=t.match(o.utils.getRelativeXY.XY_STYLE_REGEX_))&&(e.x+=Number(t[1]),t[3]&&(e.y+=Number(t[3]))),e},o.utils.getInjectionDivXY_=function(t){for(var e=0,i=0;t;){var n=o.utils.getRelativeXY(t);if(e+=n.x,i+=n.y,-1!=(" "+(t.getAttribute("class")||"")+" ").indexOf(" injectionDiv "))break;t=t.parentNode}return new o.utils.Coordinate(e,i)},o.utils.getRelativeXY.XY_REGEX_=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/,o.utils.getRelativeXY.XY_STYLE_REGEX_=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/,o.utils.isRightButton=function(t){return!(!t.ctrlKey||!o.utils.userAgent.MAC)||2==t.button},o.utils.mouseToSvg=function(t,e,o){var i=e.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,o||(o=e.getScreenCTM().inverse()),i.matrixTransform(o)},o.utils.getScrollDeltaPixels=function(t){switch(t.deltaMode){default:return{x:t.deltaX,y:t.deltaY};case 1:return{x:t.deltaX*o.LINE_MODE_MULTIPLIER,y:t.deltaY*o.LINE_MODE_MULTIPLIER};case 2:return{x:t.deltaX*o.PAGE_MODE_MULTIPLIER,y:t.deltaY*o.PAGE_MODE_MULTIPLIER}}},o.utils.tokenizeInterpolation=function(t){return o.utils.tokenizeInterpolation_(t,!0)},o.utils.replaceMessageReferences=function(t){return"string"!=typeof t?t:(t=o.utils.tokenizeInterpolation_(t,!1)).length?String(t[0]):""},o.utils.checkMessageReferences=function(t){for(var e=!0,i=o.Msg,n=t.match(/%{BKY_[A-Z]\w*}/gi),r=0;r<n.length;r++)null==i[n[r].toUpperCase().slice(6,-1)]&&(console.warn("No message string for "+n[r]+" in "+t),e=!1);return e},o.utils.tokenizeInterpolation_=function(t,e){var i=[],n=t.split("");n.push("");var r=0;t=[];for(var s=null,a=0;a<n.length;a++){var l=n[a];0==r?"%"==l?((l=t.join(""))&&i.push(l),t.length=0,r=1):t.push(l):1==r?"%"==l?(t.push(l),r=0):e&&"0"<=l&&"9">=l?(r=2,s=l,(l=t.join(""))&&i.push(l),t.length=0):"{"==l?r=3:(t.push("%",l),r=0):2==r?"0"<=l&&"9">=l?s+=l:(i.push(parseInt(s,10)),a--,r=0):3==r&&(""==l?(t.splice(0,0,"%{"),a--,r=0):"}"!=l?t.push(l):(r=t.join(""),/[A-Z]\w*/i.test(r)?(l=r.toUpperCase(),(l=o.utils.string.startsWith(l,"BKY_")?l.substring(4):null)&&l in o.Msg?"string"==typeof(r=o.Msg[l])?Array.prototype.push.apply(i,o.utils.tokenizeInterpolation_(r,e)):e?i.push(String(r)):i.push(r):i.push("%{"+r+"}")):i.push("%{"+r+"}"),r=t.length=0))}for((l=t.join(""))&&i.push(l),e=[],a=t.length=0;a<i.length;++a)"string"==typeof i[a]?t.push(i[a]):((l=t.join(""))&&e.push(l),t.length=0,e.push(i[a]));return(l=t.join(""))&&e.push(l),t.length=0,e},o.utils.genUid=function(){for(var t=o.utils.genUid.soup_.length,e=[],i=0;20>i;i++)e[i]=o.utils.genUid.soup_.charAt(Math.random()*t);return e.join("")},o.utils.genUid.soup_="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o.utils.is3dSupported=function(){if(void 0!==o.utils.is3dSupported.cached_)return o.utils.is3dSupported.cached_;if(!o.utils.global.getComputedStyle)return!1;var t=document.createElement("p"),e="none",i={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(var n in document.body.insertBefore(t,null),i)if(void 0!==t.style[n]){if(t.style[n]="translate3d(1px,1px,1px)",!(e=o.utils.global.getComputedStyle(t)))return document.body.removeChild(t),!1;e=e.getPropertyValue(i[n])}return document.body.removeChild(t),o.utils.is3dSupported.cached_="none"!==e,o.utils.is3dSupported.cached_},o.utils.runAfterPageLoad=function(t){if("object"!=typeof document)throw Error("Blockly.utils.runAfterPageLoad() requires browser document.");if("complete"==document.readyState)t();else var e=setInterval((function(){"complete"==document.readyState&&(clearInterval(e),t())}),10)},o.utils.getViewportBBox=function(){var t=o.utils.style.getViewportPageOffset();return new o.utils.Rect(t.y,document.documentElement.clientHeight+t.y,t.x,document.documentElement.clientWidth+t.x)},o.utils.arrayRemove=function(t,e){return-1!=(e=t.indexOf(e))&&(t.splice(e,1),!0)},o.utils.getDocumentScroll=function(){var t=document.documentElement,e=window;return o.utils.userAgent.IE&&e.pageYOffset!=t.scrollTop?new o.utils.Coordinate(t.scrollLeft,t.scrollTop):new o.utils.Coordinate(e.pageXOffset||t.scrollLeft,e.pageYOffset||t.scrollTop)},o.utils.getBlockTypeCounts=function(t,e){var o=Object.create(null),i=t.getDescendants(!0);for(e&&(t=t.getNextBlock())&&(t=i.indexOf(t),i.splice(t,i.length-t)),t=0;e=i[t];t++)o[e.type]?o[e.type]++:o[e.type]=1;return o},o.utils.screenToWsCoordinates=function(t,e){var i=e.x;e=e.y;var n=t.getInjectionDiv().getBoundingClientRect();return i=new o.utils.Coordinate(i-n.left,e-n.top),e=t.getOriginOffsetInPixels(),o.utils.Coordinate.difference(i,e).scale(1/t.scale)},o.utils.parseBlockColour=function(t){var e="string"==typeof t?o.utils.replaceMessageReferences(t):t,i=Number(e);if(!isNaN(i)&&0<=i&&360>=i)return{hue:i,hex:o.utils.colour.hsvToHex(i,o.HSV_SATURATION,255*o.HSV_VALUE)};if(i=o.utils.colour.parse(e))return{hue:null,hex:i};throw i='Invalid colour: "'+e+'"',t!=e&&(i+=' (from "'+t+'")'),Error(i)},o.Events={},o.Events.group_="",o.Events.recordUndo=!0,o.Events.disabled_=0,o.Events.CREATE="create",o.Events.BLOCK_CREATE=o.Events.CREATE,o.Events.DELETE="delete",o.Events.BLOCK_DELETE=o.Events.DELETE,o.Events.CHANGE="change",o.Events.BLOCK_CHANGE=o.Events.CHANGE,o.Events.MOVE="move",o.Events.BLOCK_MOVE=o.Events.MOVE,o.Events.VAR_CREATE="var_create",o.Events.VAR_DELETE="var_delete",o.Events.VAR_RENAME="var_rename",o.Events.UI="ui",o.Events.BLOCK_DRAG="drag",o.Events.SELECTED="selected",o.Events.CLICK="click",o.Events.MARKER_MOVE="marker_move",o.Events.BUBBLE_OPEN="bubble_open",o.Events.TRASHCAN_OPEN="trashcan_open",o.Events.TOOLBOX_ITEM_SELECT="toolbox_item_select",o.Events.THEME_CHANGE="theme_change",o.Events.VIEWPORT_CHANGE="viewport_change",o.Events.COMMENT_CREATE="comment_create",o.Events.COMMENT_DELETE="comment_delete",o.Events.COMMENT_CHANGE="comment_change",o.Events.COMMENT_MOVE="comment_move",o.Events.FINISHED_LOADING="finished_loading",o.Events.BUMP_EVENTS=[o.Events.BLOCK_CREATE,o.Events.BLOCK_MOVE,o.Events.COMMENT_CREATE,o.Events.COMMENT_MOVE],o.Events.FIRE_QUEUE_=[],o.Events.fire=function(t){o.Events.isEnabled()&&(o.Events.FIRE_QUEUE_.length||setTimeout(o.Events.fireNow_,0),o.Events.FIRE_QUEUE_.push(t))},o.Events.fireNow_=function(){for(var t,e=o.Events.filter(o.Events.FIRE_QUEUE_,!0),i=o.Events.FIRE_QUEUE_.length=0;t=e[i];i++)if(t.workspaceId){var n=o.Workspace.getById(t.workspaceId);n&&n.fireChangeListener(t)}},o.Events.filter=function(t,e){t=t.slice(),e||t.reverse();for(var i,n=[],r=Object.create(null),s=0;i=t[s];s++)if(!i.isNull()){var a=[i.isUiEvent?o.Events.UI:i.type,i.blockId,i.workspaceId].join(" "),l=r[a],c=l?l.event:null;l?i.type==o.Events.MOVE&&l.index==s-1?(c.newParentId=i.newParentId,c.newInputName=i.newInputName,c.newCoordinate=i.newCoordinate,l.index=s):i.type==o.Events.CHANGE&&i.element==c.element&&i.name==c.name?c.newValue=i.newValue:i.type==o.Events.CLICK&&c.type==o.Events.BUBBLE_OPEN||(r[a]={event:i,index:s},n.push(i)):(r[a]={event:i,index:s},n.push(i))}for(t=n.filter((function(t){return!t.isNull()})),e||t.reverse(),s=1;i=t[s];s++)i.type==o.Events.CHANGE&&"mutation"==i.element&&t.unshift(t.splice(s,1)[0]);return t},o.Events.clearPendingUndo=function(){for(var t,e=0;t=o.Events.FIRE_QUEUE_[e];e++)t.recordUndo=!1},o.Events.disable=function(){o.Events.disabled_++},o.Events.enable=function(){o.Events.disabled_--},o.Events.isEnabled=function(){return 0==o.Events.disabled_},o.Events.getGroup=function(){return o.Events.group_},o.Events.setGroup=function(t){o.Events.group_="boolean"==typeof t?t?o.utils.genUid():"":t},o.Events.getDescendantIds=function(t){var e=[];t=t.getDescendants(!1);for(var o,i=0;o=t[i];i++)e[i]=o.id;return e},o.Events.fromJson=function(t,e){var i=o.registry.getClass(o.registry.Type.EVENT,t.type);if(!i)throw Error("Unknown event type.");return(i=new i).fromJson(t),i.workspaceId=e.id,i},o.Events.disableOrphans=function(t){if((t.type==o.Events.MOVE||t.type==o.Events.CREATE)&&t.workspaceId){var e=o.Workspace.getById(t.workspaceId),i=e.getBlockById(t.blockId);if(i){t=o.Events.recordUndo;try{o.Events.recordUndo=!1;var n=i.getParent();if(n&&n.isEnabled()){var r,s=i.getDescendants(!1);for(e=0;r=s[e];e++)r.setEnabled(!0)}else if((i.outputConnection||i.previousConnection)&&!e.isDragging())do{i.setEnabled(!1),i=i.getNextBlock()}while(i)}finally{o.Events.recordUndo=t}}}},o.Events.Abstract=function(){this.isBlank=null,this.workspaceId=void 0,this.group=o.Events.getGroup(),this.recordUndo=o.Events.recordUndo},o.Events.Abstract.prototype.isUiEvent=!1,o.Events.Abstract.prototype.toJson=function(){var t={type:this.type};return this.group&&(t.group=this.group),t},o.Events.Abstract.prototype.fromJson=function(t){this.isBlank=!1,this.group=t.group},o.Events.Abstract.prototype.isNull=function(){return!1},o.Events.Abstract.prototype.run=function(t){},o.Events.Abstract.prototype.getEventWorkspace_=function(){if(this.workspaceId)var t=o.Workspace.getById(this.workspaceId);if(!t)throw Error("Workspace is null. Event must have been generated from real Blockly events.");return t},o.utils.object={},o.utils.object.inherits=function(t,e){t.superClass_=e.prototype,t.prototype=Object.create(e.prototype),t.prototype.constructor=t},o.utils.object.mixin=function(t,e){for(var o in e)t[o]=e[o]},o.utils.object.deepMerge=function(t,e){for(var i in e)t[i]=null!=e[i]&&"object"==typeof e[i]?o.utils.object.deepMerge(t[i]||Object.create(null),e[i]):e[i];return t},o.utils.object.values=function(t){return Object.values?Object.values(t):Object.keys(t).map((function(e){return t[e]}))},o.Events.UiBase=function(t){o.Events.UiBase.superClass_.constructor.call(this),this.isBlank=void 0===t,this.workspaceId=t||"",this.recordUndo=!1},o.utils.object.inherits(o.Events.UiBase,o.Events.Abstract),o.Events.UiBase.prototype.isUiEvent=!0,o.Events.Ui=function(t,e,i,n){o.Events.Ui.superClass_.constructor.call(this,t?t.workspace.id:void 0),this.blockId=t?t.id:null,this.element=void 0===e?"":e,this.oldValue=void 0===i?"":i,this.newValue=void 0===n?"":n},o.utils.object.inherits(o.Events.Ui,o.Events.UiBase),o.Events.Ui.prototype.type=o.Events.UI,o.Events.Ui.prototype.toJson=function(){var t=o.Events.Ui.superClass_.toJson.call(this);return t.element=this.element,void 0!==this.newValue&&(t.newValue=this.newValue),this.blockId&&(t.blockId=this.blockId),t},o.Events.Ui.prototype.fromJson=function(t){o.Events.Ui.superClass_.fromJson.call(this,t),this.element=t.element,this.newValue=t.newValue,this.blockId=t.blockId},o.registry.register(o.registry.Type.EVENT,o.Events.UI,o.Events.Ui),o.utils.Svg=function(t){this.tagName_=t},o.utils.Svg.prototype.toString=function(){return this.tagName_},o.utils.Svg.ANIMATE=new o.utils.Svg("animate"),o.utils.Svg.CIRCLE=new o.utils.Svg("circle"),o.utils.Svg.CLIPPATH=new o.utils.Svg("clipPath"),o.utils.Svg.DEFS=new o.utils.Svg("defs"),o.utils.Svg.FECOMPOSITE=new o.utils.Svg("feComposite"),o.utils.Svg.FECOMPONENTTRANSFER=new o.utils.Svg("feComponentTransfer"),o.utils.Svg.FEFLOOD=new o.utils.Svg("feFlood"),o.utils.Svg.FEFUNCA=new o.utils.Svg("feFuncA"),o.utils.Svg.FEGAUSSIANBLUR=new o.utils.Svg("feGaussianBlur"),o.utils.Svg.FEPOINTLIGHT=new o.utils.Svg("fePointLight"),o.utils.Svg.FESPECULARLIGHTING=new o.utils.Svg("feSpecularLighting"),o.utils.Svg.FILTER=new o.utils.Svg("filter"),o.utils.Svg.FOREIGNOBJECT=new o.utils.Svg("foreignObject"),o.utils.Svg.G=new o.utils.Svg("g"),o.utils.Svg.IMAGE=new o.utils.Svg("image"),o.utils.Svg.LINE=new o.utils.Svg("line"),o.utils.Svg.PATH=new o.utils.Svg("path"),o.utils.Svg.PATTERN=new o.utils.Svg("pattern"),o.utils.Svg.POLYGON=new o.utils.Svg("polygon"),o.utils.Svg.RECT=new o.utils.Svg("rect"),o.utils.Svg.SVG=new o.utils.Svg("svg"),o.utils.Svg.TEXT=new o.utils.Svg("text"),o.utils.Svg.TSPAN=new o.utils.Svg("tspan"),o.utils.dom={},o.utils.dom.SVG_NS="http://www.w3.org/2000/svg",o.utils.dom.HTML_NS="http://www.w3.org/1999/xhtml",o.utils.dom.XLINK_NS="http://www.w3.org/1999/xlink",o.utils.dom.NodeType={ELEMENT_NODE:1,TEXT_NODE:3,COMMENT_NODE:8,DOCUMENT_POSITION_CONTAINED_BY:16},o.utils.dom.cacheWidths_=null,o.utils.dom.cacheReference_=0,o.utils.dom.canvasContext_=null,o.utils.dom.createSvgElement=function(t,e,i){for(var n in t=document.createElementNS(o.utils.dom.SVG_NS,String(t)),e)t.setAttribute(n,e[n]);return document.body.runtimeStyle&&(t.runtimeStyle=t.currentStyle=t.style),i&&i.appendChild(t),t},o.utils.dom.addClass=function(t,e){var o=t.getAttribute("class")||"";return-1==(" "+o+" ").indexOf(" "+e+" ")&&(o&&(o+=" "),t.setAttribute("class",o+e),!0)},o.utils.dom.removeClasses=function(t,e){e=e.split(" ");for(var i=0;i<e.length;i++)o.utils.dom.removeClass(t,e[i])},o.utils.dom.removeClass=function(t,e){var o=t.getAttribute("class");if(-1==(" "+o+" ").indexOf(" "+e+" "))return!1;o=o.split(/\s+/);for(var i=0;i<o.length;i++)o[i]&&o[i]!=e||(o.splice(i,1),i--);return o.length?t.setAttribute("class",o.join(" ")):t.removeAttribute("class"),!0},o.utils.dom.hasClass=function(t,e){return-1!=(" "+t.getAttribute("class")+" ").indexOf(" "+e+" ")},o.utils.dom.removeNode=function(t){return t&&t.parentNode?t.parentNode.removeChild(t):null},o.utils.dom.insertAfter=function(t,e){var o=e.nextSibling;if(!(e=e.parentNode))throw Error("Reference node has no parent.");o?e.insertBefore(t,o):e.appendChild(t)},o.utils.dom.containsNode=function(t,e){return!!(t.compareDocumentPosition(e)&o.utils.dom.NodeType.DOCUMENT_POSITION_CONTAINED_BY)},o.utils.dom.setCssTransform=function(t,e){t.style.transform=e,t.style["-webkit-transform"]=e},o.utils.dom.startTextWidthCache=function(){o.utils.dom.cacheReference_++,o.utils.dom.cacheWidths_||(o.utils.dom.cacheWidths_={})},o.utils.dom.stopTextWidthCache=function(){o.utils.dom.cacheReference_--,o.utils.dom.cacheReference_||(o.utils.dom.cacheWidths_=null)},o.utils.dom.getTextWidth=function(t){var e,i=t.textContent+"\n"+t.className.baseVal;if(o.utils.dom.cacheWidths_&&(e=o.utils.dom.cacheWidths_[i]))return e;try{e=o.utils.userAgent.IE||o.utils.userAgent.EDGE?t.getBBox().width:t.getComputedTextLength()}catch(e){return 8*t.textContent.length}return o.utils.dom.cacheWidths_&&(o.utils.dom.cacheWidths_[i]=e),e},o.utils.dom.getFastTextWidth=function(t,e,i,n){return o.utils.dom.getFastTextWidthWithSizeString(t,e+"pt",i,n)},o.utils.dom.getFastTextWidthWithSizeString=function(t,e,i,n){var r,s=t.textContent;return t=s+"\n"+t.className.baseVal,o.utils.dom.cacheWidths_&&(r=o.utils.dom.cacheWidths_[t])||(o.utils.dom.canvasContext_||((r=document.createElement("canvas")).className="blocklyComputeCanvas",o.shadowRoot?o.shadowRoot.appendChild(r):document.body.appendChild(r),o.utils.dom.canvasContext_=r.getContext("2d")),o.utils.dom.canvasContext_.font=i+" "+e+" "+n,r=o.utils.dom.canvasContext_.measureText(s).width,o.utils.dom.cacheWidths_&&(o.utils.dom.cacheWidths_[t]=r)),r},o.utils.dom.measureFontMetrics=function(t,e,o,i){var n=document.createElement("span");n.style.font=o+" "+e+" "+i,n.textContent=t,(t=document.createElement("div")).style.width="1px",t.style.height="0px",(e=document.createElement("div")).setAttribute("style","position: fixed; top: 0; left: 0; display: flex;"),e.appendChild(n),e.appendChild(t),document.body.appendChild(e);try{o={},e.style.alignItems="baseline",o.baseline=t.offsetTop-n.offsetTop,e.style.alignItems="flex-end",o.height=t.offsetTop-n.offsetTop}finally{document.body.removeChild(e)}return o},o.BlockDragSurfaceSvg=function(t){this.container_=t,this.createDom()},o.BlockDragSurfaceSvg.prototype.SVG_=null,o.BlockDragSurfaceSvg.prototype.dragGroup_=null,o.BlockDragSurfaceSvg.prototype.container_=null,o.BlockDragSurfaceSvg.prototype.scale_=1,o.BlockDragSurfaceSvg.prototype.surfaceXY_=null,o.BlockDragSurfaceSvg.prototype.createDom=function(){this.SVG_||(this.SVG_=o.utils.dom.createSvgElement(o.utils.Svg.SVG,{xmlns:o.utils.dom.SVG_NS,"xmlns:html":o.utils.dom.HTML_NS,"xmlns:xlink":o.utils.dom.XLINK_NS,version:"1.1",class:"blocklyBlockDragSurface"},this.container_),this.dragGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{},this.SVG_))},o.BlockDragSurfaceSvg.prototype.setBlocksAndShow=function(t){if(this.dragGroup_.childNodes.length)throw Error("Already dragging a block.");this.dragGroup_.appendChild(t),this.SVG_.style.display="block",this.surfaceXY_=new o.utils.Coordinate(0,0)},o.BlockDragSurfaceSvg.prototype.translateAndScaleGroup=function(t,e,o){this.scale_=o,t=t.toFixed(0),e=e.toFixed(0),this.dragGroup_.setAttribute("transform","translate("+t+","+e+") scale("+o+")")},o.BlockDragSurfaceSvg.prototype.translateSurfaceInternal_=function(){var t=this.surfaceXY_.x,e=this.surfaceXY_.y;t=t.toFixed(0),e=e.toFixed(0),this.SVG_.style.display="block",o.utils.dom.setCssTransform(this.SVG_,"translate3d("+t+"px, "+e+"px, 0px)")},o.BlockDragSurfaceSvg.prototype.translateSurface=function(t,e){this.surfaceXY_=new o.utils.Coordinate(t*this.scale_,e*this.scale_),this.translateSurfaceInternal_()},o.BlockDragSurfaceSvg.prototype.getSurfaceTranslation=function(){var t=o.utils.getRelativeXY(this.SVG_);return new o.utils.Coordinate(t.x/this.scale_,t.y/this.scale_)},o.BlockDragSurfaceSvg.prototype.getGroup=function(){return this.dragGroup_},o.BlockDragSurfaceSvg.prototype.getCurrentBlock=function(){return this.dragGroup_.firstChild},o.BlockDragSurfaceSvg.prototype.clearAndHide=function(t){if(t?t.appendChild(this.getCurrentBlock()):this.dragGroup_.removeChild(this.getCurrentBlock()),this.SVG_.style.display="none",this.dragGroup_.childNodes.length)throw Error("Drag group was not cleared.");this.surfaceXY_=null},o.Css={},o.Css.injected_=!1,o.Css.register=function(t){if(o.Css.injected_)throw Error("CSS already injected");Array.prototype.push.apply(o.Css.CONTENT,t),t.length=0},o.Css.inject=function(t,e){if(!o.Css.injected_){o.Css.injected_=!0;var i=o.Css.CONTENT.join("\n");o.Css.CONTENT.length=0,t&&(t=e.replace(/[\\/]$/,""),i=i.replace(/<<<PATH>>>/g,t),(t=document.createElement("style")).id="blockly-common-style",i=document.createTextNode(i),t.appendChild(i),o.shadowRoot?o.shadowRoot.appendChild(t):document.head.insertBefore(t,document.head.firstChild))}},o.Css.CONTENT=[".blocklySvg {","background-color: #fff;","outline: none;","overflow: hidden;","position: absolute;","display: block;","}",".blocklyWidgetDiv {","display: none;","position: absolute;","z-index: 99999;","}",".injectionDiv {","height: 100%;","position: relative;","overflow: hidden;","touch-action: none;","}",".blocklyNonSelectable {","user-select: none;","-ms-user-select: none;","-webkit-user-select: none;","}",".blocklyWsDragSurface {","display: none;","position: absolute;","top: 0;","left: 0;","}",".blocklyWsDragSurface.blocklyOverflowVisible {","overflow: visible;","}",".blocklyBlockDragSurface {","display: none;","position: absolute;","top: 0;","left: 0;","right: 0;","bottom: 0;","overflow: visible !important;","z-index: 50;","}",".blocklyBlockCanvas.blocklyCanvasTransitioning,",".blocklyBubbleCanvas.blocklyCanvasTransitioning {","transition: transform .5s;","}",".blocklyTooltipDiv {","background-color: #ffffc7;","border: 1px solid #ddc;","box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);","color: #000;","display: none;","font: 9pt sans-serif;","opacity: .9;","padding: 2px;","position: absolute;","z-index: 100000;","}",".blocklyDropDownDiv {","position: absolute;","left: 0;","top: 0;","z-index: 1000;","display: none;","border: 1px solid;","border-color: #dadce0;","background-color: #fff;","border-radius: 2px;","padding: 4px;","box-shadow: 0 0 3px 1px rgba(0,0,0,.3);","}",".blocklyDropDownDiv.blocklyFocused {","box-shadow: 0 0 6px 1px rgba(0,0,0,.3);","}",".blocklyDropDownContent {","max-height: 300px;","overflow: auto;","overflow-x: hidden;","position: relative;","}",".blocklyDropDownArrow {","position: absolute;","left: 0;","top: 0;","width: 16px;","height: 16px;","z-index: -1;","background-color: inherit;","border-color: inherit;","}",".blocklyDropDownButton {","display: inline-block;","float: left;","padding: 0;","margin: 4px;","border-radius: 4px;","outline: none;","border: 1px solid;","transition: box-shadow .1s;","cursor: pointer;","}",".blocklyArrowTop {","border-top: 1px solid;","border-left: 1px solid;","border-top-left-radius: 4px;","border-color: inherit;","}",".blocklyArrowBottom {","border-bottom: 1px solid;","border-right: 1px solid;","border-bottom-right-radius: 4px;","border-color: inherit;","}",".blocklyResizeSE {","cursor: se-resize;","fill: #aaa;","}",".blocklyResizeSW {","cursor: sw-resize;","fill: #aaa;","}",".blocklyResizeLine {","stroke: #515A5A;","stroke-width: 1;","}",".blocklyHighlightedConnectionPath {","fill: none;","stroke: #fc3;","stroke-width: 4px;","}",".blocklyPathLight {","fill: none;","stroke-linecap: round;","stroke-width: 1;","}",".blocklySelected>.blocklyPathLight {","display: none;","}",".blocklyDraggable {",'cursor: url("<<<PATH>>>/handopen.cur"), auto;',"cursor: grab;","cursor: -webkit-grab;","}",".blocklyDragging {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyDraggable:active {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyBlockDragSurface .blocklyDraggable {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyDragging.blocklyDraggingDelete {",'cursor: url("<<<PATH>>>/handdelete.cur"), auto;',"}",".blocklyDragging>.blocklyPath,",".blocklyDragging>.blocklyPathLight {","fill-opacity: .8;","stroke-opacity: .8;","}",".blocklyDragging>.blocklyPathDark {","display: none;","}",".blocklyDisabled>.blocklyPath {","fill-opacity: .5;","stroke-opacity: .5;","}",".blocklyDisabled>.blocklyPathLight,",".blocklyDisabled>.blocklyPathDark {","display: none;","}",".blocklyInsertionMarker>.blocklyPath,",".blocklyInsertionMarker>.blocklyPathLight,",".blocklyInsertionMarker>.blocklyPathDark {","fill-opacity: .2;","stroke: none;","}",".blocklyMultilineText {","font-family: monospace;","}",".blocklyNonEditableText>text {","pointer-events: none;","}",".blocklyFlyout {","position: absolute;","z-index: 20;","}",".blocklyText text {","cursor: default;","}",".blocklySvg text,",".blocklyBlockDragSurface text {","user-select: none;","-ms-user-select: none;","-webkit-user-select: none;","cursor: inherit;","}",".blocklyHidden {","display: none;","}",".blocklyFieldDropdown:not(.blocklyHidden) {","display: block;","}",".blocklyIconGroup {","cursor: default;","}",".blocklyIconGroup:not(:hover),",".blocklyIconGroupReadonly {","opacity: .6;","}",".blocklyIconShape {","fill: #00f;","stroke: #fff;","stroke-width: 1px;","}",".blocklyIconSymbol {","fill: #fff;","}",".blocklyMinimalBody {","margin: 0;","padding: 0;","}",".blocklyHtmlInput {","border: none;","border-radius: 4px;","height: 100%;","margin: 0;","outline: none;","padding: 0;","width: 100%;","text-align: center;","display: block;","box-sizing: border-box;","}",".blocklyHtmlInput::-ms-clear {","display: none;","}",".blocklyMainBackground {","stroke-width: 1;","stroke: #c6c6c6;","}",".blocklyMutatorBackground {","fill: #fff;","stroke: #ddd;","stroke-width: 1;","}",".blocklyFlyoutBackground {","fill: #ddd;","fill-opacity: .8;","}",".blocklyMainWorkspaceScrollbar {","z-index: 20;","}",".blocklyFlyoutScrollbar {","z-index: 30;","}",".blocklyScrollbarHorizontal,",".blocklyScrollbarVertical {","position: absolute;","outline: none;","}",".blocklyScrollbarBackground {","opacity: 0;","}",".blocklyScrollbarHandle {","fill: #ccc;","}",".blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,",".blocklyScrollbarHandle:hover {","fill: #bbb;","}",".blocklyFlyout .blocklyScrollbarHandle {","fill: #bbb;","}",".blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,",".blocklyFlyout .blocklyScrollbarHandle:hover {","fill: #aaa;","}",".blocklyInvalidInput {","background: #faa;","}",".blocklyVerticalMarker {","stroke-width: 3px;","fill: rgba(255,255,255,.5);","pointer-events: none;","}",".blocklyComputeCanvas {","position: absolute;","width: 0;","height: 0;","}",".blocklyNoPointerEvents {","pointer-events: none;","}",".blocklyContextMenu {","border-radius: 4px;","max-height: 100%;","}",".blocklyDropdownMenu {","border-radius: 2px;","padding: 0 !important;","}",".blocklyDropdownMenu .blocklyMenuItem {","padding-left: 28px;","}",".blocklyDropdownMenu .blocklyMenuItemRtl {","padding-left: 5px;","padding-right: 28px;","}",".blocklyWidgetDiv .blocklyMenu {","background: #fff;","border: 1px solid transparent;","box-shadow: 0 0 3px 1px rgba(0,0,0,.3);","font: normal 13px Arial, sans-serif;","margin: 0;","outline: none;","padding: 4px 0;","position: absolute;","overflow-y: auto;","overflow-x: hidden;","max-height: 100%;","z-index: 20000;","}",".blocklyWidgetDiv .blocklyMenu.blocklyFocused {","box-shadow: 0 0 6px 1px rgba(0,0,0,.3);","}",".blocklyDropDownDiv .blocklyMenu {","background: inherit;","border: inherit;",'font: normal 13px "Helvetica Neue", Helvetica, sans-serif;',"outline: none;","position: relative;","z-index: 20000;","}",".blocklyMenuItem {","border: none;","color: #000;","cursor: pointer;","list-style: none;","margin: 0;","min-width: 7em;","padding: 6px 15px;","white-space: nowrap;","}",".blocklyMenuItemDisabled {","color: #ccc;","cursor: inherit;","}",".blocklyMenuItemHighlight {","background-color: rgba(0,0,0,.1);","}",".blocklyMenuItemCheckbox {","height: 16px;","position: absolute;","width: 16px;","}",".blocklyMenuItemSelected .blocklyMenuItemCheckbox {","background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;","float: left;","margin-left: -24px;","position: static;","}",".blocklyMenuItemRtl .blocklyMenuItemCheckbox {","float: right;","margin-right: -24px;","}"],o.utils.math={},o.utils.math.toRadians=function(t){return t*Math.PI/180},o.utils.math.toDegrees=function(t){return 180*t/Math.PI},o.utils.math.clamp=function(t,e,o){if(o<t){var i=o;o=t,t=i}return Math.max(t,Math.min(e,o))},o.DropDownDiv=function(){},o.DropDownDiv.boundsElement_=null,o.DropDownDiv.owner_=null,o.DropDownDiv.positionToField_=null,o.DropDownDiv.ARROW_SIZE=16,o.DropDownDiv.BORDER_SIZE=1,o.DropDownDiv.ARROW_HORIZONTAL_PADDING=12,o.DropDownDiv.PADDING_Y=16,o.DropDownDiv.ANIMATION_TIME=.25,o.DropDownDiv.animateOutTimer_=null,o.DropDownDiv.onHide_=null,o.DropDownDiv.rendererClassName_="",o.DropDownDiv.themeClassName_="",o.DropDownDiv.createDom=function(){if(!o.DropDownDiv.DIV_){var t=document.createElement("div");t.className="blocklyDropDownDiv",(o.parentContainer||o.shadowRoot||document.body).appendChild(t),o.DropDownDiv.DIV_=t;var e=document.createElement("div");e.className="blocklyDropDownContent",t.appendChild(e),o.DropDownDiv.content_=e,(e=document.createElement("div")).className="blocklyDropDownArrow",t.appendChild(e),o.DropDownDiv.arrow_=e,o.DropDownDiv.DIV_.style.opacity=0,o.DropDownDiv.DIV_.style.transition="transform "+o.DropDownDiv.ANIMATION_TIME+"s, opacity "+o.DropDownDiv.ANIMATION_TIME+"s",t.addEventListener("focusin",(function(){o.utils.dom.addClass(t,"blocklyFocused")})),t.addEventListener("focusout",(function(){o.utils.dom.removeClass(t,"blocklyFocused")}))}},o.DropDownDiv.setBoundsElement=function(t){o.DropDownDiv.boundsElement_=t},o.DropDownDiv.getContentDiv=function(){return o.DropDownDiv.content_},o.DropDownDiv.clearContent=function(){o.DropDownDiv.content_.textContent="",o.DropDownDiv.content_.style.width=""},o.DropDownDiv.setColour=function(t,e){o.DropDownDiv.DIV_.style.backgroundColor=t,o.DropDownDiv.DIV_.style.borderColor=e},o.DropDownDiv.showPositionedByBlock=function(t,e,i,n){return o.DropDownDiv.showPositionedByRect_(o.DropDownDiv.getScaledBboxOfBlock_(e),t,i,n)},o.DropDownDiv.showPositionedByField=function(t,e,i){return o.DropDownDiv.positionToField_=!0,o.DropDownDiv.showPositionedByRect_(o.DropDownDiv.getScaledBboxOfField_(t),t,e,i)},o.DropDownDiv.getScaledBboxOfBlock_=function(t){var e=t.getSvgRoot(),i=e.getBBox(),n=t.workspace.scale;return t=i.height*n,i=i.width*n,e=o.utils.style.getPageOffset(e),new o.utils.Rect(e.y,e.y+t,e.x,e.x+i)},o.DropDownDiv.getScaledBboxOfField_=function(t){return t=t.getScaledBBox(),new o.utils.Rect(t.top,t.bottom,t.left,t.right)},o.DropDownDiv.showPositionedByRect_=function(t,e,i,n){var r=t.left+(t.right-t.left)/2,s=t.bottom;t=t.top,n&&(t+=n);for(var a=(n=e.getSourceBlock()).workspace;a.options.parentWorkspace;)a=a.options.parentWorkspace;return o.DropDownDiv.setBoundsElement(a.getParentSvg().parentNode),o.DropDownDiv.show(e,n.RTL,r,s,r,t,i)},o.DropDownDiv.show=function(t,e,i,n,r,s,a){return o.DropDownDiv.owner_=t,o.DropDownDiv.onHide_=a||null,(t=o.DropDownDiv.DIV_).style.direction=e?"rtl":"ltr",e=o.getMainWorkspace(),o.DropDownDiv.rendererClassName_=e.getRenderer().getClassName(),o.DropDownDiv.themeClassName_=e.getTheme().getClassName(),o.utils.dom.addClass(t,o.DropDownDiv.rendererClassName_),o.utils.dom.addClass(t,o.DropDownDiv.themeClassName_),o.DropDownDiv.positionInternal_(i,n,r,s)},o.DropDownDiv.getBoundsInfo_=function(){var t=o.utils.style.getPageOffset(o.DropDownDiv.boundsElement_),e=o.utils.style.getSize(o.DropDownDiv.boundsElement_);return{left:t.x,right:t.x+e.width,top:t.y,bottom:t.y+e.height,width:e.width,height:e.height}},o.DropDownDiv.getPositionMetrics_=function(t,e,i,n){var r=o.DropDownDiv.getBoundsInfo_(),s=o.utils.style.getSize(o.DropDownDiv.DIV_);return e+s.height<r.bottom?o.DropDownDiv.getPositionBelowMetrics_(t,e,r,s):n-s.height>r.top?o.DropDownDiv.getPositionAboveMetrics_(i,n,r,s):e+s.height<document.documentElement.clientHeight?o.DropDownDiv.getPositionBelowMetrics_(t,e,r,s):n-s.height>document.documentElement.clientTop?o.DropDownDiv.getPositionAboveMetrics_(i,n,r,s):o.DropDownDiv.getPositionTopOfPageMetrics_(t,r,s)},o.DropDownDiv.getPositionBelowMetrics_=function(t,e,i,n){return{initialX:(t=o.DropDownDiv.getPositionX(t,i.left,i.right,n.width)).divX,initialY:e,finalX:t.divX,finalY:e+o.DropDownDiv.PADDING_Y,arrowX:t.arrowX,arrowY:-(o.DropDownDiv.ARROW_SIZE/2+o.DropDownDiv.BORDER_SIZE),arrowAtTop:!0,arrowVisible:!0}},o.DropDownDiv.getPositionAboveMetrics_=function(t,e,i,n){return{initialX:(t=o.DropDownDiv.getPositionX(t,i.left,i.right,n.width)).divX,initialY:e-n.height,finalX:t.divX,finalY:e-n.height-o.DropDownDiv.PADDING_Y,arrowX:t.arrowX,arrowY:n.height-2*o.DropDownDiv.BORDER_SIZE-o.DropDownDiv.ARROW_SIZE/2,arrowAtTop:!1,arrowVisible:!0}},o.DropDownDiv.getPositionTopOfPageMetrics_=function(t,e,i){return{initialX:(t=o.DropDownDiv.getPositionX(t,e.left,e.right,i.width)).divX,initialY:0,finalX:t.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},o.DropDownDiv.getPositionX=function(t,e,i,n){var r=t;return t=o.utils.math.clamp(e,t-n/2,i-n),r-=o.DropDownDiv.ARROW_SIZE/2,e=o.DropDownDiv.ARROW_HORIZONTAL_PADDING,{arrowX:n=o.utils.math.clamp(e,r-t,n-e-o.DropDownDiv.ARROW_SIZE),divX:t}},o.DropDownDiv.isVisible=function(){return!!o.DropDownDiv.owner_},o.DropDownDiv.hideIfOwner=function(t,e){return o.DropDownDiv.owner_===t&&(e?o.DropDownDiv.hideWithoutAnimation():o.DropDownDiv.hide(),!0)},o.DropDownDiv.hide=function(){var t=o.DropDownDiv.DIV_;t.style.transform="translate(0, 0)",t.style.opacity=0,o.DropDownDiv.animateOutTimer_=setTimeout((function(){o.DropDownDiv.hideWithoutAnimation()}),1e3*o.DropDownDiv.ANIMATION_TIME),o.DropDownDiv.onHide_&&(o.DropDownDiv.onHide_(),o.DropDownDiv.onHide_=null)},o.DropDownDiv.hideWithoutAnimation=function(){if(o.DropDownDiv.isVisible()){o.DropDownDiv.animateOutTimer_&&clearTimeout(o.DropDownDiv.animateOutTimer_);var t=o.DropDownDiv.DIV_;t.style.transform="",t.style.left="",t.style.top="",t.style.opacity=0,t.style.display="none",t.style.backgroundColor="",t.style.borderColor="",o.DropDownDiv.onHide_&&(o.DropDownDiv.onHide_(),o.DropDownDiv.onHide_=null),o.DropDownDiv.clearContent(),o.DropDownDiv.owner_=null,o.DropDownDiv.rendererClassName_&&(o.utils.dom.removeClass(t,o.DropDownDiv.rendererClassName_),o.DropDownDiv.rendererClassName_=""),o.DropDownDiv.themeClassName_&&(o.utils.dom.removeClass(t,o.DropDownDiv.themeClassName_),o.DropDownDiv.themeClassName_=""),o.getMainWorkspace().markFocused()}},o.DropDownDiv.positionInternal_=function(t,e,i,n){(t=o.DropDownDiv.getPositionMetrics_(t,e,i,n)).arrowVisible?(o.DropDownDiv.arrow_.style.display="",o.DropDownDiv.arrow_.style.transform="translate("+t.arrowX+"px,"+t.arrowY+"px) rotate(45deg)",o.DropDownDiv.arrow_.setAttribute("class",t.arrowAtTop?"blocklyDropDownArrow blocklyArrowTop":"blocklyDropDownArrow blocklyArrowBottom")):o.DropDownDiv.arrow_.style.display="none",e=Math.floor(t.initialX),i=Math.floor(t.initialY),n=Math.floor(t.finalX);var r=Math.floor(t.finalY),s=o.DropDownDiv.DIV_;return s.style.left=e+"px",s.style.top=i+"px",s.style.display="block",s.style.opacity=1,s.style.transform="translate("+(n-e)+"px,"+(r-i)+"px)",!!t.arrowAtTop},o.DropDownDiv.repositionForWindowResize=function(){if(o.DropDownDiv.owner_){var t=o.DropDownDiv.owner_,e=t.getSourceBlock();e=(t=o.DropDownDiv.positionToField_?o.DropDownDiv.getScaledBboxOfField_(t):o.DropDownDiv.getScaledBboxOfBlock_(e)).left+(t.right-t.left)/2,o.DropDownDiv.positionInternal_(e,t.bottom,e,t.top)}else o.DropDownDiv.hide()},o.Grid=function(t,e){this.gridPattern_=t,this.spacing_=e.spacing,this.length_=e.length,this.line2_=(this.line1_=t.firstChild)&&this.line1_.nextSibling,this.snapToGrid_=e.snap},o.Grid.prototype.scale_=1,o.Grid.prototype.dispose=function(){this.gridPattern_=null},o.Grid.prototype.shouldSnap=function(){return this.snapToGrid_},o.Grid.prototype.getSpacing=function(){return this.spacing_},o.Grid.prototype.getPatternId=function(){return this.gridPattern_.id},o.Grid.prototype.update=function(t){this.scale_=t;var e=this.spacing_*t||100;this.gridPattern_.setAttribute("width",e),this.gridPattern_.setAttribute("height",e);var o=(e=Math.floor(this.spacing_/2)+.5)-this.length_/2,i=e+this.length_/2;e*=t,o*=t,i*=t,this.setLineAttributes_(this.line1_,t,o,i,e,e),this.setLineAttributes_(this.line2_,t,e,e,o,i)},o.Grid.prototype.setLineAttributes_=function(t,e,o,i,n,r){t&&(t.setAttribute("stroke-width",e),t.setAttribute("x1",o),t.setAttribute("y1",n),t.setAttribute("x2",i),t.setAttribute("y2",r))},o.Grid.prototype.moveTo=function(t,e){this.gridPattern_.setAttribute("x",t),this.gridPattern_.setAttribute("y",e),(o.utils.userAgent.IE||o.utils.userAgent.EDGE)&&this.update(this.scale_)},o.Grid.createDom=function(t,e,i){return t=o.utils.dom.createSvgElement(o.utils.Svg.PATTERN,{id:"blocklyGridPattern"+t,patternUnits:"userSpaceOnUse"},i),0<e.length&&0<e.spacing?(o.utils.dom.createSvgElement(o.utils.Svg.LINE,{stroke:e.colour},t),1<e.length&&o.utils.dom.createSvgElement(o.utils.Svg.LINE,{stroke:e.colour},t)):o.utils.dom.createSvgElement(o.utils.Svg.LINE,{},t),t},o.Theme=function(t,e,i,n){this.name=t,this.blockStyles=e||Object.create(null),this.categoryStyles=i||Object.create(null),this.componentStyles=n||Object.create(null),this.fontStyle=Object.create(null),this.startHats=null,o.registry.register(o.registry.Type.THEME,t,this)},o.Theme.prototype.getClassName=function(){return this.name+"-theme"},o.Theme.prototype.setBlockStyle=function(t,e){this.blockStyles[t]=e},o.Theme.prototype.setCategoryStyle=function(t,e){this.categoryStyles[t]=e},o.Theme.prototype.getComponentStyle=function(t){return(t=this.componentStyles[t])&&"string"==typeof t&&this.getComponentStyle(t)?this.getComponentStyle(t):t?String(t):null},o.Theme.prototype.setComponentStyle=function(t,e){this.componentStyles[t]=e},o.Theme.prototype.setFontStyle=function(t){this.fontStyle=t},o.Theme.prototype.setStartHats=function(t){this.startHats=t},o.Theme.defineTheme=function(t,e){var i=new o.Theme(t),n=e.base;return n&&("string"==typeof n&&(n=o.registry.getObject(o.registry.Type.THEME,n)),n instanceof o.Theme&&(o.utils.object.deepMerge(i,n),i.name=t)),o.utils.object.deepMerge(i.blockStyles,e.blockStyles),o.utils.object.deepMerge(i.categoryStyles,e.categoryStyles),o.utils.object.deepMerge(i.componentStyles,e.componentStyles),o.utils.object.deepMerge(i.fontStyle,e.fontStyle),null!=e.startHats&&(i.startHats=e.startHats),i},o.Themes={},o.Themes.Classic={},o.Themes.Classic.defaultBlockStyles={colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}},o.Themes.Classic.categoryStyles={colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}},o.Themes.Classic=new o.Theme("classic",o.Themes.Classic.defaultBlockStyles,o.Themes.Classic.categoryStyles),o.utils.IdGenerator={},o.utils.IdGenerator.nextId_=0,o.utils.IdGenerator.getNextUniqueId=function(){return"blockly-"+(o.utils.IdGenerator.nextId_++).toString(36)},o.utils.Metrics=function(){},o.utils.toolbox={},o.utils.toolbox.CATEGORY_TOOLBOX_KIND="categoryToolbox",o.utils.toolbox.FLYOUT_TOOLBOX_KIND="flyoutToolbox",o.utils.toolbox.Position={TOP:o.TOOLBOX_AT_TOP,BOTTOM:o.TOOLBOX_AT_BOTTOM,LEFT:o.TOOLBOX_AT_LEFT,RIGHT:o.TOOLBOX_AT_RIGHT},o.utils.toolbox.convertToolboxDefToJson=function(t){return t?((t instanceof Element||"string"==typeof t)&&(t=o.utils.toolbox.parseToolboxTree(t),t=o.utils.toolbox.convertToToolboxJson_(t)),o.utils.toolbox.validateToolbox_(t),t):null},o.utils.toolbox.validateToolbox_=function(t){var e=t.kind;if(t=t.contents,e&&e!=o.utils.toolbox.FLYOUT_TOOLBOX_KIND&&e!=o.utils.toolbox.CATEGORY_TOOLBOX_KIND)throw Error("Invalid toolbox kind "+e+". Please supply either "+o.utils.toolbox.FLYOUT_TOOLBOX_KIND+" or "+o.utils.toolbox.CATEGORY_TOOLBOX_KIND);if(!t)throw Error("Toolbox must have a contents attribute.")},o.utils.toolbox.convertFlyoutDefToJsonArray=function(t){return t?t.contents?t.contents:Array.isArray(t)&&0<t.length&&!t[0].nodeType?t:o.utils.toolbox.xmlToJsonArray_(t):[]},o.utils.toolbox.hasCategories=function(t){if(!t)return!1;var e=t.kind;return e?e==o.utils.toolbox.CATEGORY_TOOLBOX_KIND:!!t.contents.filter((function(t){return"CATEGORY"==t.kind.toUpperCase()})).length},o.utils.toolbox.isCategoryCollapsible=function(t){return!(!t||!t.contents||!t.contents.filter((function(t){return"CATEGORY"==t.kind.toUpperCase()})).length)},o.utils.toolbox.convertToToolboxJson_=function(t){var e={contents:o.utils.toolbox.xmlToJsonArray_(t)};return t instanceof Node&&o.utils.toolbox.addAttributes_(t,e),e},o.utils.toolbox.xmlToJsonArray_=function(t){var e,i=[],n=t.childNodes;for(n||(n=t),t=0;e=n[t];t++)if(e.tagName){var r={},s=e.tagName.toUpperCase();r.kind=s,"BLOCK"==s?r.blockxml=e:e.childNodes&&0<e.childNodes.length&&(r.contents=o.utils.toolbox.xmlToJsonArray_(e)),o.utils.toolbox.addAttributes_(e,r),i.push(r)}return i},o.utils.toolbox.addAttributes_=function(t,e){for(var o=0;o<t.attributes.length;o++){var i=t.attributes[o];-1<i.nodeName.indexOf("css-")?(e.cssconfig=e.cssconfig||{},e.cssconfig[i.nodeName.replace("css-","")]=i.value):e[i.nodeName]=i.value}},o.utils.toolbox.parseToolboxTree=function(t){if(t){if("string"!=typeof t&&(o.utils.userAgent.IE&&t.outerHTML?t=t.outerHTML:t instanceof Element||(t=null)),"string"==typeof t&&"xml"!=(t=o.Xml.textToDom(t)).nodeName.toLowerCase())throw TypeError("Toolbox should be an <xml> document.")}else t=null;return t},o.utils.xml={},o.utils.xml.NAME_SPACE="https://developers.google.com/blockly/xml",o.utils.xml.document=function(){return document},o.utils.xml.createElement=function(t){return o.utils.xml.document().createElementNS(o.utils.xml.NAME_SPACE,t)},o.utils.xml.createTextNode=function(t){return o.utils.xml.document().createTextNode(t)},o.utils.xml.textToDomDocument=function(t){return(new DOMParser).parseFromString(t,"text/xml")},o.utils.xml.domToText=function(t){return(new XMLSerializer).serializeToString(t)},o.Events.BlockBase=function(t){o.Events.BlockBase.superClass_.constructor.call(this),this.blockId=(this.isBlank=void 0===t)?"":t.id,this.workspaceId=this.isBlank?"":t.workspace.id},o.utils.object.inherits(o.Events.BlockBase,o.Events.Abstract),o.Events.BlockBase.prototype.toJson=function(){var t=o.Events.BlockBase.superClass_.toJson.call(this);return t.blockId=this.blockId,t},o.Events.BlockBase.prototype.fromJson=function(t){o.Events.BlockBase.superClass_.fromJson.call(this,t),this.blockId=t.blockId},o.Events.Change=function(t,e,i,n,r){o.Events.Change.superClass_.constructor.call(this,t),t&&(this.element=void 0===e?"":e,this.name=void 0===i?"":i,this.oldValue=void 0===n?"":n,this.newValue=void 0===r?"":r)},o.utils.object.inherits(o.Events.Change,o.Events.BlockBase),o.Events.BlockChange=o.Events.Change,o.Events.Change.prototype.type=o.Events.CHANGE,o.Events.Change.prototype.toJson=function(){var t=o.Events.Change.superClass_.toJson.call(this);return t.element=this.element,this.name&&(t.name=this.name),t.oldValue=this.oldValue,t.newValue=this.newValue,t},o.Events.Change.prototype.fromJson=function(t){o.Events.Change.superClass_.fromJson.call(this,t),this.element=t.element,this.name=t.name,this.oldValue=t.oldValue,this.newValue=t.newValue},o.Events.Change.prototype.isNull=function(){return this.oldValue==this.newValue},o.Events.Change.prototype.run=function(t){var e=this.getEventWorkspace_().getBlockById(this.blockId);if(e)switch(e.mutator&&e.mutator.setVisible(!1),t=t?this.newValue:this.oldValue,this.element){case"field":(e=e.getField(this.name))?e.setValue(t):console.warn("Can't set non-existent field: "+this.name);break;case"comment":e.setCommentText(t||null);break;case"collapsed":e.setCollapsed(!!t);break;case"disabled":e.setEnabled(!t);break;case"inline":e.setInputsInline(!!t);break;case"mutation":var i="";if(e.mutationToDom&&(i=(i=e.mutationToDom())&&o.Xml.domToText(i)),e.domToMutation){var n=o.Xml.textToDom(t||"<mutation/>");e.domToMutation(n)}o.Events.fire(new o.Events.Change(e,"mutation",null,i,t));break;default:console.warn("Unknown change type: "+this.element)}else console.warn("Can't change non-existent block: "+this.blockId)},o.Events.Create=function(t){o.Events.Create.superClass_.constructor.call(this,t),t&&(t.isShadow()&&(this.recordUndo=!1),this.xml=t.workspace.rendered?o.Xml.blockToDomWithXY(t):o.Xml.blockToDom(t),this.ids=o.Events.getDescendantIds(t))},o.utils.object.inherits(o.Events.Create,o.Events.BlockBase),o.Events.BlockCreate=o.Events.Create,o.Events.Create.prototype.type=o.Events.CREATE,o.Events.Create.prototype.toJson=function(){var t=o.Events.Create.superClass_.toJson.call(this);return t.xml=o.Xml.domToText(this.xml),t.ids=this.ids,this.recordUndo||(t.recordUndo=this.recordUndo),t},o.Events.Create.prototype.fromJson=function(t){o.Events.Create.superClass_.fromJson.call(this,t),this.xml=o.Xml.textToDom(t.xml),this.ids=t.ids,void 0!==t.recordUndo&&(this.recordUndo=t.recordUndo)},o.Events.Create.prototype.run=function(t){var e=this.getEventWorkspace_();if(t)(t=o.utils.xml.createElement("xml")).appendChild(this.xml),o.Xml.domToWorkspace(t,e);else{t=0;for(var i;i=this.ids[t];t++){var n=e.getBlockById(i);n?n.dispose(!1):i==this.blockId&&console.warn("Can't uncreate non-existent block: "+i)}}},o.Events.Delete=function(t){if(o.Events.Delete.superClass_.constructor.call(this,t),t){if(t.getParent())throw Error("Connected blocks cannot be deleted.");t.isShadow()&&(this.recordUndo=!1),this.oldXml=t.workspace.rendered?o.Xml.blockToDomWithXY(t):o.Xml.blockToDom(t),this.ids=o.Events.getDescendantIds(t)}},o.utils.object.inherits(o.Events.Delete,o.Events.BlockBase),o.Events.BlockDelete=o.Events.Delete,o.Events.Delete.prototype.type=o.Events.DELETE,o.Events.Delete.prototype.toJson=function(){var t=o.Events.Delete.superClass_.toJson.call(this);return t.oldXml=o.Xml.domToText(this.oldXml),t.ids=this.ids,this.recordUndo||(t.recordUndo=this.recordUndo),t},o.Events.Delete.prototype.fromJson=function(t){o.Events.Delete.superClass_.fromJson.call(this,t),this.oldXml=o.Xml.textToDom(t.oldXml),this.ids=t.ids,void 0!==t.recordUndo&&(this.recordUndo=t.recordUndo)},o.Events.Delete.prototype.run=function(t){var e=this.getEventWorkspace_();if(t){t=0;for(var i;i=this.ids[t];t++){var n=e.getBlockById(i);n?n.dispose(!1):i==this.blockId&&console.warn("Can't delete non-existent block: "+i)}}else(t=o.utils.xml.createElement("xml")).appendChild(this.oldXml),o.Xml.domToWorkspace(t,e)},o.Events.Move=function(t){o.Events.Move.superClass_.constructor.call(this,t),t&&(t.isShadow()&&(this.recordUndo=!1),t=this.currentLocation_(),this.oldParentId=t.parentId,this.oldInputName=t.inputName,this.oldCoordinate=t.coordinate)},o.utils.object.inherits(o.Events.Move,o.Events.BlockBase),o.Events.BlockMove=o.Events.Move,o.Events.Move.prototype.type=o.Events.MOVE,o.Events.Move.prototype.toJson=function(){var t=o.Events.Move.superClass_.toJson.call(this);return this.newParentId&&(t.newParentId=this.newParentId),this.newInputName&&(t.newInputName=this.newInputName),this.newCoordinate&&(t.newCoordinate=Math.round(this.newCoordinate.x)+","+Math.round(this.newCoordinate.y)),this.recordUndo||(t.recordUndo=this.recordUndo),t},o.Events.Move.prototype.fromJson=function(t){if(o.Events.Move.superClass_.fromJson.call(this,t),this.newParentId=t.newParentId,this.newInputName=t.newInputName,t.newCoordinate){var e=t.newCoordinate.split(",");this.newCoordinate=new o.utils.Coordinate(Number(e[0]),Number(e[1]))}void 0!==t.recordUndo&&(this.recordUndo=t.recordUndo)},o.Events.Move.prototype.recordNew=function(){var t=this.currentLocation_();this.newParentId=t.parentId,this.newInputName=t.inputName,this.newCoordinate=t.coordinate},o.Events.Move.prototype.currentLocation_=function(){var t=this.getEventWorkspace_().getBlockById(this.blockId),e={},o=t.getParent();return o?(e.parentId=o.id,(t=o.getInputWithBlock(t))&&(e.inputName=t.name)):e.coordinate=t.getRelativeToSurfaceXY(),e},o.Events.Move.prototype.isNull=function(){return this.oldParentId==this.newParentId&&this.oldInputName==this.newInputName&&o.utils.Coordinate.equals(this.oldCoordinate,this.newCoordinate)},o.Events.Move.prototype.run=function(t){var e=this.getEventWorkspace_(),i=e.getBlockById(this.blockId);if(i){var n=t?this.newParentId:this.oldParentId,r=t?this.newInputName:this.oldInputName;t=t?this.newCoordinate:this.oldCoordinate;var s=null;if(n&&!(s=e.getBlockById(n)))return void console.warn("Can't connect to non-existent block: "+n);if(i.getParent()&&i.unplug(),t)r=i.getRelativeToSurfaceXY(),i.moveBy(t.x-r.x,t.y-r.y);else{if(i=i.outputConnection||i.previousConnection,r){if(e=s.getInput(r))var a=e.connection}else i.type==o.PREVIOUS_STATEMENT&&(a=s.nextConnection);a?i.connect(a):console.warn("Can't connect to non-existent input: "+r)}}else console.warn("Can't move non-existent block: "+this.blockId)},o.registry.register(o.registry.Type.EVENT,o.Events.CREATE,o.Events.Create),o.registry.register(o.registry.Type.EVENT,o.Events.DELETE,o.Events.Delete),o.registry.register(o.registry.Type.EVENT,o.Events.CHANGE,o.Events.Change),o.registry.register(o.registry.Type.EVENT,o.Events.MOVE,o.Events.Move),o.Events.FinishedLoading=function(t){this.isBlank=void 0===t,this.workspaceId=t?t.id:"",this.group=o.Events.getGroup(),this.recordUndo=!1},o.utils.object.inherits(o.Events.FinishedLoading,o.Events.Abstract),o.Events.FinishedLoading.prototype.type=o.Events.FINISHED_LOADING,o.Events.FinishedLoading.prototype.toJson=function(){var t={type:this.type};return this.group&&(t.group=this.group),this.workspaceId&&(t.workspaceId=this.workspaceId),t},o.Events.FinishedLoading.prototype.fromJson=function(t){this.isBlank=!1,this.workspaceId=t.workspaceId,this.group=t.group},o.registry.register(o.registry.Type.EVENT,o.Events.FINISHED_LOADING,o.Events.FinishedLoading),o.Events.VarBase=function(t){o.Events.VarBase.superClass_.constructor.call(this),this.varId=(this.isBlank=void 0===t)?"":t.getId(),this.workspaceId=this.isBlank?"":t.workspace.id},o.utils.object.inherits(o.Events.VarBase,o.Events.Abstract),o.Events.VarBase.prototype.toJson=function(){var t=o.Events.VarBase.superClass_.toJson.call(this);return t.varId=this.varId,t},o.Events.VarBase.prototype.fromJson=function(t){o.Events.VarBase.superClass_.toJson.call(this),this.varId=t.varId},o.Events.VarCreate=function(t){o.Events.VarCreate.superClass_.constructor.call(this,t),t&&(this.varType=t.type,this.varName=t.name)},o.utils.object.inherits(o.Events.VarCreate,o.Events.VarBase),o.Events.VarCreate.prototype.type=o.Events.VAR_CREATE,o.Events.VarCreate.prototype.toJson=function(){var t=o.Events.VarCreate.superClass_.toJson.call(this);return t.varType=this.varType,t.varName=this.varName,t},o.Events.VarCreate.prototype.fromJson=function(t){o.Events.VarCreate.superClass_.fromJson.call(this,t),this.varType=t.varType,this.varName=t.varName},o.Events.VarCreate.prototype.run=function(t){var e=this.getEventWorkspace_();t?e.createVariable(this.varName,this.varType,this.varId):e.deleteVariableById(this.varId)},o.Events.VarDelete=function(t){o.Events.VarDelete.superClass_.constructor.call(this,t),t&&(this.varType=t.type,this.varName=t.name)},o.utils.object.inherits(o.Events.VarDelete,o.Events.VarBase),o.Events.VarDelete.prototype.type=o.Events.VAR_DELETE,o.Events.VarDelete.prototype.toJson=function(){var t=o.Events.VarDelete.superClass_.toJson.call(this);return t.varType=this.varType,t.varName=this.varName,t},o.Events.VarDelete.prototype.fromJson=function(t){o.Events.VarDelete.superClass_.fromJson.call(this,t),this.varType=t.varType,this.varName=t.varName},o.Events.VarDelete.prototype.run=function(t){var e=this.getEventWorkspace_();t?e.deleteVariableById(this.varId):e.createVariable(this.varName,this.varType,this.varId)},o.Events.VarRename=function(t,e){o.Events.VarRename.superClass_.constructor.call(this,t),t&&(this.oldName=t.name,this.newName=void 0===e?"":e)},o.utils.object.inherits(o.Events.VarRename,o.Events.VarBase),o.Events.VarRename.prototype.type=o.Events.VAR_RENAME,o.Events.VarRename.prototype.toJson=function(){var t=o.Events.VarRename.superClass_.toJson.call(this);return t.oldName=this.oldName,t.newName=this.newName,t},o.Events.VarRename.prototype.fromJson=function(t){o.Events.VarRename.superClass_.fromJson.call(this,t),this.oldName=t.oldName,this.newName=t.newName},o.Events.VarRename.prototype.run=function(t){var e=this.getEventWorkspace_();t?e.renameVariableById(this.varId,this.newName):e.renameVariableById(this.varId,this.oldName)},o.registry.register(o.registry.Type.EVENT,o.Events.VAR_CREATE,o.Events.VarCreate),o.registry.register(o.registry.Type.EVENT,o.Events.VAR_DELETE,o.Events.VarDelete),o.registry.register(o.registry.Type.EVENT,o.Events.VAR_RENAME,o.Events.VarRename),o.Xml={},o.Xml.workspaceToDom=function(t,e){var i=o.utils.xml.createElement("xml"),n=o.Xml.variablesToDom(o.Variables.allUsedVarModels(t));n.hasChildNodes()&&i.appendChild(n);var r,s=t.getTopComments(!0);for(n=0;r=s[n];n++)i.appendChild(r.toXmlWithXY(e));for(t=t.getTopBlocks(!0),n=0;s=t[n];n++)i.appendChild(o.Xml.blockToDomWithXY(s,e));return i},o.Xml.variablesToDom=function(t){for(var e,i=o.utils.xml.createElement("variables"),n=0;e=t[n];n++){var r=o.utils.xml.createElement("variable");r.appendChild(o.utils.xml.createTextNode(e.name)),e.type&&r.setAttribute("type",e.type),r.id=e.getId(),i.appendChild(r)}return i},o.Xml.blockToDomWithXY=function(t,e){if(t.isInsertionMarker()&&!(t=t.getChildren(!1)[0]))return new DocumentFragment;var i;t.workspace.RTL&&(i=t.workspace.getWidth()),e=o.Xml.blockToDom(t,e);var n=t.getRelativeToSurfaceXY();return e.setAttribute("x",Math.round(t.workspace.RTL?i-n.x:n.x)),e.setAttribute("y",Math.round(n.y)),e},o.Xml.fieldToDom_=function(t){if(t.isSerializable()){var e=o.utils.xml.createElement("field");return e.setAttribute("name",t.name||""),t.toXml(e)}return null},o.Xml.allFieldsToDom_=function(t,e){for(var i,n=0;i=t.inputList[n];n++)for(var r,s=0;r=i.fieldRow[s];s++)(r=o.Xml.fieldToDom_(r))&&e.appendChild(r)},o.Xml.blockToDom=function(t,e){if(t.isInsertionMarker())return(t=t.getChildren(!1)[0])?o.Xml.blockToDom(t):new DocumentFragment;var i=o.utils.xml.createElement(t.isShadow()?"shadow":"block");if(i.setAttribute("type",t.type),e||i.setAttribute("id",t.id),t.mutationToDom){var n=t.mutationToDom();n&&(n.hasChildNodes()||n.hasAttributes())&&i.appendChild(n)}if(o.Xml.allFieldsToDom_(t,i),n=t.getCommentText()){var r=t.commentModel.size,s=t.commentModel.pinned,a=o.utils.xml.createElement("comment");a.appendChild(o.utils.xml.createTextNode(n)),a.setAttribute("pinned",s),a.setAttribute("h",r.height),a.setAttribute("w",r.width),i.appendChild(a)}for(t.data&&((n=o.utils.xml.createElement("data")).appendChild(o.utils.xml.createTextNode(t.data)),i.appendChild(n)),n=0;r=t.inputList[n];n++){var l;if(s=!0,r.type!=o.DUMMY_INPUT){var c=r.connection.targetBlock();r.type==o.INPUT_VALUE?l=o.utils.xml.createElement("value"):r.type==o.NEXT_STATEMENT&&(l=o.utils.xml.createElement("statement")),!(a=r.connection.getShadowDom())||c&&c.isShadow()||l.appendChild(o.Xml.cloneShadow_(a,e)),c&&(a=o.Xml.blockToDom(c,e)).nodeType==o.utils.dom.NodeType.ELEMENT_NODE&&(l.appendChild(a),s=!1),l.setAttribute("name",r.name),s||i.appendChild(l)}}return null!=t.inputsInline&&t.inputsInline!=t.inputsInlineDefault&&i.setAttribute("inline",t.inputsInline),t.isCollapsed()&&i.setAttribute("collapsed",!0),t.isEnabled()||i.setAttribute("disabled",!0),t.isDeletable()||t.isShadow()||i.setAttribute("deletable",!1),t.isMovable()||t.isShadow()||i.setAttribute("movable",!1),t.isEditable()||i.setAttribute("editable",!1),(n=t.getNextBlock())&&(a=o.Xml.blockToDom(n,e)).nodeType==o.utils.dom.NodeType.ELEMENT_NODE&&((l=o.utils.xml.createElement("next")).appendChild(a),i.appendChild(l)),!(a=t.nextConnection&&t.nextConnection.getShadowDom())||n&&n.isShadow()||l.appendChild(o.Xml.cloneShadow_(a,e)),i},o.Xml.cloneShadow_=function(t,e){for(var i,n=t=t.cloneNode(!0);n;)if(e&&"shadow"==n.nodeName&&n.removeAttribute("id"),n.firstChild)n=n.firstChild;else{for(;n&&!n.nextSibling;)i=n,n=n.parentNode,i.nodeType==o.utils.dom.NodeType.TEXT_NODE&&""==i.data.trim()&&n.firstChild!=i&&o.utils.dom.removeNode(i);n&&(i=n,n=n.nextSibling,i.nodeType==o.utils.dom.NodeType.TEXT_NODE&&""==i.data.trim()&&o.utils.dom.removeNode(i))}return t},o.Xml.domToText=function(t){return o.utils.xml.domToText(t).replace(/<(\w+)([^<]*)\/>/g,"<$1$2></$1>")},o.Xml.domToPrettyText=function(t){t=o.Xml.domToText(t).split("<");for(var e="",i=1;i<t.length;i++){var n=t[i];"/"==n[0]&&(e=e.substring(2)),t[i]=e+"<"+n,"/"!=n[0]&&"/>"!=n.slice(-2)&&(e+="  ")}return(t=(t=t.join("\n")).replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>")).replace(/^\n/,"")},o.Xml.textToDom=function(t){var e=o.utils.xml.textToDomDocument(t);if(!e||!e.documentElement||e.getElementsByTagName("parsererror").length)throw Error("textToDom was unable to parse: "+t);return e.documentElement},o.Xml.clearWorkspaceAndLoadFromXml=function(t,e){return e.setResizesEnabled(!1),e.clear(),t=o.Xml.domToWorkspace(t,e),e.setResizesEnabled(!0),t},o.Xml.domToWorkspace=function(t,e){if(t instanceof o.Workspace){var i=t;t=e,e=i,console.warn("Deprecated call to Blockly.Xml.domToWorkspace, swap the arguments.")}var n;e.RTL&&(n=e.getWidth()),i=[],o.utils.dom.startTextWidthCache();var r=o.Events.getGroup();r||o.Events.setGroup(!0),e.setResizesEnabled&&e.setResizesEnabled(!1);var s=!0;try{for(var a,l=0;a=t.childNodes[l];l++){var c=a.nodeName.toLowerCase(),u=a;if("block"==c||"shadow"==c&&!o.Events.recordUndo){var h=o.Xml.domToBlock(u,e);i.push(h.id);var _=u.hasAttribute("x")?parseInt(u.getAttribute("x"),10):10,p=u.hasAttribute("y")?parseInt(u.getAttribute("y"),10):10;isNaN(_)||isNaN(p)||h.moveBy(e.RTL?n-_:_,p),s=!1}else{if("shadow"==c)throw TypeError("Shadow block cannot be a top-level block.");if("comment"==c)e.rendered?o.WorkspaceCommentSvg?o.WorkspaceCommentSvg.fromXml(u,e,n):console.warn("Missing require for Blockly.WorkspaceCommentSvg, ignoring workspace comment."):o.WorkspaceComment?o.WorkspaceComment.fromXml(u,e):console.warn("Missing require for Blockly.WorkspaceComment, ignoring workspace comment.");else if("variables"==c){if(!s)throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");o.Xml.domToVariables(u,e),s=!1}}}}finally{r||o.Events.setGroup(!1),o.utils.dom.stopTextWidthCache()}return e.setResizesEnabled&&e.setResizesEnabled(!0),o.Events.fire(new o.Events.FinishedLoading(e)),i},o.Xml.appendDomToWorkspace=function(t,e){var i;if(Object.prototype.hasOwnProperty.call(e,"scale")&&(i=e.getBlocksBoundingBox()),t=o.Xml.domToWorkspace(t,e),i&&i.top!=i.bottom){var n=i.bottom,r=e.RTL?i.right:i.left,s=1/0,a=-1/0,l=1/0;for(i=0;i<t.length;i++){var c=e.getBlockById(t[i]).getRelativeToSurfaceXY();c.y<l&&(l=c.y),c.x<s&&(s=c.x),c.x>a&&(a=c.x)}for(n=n-l+10,r=e.RTL?r-a:r-s,i=0;i<t.length;i++)e.getBlockById(t[i]).moveBy(r,n)}return t},o.Xml.domToBlock=function(t,e){if(t instanceof o.Workspace){var i=t;t=e,e=i,console.warn("Deprecated call to Blockly.Xml.domToBlock, swap the arguments.")}o.Events.disable(),i=e.getAllVariables();try{var n=o.Xml.domToBlockHeadless_(t,e),r=n.getDescendants(!1);if(e.rendered){n.setConnectionTracking(!1);for(var s=r.length-1;0<=s;s--)r[s].initSvg();for(s=r.length-1;0<=s;s--)r[s].render(!1);setTimeout((function(){n.disposed||n.setConnectionTracking(!0)}),1),n.updateDisabled(),e.resizeContents()}else for(s=r.length-1;0<=s;s--)r[s].initModel()}finally{o.Events.enable()}if(o.Events.isEnabled()){for(t=o.Variables.getAddedVariables(e,i),s=0;s<t.length;s++)o.Events.fire(new o.Events.VarCreate(t[s]));o.Events.fire(new o.Events.BlockCreate(n))}return n},o.Xml.domToVariables=function(t,e){for(var i,n=0;i=t.childNodes[n];n++)if(i.nodeType==o.utils.dom.NodeType.ELEMENT_NODE){var r=i.getAttribute("type"),s=i.getAttribute("id");e.createVariable(i.textContent,r,s)}},o.Xml.domToBlockHeadless_=function(t,e){var i=null,n=t.getAttribute("type");if(!n)throw TypeError("Block type unspecified: "+t.outerHTML);var r=t.getAttribute("id");i=e.newBlock(n,r);var s,a=null;for(r=0;s=t.childNodes[r];r++)if(s.nodeType!=o.utils.dom.NodeType.TEXT_NODE){for(var l,c=a=null,u=0;l=s.childNodes[u];u++)l.nodeType==o.utils.dom.NodeType.ELEMENT_NODE&&("block"==l.nodeName.toLowerCase()?a=l:"shadow"==l.nodeName.toLowerCase()&&(c=l));u=!1;var h=s.getAttribute("name");switch(l=s,s.nodeName.toLowerCase()){case"mutation":i.domToMutation&&(i.domToMutation(l),i.initSvg&&(u=!0));break;case"comment":if(!o.Comment){console.warn("Missing require for Blockly.Comment, ignoring block comment.");break}c=l.textContent,a="true"==l.getAttribute("pinned"),s=parseInt(l.getAttribute("w"),10),l=parseInt(l.getAttribute("h"),10),i.setCommentText(c),i.commentModel.pinned=a,isNaN(s)||isNaN(l)||(i.commentModel.size=new o.utils.Size(s,l)),a&&i.getCommentIcon&&!i.isInFlyout&&setTimeout((function(){i.getCommentIcon().setVisible(!0)}),1);break;case"data":i.data=s.textContent;break;case"title":case"field":o.Xml.domToField_(i,h,l);break;case"value":case"statement":if(!(l=i.getInput(h))){console.warn("Ignoring non-existent input "+h+" in block "+n);break}if(a)if((a=o.Xml.domToBlockHeadless_(a,e)).outputConnection)l.connection.connect(a.outputConnection);else{if(!a.previousConnection)throw TypeError("Child block does not have output or previous statement.");l.connection.connect(a.previousConnection)}c&&l.connection.setShadowDom(c);break;case"next":if(a){if(!i.nextConnection)throw TypeError("Next statement does not exist.");if(i.nextConnection.isConnected())throw TypeError("Next statement is already connected.");if(!(a=o.Xml.domToBlockHeadless_(a,e)).previousConnection)throw TypeError("Next block does not have previous statement.");i.nextConnection.connect(a.previousConnection)}c&&i.nextConnection&&i.nextConnection.setShadowDom(c);break;default:console.warn("Ignoring unknown tag: "+s.nodeName)}}if(u&&i.initSvg(),(r=t.getAttribute("inline"))&&i.setInputsInline("true"==r),(r=t.getAttribute("disabled"))&&i.setEnabled("true"!=r&&"disabled"!=r),(r=t.getAttribute("deletable"))&&i.setDeletable("true"==r),(r=t.getAttribute("movable"))&&i.setMovable("true"==r),(r=t.getAttribute("editable"))&&i.setEditable("true"==r),(r=t.getAttribute("collapsed"))&&i.setCollapsed("true"==r),"shadow"==t.nodeName.toLowerCase()){for(t=i.getChildren(!1),r=0;e=t[r];r++)if(!e.isShadow())throw TypeError("Shadow block not allowed non-shadow child.");if(i.getVarModels().length)throw TypeError("Shadow blocks cannot have variable references.");i.setShadow(!0)}return i},o.Xml.domToField_=function(t,e,o){var i=t.getField(e);i?i.fromXml(o):console.warn("Ignoring non-existent field "+e+" in block "+t.type)},o.Xml.deleteNext=function(t){for(var e,o=0;e=t.childNodes[o];o++)if("next"==e.nodeName.toLowerCase()){t.removeChild(e);break}},o.Options=function(t){var e=!!t.readOnly;if(e)var i=null,n=!1,r=!1,s=!1,a=!1,l=!1,c=!1;else{i=o.utils.toolbox.convertToolboxDefToJson(t.toolbox),n=o.utils.toolbox.hasCategories(i),void 0===(r=t.trashcan)&&(r=n);var u=t.maxTrashcanContents;r?void 0===u&&(u=32):u=0,void 0===(s=t.collapse)&&(s=n),void 0===(a=t.comments)&&(a=n),void 0===(l=t.disable)&&(l=n),void 0===(c=t.sounds)&&(c=!0)}var h=!!t.rtl,_=t.horizontalLayout;void 0===_&&(_=!1);var p=t.toolboxPosition;p="end"!==p,p=_?p?o.utils.toolbox.Position.TOP:o.utils.toolbox.Position.BOTTOM:p==h?o.utils.toolbox.Position.RIGHT:o.utils.toolbox.Position.LEFT;var d=t.css;void 0===d&&(d=!0);var g="https://blockly-demo.appspot.com/static/media/";t.media?g=t.media:t.path&&(g=t.path+"media/");var E=void 0===t.oneBasedIndex||!!t.oneBasedIndex,T=t.renderer||"geras",R=t.plugins||{};this.RTL=h,this.oneBasedIndex=E,this.collapse=s,this.comments=a,this.disable=l,this.readOnly=e,this.maxBlocks=t.maxBlocks||1/0,this.maxInstances=t.maxInstances,this.pathToMedia=g,this.hasCategories=n,this.moveOptions=o.Options.parseMoveOptions_(t,n),this.hasScrollbars=this.moveOptions.scrollbars,this.hasTrashcan=r,this.maxTrashcanContents=u,this.hasSounds=c,this.hasCss=d,this.horizontalLayout=_,this.languageTree=i,this.gridOptions=o.Options.parseGridOptions_(t),this.zoomOptions=o.Options.parseZoomOptions_(t),this.toolboxPosition=p,this.theme=o.Options.parseThemeOptions_(t),this.renderer=T,this.rendererOverrides=t.rendererOverrides,this.gridPattern=null,this.parentWorkspace=t.parentWorkspace,this.plugins=R},o.BlocklyOptions=function(){},o.Options.parseMoveOptions_=function(t,e){var o=t.move||{},i={};return i.scrollbars=void 0===o.scrollbars&&void 0===t.scrollbars?e:!!o.scrollbars||!!t.scrollbars,i.wheel=!(!i.scrollbars||void 0===o.wheel||!o.wheel),i.drag=!(!i.scrollbars||void 0!==o.drag&&!o.drag),i},o.Options.parseZoomOptions_=function(t){t=t.zoom||{};var e={};return e.controls=void 0!==t.controls&&!!t.controls,e.wheel=void 0!==t.wheel&&!!t.wheel,e.startScale=void 0===t.startScale?1:Number(t.startScale),e.maxScale=void 0===t.maxScale?3:Number(t.maxScale),e.minScale=void 0===t.minScale?.3:Number(t.minScale),e.scaleSpeed=void 0===t.scaleSpeed?1.2:Number(t.scaleSpeed),e.pinch=void 0===t.pinch?e.wheel||e.controls:!!t.pinch,e},o.Options.parseGridOptions_=function(t){t=t.grid||{};var e={};return e.spacing=Number(t.spacing)||0,e.colour=t.colour||"#888",e.length=void 0===t.length?1:Number(t.length),e.snap=0<e.spacing&&!!t.snap,e},o.Options.parseThemeOptions_=function(t){return"string"==typeof(t=t.theme||o.Themes.Classic)?o.registry.getObject(o.registry.Type.THEME,t):t instanceof o.Theme?t:o.Theme.defineTheme(t.name||"builtin"+o.utils.IdGenerator.getNextUniqueId(),t)},o.Options.parseToolboxTree=function(t){return o.utils.deprecation.warn("Blockly.Options.parseToolboxTree","September 2020","September 2021","Blockly.utils.toolbox.parseToolboxTree"),o.utils.toolbox.parseToolboxTree(t)},o.Touch={},o.Touch.TOUCH_ENABLED="ontouchstart"in o.utils.global||!!(o.utils.global.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!o.utils.global.navigator||!o.utils.global.navigator.maxTouchPoints&&!o.utils.global.navigator.msMaxTouchPoints),o.Touch.touchIdentifier_=null,o.Touch.TOUCH_MAP={},o.utils.global.PointerEvent?o.Touch.TOUCH_MAP={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]}:o.Touch.TOUCH_ENABLED&&(o.Touch.TOUCH_MAP={mousedown:["touchstart"],mousemove:["touchmove"],mouseup:["touchend","touchcancel"]}),o.longPid_=0,o.longStart=function(t,e){o.longStop_(),t.changedTouches&&1!=t.changedTouches.length||(o.longPid_=setTimeout((function(){t.changedTouches&&(t.button=2,t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),e&&e.handleRightClick(t)}),o.LONGPRESS))},o.longStop_=function(){o.longPid_&&(clearTimeout(o.longPid_),o.longPid_=0)},o.Touch.clearTouchIdentifier=function(){o.Touch.touchIdentifier_=null},o.Touch.shouldHandleEvent=function(t){return!o.Touch.isMouseOrTouchEvent(t)||o.Touch.checkTouchIdentifier(t)},o.Touch.getTouchIdentifierFromEvent=function(t){return null!=t.pointerId?t.pointerId:t.changedTouches&&t.changedTouches[0]&&void 0!==t.changedTouches[0].identifier&&null!==t.changedTouches[0].identifier?t.changedTouches[0].identifier:"mouse"},o.Touch.checkTouchIdentifier=function(t){var e=o.Touch.getTouchIdentifierFromEvent(t);return void 0!==o.Touch.touchIdentifier_&&null!==o.Touch.touchIdentifier_?o.Touch.touchIdentifier_==e:("mousedown"==t.type||"touchstart"==t.type||"pointerdown"==t.type)&&(o.Touch.touchIdentifier_=e,!0)},o.Touch.setClientFromTouch=function(t){if(o.utils.string.startsWith(t.type,"touch")){var e=t.changedTouches[0];t.clientX=e.clientX,t.clientY=e.clientY}},o.Touch.isMouseOrTouchEvent=function(t){return o.utils.string.startsWith(t.type,"touch")||o.utils.string.startsWith(t.type,"mouse")||o.utils.string.startsWith(t.type,"pointer")},o.Touch.isTouchEvent=function(t){return o.utils.string.startsWith(t.type,"touch")||o.utils.string.startsWith(t.type,"pointer")},o.Touch.splitEventByTouches=function(t){var e=[];if(t.changedTouches)for(var o=0;o<t.changedTouches.length;o++)e[o]={type:t.type,changedTouches:[t.changedTouches[o]],target:t.target,stopPropagation:function(){t.stopPropagation()},preventDefault:function(){t.preventDefault()}};else e.push(t);return e},o.ScrollbarPair=function(t){this.workspace_=t,this.hScroll=new o.Scrollbar(t,!0,!0,"blocklyMainWorkspaceScrollbar"),this.vScroll=new o.Scrollbar(t,!1,!0,"blocklyMainWorkspaceScrollbar"),this.corner_=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{height:o.Scrollbar.scrollbarThickness,width:o.Scrollbar.scrollbarThickness,class:"blocklyScrollbarBackground"},null),o.utils.dom.insertAfter(this.corner_,t.getBubbleCanvas()),this.oldHostMetrics_=null},o.ScrollbarPair.prototype.dispose=function(){o.utils.dom.removeNode(this.corner_),this.oldHostMetrics_=this.workspace_=this.corner_=null,this.hScroll.dispose(),this.hScroll=null,this.vScroll.dispose(),this.vScroll=null},o.ScrollbarPair.prototype.resize=function(){var t=this.workspace_.getMetrics();if(t){var e=!1,i=!1;if(this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth==t.viewWidth&&this.oldHostMetrics_.viewHeight==t.viewHeight&&this.oldHostMetrics_.absoluteTop==t.absoluteTop&&this.oldHostMetrics_.absoluteLeft==t.absoluteLeft?(this.oldHostMetrics_&&this.oldHostMetrics_.contentWidth==t.contentWidth&&this.oldHostMetrics_.viewLeft==t.viewLeft&&this.oldHostMetrics_.contentLeft==t.contentLeft||(e=!0),this.oldHostMetrics_&&this.oldHostMetrics_.contentHeight==t.contentHeight&&this.oldHostMetrics_.viewTop==t.viewTop&&this.oldHostMetrics_.contentTop==t.contentTop||(i=!0)):i=e=!0,e||i){try{o.Events.disable(),e&&this.hScroll.resize(t),i&&this.vScroll.resize(t)}finally{o.Events.enable()}this.workspace_.maybeFireViewportChangeEvent()}this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth==t.viewWidth&&this.oldHostMetrics_.absoluteLeft==t.absoluteLeft||this.corner_.setAttribute("x",this.vScroll.position.x),this.oldHostMetrics_&&this.oldHostMetrics_.viewHeight==t.viewHeight&&this.oldHostMetrics_.absoluteTop==t.absoluteTop||this.corner_.setAttribute("y",this.hScroll.position.y),this.oldHostMetrics_=t}},o.ScrollbarPair.prototype.set=function(t,e){var o={};t*=this.hScroll.ratio,e*=this.vScroll.ratio;var i=this.vScroll.scrollViewSize_;o.x=this.getRatio_(t,this.hScroll.scrollViewSize_),o.y=this.getRatio_(e,i),this.workspace_.setMetrics(o),this.hScroll.setHandlePosition(t),this.vScroll.setHandlePosition(e)},o.ScrollbarPair.prototype.getRatio_=function(t,e){return t/=e,isNaN(t)?0:t},o.Scrollbar=function(t,e,i,n){this.workspace_=t,this.pair_=i||!1,this.horizontal_=e,this.ratio=this.oldHostMetrics_=null,this.createDom_(n),this.position=new o.utils.Coordinate(0,0),t=o.Scrollbar.scrollbarThickness,e?(this.svgBackground_.setAttribute("height",t),this.outerSvg_.setAttribute("height",t),this.svgHandle_.setAttribute("height",t-5),this.svgHandle_.setAttribute("y",2.5),this.lengthAttribute_="width",this.positionAttribute_="x"):(this.svgBackground_.setAttribute("width",t),this.outerSvg_.setAttribute("width",t),this.svgHandle_.setAttribute("width",t-5),this.svgHandle_.setAttribute("x",2.5),this.lengthAttribute_="height",this.positionAttribute_="y"),this.onMouseDownBarWrapper_=o.bindEventWithChecks_(this.svgBackground_,"mousedown",this,this.onMouseDownBar_),this.onMouseDownHandleWrapper_=o.bindEventWithChecks_(this.svgHandle_,"mousedown",this,this.onMouseDownHandle_)},o.Scrollbar.prototype.origin_=new o.utils.Coordinate(0,0),o.Scrollbar.prototype.startDragMouse_=0,o.Scrollbar.prototype.scrollViewSize_=0,o.Scrollbar.prototype.handleLength_=0,o.Scrollbar.prototype.handlePosition_=0,o.Scrollbar.prototype.isVisible_=!0,o.Scrollbar.prototype.containerVisible_=!0,o.Scrollbar.scrollbarThickness=15,o.Touch.TOUCH_ENABLED&&(o.Scrollbar.scrollbarThickness=25),o.Scrollbar.metricsAreEquivalent_=function(t,e){return!(!t||!e||t.viewWidth!=e.viewWidth||t.viewHeight!=e.viewHeight||t.viewLeft!=e.viewLeft||t.viewTop!=e.viewTop||t.absoluteTop!=e.absoluteTop||t.absoluteLeft!=e.absoluteLeft||t.contentWidth!=e.contentWidth||t.contentHeight!=e.contentHeight||t.contentLeft!=e.contentLeft||t.contentTop!=e.contentTop)},o.Scrollbar.prototype.dispose=function(){this.cleanUp_(),o.unbindEvent_(this.onMouseDownBarWrapper_),this.onMouseDownBarWrapper_=null,o.unbindEvent_(this.onMouseDownHandleWrapper_),this.onMouseDownHandleWrapper_=null,o.utils.dom.removeNode(this.outerSvg_),this.svgBackground_=this.svgGroup_=this.outerSvg_=null,this.svgHandle_&&(this.workspace_.getThemeManager().unsubscribe(this.svgHandle_),this.svgHandle_=null),this.workspace_=null},o.Scrollbar.prototype.setHandleLength_=function(t){this.handleLength_=t,this.svgHandle_.setAttribute(this.lengthAttribute_,this.handleLength_)},o.Scrollbar.prototype.setHandlePosition=function(t){this.handlePosition_=t,this.svgHandle_.setAttribute(this.positionAttribute_,this.handlePosition_)},o.Scrollbar.prototype.setScrollViewSize_=function(t){this.scrollViewSize_=t,this.outerSvg_.setAttribute(this.lengthAttribute_,this.scrollViewSize_),this.svgBackground_.setAttribute(this.lengthAttribute_,this.scrollViewSize_)},o.ScrollbarPair.prototype.setContainerVisible=function(t){this.hScroll.setContainerVisible(t),this.vScroll.setContainerVisible(t)},o.Scrollbar.prototype.setPosition=function(t,e){this.position.x=t,this.position.y=e,o.utils.dom.setCssTransform(this.outerSvg_,"translate("+(this.position.x+this.origin_.x)+"px,"+(this.position.y+this.origin_.y)+"px)")},o.Scrollbar.prototype.resize=function(t){(t||(t=this.workspace_.getMetrics()))&&(o.Scrollbar.metricsAreEquivalent_(t,this.oldHostMetrics_)||(this.oldHostMetrics_=t,this.horizontal_?this.resizeHorizontal_(t):this.resizeVertical_(t),this.onScroll_()))},o.Scrollbar.prototype.resizeHorizontal_=function(t){this.resizeViewHorizontal(t)},o.Scrollbar.prototype.resizeViewHorizontal=function(t){var e=t.viewWidth-1;this.pair_&&(e-=o.Scrollbar.scrollbarThickness),this.setScrollViewSize_(Math.max(0,e)),e=t.absoluteLeft+.5,this.pair_&&this.workspace_.RTL&&(e+=o.Scrollbar.scrollbarThickness),this.setPosition(e,t.absoluteTop+t.viewHeight-o.Scrollbar.scrollbarThickness-.5),this.resizeContentHorizontal(t)},o.Scrollbar.prototype.resizeContentHorizontal=function(t){this.pair_||this.setVisible(this.scrollViewSize_<t.contentWidth),this.ratio=this.scrollViewSize_/t.contentWidth,(-1/0==this.ratio||1/0==this.ratio||isNaN(this.ratio))&&(this.ratio=0),this.setHandleLength_(Math.max(0,t.viewWidth*this.ratio)),this.setHandlePosition(this.constrainHandle_((t.viewLeft-t.contentLeft)*this.ratio))},o.Scrollbar.prototype.resizeVertical_=function(t){this.resizeViewVertical(t)},o.Scrollbar.prototype.resizeViewVertical=function(t){var e=t.viewHeight-1;this.pair_&&(e-=o.Scrollbar.scrollbarThickness),this.setScrollViewSize_(Math.max(0,e)),e=t.absoluteLeft+.5,this.workspace_.RTL||(e+=t.viewWidth-o.Scrollbar.scrollbarThickness-1),this.setPosition(e,t.absoluteTop+.5),this.resizeContentVertical(t)},o.Scrollbar.prototype.resizeContentVertical=function(t){this.pair_||this.setVisible(this.scrollViewSize_<t.contentHeight),this.ratio=this.scrollViewSize_/t.contentHeight,(-1/0==this.ratio||1/0==this.ratio||isNaN(this.ratio))&&(this.ratio=0),this.setHandleLength_(Math.max(0,t.viewHeight*this.ratio)),this.setHandlePosition(this.constrainHandle_((t.viewTop-t.contentTop)*this.ratio))},o.Scrollbar.prototype.createDom_=function(t){var e="blocklyScrollbar"+(this.horizontal_?"Horizontal":"Vertical");t&&(e+=" "+t),this.outerSvg_=o.utils.dom.createSvgElement(o.utils.Svg.SVG,{class:e},null),this.svgGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{},this.outerSvg_),this.svgBackground_=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{class:"blocklyScrollbarBackground"},this.svgGroup_),t=Math.floor((o.Scrollbar.scrollbarThickness-5)/2),this.svgHandle_=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{class:"blocklyScrollbarHandle",rx:t,ry:t},this.svgGroup_),this.workspace_.getThemeManager().subscribe(this.svgHandle_,"scrollbarColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgHandle_,"scrollbarOpacity","fill-opacity"),o.utils.dom.insertAfter(this.outerSvg_,this.workspace_.getParentSvg())},o.Scrollbar.prototype.isVisible=function(){return this.isVisible_},o.Scrollbar.prototype.setContainerVisible=function(t){var e=t!=this.containerVisible_;this.containerVisible_=t,e&&this.updateDisplay_()},o.Scrollbar.prototype.setVisible=function(t){var e=t!=this.isVisible();if(this.pair_)throw Error("Unable to toggle visibility of paired scrollbars.");this.isVisible_=t,e&&this.updateDisplay_()},o.Scrollbar.prototype.updateDisplay_=function(){this.containerVisible_&&this.isVisible()?this.outerSvg_.setAttribute("display","block"):this.outerSvg_.setAttribute("display","none")},o.Scrollbar.prototype.onMouseDownBar_=function(t){if(this.workspace_.markFocused(),o.Touch.clearTouchIdentifier(),this.cleanUp_(),o.utils.isRightButton(t))t.stopPropagation();else{var e=o.utils.mouseToSvg(t,this.workspace_.getParentSvg(),this.workspace_.getInverseScreenCTM());e=this.horizontal_?e.x:e.y;var i=o.utils.getInjectionDivXY_(this.svgHandle_);i=this.horizontal_?i.x:i.y;var n=this.handlePosition_,r=.95*this.handleLength_;e<=i?n-=r:e>=i+this.handleLength_&&(n+=r),this.setHandlePosition(this.constrainHandle_(n)),this.onScroll_(),t.stopPropagation(),t.preventDefault()}},o.Scrollbar.prototype.onMouseDownHandle_=function(t){this.workspace_.markFocused(),this.cleanUp_(),o.utils.isRightButton(t)?t.stopPropagation():(this.startDragHandle=this.handlePosition_,this.workspace_.setupDragSurface(),this.startDragMouse_=this.horizontal_?t.clientX:t.clientY,o.Scrollbar.onMouseUpWrapper_=o.bindEventWithChecks_(document,"mouseup",this,this.onMouseUpHandle_),o.Scrollbar.onMouseMoveWrapper_=o.bindEventWithChecks_(document,"mousemove",this,this.onMouseMoveHandle_),t.stopPropagation(),t.preventDefault())},o.Scrollbar.prototype.onMouseMoveHandle_=function(t){this.setHandlePosition(this.constrainHandle_(this.startDragHandle+((this.horizontal_?t.clientX:t.clientY)-this.startDragMouse_))),this.onScroll_()},o.Scrollbar.prototype.onMouseUpHandle_=function(){this.workspace_.resetDragSurface(),o.Touch.clearTouchIdentifier(),this.cleanUp_()},o.Scrollbar.prototype.cleanUp_=function(){o.hideChaff(!0),o.Scrollbar.onMouseUpWrapper_&&(o.unbindEvent_(o.Scrollbar.onMouseUpWrapper_),o.Scrollbar.onMouseUpWrapper_=null),o.Scrollbar.onMouseMoveWrapper_&&(o.unbindEvent_(o.Scrollbar.onMouseMoveWrapper_),o.Scrollbar.onMouseMoveWrapper_=null)},o.Scrollbar.prototype.constrainHandle_=function(t){return 0>=t||isNaN(t)||this.scrollViewSize_<this.handleLength_?0:Math.min(t,this.scrollViewSize_-this.handleLength_)},o.Scrollbar.prototype.onScroll_=function(){var t=this.handlePosition_/this.scrollViewSize_;isNaN(t)&&(t=0);var e={};this.horizontal_?e.x=t:e.y=t,this.workspace_.setMetrics(e)},o.Scrollbar.prototype.set=function(t){this.setHandlePosition(this.constrainHandle_(t*this.ratio)),this.onScroll_()},o.Scrollbar.prototype.setOrigin=function(t,e){this.origin_=new o.utils.Coordinate(t,e)},o.Tooltip={},o.Tooltip.visible=!1,o.Tooltip.blocked_=!1,o.Tooltip.LIMIT=50,o.Tooltip.mouseOutPid_=0,o.Tooltip.showPid_=0,o.Tooltip.lastX_=0,o.Tooltip.lastY_=0,o.Tooltip.element_=null,o.Tooltip.poisonedElement_=null,o.Tooltip.OFFSET_X=0,o.Tooltip.OFFSET_Y=10,o.Tooltip.RADIUS_OK=10,o.Tooltip.HOVER_MS=750,o.Tooltip.MARGINS=5,o.Tooltip.DIV=null,o.Tooltip.getTooltipOfObject=function(t){if(t=o.Tooltip.getTargetObject_(t)){for(t=t.tooltip;"function"==typeof t;)t=t();if("string"!=typeof t)throw Error("Tooltip function must return a string.");return t}return""},o.Tooltip.getTargetObject_=function(t){for(;t&&t.tooltip;){if("string"==typeof t.tooltip||"function"==typeof t.tooltip)return t;t=t.tooltip}return null},o.Tooltip.createDom=function(){o.Tooltip.DIV||(o.Tooltip.DIV=document.createElement("div"),o.Tooltip.DIV.className="blocklyTooltipDiv",(o.parentContainer||document.body).appendChild(o.Tooltip.DIV))},o.Tooltip.bindMouseEvents=function(t){t.mouseOverWrapper_=o.bindEvent_(t,"mouseover",null,o.Tooltip.onMouseOver_),t.mouseOutWrapper_=o.bindEvent_(t,"mouseout",null,o.Tooltip.onMouseOut_),t.addEventListener("mousemove",o.Tooltip.onMouseMove_,!1)},o.Tooltip.unbindMouseEvents=function(t){t&&(o.unbindEvent_(t.mouseOverWrapper_),o.unbindEvent_(t.mouseOutWrapper_),t.removeEventListener("mousemove",o.Tooltip.onMouseMove_))},o.Tooltip.onMouseOver_=function(t){o.Tooltip.blocked_||(t=o.Tooltip.getTargetObject_(t.currentTarget),o.Tooltip.element_!=t&&(o.Tooltip.hide(),o.Tooltip.poisonedElement_=null,o.Tooltip.element_=t),clearTimeout(o.Tooltip.mouseOutPid_))},o.Tooltip.onMouseOut_=function(t){o.Tooltip.blocked_||(o.Tooltip.mouseOutPid_=setTimeout((function(){o.Tooltip.element_=null,o.Tooltip.poisonedElement_=null,o.Tooltip.hide()}),1),clearTimeout(o.Tooltip.showPid_))},o.Tooltip.onMouseMove_=function(t){if(o.Tooltip.element_&&o.Tooltip.element_.tooltip&&!o.Tooltip.blocked_)if(o.Tooltip.visible){var e=o.Tooltip.lastX_-t.pageX;t=o.Tooltip.lastY_-t.pageY,Math.sqrt(e*e+t*t)>o.Tooltip.RADIUS_OK&&o.Tooltip.hide()}else o.Tooltip.poisonedElement_!=o.Tooltip.element_&&(clearTimeout(o.Tooltip.showPid_),o.Tooltip.lastX_=t.pageX,o.Tooltip.lastY_=t.pageY,o.Tooltip.showPid_=setTimeout(o.Tooltip.show_,o.Tooltip.HOVER_MS))},o.Tooltip.dispose=function(){o.Tooltip.element_=null,o.Tooltip.poisonedElement_=null,o.Tooltip.hide()},o.Tooltip.hide=function(){o.Tooltip.visible&&(o.Tooltip.visible=!1,o.Tooltip.DIV&&(o.Tooltip.DIV.style.display="none")),o.Tooltip.showPid_&&clearTimeout(o.Tooltip.showPid_)},o.Tooltip.block=function(){o.Tooltip.hide(),o.Tooltip.blocked_=!0},o.Tooltip.unblock=function(){o.Tooltip.blocked_=!1},o.Tooltip.show_=function(){if(!o.Tooltip.blocked_&&(o.Tooltip.poisonedElement_=o.Tooltip.element_,o.Tooltip.DIV)){o.Tooltip.DIV.textContent="";var t=o.Tooltip.getTooltipOfObject(o.Tooltip.element_);t=(t=o.utils.string.wrap(t,o.Tooltip.LIMIT)).split("\n");for(var e=0;e<t.length;e++){var i=document.createElement("div");i.appendChild(document.createTextNode(t[e])),o.Tooltip.DIV.appendChild(i)}t=o.Tooltip.element_.RTL,e=document.documentElement.clientWidth,i=document.documentElement.clientHeight,o.Tooltip.DIV.style.direction=t?"rtl":"ltr",o.Tooltip.DIV.style.display="block",o.Tooltip.visible=!0;var n=o.Tooltip.lastX_;n=t?n-(o.Tooltip.OFFSET_X+o.Tooltip.DIV.offsetWidth):n+o.Tooltip.OFFSET_X;var r=o.Tooltip.lastY_+o.Tooltip.OFFSET_Y;r+o.Tooltip.DIV.offsetHeight>i+window.scrollY&&(r-=o.Tooltip.DIV.offsetHeight+2*o.Tooltip.OFFSET_Y),t?n=Math.max(o.Tooltip.MARGINS-window.scrollX,n):n+o.Tooltip.DIV.offsetWidth>e+window.scrollX-2*o.Tooltip.MARGINS&&(n=e-o.Tooltip.DIV.offsetWidth-2*o.Tooltip.MARGINS),o.Tooltip.DIV.style.top=r+"px",o.Tooltip.DIV.style.left=n+"px"}},o.WorkspaceDragSurfaceSvg=function(t){this.container_=t,this.createDom()},o.WorkspaceDragSurfaceSvg.prototype.SVG_=null,o.WorkspaceDragSurfaceSvg.prototype.container_=null,o.WorkspaceDragSurfaceSvg.prototype.createDom=function(){this.SVG_||(this.SVG_=o.utils.dom.createSvgElement(o.utils.Svg.SVG,{xmlns:o.utils.dom.SVG_NS,"xmlns:html":o.utils.dom.HTML_NS,"xmlns:xlink":o.utils.dom.XLINK_NS,version:"1.1",class:"blocklyWsDragSurface blocklyOverflowVisible"},null),this.container_.appendChild(this.SVG_))},o.WorkspaceDragSurfaceSvg.prototype.translateSurface=function(t,e){t=t.toFixed(0),e=e.toFixed(0),this.SVG_.style.display="block",o.utils.dom.setCssTransform(this.SVG_,"translate3d("+t+"px, "+e+"px, 0px)")},o.WorkspaceDragSurfaceSvg.prototype.getSurfaceTranslation=function(){return o.utils.getRelativeXY(this.SVG_)},o.WorkspaceDragSurfaceSvg.prototype.clearAndHide=function(t){if(!t)throw Error("Couldn't clear and hide the drag surface: missing new surface.");var e=this.SVG_.childNodes[0],i=this.SVG_.childNodes[1];if(!(e&&i&&o.utils.dom.hasClass(e,"blocklyBlockCanvas")&&o.utils.dom.hasClass(i,"blocklyBubbleCanvas")))throw Error("Couldn't clear and hide the drag surface. A node was missing.");if(null!=this.previousSibling_?o.utils.dom.insertAfter(e,this.previousSibling_):t.insertBefore(e,t.firstChild),o.utils.dom.insertAfter(i,e),this.SVG_.style.display="none",this.SVG_.childNodes.length)throw Error("Drag surface was not cleared.");o.utils.dom.setCssTransform(this.SVG_,""),this.previousSibling_=null},o.WorkspaceDragSurfaceSvg.prototype.setContentsAndShow=function(t,e,o,i,n,r){if(this.SVG_.childNodes.length)throw Error("Already dragging a block.");this.previousSibling_=o,t.setAttribute("transform","translate(0, 0) scale("+r+")"),e.setAttribute("transform","translate(0, 0) scale("+r+")"),this.SVG_.setAttribute("width",i),this.SVG_.setAttribute("height",n),this.SVG_.appendChild(t),this.SVG_.appendChild(e),this.SVG_.style.display="block"},o.ASTNode=function(t,e,i){if(!e)throw Error("Cannot create a node without a location.");this.type_=t,this.isConnection_=o.ASTNode.isConnectionType_(t),this.location_=e,this.wsCoordinate_=null,this.processParams_(i||null)},o.ASTNode.types={FIELD:"field",BLOCK:"block",INPUT:"input",OUTPUT:"output",NEXT:"next",PREVIOUS:"previous",STACK:"stack",WORKSPACE:"workspace"},o.ASTNode.NAVIGATE_ALL_FIELDS=!1,o.ASTNode.DEFAULT_OFFSET_Y=-20,o.ASTNode.isConnectionType_=function(t){switch(t){case o.ASTNode.types.PREVIOUS:case o.ASTNode.types.NEXT:case o.ASTNode.types.INPUT:case o.ASTNode.types.OUTPUT:return!0}return!1},o.ASTNode.createFieldNode=function(t){return t?new o.ASTNode(o.ASTNode.types.FIELD,t):null},o.ASTNode.createConnectionNode=function(t){return t?t.type==o.INPUT_VALUE||t.type==o.NEXT_STATEMENT&&t.getParentInput()?o.ASTNode.createInputNode(t.getParentInput()):t.type==o.NEXT_STATEMENT?new o.ASTNode(o.ASTNode.types.NEXT,t):t.type==o.OUTPUT_VALUE?new o.ASTNode(o.ASTNode.types.OUTPUT,t):t.type==o.PREVIOUS_STATEMENT?new o.ASTNode(o.ASTNode.types.PREVIOUS,t):null:null},o.ASTNode.createInputNode=function(t){return t&&t.connection?new o.ASTNode(o.ASTNode.types.INPUT,t.connection):null},o.ASTNode.createBlockNode=function(t){return t?new o.ASTNode(o.ASTNode.types.BLOCK,t):null},o.ASTNode.createStackNode=function(t){return t?new o.ASTNode(o.ASTNode.types.STACK,t):null},o.ASTNode.createWorkspaceNode=function(t,e){return e&&t?new o.ASTNode(o.ASTNode.types.WORKSPACE,t,{wsCoordinate:e}):null},o.ASTNode.createTopNode=function(t){var e=t.previousConnection||t.outputConnection;return e?o.ASTNode.createConnectionNode(e):o.ASTNode.createBlockNode(t)},o.ASTNode.prototype.processParams_=function(t){t&&t.wsCoordinate&&(this.wsCoordinate_=t.wsCoordinate)},o.ASTNode.prototype.getLocation=function(){return this.location_},o.ASTNode.prototype.getType=function(){return this.type_},o.ASTNode.prototype.getWsCoordinate=function(){return this.wsCoordinate_},o.ASTNode.prototype.isConnection=function(){return this.isConnection_},o.ASTNode.prototype.findNextForInput_=function(){var t,e=this.location_.getParentInput(),i=e.getSourceBlock();for(e=i.inputList.indexOf(e)+1;t=i.inputList[e];e++){for(var n,r=t.fieldRow,s=0;n=r[s];s++)if(n.isClickable()||o.ASTNode.NAVIGATE_ALL_FIELDS)return o.ASTNode.createFieldNode(n);if(t.connection)return o.ASTNode.createInputNode(t)}return null},o.ASTNode.prototype.findNextForField_=function(){var t=this.location_,e=t.getParentInput(),i=t.getSourceBlock(),n=i.inputList.indexOf(e);for(t=e.fieldRow.indexOf(t)+1;e=i.inputList[n];n++){for(var r=e.fieldRow;t<r.length;){if(r[t].isClickable()||o.ASTNode.NAVIGATE_ALL_FIELDS)return o.ASTNode.createFieldNode(r[t]);t++}if(t=0,e.connection)return o.ASTNode.createInputNode(e)}return null},o.ASTNode.prototype.findPrevForInput_=function(){for(var t,e=this.location_.getParentInput(),i=e.getSourceBlock(),n=i.inputList.indexOf(e);t=i.inputList[n];n--){if(t.connection&&t!==e)return o.ASTNode.createInputNode(t);for(var r,s=(t=t.fieldRow).length-1;r=t[s];s--)if(r.isClickable()||o.ASTNode.NAVIGATE_ALL_FIELDS)return o.ASTNode.createFieldNode(r)}return null},o.ASTNode.prototype.findPrevForField_=function(){var t,e=this.location_,i=e.getParentInput(),n=e.getSourceBlock(),r=n.inputList.indexOf(i);for(e=i.fieldRow.indexOf(e)-1;t=n.inputList[r];r--){if(t.connection&&t!==i)return o.ASTNode.createInputNode(t);for(t=t.fieldRow;-1<e;){if(t[e].isClickable()||o.ASTNode.NAVIGATE_ALL_FIELDS)return o.ASTNode.createFieldNode(t[e]);e--}0<=r-1&&(e=n.inputList[r-1].fieldRow.length-1)}return null},o.ASTNode.prototype.navigateBetweenStacks_=function(t){var e=this.getLocation();if(e instanceof o.Block||(e=e.getSourceBlock()),!e||!e.workspace)return null;var i=e.getRootBlock();e=i.workspace.getTopBlocks(!0);for(var n,r=0;n=e[r];r++)if(i.id==n.id)return-1==(t=r+(t?1:-1))||t==e.length?null:o.ASTNode.createStackNode(e[t]);throw Error("Couldn't find "+(t?"next":"previous")+" stack?!")},o.ASTNode.prototype.findTopASTNodeForBlock_=function(t){var e=t.previousConnection||t.outputConnection;return e?o.ASTNode.createConnectionNode(e):o.ASTNode.createBlockNode(t)},o.ASTNode.prototype.getOutAstNodeForBlock_=function(t){if(!t)return null;var e=(t=t.getTopStackBlock()).previousConnection||t.outputConnection;return e&&e.targetConnection&&e.targetConnection.getParentInput()?o.ASTNode.createInputNode(e.targetConnection.getParentInput()):o.ASTNode.createStackNode(t)},o.ASTNode.prototype.findFirstFieldOrInput_=function(t){t=t.inputList;for(var e,i=0;e=t[i];i++){for(var n,r=e.fieldRow,s=0;n=r[s];s++)if(n.isClickable()||o.ASTNode.NAVIGATE_ALL_FIELDS)return o.ASTNode.createFieldNode(n);if(e.connection)return o.ASTNode.createInputNode(e)}return null},o.ASTNode.prototype.getSourceBlock=function(){return this.getType()===o.ASTNode.types.BLOCK||this.getType()===o.ASTNode.types.STACK?this.getLocation():this.getType()===o.ASTNode.types.WORKSPACE?null:this.getLocation().getSourceBlock()},o.ASTNode.prototype.next=function(){switch(this.type_){case o.ASTNode.types.STACK:return this.navigateBetweenStacks_(!0);case o.ASTNode.types.OUTPUT:var t=this.location_;return o.ASTNode.createBlockNode(t.getSourceBlock());case o.ASTNode.types.FIELD:return this.findNextForField_();case o.ASTNode.types.INPUT:return this.findNextForInput_();case o.ASTNode.types.BLOCK:return o.ASTNode.createConnectionNode(this.location_.nextConnection);case o.ASTNode.types.PREVIOUS:return t=this.location_,o.ASTNode.createBlockNode(t.getSourceBlock());case o.ASTNode.types.NEXT:return t=this.location_,o.ASTNode.createConnectionNode(t.targetConnection)}return null},o.ASTNode.prototype.in=function(){switch(this.type_){case o.ASTNode.types.WORKSPACE:var t=this.location_.getTopBlocks(!0);if(0<t.length)return o.ASTNode.createStackNode(t[0]);break;case o.ASTNode.types.STACK:return t=this.location_,this.findTopASTNodeForBlock_(t);case o.ASTNode.types.BLOCK:return t=this.location_,this.findFirstFieldOrInput_(t);case o.ASTNode.types.INPUT:return o.ASTNode.createConnectionNode(this.location_.targetConnection)}return null},o.ASTNode.prototype.prev=function(){switch(this.type_){case o.ASTNode.types.STACK:return this.navigateBetweenStacks_(!1);case o.ASTNode.types.FIELD:return this.findPrevForField_();case o.ASTNode.types.INPUT:return this.findPrevForInput_();case o.ASTNode.types.BLOCK:var t=this.location_;return o.ASTNode.createConnectionNode(t.previousConnection||t.outputConnection);case o.ASTNode.types.PREVIOUS:if((t=(t=this.location_).targetConnection)&&!t.getParentInput())return o.ASTNode.createConnectionNode(t);break;case o.ASTNode.types.NEXT:return t=this.location_,o.ASTNode.createBlockNode(t.getSourceBlock())}return null},o.ASTNode.prototype.out=function(){switch(this.type_){case o.ASTNode.types.STACK:var t=this.location_,e=t.getRelativeToSurfaceXY();return e=new o.utils.Coordinate(e.x,e.y+o.ASTNode.DEFAULT_OFFSET_Y),o.ASTNode.createWorkspaceNode(t.workspace,e);case o.ASTNode.types.OUTPUT:return(e=(t=this.location_).targetConnection)?o.ASTNode.createConnectionNode(e):o.ASTNode.createStackNode(t.getSourceBlock());case o.ASTNode.types.FIELD:return o.ASTNode.createBlockNode(this.location_.getSourceBlock());case o.ASTNode.types.INPUT:return t=this.location_,o.ASTNode.createBlockNode(t.getSourceBlock());case o.ASTNode.types.BLOCK:return t=this.location_,this.getOutAstNodeForBlock_(t);case o.ASTNode.types.PREVIOUS:case o.ASTNode.types.NEXT:return t=this.location_,this.getOutAstNodeForBlock_(t.getSourceBlock())}return null},o.Blocks=Object.create(null),o.utils.deprecation={},o.utils.deprecation.warn=function(t,e,o,i){t=t+" was deprecated on "+e+" and will be deleted on "+o+".",i&&(t+="\nUse "+i+" instead."),console.warn(t)},o.Connection=function(t,e){this.sourceBlock_=t,this.type=e},o.Connection.CAN_CONNECT=0,o.Connection.REASON_SELF_CONNECTION=1,o.Connection.REASON_WRONG_TYPE=2,o.Connection.REASON_TARGET_NULL=3,o.Connection.REASON_CHECKS_FAILED=4,o.Connection.REASON_DIFFERENT_WORKSPACES=5,o.Connection.REASON_SHADOW_PARENT=6,o.Connection.REASON_DRAG_CHECKS_FAILED=7,o.Connection.prototype.targetConnection=null,o.Connection.prototype.disposed=!1,o.Connection.prototype.check_=null,o.Connection.prototype.shadowDom_=null,o.Connection.prototype.x=0,o.Connection.prototype.y=0,o.Connection.prototype.connect_=function(t){var e,i=this,n=i.getSourceBlock(),r=t.getSourceBlock();if(t.isConnected()&&t.disconnect(),i.isConnected()){var s=i.targetBlock(),a=i.getShadowDom();if(i.shadowDom_=null,s.isShadow())a=o.Xml.blockToDom(s),s.dispose(!1),s=null;else if(i.type==o.INPUT_VALUE){if(!s.outputConnection)throw Error("Orphan block does not have an output connection.");var l=o.Connection.lastConnectionInRow(r,s);l&&(s.outputConnection.connect(l),s=null)}else if(i.type==o.NEXT_STATEMENT){if(!s.previousConnection)throw Error("Orphan block does not have a previous connection.");for(l=r;l.nextConnection;){var c=l.getNextBlock();if(!c||c.isShadow()){s.workspace.connectionChecker.canConnect(s.previousConnection,l.nextConnection,!1)&&(l.nextConnection.connect(s.previousConnection),s=null);break}l=c}}if(s&&(i.disconnect(),o.Events.recordUndo)){var u=o.Events.getGroup();setTimeout((function(){s.workspace&&!s.getParent()&&(o.Events.setGroup(u),s.outputConnection?s.outputConnection.onFailedConnect(i):s.previousConnection&&s.previousConnection.onFailedConnect(i),o.Events.setGroup(!1))}),o.BUMP_DELAY)}i.shadowDom_=a}o.Events.isEnabled()&&(e=new o.Events.BlockMove(r)),o.Connection.connectReciprocally_(i,t),r.setParent(n),e&&(e.recordNew(),o.Events.fire(e))},o.Connection.prototype.dispose=function(){if(this.isConnected()){this.setShadowDom(null);var t=this.targetBlock();t&&t.unplug()}this.disposed=!0},o.Connection.prototype.getSourceBlock=function(){return this.sourceBlock_},o.Connection.prototype.isSuperior=function(){return this.type==o.INPUT_VALUE||this.type==o.NEXT_STATEMENT},o.Connection.prototype.isConnected=function(){return!!this.targetConnection},o.Connection.prototype.canConnectWithReason=function(t){return o.utils.deprecation.warn("Connection.prototype.canConnectWithReason","July 2020","July 2021","the workspace's connection checker"),this.getConnectionChecker().canConnectWithReason(this,t,!1)},o.Connection.prototype.checkConnection=function(t){o.utils.deprecation.warn("Connection.prototype.checkConnection","July 2020","July 2021","the workspace's connection checker");var e=this.getConnectionChecker(),i=e.canConnectWithReason(this,t,!1);if(i!=o.Connection.CAN_CONNECT)throw Error(e.getErrorMessage(i,this,t))},o.Connection.prototype.getConnectionChecker=function(){return this.sourceBlock_.workspace.connectionChecker},o.Connection.prototype.isConnectionAllowed=function(t){return o.utils.deprecation.warn("Connection.prototype.isConnectionAllowed","July 2020","July 2021","the workspace's connection checker"),this.getConnectionChecker().canConnect(this,t,!0)},o.Connection.prototype.onFailedConnect=function(t){},o.Connection.prototype.connect=function(t){if(this.targetConnection!=t&&this.getConnectionChecker().canConnect(this,t,!1)){var e=o.Events.getGroup();e||o.Events.setGroup(!0),this.isSuperior()?this.connect_(t):t.connect_(this),e||o.Events.setGroup(!1)}},o.Connection.connectReciprocally_=function(t,e){if(!t||!e)throw Error("Cannot connect null connections.");t.targetConnection=e,e.targetConnection=t},o.Connection.singleConnection_=function(t,e){var i=null;e=e.outputConnection;for(var n=0;n<t.inputList.length;n++){var r=t.inputList[n].connection,s=e.getConnectionChecker();if(r&&r.type==o.INPUT_VALUE&&s.canConnect(e,r,!1)){if(i)return null;i=r}}return i},o.Connection.lastConnectionInRow=function(t,e){for(var i;i=o.Connection.singleConnection_(t,e);)if(!(t=i.targetBlock())||t.isShadow())return i;return null},o.Connection.prototype.disconnect=function(){var t=this.targetConnection;if(!t)throw Error("Source connection not connected.");if(t.targetConnection!=this)throw Error("Target connection not connected to source connection.");if(this.isSuperior()){var e=this.sourceBlock_,i=t.getSourceBlock();t=this}else e=t.getSourceBlock(),i=this.sourceBlock_;var n=o.Events.getGroup();n||o.Events.setGroup(!0),this.disconnectInternal_(e,i),i.isShadow()||t.respawnShadow_(),n||o.Events.setGroup(!1)},o.Connection.prototype.disconnectInternal_=function(t,e){var i;o.Events.isEnabled()&&(i=new o.Events.BlockMove(e)),this.targetConnection=this.targetConnection.targetConnection=null,e.setParent(null),i&&(i.recordNew(),o.Events.fire(i))},o.Connection.prototype.respawnShadow_=function(){var t=this.getSourceBlock(),e=this.getShadowDom();if(t.workspace&&e)if((t=o.Xml.domToBlock(e,t.workspace)).outputConnection)this.connect(t.outputConnection);else{if(!t.previousConnection)throw Error("Child block does not have output or previous statement.");this.connect(t.previousConnection)}},o.Connection.prototype.targetBlock=function(){return this.isConnected()?this.targetConnection.getSourceBlock():null},o.Connection.prototype.checkType=function(t){return o.utils.deprecation.warn("Connection.prototype.checkType","October 2019","January 2021","the workspace's connection checker"),this.getConnectionChecker().canConnect(this,t,!1)},o.Connection.prototype.checkType_=function(t){return o.utils.deprecation.warn("Connection.prototype.checkType_","October 2019","January 2021","the workspace's connection checker"),this.checkType(t)},o.Connection.prototype.onCheckChanged_=function(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()},o.Connection.prototype.setCheck=function(t){return t?(Array.isArray(t)||(t=[t]),this.check_=t,this.onCheckChanged_()):this.check_=null,this},o.Connection.prototype.getCheck=function(){return this.check_},o.Connection.prototype.setShadowDom=function(t){this.shadowDom_=t,(t=this.targetBlock())?t.isShadow()&&(t.dispose(!1),this.respawnShadow_()):this.respawnShadow_()},o.Connection.prototype.getShadowDom=function(){return this.shadowDom_},o.Connection.prototype.neighbours=function(t){return[]},o.Connection.prototype.getParentInput=function(){for(var t=null,e=this.sourceBlock_,o=e.inputList,i=0;i<e.inputList.length;i++)if(o[i].connection===this){t=o[i];break}return t},o.Connection.prototype.toString=function(){var t=this.sourceBlock_;if(!t)return"Orphan Connection";if(t.outputConnection==this)var e="Output Connection of ";else if(t.previousConnection==this)e="Previous Connection of ";else if(t.nextConnection==this)e="Next Connection of ";else{e=null;for(var o,i=0;o=t.inputList[i];i++)if(o.connection==this){e=o;break}if(!e)return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection";e='Input "'+e.name+'" connection on '}return e+t.toDevString()},o.Extensions={},o.Extensions.ALL_={},o.Extensions.register=function(t,e){if("string"!=typeof t||""==t.trim())throw Error('Error: Invalid extension name "'+t+'"');if(o.Extensions.ALL_[t])throw Error('Error: Extension "'+t+'" is already registered.');if("function"!=typeof e)throw Error('Error: Extension "'+t+'" must be a function');o.Extensions.ALL_[t]=e},o.Extensions.registerMixin=function(t,e){if(!e||"object"!=typeof e)throw Error('Error: Mixin "'+t+'" must be a object');o.Extensions.register(t,(function(){this.mixin(e)}))},o.Extensions.registerMutator=function(t,e,i,n){var r='Error when registering mutator "'+t+'": ';o.Extensions.checkHasFunction_(r,e.domToMutation,"domToMutation"),o.Extensions.checkHasFunction_(r,e.mutationToDom,"mutationToDom");var s=o.Extensions.checkMutatorDialog_(e,r);if(i&&"function"!=typeof i)throw Error('Extension "'+t+'" is not a function');o.Extensions.register(t,(function(){if(s){if(!o.Mutator)throw Error(r+"Missing require for Blockly.Mutator");this.setMutator(new o.Mutator(n||[]))}this.mixin(e),i&&i.apply(this)}))},o.Extensions.unregister=function(t){o.Extensions.ALL_[t]?delete o.Extensions.ALL_[t]:console.warn('No extension mapping for name "'+t+'" found to unregister')},o.Extensions.apply=function(t,e,i){var n=o.Extensions.ALL_[t];if("function"!=typeof n)throw Error('Error: Extension "'+t+'" not found.');if(i)o.Extensions.checkNoMutatorProperties_(t,e);else var r=o.Extensions.getMutatorProperties_(e);if(n.apply(e),i)o.Extensions.checkBlockHasMutatorProperties_('Error after applying mutator "'+t+'": ',e);else if(!o.Extensions.mutatorPropertiesMatch_(r,e))throw Error('Error when applying extension "'+t+'": mutation properties changed when applying a non-mutator extension.')},o.Extensions.checkHasFunction_=function(t,e,o){if(!e)throw Error(t+'missing required property "'+o+'"');if("function"!=typeof e)throw Error(t+'" required property "'+o+'" must be a function')},o.Extensions.checkNoMutatorProperties_=function(t,e){if(o.Extensions.getMutatorProperties_(e).length)throw Error('Error: tried to apply mutation "'+t+'" to a block that already has mutator functions.  Block id: '+e.id)},o.Extensions.checkMutatorDialog_=function(t,e){var o=void 0!==t.compose,i=void 0!==t.decompose;if(o&&i){if("function"!=typeof t.compose)throw Error(e+"compose must be a function.");if("function"!=typeof t.decompose)throw Error(e+"decompose must be a function.");return!0}if(o||i)throw Error(e+'Must have both or neither of "compose" and "decompose"');return!1},o.Extensions.checkBlockHasMutatorProperties_=function(t,e){if("function"!=typeof e.domToMutation)throw Error(t+'Applying a mutator didn\'t add "domToMutation"');if("function"!=typeof e.mutationToDom)throw Error(t+'Applying a mutator didn\'t add "mutationToDom"');o.Extensions.checkMutatorDialog_(e,t)},o.Extensions.getMutatorProperties_=function(t){var e=[];return void 0!==t.domToMutation&&e.push(t.domToMutation),void 0!==t.mutationToDom&&e.push(t.mutationToDom),void 0!==t.compose&&e.push(t.compose),void 0!==t.decompose&&e.push(t.decompose),e},o.Extensions.mutatorPropertiesMatch_=function(t,e){if((e=o.Extensions.getMutatorProperties_(e)).length!=t.length)return!1;for(var i=0;i<e.length;i++)if(t[i]!=e[i])return!1;return!0},o.Extensions.buildTooltipForDropdown=function(t,e){var i=[];return"object"==typeof document&&o.utils.runAfterPageLoad((function(){for(var t in e)o.utils.checkMessageReferences(e[t])})),function(){this.type&&-1==i.indexOf(this.type)&&(o.Extensions.checkDropdownOptionsInTable_(this,t,e),i.push(this.type)),this.setTooltip(function(){var n=String(this.getFieldValue(t)),r=e[n];return null==r?-1==i.indexOf(this.type)&&(n="No tooltip mapping for value "+n+" of field "+t,null!=this.type&&(n+=" of block type "+this.type),console.warn(n+".")):r=o.utils.replaceMessageReferences(r),r}.bind(this))}},o.Extensions.checkDropdownOptionsInTable_=function(t,e,o){var i=t.getField(e);if(!i.isOptionListDynamic()){i=i.getOptions();for(var n=0;n<i.length;++n){var r=i[n][1];null==o[r]&&console.warn("No tooltip mapping for value "+r+" of field "+e+" of block type "+t.type)}}},o.Extensions.buildTooltipWithFieldText=function(t,e){return"object"==typeof document&&o.utils.runAfterPageLoad((function(){o.utils.checkMessageReferences(t)})),function(){this.setTooltip(function(){var i=this.getField(e);return o.utils.replaceMessageReferences(t).replace("%1",i?i.getText():"")}.bind(this))}},o.Extensions.extensionParentTooltip_=function(){this.tooltipWhenNotConnected_=this.tooltip,this.setTooltip(function(){var t=this.getParent();return t&&t.getInputsInline()&&t.tooltip||this.tooltipWhenNotConnected_}.bind(this))},o.Extensions.register("parent_tooltip_when_inline",o.Extensions.extensionParentTooltip_),o.fieldRegistry={},o.fieldRegistry.register=function(t,e){o.registry.register(o.registry.Type.FIELD,t,e)},o.fieldRegistry.unregister=function(t){o.registry.unregister(o.registry.Type.FIELD,t)},o.fieldRegistry.fromJson=function(t){var e=o.registry.getObject(o.registry.Type.FIELD,t.type);return e?e.fromJson(t):(console.warn("Blockly could not create a field of type "+t.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null)},o.blockAnimations={},o.blockAnimations.disconnectPid_=0,o.blockAnimations.disconnectGroup_=null,o.blockAnimations.disposeUiEffect=function(t){var e=t.workspace,i=t.getSvgRoot();e.getAudioManager().play("delete"),t=e.getSvgXY(i),(i=i.cloneNode(!0)).translateX_=t.x,i.translateY_=t.y,i.setAttribute("transform","translate("+t.x+","+t.y+")"),e.getParentSvg().appendChild(i),i.bBox_=i.getBBox(),o.blockAnimations.disposeUiStep_(i,e.RTL,new Date,e.scale)},o.blockAnimations.disposeUiStep_=function(t,e,i,n){var r=(new Date-i)/150;1<r?o.utils.dom.removeNode(t):(t.setAttribute("transform","translate("+(t.translateX_+(e?-1:1)*t.bBox_.width*n/2*r)+","+(t.translateY_+t.bBox_.height*n*r)+") scale("+(1-r)*n+")"),setTimeout(o.blockAnimations.disposeUiStep_,10,t,e,i,n))},o.blockAnimations.connectionUiEffect=function(t){var e=t.workspace,i=e.scale;if(e.getAudioManager().play("click"),!(1>i)){var n=e.getSvgXY(t.getSvgRoot());t.outputConnection?(n.x+=(t.RTL?3:-3)*i,n.y+=13*i):t.previousConnection&&(n.x+=(t.RTL?-23:23)*i,n.y+=3*i),t=o.utils.dom.createSvgElement(o.utils.Svg.CIRCLE,{cx:n.x,cy:n.y,r:0,fill:"none",stroke:"#888","stroke-width":10},e.getParentSvg()),o.blockAnimations.connectionUiStep_(t,new Date,i)}},o.blockAnimations.connectionUiStep_=function(t,e,i){var n=(new Date-e)/150;1<n?o.utils.dom.removeNode(t):(t.setAttribute("r",25*n*i),t.style.opacity=1-n,o.blockAnimations.disconnectPid_=setTimeout(o.blockAnimations.connectionUiStep_,10,t,e,i))},o.blockAnimations.disconnectUiEffect=function(t){if(t.workspace.getAudioManager().play("disconnect"),!(1>t.workspace.scale)){var e=t.getHeightWidth().height;e=Math.atan(10/e)/Math.PI*180,t.RTL||(e*=-1),o.blockAnimations.disconnectUiStep_(t.getSvgRoot(),e,new Date)}},o.blockAnimations.disconnectUiStep_=function(t,e,i){var n=(new Date-i)/200;1<n?t.skew_="":(t.skew_="skewX("+Math.round(Math.sin(n*Math.PI*3)*(1-n)*e)+")",o.blockAnimations.disconnectGroup_=t,o.blockAnimations.disconnectPid_=setTimeout(o.blockAnimations.disconnectUiStep_,10,t,e,i)),t.setAttribute("transform",t.translate_+t.skew_)},o.blockAnimations.disconnectUiStop=function(){if(o.blockAnimations.disconnectGroup_){clearTimeout(o.blockAnimations.disconnectPid_);var t=o.blockAnimations.disconnectGroup_;t.skew_="",t.setAttribute("transform",t.translate_),o.blockAnimations.disconnectGroup_=null}},o.Events.BlockDrag=function(t,e,i){o.Events.BlockDrag.superClass_.constructor.call(this,t?t.workspace.id:void 0),this.blockId=t?t.id:null,this.isStart=e,this.blocks=i},o.utils.object.inherits(o.Events.BlockDrag,o.Events.UiBase),o.Events.BlockDrag.prototype.type=o.Events.BLOCK_DRAG,o.Events.BlockDrag.prototype.toJson=function(){var t=o.Events.BlockDrag.superClass_.toJson.call(this);return t.isStart=this.isStart,t.blockId=this.blockId,t.blocks=this.blocks,t},o.Events.BlockDrag.prototype.fromJson=function(t){o.Events.BlockDrag.superClass_.fromJson.call(this,t),this.isStart=t.isStart,this.blockId=t.blockId,this.blocks=t.blocks},o.registry.register(o.registry.Type.EVENT,o.Events.BLOCK_DRAG,o.Events.BlockDrag),o.InsertionMarkerManager=function(t){this.topBlock_=o.selected=t,this.workspace_=t.workspace,this.lastMarker_=this.lastOnStack_=null,this.firstMarker_=this.createMarkerBlock_(this.topBlock_),this.localConnection_=this.closestConnection_=null,this.wouldDeleteBlock_=!1,this.fadedBlock_=this.highlightedBlock_=this.markerConnection_=null,this.availableConnections_=this.initAvailableConnections_()},o.InsertionMarkerManager.PREVIEW_TYPE={INSERTION_MARKER:0,INPUT_OUTLINE:1,REPLACEMENT_FADE:2},o.InsertionMarkerManager.prototype.dispose=function(){this.availableConnections_.length=0,o.Events.disable();try{this.firstMarker_&&this.firstMarker_.dispose(),this.lastMarker_&&this.lastMarker_.dispose()}finally{o.Events.enable()}},o.InsertionMarkerManager.prototype.updateAvailableConnections=function(){this.availableConnections_=this.initAvailableConnections_()},o.InsertionMarkerManager.prototype.wouldDeleteBlock=function(){return this.wouldDeleteBlock_},o.InsertionMarkerManager.prototype.wouldConnectBlock=function(){return!!this.closestConnection_},o.InsertionMarkerManager.prototype.applyConnections=function(){if(this.closestConnection_&&(o.Events.disable(),this.hidePreview_(),o.Events.enable(),this.localConnection_.connect(this.closestConnection_),this.topBlock_.rendered)){var t=this.localConnection_.isSuperior()?this.closestConnection_:this.localConnection_;o.blockAnimations.connectionUiEffect(t.getSourceBlock()),this.topBlock_.getRootBlock().bringToFront()}},o.InsertionMarkerManager.prototype.update=function(t,e){var i=this.getCandidate_(t);((this.wouldDeleteBlock_=this.shouldDelete_(i,e))||this.shouldUpdatePreviews_(i,t))&&(o.Events.disable(),this.maybeHidePreview_(i),this.maybeShowPreview_(i),o.Events.enable())},o.InsertionMarkerManager.prototype.createMarkerBlock_=function(t){var e=t.type;o.Events.disable();try{var i=this.workspace_.newBlock(e);if(i.setInsertionMarker(!0),t.mutationToDom){var n=t.mutationToDom();n&&i.domToMutation(n)}for(e=0;e<t.inputList.length;e++){var r=t.inputList[e];if(r.name!=o.Block.COLLAPSED_INPUT_NAME){var s=i.inputList[e];for(n=0;n<r.fieldRow.length;n++)s.fieldRow[n].setValue(r.fieldRow[n].getValue())}}i.setCollapsed(t.isCollapsed()),i.setInputsInline(t.getInputsInline()),i.initSvg(),i.getSvgRoot().setAttribute("visibility","hidden")}finally{o.Events.enable()}return i},o.InsertionMarkerManager.prototype.initAvailableConnections_=function(){var t=this.topBlock_.getConnections_(!1),e=this.topBlock_.lastConnectionInStack();if(e&&e!=this.topBlock_.nextConnection){if(t.push(e),this.lastOnStack_=e,this.lastMarker_){o.Events.disable();try{this.lastMarker_.dispose()}finally{o.Events.enable()}}this.lastMarker_=this.createMarkerBlock_(e.getSourceBlock())}return t},o.InsertionMarkerManager.prototype.shouldUpdatePreviews_=function(t,e){var i=t.local,n=t.closest;return t=t.radius,i&&n?this.localConnection_&&this.closestConnection_?!(this.closestConnection_==n&&this.localConnection_==i||(i=this.localConnection_.x+e.x-this.closestConnection_.x,e=this.localConnection_.y+e.y-this.closestConnection_.y,e=Math.sqrt(i*i+e*e),n&&t>e-o.CURRENT_CONNECTION_PREFERENCE)):!this.localConnection_&&!this.closestConnection_||(console.error("Only one of localConnection_ and closestConnection_ was set."),console.error("Returning true from shouldUpdatePreviews, but it's not clear why."),!0):!(!this.localConnection_||!this.closestConnection_)},o.InsertionMarkerManager.prototype.getCandidate_=function(t){for(var e=this.getStartRadius_(),o=null,i=null,n=0;n<this.availableConnections_.length;n++){var r=this.availableConnections_[n],s=r.closest(e,t);s.connection&&(o=s.connection,i=r,e=s.radius)}return{closest:o,local:i,radius:e}},o.InsertionMarkerManager.prototype.getStartRadius_=function(){return this.closestConnection_&&this.localConnection_?o.CONNECTING_SNAP_RADIUS:o.SNAP_RADIUS},o.InsertionMarkerManager.prototype.shouldDelete_=function(t,e){return t=t&&!!t.closest&&e!=o.DELETE_AREA_TOOLBOX,!!e&&!this.topBlock_.getParent()&&this.topBlock_.isDeletable()&&!t},o.InsertionMarkerManager.prototype.maybeShowPreview_=function(t){if(!this.wouldDeleteBlock_){var e=t.closest;t=t.local,e&&(e==this.closestConnection_||e.getSourceBlock().isInsertionMarker()?console.log("Trying to connect to an insertion marker"):(this.closestConnection_=e,this.localConnection_=t,this.showPreview_()))}},o.InsertionMarkerManager.prototype.showPreview_=function(){var t=this.closestConnection_,e=this.workspace_.getRenderer();switch(e.getConnectionPreviewMethod(t,this.localConnection_,this.topBlock_)){case o.InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE:this.showInsertionInputOutline_();break;case o.InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:this.showInsertionMarker_();break;case o.InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:this.showReplacementFade_()}t&&e.shouldHighlightConnection(t)&&t.highlight()},o.InsertionMarkerManager.prototype.maybeHidePreview_=function(t){if(t.closest){var e=this.closestConnection_!=t.closest;t=this.localConnection_!=t.local,this.closestConnection_&&this.localConnection_&&(e||t||this.wouldDeleteBlock_)&&this.hidePreview_()}else this.hidePreview_();this.localConnection_=this.closestConnection_=this.markerConnection_=null},o.InsertionMarkerManager.prototype.hidePreview_=function(){this.closestConnection_&&this.closestConnection_.targetBlock()&&this.workspace_.getRenderer().shouldHighlightConnection(this.closestConnection_)&&this.closestConnection_.unhighlight(),this.fadedBlock_?this.hideReplacementFade_():this.highlightedBlock_?this.hideInsertionInputOutline_():this.markerConnection_&&this.hideInsertionMarker_()},o.InsertionMarkerManager.prototype.showInsertionMarker_=function(){var t=this.localConnection_,e=this.closestConnection_,o=this.lastOnStack_&&t==this.lastOnStack_?this.lastMarker_:this.firstMarker_;if((t=o.getMatchingConnection(t.getSourceBlock(),t))==this.markerConnection_)throw Error("Made it to showInsertionMarker_ even though the marker isn't changing");o.render(),o.rendered=!0,o.getSvgRoot().setAttribute("visibility","visible"),t&&e&&o.positionNearConnection(t,e),e&&t.connect(e),this.markerConnection_=t},o.InsertionMarkerManager.prototype.hideInsertionMarker_=function(){if(this.markerConnection_){var t=this.markerConnection_,e=t.getSourceBlock(),i=e.nextConnection,n=e.previousConnection,r=e.outputConnection;if(r=t.type==o.INPUT_VALUE&&!(r&&r.targetConnection),!(t!=i||n&&n.targetConnection)||r?t.targetBlock().unplug(!1):t.type==o.NEXT_STATEMENT&&t!=i?((i=t.targetConnection).getSourceBlock().unplug(!1),n=n?n.targetConnection:null,e.unplug(!0),n&&n.connect(i)):e.unplug(!0),t.targetConnection)throw Error("markerConnection_ still connected at the end of disconnectInsertionMarker");this.markerConnection_=null,e.getSvgRoot().setAttribute("visibility","hidden")}else console.log("No insertion marker connection to disconnect")},o.InsertionMarkerManager.prototype.showInsertionInputOutline_=function(){var t=this.closestConnection_;this.highlightedBlock_=t.getSourceBlock(),this.highlightedBlock_.highlightShapeForInput(t,!0)},o.InsertionMarkerManager.prototype.hideInsertionInputOutline_=function(){this.highlightedBlock_.highlightShapeForInput(this.closestConnection_,!1),this.highlightedBlock_=null},o.InsertionMarkerManager.prototype.showReplacementFade_=function(){this.fadedBlock_=this.closestConnection_.targetBlock(),this.fadedBlock_.fadeForReplacement(!0)},o.InsertionMarkerManager.prototype.hideReplacementFade_=function(){this.fadedBlock_.fadeForReplacement(!1),this.fadedBlock_=null},o.InsertionMarkerManager.prototype.getInsertionMarkers=function(){var t=[];return this.firstMarker_&&t.push(this.firstMarker_),this.lastMarker_&&t.push(this.lastMarker_),t},o.BlockDragger=function(t,e){this.draggingBlock_=t,this.workspace_=e,this.draggedConnectionManager_=new o.InsertionMarkerManager(this.draggingBlock_),this.deleteArea_=null,this.wouldDeleteBlock_=!1,this.startXY_=this.draggingBlock_.getRelativeToSurfaceXY(),this.dragIconData_=o.BlockDragger.initIconData_(t)},o.BlockDragger.prototype.dispose=function(){this.dragIconData_.length=0,this.draggedConnectionManager_&&this.draggedConnectionManager_.dispose()},o.BlockDragger.initIconData_=function(t){var e=[];t=t.getDescendants(!1);for(var o,i=0;o=t[i];i++){o=o.getIcons();for(var n=0;n<o.length;n++){var r={location:o[n].getIconLocation(),icon:o[n]};e.push(r)}}return e},o.BlockDragger.prototype.startBlockDrag=function(t,e){o.Events.getGroup()||o.Events.setGroup(!0),this.fireDragStartEvent_(),this.workspace_.isMutator&&this.draggingBlock_.bringToFront(),o.utils.dom.startTextWidthCache(),this.workspace_.setResizesEnabled(!1),o.blockAnimations.disconnectUiStop(),(this.draggingBlock_.getParent()||e&&this.draggingBlock_.nextConnection&&this.draggingBlock_.nextConnection.targetBlock())&&(this.draggingBlock_.unplug(e),t=this.pixelsToWorkspaceUnits_(t),t=o.utils.Coordinate.sum(this.startXY_,t),this.draggingBlock_.translate(t.x,t.y),o.blockAnimations.disconnectUiEffect(this.draggingBlock_),this.draggedConnectionManager_.updateAvailableConnections()),this.draggingBlock_.setDragging(!0),this.draggingBlock_.moveToDragSurface(),(t=this.workspace_.getToolbox())&&"function"==typeof t.addStyle&&(e=this.draggingBlock_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab",t.addStyle(e))},o.BlockDragger.prototype.fireDragStartEvent_=function(){var t=new o.Events.BlockDrag(this.draggingBlock_,!0,this.draggingBlock_.getDescendants(!1));o.Events.fire(t)},o.BlockDragger.prototype.dragBlock=function(t,e){e=this.pixelsToWorkspaceUnits_(e);var i=o.utils.Coordinate.sum(this.startXY_,e);this.draggingBlock_.moveDuringDrag(i),this.dragIcons_(e),this.deleteArea_=this.workspace_.isDeleteArea(t),this.draggedConnectionManager_.update(e,this.deleteArea_),this.updateCursorDuringBlockDrag_()},o.BlockDragger.prototype.endBlockDrag=function(t,e){this.dragBlock(t,e),this.dragIconData_=[],this.fireDragEndEvent_(),o.utils.dom.stopTextWidthCache(),o.blockAnimations.disconnectUiStop(),t=this.pixelsToWorkspaceUnits_(e),e=o.utils.Coordinate.sum(this.startXY_,t),this.draggingBlock_.moveOffDragSurface(e),this.maybeDeleteBlock_()||(this.draggingBlock_.moveConnections(t.x,t.y),this.draggingBlock_.setDragging(!1),this.fireMoveEvent_(),this.draggedConnectionManager_.wouldConnectBlock()?this.draggedConnectionManager_.applyConnections():this.draggingBlock_.render(),this.draggingBlock_.scheduleSnapAndBump()),this.workspace_.setResizesEnabled(!0),(t=this.workspace_.getToolbox())&&"function"==typeof t.removeStyle&&(e=this.draggingBlock_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab",t.removeStyle(e)),o.Events.setGroup(!1)},o.BlockDragger.prototype.fireDragEndEvent_=function(){var t=new o.Events.BlockDrag(this.draggingBlock_,!1,this.draggingBlock_.getDescendants(!1));o.Events.fire(t)},o.BlockDragger.prototype.fireMoveEvent_=function(){var t=new o.Events.BlockMove(this.draggingBlock_);t.oldCoordinate=this.startXY_,t.recordNew(),o.Events.fire(t)},o.BlockDragger.prototype.maybeDeleteBlock_=function(){var t=this.workspace_.trashcan;return this.wouldDeleteBlock_?(t&&setTimeout(t.closeLid.bind(t),100),this.fireMoveEvent_(),this.draggingBlock_.dispose(!1,!0),o.draggingConnections=[]):t&&t.closeLid(),this.wouldDeleteBlock_},o.BlockDragger.prototype.updateCursorDuringBlockDrag_=function(){this.wouldDeleteBlock_=this.draggedConnectionManager_.wouldDeleteBlock();var t=this.workspace_.trashcan;this.wouldDeleteBlock_?(this.draggingBlock_.setDeleteStyle(!0),this.deleteArea_==o.DELETE_AREA_TRASH&&t&&t.setLidOpen(!0)):(this.draggingBlock_.setDeleteStyle(!1),t&&t.setLidOpen(!1))},o.BlockDragger.prototype.pixelsToWorkspaceUnits_=function(t){return t=new o.utils.Coordinate(t.x/this.workspace_.scale,t.y/this.workspace_.scale),this.workspace_.isMutator&&t.scale(1/this.workspace_.options.parentWorkspace.scale),t},o.BlockDragger.prototype.dragIcons_=function(t){for(var e=0;e<this.dragIconData_.length;e++){var i=this.dragIconData_[e];i.icon.setIconLocation(o.utils.Coordinate.sum(i.location,t))}},o.BlockDragger.prototype.getInsertionMarkers=function(){return this.draggedConnectionManager_&&this.draggedConnectionManager_.getInsertionMarkers?this.draggedConnectionManager_.getInsertionMarkers():[]},o.ConnectionChecker=function(){},o.ConnectionChecker.prototype.canConnect=function(t,e,i,n){return this.canConnectWithReason(t,e,i,n)==o.Connection.CAN_CONNECT},o.ConnectionChecker.prototype.canConnectWithReason=function(t,e,i,n){var r=this.doSafetyChecks(t,e);return r!=o.Connection.CAN_CONNECT?r:this.doTypeChecks(t,e)?i&&!this.doDragChecks(t,e,n||0)?o.Connection.REASON_DRAG_CHECKS_FAILED:o.Connection.CAN_CONNECT:o.Connection.REASON_CHECKS_FAILED},o.ConnectionChecker.prototype.getErrorMessage=function(t,e,i){switch(t){case o.Connection.REASON_SELF_CONNECTION:return"Attempted to connect a block to itself.";case o.Connection.REASON_DIFFERENT_WORKSPACES:return"Blocks not on same workspace.";case o.Connection.REASON_WRONG_TYPE:return"Attempt to connect incompatible types.";case o.Connection.REASON_TARGET_NULL:return"Target connection is null.";case o.Connection.REASON_CHECKS_FAILED:return"Connection checks failed. "+e+" expected "+e.getCheck()+", found "+i.getCheck();case o.Connection.REASON_SHADOW_PARENT:return"Connecting non-shadow to shadow block.";case o.Connection.REASON_DRAG_CHECKS_FAILED:return"Drag checks failed.";default:return"Unknown connection failure: this should never happen!"}},o.ConnectionChecker.prototype.doSafetyChecks=function(t,e){if(!t||!e)return o.Connection.REASON_TARGET_NULL;if(t.isSuperior())var i=t.getSourceBlock(),n=e.getSourceBlock();else n=t.getSourceBlock(),i=e.getSourceBlock();return i==n?o.Connection.REASON_SELF_CONNECTION:e.type!=o.OPPOSITE_TYPE[t.type]?o.Connection.REASON_WRONG_TYPE:i.workspace!==n.workspace?o.Connection.REASON_DIFFERENT_WORKSPACES:i.isShadow()&&!n.isShadow()?o.Connection.REASON_SHADOW_PARENT:o.Connection.CAN_CONNECT},o.ConnectionChecker.prototype.doTypeChecks=function(t,e){if(t=t.getCheck(),e=e.getCheck(),!t||!e)return!0;for(var o=0;o<t.length;o++)if(-1!=e.indexOf(t[o]))return!0;return!1},o.ConnectionChecker.prototype.doDragChecks=function(t,e,i){if(t.distanceFrom(e)>i||e.getSourceBlock().isInsertionMarker())return!1;switch(e.type){case o.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(t,e);case o.OUTPUT_VALUE:if(e.isConnected()&&!e.targetBlock().isInsertionMarker()||t.isConnected())return!1;break;case o.INPUT_VALUE:if(e.isConnected()&&!e.targetBlock().isMovable()&&!e.targetBlock().isShadow())return!1;break;case o.NEXT_STATEMENT:if(e.isConnected()&&!t.getSourceBlock().nextConnection&&!e.targetBlock().isShadow()&&e.targetBlock().nextConnection)return!1;break;default:return!1}return-1==o.draggingConnections.indexOf(e)},o.ConnectionChecker.prototype.canConnectToPrevious_=function(t,e){return!(t.targetConnection||-1!=o.draggingConnections.indexOf(e)||e.targetConnection&&(!(t=e.targetBlock()).isInsertionMarker()||t.getPreviousBlock()))},o.registry.register(o.registry.Type.CONNECTION_CHECKER,o.registry.DEFAULT,o.ConnectionChecker),o.VariableMap=function(t){this.variableMap_=Object.create(null),this.workspace=t},o.VariableMap.prototype.clear=function(){this.variableMap_=Object.create(null)},o.VariableMap.prototype.renameVariable=function(t,e){var i=this.getVariable(e,t.type),n=this.workspace.getAllBlocks(!1);o.Events.setGroup(!0);try{i&&i.getId()!=t.getId()?this.renameVariableWithConflict_(t,e,i,n):this.renameVariableAndUses_(t,e,n)}finally{o.Events.setGroup(!1)}},o.VariableMap.prototype.renameVariableById=function(t,e){var o=this.getVariableById(t);if(!o)throw Error("Tried to rename a variable that didn't exist. ID: "+t);this.renameVariable(o,e)},o.VariableMap.prototype.renameVariableAndUses_=function(t,e,i){for(o.Events.fire(new o.Events.VarRename(t,e)),t.name=e,e=0;e<i.length;e++)i[e].updateVarName(t)},o.VariableMap.prototype.renameVariableWithConflict_=function(t,e,i,n){var r=t.type;for(e!=i.name&&this.renameVariableAndUses_(i,e,n),e=0;e<n.length;e++)n[e].renameVarById(t.getId(),i.getId());o.Events.fire(new o.Events.VarDelete(t)),t=this.getVariablesOfType(r).indexOf(t),this.variableMap_[r].splice(t,1)},o.VariableMap.prototype.createVariable=function(t,e,i){var n=this.getVariable(t,e);if(n){if(i&&n.getId()!=i)throw Error('Variable "'+t+'" is already in use and its id is "'+n.getId()+'" which conflicts with the passed in id, "'+i+'".');return n}if(i&&this.getVariableById(i))throw Error('Variable id, "'+i+'", is already in use.');return n=i||o.utils.genUid(),e=e||"",n=new o.VariableModel(this.workspace,t,e,n),(t=this.variableMap_[e]||[]).push(n),delete this.variableMap_[e],this.variableMap_[e]=t,n},o.VariableMap.prototype.deleteVariable=function(t){for(var e,i=this.variableMap_[t.type],n=0;e=i[n];n++)if(e.getId()==t.getId()){i.splice(n,1),o.Events.fire(new o.Events.VarDelete(t));break}},o.VariableMap.prototype.deleteVariableById=function(t){var e=this.getVariableById(t);if(e){var i,n=e.name,r=this.getVariableUsesById(t);for(t=0;i=r[t];t++)if("procedures_defnoreturn"==i.type||"procedures_defreturn"==i.type)return t=i.getFieldValue("NAME"),n=o.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",n).replace("%2",t),void o.alert(n);var s=this;1<r.length?(n=o.Msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",String(r.length)).replace("%2",n),o.confirm(n,(function(t){t&&e&&s.deleteVariableInternal(e,r)}))):s.deleteVariableInternal(e,r)}else console.warn("Can't delete non-existent variable: "+t)},o.VariableMap.prototype.deleteVariableInternal=function(t,e){var i=o.Events.getGroup();i||o.Events.setGroup(!0);try{for(var n=0;n<e.length;n++)e[n].dispose(!0);this.deleteVariable(t)}finally{i||o.Events.setGroup(!1)}},o.VariableMap.prototype.getVariable=function(t,e){if(e=this.variableMap_[e||""])for(var i,n=0;i=e[n];n++)if(o.Names.equals(i.name,t))return i;return null},o.VariableMap.prototype.getVariableById=function(t){for(var e=Object.keys(this.variableMap_),o=0;o<e.length;o++)for(var i,n=e[o],r=0;i=this.variableMap_[n][r];r++)if(i.getId()==t)return i;return null},o.VariableMap.prototype.getVariablesOfType=function(t){return(t=this.variableMap_[t||""])?t.slice():[]},o.VariableMap.prototype.getVariableTypes=function(t){var e={};o.utils.object.mixin(e,this.variableMap_),t&&t.getPotentialVariableMap()&&o.utils.object.mixin(e,t.getPotentialVariableMap().variableMap_),t=Object.keys(e),e=!1;for(var i=0;i<t.length;i++)""==t[i]&&(e=!0);return e||t.push(""),t},o.VariableMap.prototype.getAllVariables=function(){var t,e=[];for(t in this.variableMap_)e=e.concat(this.variableMap_[t]);return e},o.VariableMap.prototype.getAllVariableNames=function(){var t,e=[];for(t in this.variableMap_)for(var o,i=this.variableMap_[t],n=0;o=i[n];n++)e.push(o.name);return e},o.VariableMap.prototype.getVariableUsesById=function(t){for(var e=[],o=this.workspace.getAllBlocks(!1),i=0;i<o.length;i++){var n=o[i].getVarModels();if(n)for(var r=0;r<n.length;r++)n[r].getId()==t&&e.push(o[i])}return e},o.Workspace=function(t){this.id=o.utils.genUid(),o.Workspace.WorkspaceDB_[this.id]=this,this.options=t||new o.Options({}),this.RTL=!!this.options.RTL,this.horizontalLayout=!!this.options.horizontalLayout,this.toolboxPosition=this.options.toolboxPosition,this.connectionChecker=new(o.registry.getClassFromOptions(o.registry.Type.CONNECTION_CHECKER,this.options))(this),this.topBlocks_=[],this.topComments_=[],this.commentDB_=Object.create(null),this.listeners_=[],this.undoStack_=[],this.redoStack_=[],this.blockDB_=Object.create(null),this.typedBlocksDB_=Object.create(null),this.variableMap_=new o.VariableMap(this),this.potentialVariableMap_=null},o.Workspace.prototype.rendered=!1,o.Workspace.prototype.isClearing=!1,o.Workspace.prototype.MAX_UNDO=1024,o.Workspace.prototype.connectionDBList=null,o.Workspace.prototype.dispose=function(){this.listeners_.length=0,this.clear(),delete o.Workspace.WorkspaceDB_[this.id]},o.Workspace.SCAN_ANGLE=3,o.Workspace.prototype.sortObjects_=function(t,e){return t=t.getRelativeToSurfaceXY(),e=e.getRelativeToSurfaceXY(),t.y+o.Workspace.prototype.sortObjects_.offset*t.x-(e.y+o.Workspace.prototype.sortObjects_.offset*e.x)},o.Workspace.prototype.addTopBlock=function(t){this.topBlocks_.push(t)},o.Workspace.prototype.removeTopBlock=function(t){if(!o.utils.arrayRemove(this.topBlocks_,t))throw Error("Block not present in workspace's list of top-most blocks.")},o.Workspace.prototype.getTopBlocks=function(t){var e=[].concat(this.topBlocks_);return t&&1<e.length&&(this.sortObjects_.offset=Math.sin(o.utils.math.toRadians(o.Workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),e.sort(this.sortObjects_)),e},o.Workspace.prototype.addTypedBlock=function(t){this.typedBlocksDB_[t.type]||(this.typedBlocksDB_[t.type]=[]),this.typedBlocksDB_[t.type].push(t)},o.Workspace.prototype.removeTypedBlock=function(t){this.typedBlocksDB_[t.type].splice(this.typedBlocksDB_[t.type].indexOf(t),1),this.typedBlocksDB_[t.type].length||delete this.typedBlocksDB_[t.type]},o.Workspace.prototype.getBlocksByType=function(t,e){return this.typedBlocksDB_[t]?(t=this.typedBlocksDB_[t].slice(0),e&&1<t.length&&(this.sortObjects_.offset=Math.sin(o.utils.math.toRadians(o.Workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),t.sort(this.sortObjects_)),t):[]},o.Workspace.prototype.addTopComment=function(t){this.topComments_.push(t),this.commentDB_[t.id]&&console.warn('Overriding an existing comment on this workspace, with id "'+t.id+'"'),this.commentDB_[t.id]=t},o.Workspace.prototype.removeTopComment=function(t){if(!o.utils.arrayRemove(this.topComments_,t))throw Error("Comment not present in workspace's list of top-most comments.");delete this.commentDB_[t.id]},o.Workspace.prototype.getTopComments=function(t){var e=[].concat(this.topComments_);return t&&1<e.length&&(this.sortObjects_.offset=Math.sin(o.utils.math.toRadians(o.Workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),e.sort(this.sortObjects_)),e},o.Workspace.prototype.getAllBlocks=function(t){if(t){t=this.getTopBlocks(!0);for(var e=[],o=0;o<t.length;o++)e.push.apply(e,t[o].getDescendants(!0))}else for(e=this.getTopBlocks(!1),o=0;o<e.length;o++)e.push.apply(e,e[o].getChildren(!1));return e.filter((function(t){return!t.isInsertionMarker()}))},o.Workspace.prototype.clear=function(){this.isClearing=!0;try{var t=o.Events.getGroup();for(t||o.Events.setGroup(!0);this.topBlocks_.length;)this.topBlocks_[0].dispose(!1);for(;this.topComments_.length;)this.topComments_[this.topComments_.length-1].dispose(!1);t||o.Events.setGroup(!1),this.variableMap_.clear(),this.potentialVariableMap_&&this.potentialVariableMap_.clear()}finally{this.isClearing=!1}},o.Workspace.prototype.renameVariableById=function(t,e){this.variableMap_.renameVariableById(t,e)},o.Workspace.prototype.createVariable=function(t,e,o){return this.variableMap_.createVariable(t,e,o)},o.Workspace.prototype.getVariableUsesById=function(t){return this.variableMap_.getVariableUsesById(t)},o.Workspace.prototype.deleteVariableById=function(t){this.variableMap_.deleteVariableById(t)},o.Workspace.prototype.getVariable=function(t,e){return this.variableMap_.getVariable(t,e)},o.Workspace.prototype.getVariableById=function(t){return this.variableMap_.getVariableById(t)},o.Workspace.prototype.getVariablesOfType=function(t){return this.variableMap_.getVariablesOfType(t)},o.Workspace.prototype.getVariableTypes=function(){return this.variableMap_.getVariableTypes(this)},o.Workspace.prototype.getAllVariables=function(){return this.variableMap_.getAllVariables()},o.Workspace.prototype.getAllVariableNames=function(){return this.variableMap_.getAllVariableNames()},o.Workspace.prototype.getWidth=function(){return 0},o.Workspace.prototype.newBlock=function(t,e){return new o.Block(this,t,e)},o.Workspace.prototype.remainingCapacity=function(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length},o.Workspace.prototype.remainingCapacityOfType=function(t){return this.options.maxInstances?(void 0!==this.options.maxInstances[t]?this.options.maxInstances[t]:1/0)-this.getBlocksByType(t,!1).length:1/0},o.Workspace.prototype.isCapacityAvailable=function(t){if(!this.hasBlockLimits())return!0;var e,o=0;for(e in t){if(t[e]>this.remainingCapacityOfType(e))return!1;o+=t[e]}return!(o>this.remainingCapacity())},o.Workspace.prototype.hasBlockLimits=function(){return 1/0!=this.options.maxBlocks||!!this.options.maxInstances},o.Workspace.prototype.getUndoStack=function(){return this.undoStack_},o.Workspace.prototype.getRedoStack=function(){return this.redoStack_},o.Workspace.prototype.undo=function(t){var e=t?this.redoStack_:this.undoStack_,i=t?this.undoStack_:this.redoStack_,n=e.pop();if(n){for(var r=[n];e.length&&n.group&&n.group==e[e.length-1].group;)r.push(e.pop());for(e=0;n=r[e];e++)i.push(n);r=o.Events.filter(r,t),o.Events.recordUndo=!1;try{for(e=0;n=r[e];e++)n.run(t)}finally{o.Events.recordUndo=!0}}},o.Workspace.prototype.clearUndo=function(){this.undoStack_.length=0,this.redoStack_.length=0,o.Events.clearPendingUndo()},o.Workspace.prototype.addChangeListener=function(t){return this.listeners_.push(t),t},o.Workspace.prototype.removeChangeListener=function(t){o.utils.arrayRemove(this.listeners_,t)},o.Workspace.prototype.fireChangeListener=function(t){if(t.recordUndo)for(this.undoStack_.push(t),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(var e,o=0;e=this.listeners_[o];o++)e(t)},o.Workspace.prototype.getBlockById=function(t){return this.blockDB_[t]||null},o.Workspace.prototype.setBlockById=function(t,e){this.blockDB_[t]=e},o.Workspace.prototype.removeBlockById=function(t){delete this.blockDB_[t]},o.Workspace.prototype.getCommentById=function(t){return this.commentDB_[t]||null},o.Workspace.prototype.allInputsFilled=function(t){for(var e,o=this.getTopBlocks(!1),i=0;e=o[i];i++)if(!e.allInputsFilled(t))return!1;return!0},o.Workspace.prototype.getPotentialVariableMap=function(){return this.potentialVariableMap_},o.Workspace.prototype.createPotentialVariableMap=function(){this.potentialVariableMap_=new o.VariableMap(this)},o.Workspace.prototype.getVariableMap=function(){return this.variableMap_},o.Workspace.prototype.setVariableMap=function(t){this.variableMap_=t},o.Workspace.WorkspaceDB_=Object.create(null),o.Workspace.getById=function(t){return o.Workspace.WorkspaceDB_[t]||null},o.Workspace.getAll=function(){var t,e=[];for(t in o.Workspace.WorkspaceDB_)e.push(o.Workspace.WorkspaceDB_[t]);return e},o.Bubble=function(t,e,i,n,r,s){this.workspace_=t,this.content_=e,this.shape_=i,this.onMouseDownResizeWrapper_=this.onMouseDownBubbleWrapper_=this.moveCallback_=this.resizeCallback_=null,this.disposed=!1,i=o.Bubble.ARROW_ANGLE,this.workspace_.RTL&&(i=-i),this.arrow_radians_=o.utils.math.toRadians(i),t.getBubbleCanvas().appendChild(this.createDom_(e,!(!r||!s))),this.setAnchorLocation(n),r&&s||(r=(t=this.content_.getBBox()).width+2*o.Bubble.BORDER_WIDTH,s=t.height+2*o.Bubble.BORDER_WIDTH),this.setBubbleSize(r,s),this.positionBubble_(),this.renderArrow_(),this.rendered_=!0},o.Bubble.BORDER_WIDTH=6,o.Bubble.ARROW_THICKNESS=5,o.Bubble.ARROW_ANGLE=20,o.Bubble.ARROW_BEND=4,o.Bubble.ANCHOR_RADIUS=8,o.Bubble.onMouseUpWrapper_=null,o.Bubble.onMouseMoveWrapper_=null,o.Bubble.unbindDragEvents_=function(){o.Bubble.onMouseUpWrapper_&&(o.unbindEvent_(o.Bubble.onMouseUpWrapper_),o.Bubble.onMouseUpWrapper_=null),o.Bubble.onMouseMoveWrapper_&&(o.unbindEvent_(o.Bubble.onMouseMoveWrapper_),o.Bubble.onMouseMoveWrapper_=null)},o.Bubble.bubbleMouseUp_=function(t){o.Touch.clearTouchIdentifier(),o.Bubble.unbindDragEvents_()},o.Bubble.prototype.rendered_=!1,o.Bubble.prototype.anchorXY_=null,o.Bubble.prototype.relativeLeft_=0,o.Bubble.prototype.relativeTop_=0,o.Bubble.prototype.width_=0,o.Bubble.prototype.height_=0,o.Bubble.prototype.autoLayout_=!0,o.Bubble.prototype.createDom_=function(t,e){this.bubbleGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{},null);var i={filter:"url(#"+this.workspace_.getRenderer().getConstants().embossFilterId+")"};return o.utils.userAgent.JAVA_FX&&(i={}),i=o.utils.dom.createSvgElement(o.utils.Svg.G,i,this.bubbleGroup_),this.bubbleArrow_=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{},i),this.bubbleBack_=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{class:"blocklyDraggable",x:0,y:0,rx:o.Bubble.BORDER_WIDTH,ry:o.Bubble.BORDER_WIDTH},i),e?(this.resizeGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:this.workspace_.RTL?"blocklyResizeSW":"blocklyResizeSE"},this.bubbleGroup_),e=2*o.Bubble.BORDER_WIDTH,o.utils.dom.createSvgElement(o.utils.Svg.POLYGON,{points:"0,x x,x x,0".replace(/x/g,e.toString())},this.resizeGroup_),o.utils.dom.createSvgElement(o.utils.Svg.LINE,{class:"blocklyResizeLine",x1:e/3,y1:e-1,x2:e-1,y2:e/3},this.resizeGroup_),o.utils.dom.createSvgElement(o.utils.Svg.LINE,{class:"blocklyResizeLine",x1:2*e/3,y1:e-1,x2:e-1,y2:2*e/3},this.resizeGroup_)):this.resizeGroup_=null,this.workspace_.options.readOnly||(this.onMouseDownBubbleWrapper_=o.bindEventWithChecks_(this.bubbleBack_,"mousedown",this,this.bubbleMouseDown_),this.resizeGroup_&&(this.onMouseDownResizeWrapper_=o.bindEventWithChecks_(this.resizeGroup_,"mousedown",this,this.resizeMouseDown_))),this.bubbleGroup_.appendChild(t),this.bubbleGroup_},o.Bubble.prototype.getSvgRoot=function(){return this.bubbleGroup_},o.Bubble.prototype.setSvgId=function(t){this.bubbleGroup_.dataset&&(this.bubbleGroup_.dataset.blockId=t)},o.Bubble.prototype.bubbleMouseDown_=function(t){var e=this.workspace_.getGesture(t);e&&e.handleBubbleStart(t,this)},o.Bubble.prototype.showContextMenu=function(t){},o.Bubble.prototype.isDeletable=function(){return!1},o.Bubble.prototype.setDeleteStyle=function(t){},o.Bubble.prototype.resizeMouseDown_=function(t){this.promote(),o.Bubble.unbindDragEvents_(),o.utils.isRightButton(t)||(this.workspace_.startDrag(t,new o.utils.Coordinate(this.workspace_.RTL?-this.width_:this.width_,this.height_)),o.Bubble.onMouseUpWrapper_=o.bindEventWithChecks_(document,"mouseup",this,o.Bubble.bubbleMouseUp_),o.Bubble.onMouseMoveWrapper_=o.bindEventWithChecks_(document,"mousemove",this,this.resizeMouseMove_),o.hideChaff()),t.stopPropagation()},o.Bubble.prototype.resizeMouseMove_=function(t){this.autoLayout_=!1,t=this.workspace_.moveDrag(t),this.setBubbleSize(this.workspace_.RTL?-t.x:t.x,t.y),this.workspace_.RTL&&this.positionBubble_()},o.Bubble.prototype.registerResizeEvent=function(t){this.resizeCallback_=t},o.Bubble.prototype.registerMoveEvent=function(t){this.moveCallback_=t},o.Bubble.prototype.promote=function(){var t=this.bubbleGroup_.parentNode;return t.lastChild!==this.bubbleGroup_&&(t.appendChild(this.bubbleGroup_),!0)},o.Bubble.prototype.setAnchorLocation=function(t){this.anchorXY_=t,this.rendered_&&this.positionBubble_()},o.Bubble.prototype.layoutBubble_=function(){var t=this.workspace_.getMetrics();t.viewLeft/=this.workspace_.scale,t.viewWidth/=this.workspace_.scale,t.viewTop/=this.workspace_.scale,t.viewHeight/=this.workspace_.scale;var e=this.getOptimalRelativeLeft_(t),o=this.getOptimalRelativeTop_(t),i=this.shape_.getBBox(),n={x:e,y:-this.height_-this.workspace_.getRenderer().getConstants().MIN_BLOCK_HEIGHT},r={x:-this.width_-30,y:o};o={x:i.width,y:o};var s={x:e,y:i.height};e=i.width<i.height?o:s,i=i.width<i.height?s:o,o=this.getOverlap_(n,t),s=this.getOverlap_(r,t);var a=this.getOverlap_(e,t);t=this.getOverlap_(i,t),o==(t=Math.max(o,s,a,t))?(this.relativeLeft_=n.x,this.relativeTop_=n.y):s==t?(this.relativeLeft_=r.x,this.relativeTop_=r.y):a==t?(this.relativeLeft_=e.x,this.relativeTop_=e.y):(this.relativeLeft_=i.x,this.relativeTop_=i.y)},o.Bubble.prototype.getOverlap_=function(t,e){var o=this.workspace_.RTL?this.anchorXY_.x-t.x-this.width_:t.x+this.anchorXY_.x;return t=t.y+this.anchorXY_.y,Math.max(0,Math.min(1,(Math.min(o+this.width_,e.viewLeft+e.viewWidth)-Math.max(o,e.viewLeft))*(Math.min(t+this.height_,e.viewTop+e.viewHeight)-Math.max(t,e.viewTop))/(this.width_*this.height_)))},o.Bubble.prototype.getOptimalRelativeLeft_=function(t){var e=-this.width_/4;if(this.width_>t.viewWidth)return e;if(this.workspace_.RTL)var i=this.anchorXY_.x-e,n=i-this.width_,r=t.viewLeft+t.viewWidth,s=t.viewLeft+o.Scrollbar.scrollbarThickness/this.workspace_.scale;else i=(n=e+this.anchorXY_.x)+this.width_,s=t.viewLeft,r=t.viewLeft+t.viewWidth-o.Scrollbar.scrollbarThickness/this.workspace_.scale;return this.workspace_.RTL?n<s?e=-(s-this.anchorXY_.x+this.width_):i>r&&(e=-(r-this.anchorXY_.x)):n<s?e=s-this.anchorXY_.x:i>r&&(e=r-this.anchorXY_.x-this.width_),e},o.Bubble.prototype.getOptimalRelativeTop_=function(t){var e=-this.height_/4;if(this.height_>t.viewHeight)return e;var i=this.anchorXY_.y+e,n=i+this.height_,r=t.viewTop;t=t.viewTop+t.viewHeight-o.Scrollbar.scrollbarThickness/this.workspace_.scale;var s=this.anchorXY_.y;return i<r?e=r-s:n>t&&(e=t-s-this.height_),e},o.Bubble.prototype.positionBubble_=function(){var t=this.anchorXY_.x;t=this.workspace_.RTL?t-(this.relativeLeft_+this.width_):t+this.relativeLeft_,this.moveTo(t,this.relativeTop_+this.anchorXY_.y)},o.Bubble.prototype.moveTo=function(t,e){this.bubbleGroup_.setAttribute("transform","translate("+t+","+e+")")},o.Bubble.prototype.setDragging=function(t){!t&&this.moveCallback_&&this.moveCallback_()},o.Bubble.prototype.getBubbleSize=function(){return new o.utils.Size(this.width_,this.height_)},o.Bubble.prototype.setBubbleSize=function(t,e){var i=2*o.Bubble.BORDER_WIDTH;t=Math.max(t,i+45),e=Math.max(e,i+20),this.width_=t,this.height_=e,this.bubbleBack_.setAttribute("width",t),this.bubbleBack_.setAttribute("height",e),this.resizeGroup_&&(this.workspace_.RTL?this.resizeGroup_.setAttribute("transform","translate("+2*o.Bubble.BORDER_WIDTH+","+(e-i)+") scale(-1 1)"):this.resizeGroup_.setAttribute("transform","translate("+(t-i)+","+(e-i)+")")),this.autoLayout_&&this.layoutBubble_(),this.positionBubble_(),this.renderArrow_(),this.resizeCallback_&&this.resizeCallback_()},o.Bubble.prototype.renderArrow_=function(){var t=[],e=this.width_/2,i=this.height_/2,n=-this.relativeLeft_,r=-this.relativeTop_;if(e==n&&i==r)t.push("M "+e+","+i);else{r-=i,n-=e,this.workspace_.RTL&&(n*=-1);var s=Math.sqrt(r*r+n*n),a=Math.acos(n/s);0>r&&(a=2*Math.PI-a);var l=a+Math.PI/2;l>2*Math.PI&&(l-=2*Math.PI);var c=Math.sin(l),u=Math.cos(l),h=this.getBubbleSize();l=(h.width+h.height)/o.Bubble.ARROW_THICKNESS,l=Math.min(l,h.width,h.height)/4,n=e+(h=1-o.Bubble.ANCHOR_RADIUS/s)*n,r=i+h*r,h=e+l*u;var _=i+l*c;e-=l*u,i-=l*c,(c=a+this.arrow_radians_)>2*Math.PI&&(c-=2*Math.PI),a=Math.sin(c)*s/o.Bubble.ARROW_BEND,s=Math.cos(c)*s/o.Bubble.ARROW_BEND,t.push("M"+h+","+_),t.push("C"+(h+s)+","+(_+a)+" "+n+","+r+" "+n+","+r),t.push("C"+n+","+r+" "+(e+s)+","+(i+a)+" "+e+","+i)}t.push("z"),this.bubbleArrow_.setAttribute("d",t.join(" "))},o.Bubble.prototype.setColour=function(t){this.bubbleBack_.setAttribute("fill",t),this.bubbleArrow_.setAttribute("fill",t)},o.Bubble.prototype.dispose=function(){this.onMouseDownBubbleWrapper_&&o.unbindEvent_(this.onMouseDownBubbleWrapper_),this.onMouseDownResizeWrapper_&&o.unbindEvent_(this.onMouseDownResizeWrapper_),o.Bubble.unbindDragEvents_(),o.utils.dom.removeNode(this.bubbleGroup_),this.disposed=!0},o.Bubble.prototype.moveDuringDrag=function(t,e){t?t.translateSurface(e.x,e.y):this.moveTo(e.x,e.y),this.relativeLeft_=this.workspace_.RTL?this.anchorXY_.x-e.x-this.width_:e.x-this.anchorXY_.x,this.relativeTop_=e.y-this.anchorXY_.y,this.renderArrow_()},o.Bubble.prototype.getRelativeToSurfaceXY=function(){return new o.utils.Coordinate(this.workspace_.RTL?-this.relativeLeft_+this.anchorXY_.x-this.width_:this.anchorXY_.x+this.relativeLeft_,this.anchorXY_.y+this.relativeTop_)},o.Bubble.prototype.setAutoLayout=function(t){this.autoLayout_=t},o.Bubble.textToDom=function(t){var e=o.utils.dom.createSvgElement(o.utils.Svg.TEXT,{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",y:o.Bubble.BORDER_WIDTH},null);t=t.split("\n");for(var i=0;i<t.length;i++){var n=o.utils.dom.createSvgElement(o.utils.Svg.TSPAN,{dy:"1em",x:o.Bubble.BORDER_WIDTH},e),r=document.createTextNode(t[i]);n.appendChild(r)}return e},o.Bubble.createNonEditableBubble=function(t,e,i){if((i=new o.Bubble(e.workspace,t,e.pathObject.svgPath,i,null,null)).setSvgId(e.id),e.RTL){e=t.getBBox().width;for(var n,r=0;n=t.childNodes[r];r++)n.setAttribute("text-anchor","end"),n.setAttribute("x",e+o.Bubble.BORDER_WIDTH)}return i},o.Events.CommentBase=function(t){this.commentId=(this.isBlank=void 0===t)?"":t.id,this.workspaceId=this.isBlank?"":t.workspace.id,this.group=o.Events.getGroup(),this.recordUndo=o.Events.recordUndo},o.utils.object.inherits(o.Events.CommentBase,o.Events.Abstract),o.Events.CommentBase.prototype.toJson=function(){var t=o.Events.CommentBase.superClass_.toJson.call(this);return this.commentId&&(t.commentId=this.commentId),t},o.Events.CommentBase.prototype.fromJson=function(t){o.Events.CommentBase.superClass_.fromJson.call(this,t),this.commentId=t.commentId},o.Events.CommentChange=function(t,e,i){o.Events.CommentChange.superClass_.constructor.call(this,t),t&&(this.oldContents_=void 0===e?"":e,this.newContents_=void 0===i?"":i)},o.utils.object.inherits(o.Events.CommentChange,o.Events.CommentBase),o.Events.CommentChange.prototype.type=o.Events.COMMENT_CHANGE,o.Events.CommentChange.prototype.toJson=function(){var t=o.Events.CommentChange.superClass_.toJson.call(this);return t.newContents=this.newContents_,t},o.Events.CommentChange.prototype.fromJson=function(t){o.Events.CommentChange.superClass_.fromJson.call(this,t),this.newContents_=t.newValue},o.Events.CommentChange.prototype.isNull=function(){return this.oldContents_==this.newContents_},o.Events.CommentChange.prototype.run=function(t){var e=this.getEventWorkspace_().getCommentById(this.commentId);e?e.setContent(t?this.newContents_:this.oldContents_):console.warn("Can't change non-existent comment: "+this.commentId)},o.Events.CommentCreate=function(t){o.Events.CommentCreate.superClass_.constructor.call(this,t),t&&(this.xml=t.toXmlWithXY())},o.utils.object.inherits(o.Events.CommentCreate,o.Events.CommentBase),o.Events.CommentCreate.prototype.type=o.Events.COMMENT_CREATE,o.Events.CommentCreate.prototype.toJson=function(){var t=o.Events.CommentCreate.superClass_.toJson.call(this);return t.xml=o.Xml.domToText(this.xml),t},o.Events.CommentCreate.prototype.fromJson=function(t){o.Events.CommentCreate.superClass_.fromJson.call(this,t),this.xml=o.Xml.textToDom(t.xml)},o.Events.CommentCreate.prototype.run=function(t){o.Events.CommentCreateDeleteHelper(this,t)},o.Events.CommentCreateDeleteHelper=function(t,e){var i=t.getEventWorkspace_();e?((e=o.utils.xml.createElement("xml")).appendChild(t.xml),o.Xml.domToWorkspace(e,i)):(i=i.getCommentById(t.commentId))?i.dispose(!1,!1):console.warn("Can't uncreate non-existent comment: "+t.commentId)},o.Events.CommentDelete=function(t){o.Events.CommentDelete.superClass_.constructor.call(this,t),t&&(this.xml=t.toXmlWithXY())},o.utils.object.inherits(o.Events.CommentDelete,o.Events.CommentBase),o.Events.CommentDelete.prototype.type=o.Events.COMMENT_DELETE,o.Events.CommentDelete.prototype.toJson=function(){return o.Events.CommentDelete.superClass_.toJson.call(this)},o.Events.CommentDelete.prototype.fromJson=function(t){o.Events.CommentDelete.superClass_.fromJson.call(this,t)},o.Events.CommentDelete.prototype.run=function(t){o.Events.CommentCreateDeleteHelper(this,!t)},o.Events.CommentMove=function(t){o.Events.CommentMove.superClass_.constructor.call(this,t),t&&(this.comment_=t,this.oldCoordinate_=t.getXY(),this.newCoordinate_=null)},o.utils.object.inherits(o.Events.CommentMove,o.Events.CommentBase),o.Events.CommentMove.prototype.recordNew=function(){if(!this.comment_)throw Error("Tried to record the new position of a comment on the same event twice.");this.newCoordinate_=this.comment_.getXY(),this.comment_=null},o.Events.CommentMove.prototype.type=o.Events.COMMENT_MOVE,o.Events.CommentMove.prototype.setOldCoordinate=function(t){this.oldCoordinate_=t},o.Events.CommentMove.prototype.toJson=function(){var t=o.Events.CommentMove.superClass_.toJson.call(this);return this.newCoordinate_&&(t.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y)),t},o.Events.CommentMove.prototype.fromJson=function(t){o.Events.CommentMove.superClass_.fromJson.call(this,t),t.newCoordinate&&(t=t.newCoordinate.split(","),this.newCoordinate_=new o.utils.Coordinate(Number(t[0]),Number(t[1])))},o.Events.CommentMove.prototype.isNull=function(){return o.utils.Coordinate.equals(this.oldCoordinate_,this.newCoordinate_)},o.Events.CommentMove.prototype.run=function(t){var e=this.getEventWorkspace_().getCommentById(this.commentId);if(e){t=t?this.newCoordinate_:this.oldCoordinate_;var o=e.getXY();e.moveBy(t.x-o.x,t.y-o.y)}else console.warn("Can't move non-existent comment: "+this.commentId)},o.registry.register(o.registry.Type.EVENT,o.Events.COMMENT_CREATE,o.Events.CommentCreate),o.registry.register(o.registry.Type.EVENT,o.Events.COMMENT_CHANGE,o.Events.CommentChange),o.registry.register(o.registry.Type.EVENT,o.Events.COMMENT_MOVE,o.Events.CommentMove),o.registry.register(o.registry.Type.EVENT,o.Events.COMMENT_DELETE,o.Events.CommentDelete),o.BubbleDragger=function(t,e){this.draggingBubble_=t,this.workspace_=e,this.deleteArea_=null,this.wouldDeleteBubble_=!1,this.startXY_=this.draggingBubble_.getRelativeToSurfaceXY(),this.dragSurface_=o.utils.is3dSupported()&&e.getBlockDragSurface()?e.getBlockDragSurface():null},o.BubbleDragger.prototype.dispose=function(){this.dragSurface_=this.workspace_=this.draggingBubble_=null},o.BubbleDragger.prototype.startBubbleDrag=function(){o.Events.getGroup()||o.Events.setGroup(!0),this.workspace_.setResizesEnabled(!1),this.draggingBubble_.setAutoLayout(!1),this.dragSurface_&&this.moveToDragSurface_(),this.draggingBubble_.setDragging&&this.draggingBubble_.setDragging(!0);var t=this.workspace_.getToolbox();if(t&&"function"==typeof t.addStyle){var e=this.draggingBubble_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab";t.addStyle(e)}},o.BubbleDragger.prototype.dragBubble=function(t,e){e=this.pixelsToWorkspaceUnits_(e),e=o.utils.Coordinate.sum(this.startXY_,e),this.draggingBubble_.moveDuringDrag(this.dragSurface_,e),this.draggingBubble_.isDeletable()&&(this.deleteArea_=this.workspace_.isDeleteArea(t),this.updateCursorDuringBubbleDrag_())},o.BubbleDragger.prototype.maybeDeleteBubble_=function(){var t=this.workspace_.trashcan;return this.wouldDeleteBubble_?(t&&setTimeout(t.closeLid.bind(t),100),this.fireMoveEvent_(),this.draggingBubble_.dispose(!1,!0)):t&&t.closeLid(),this.wouldDeleteBubble_},o.BubbleDragger.prototype.updateCursorDuringBubbleDrag_=function(){this.wouldDeleteBubble_=this.deleteArea_!=o.DELETE_AREA_NONE;var t=this.workspace_.trashcan;this.wouldDeleteBubble_?(this.draggingBubble_.setDeleteStyle(!0),this.deleteArea_==o.DELETE_AREA_TRASH&&t&&t.setLidOpen(!0)):(this.draggingBubble_.setDeleteStyle(!1),t&&t.setLidOpen(!1))},o.BubbleDragger.prototype.endBubbleDrag=function(t,e){this.dragBubble(t,e),t=this.pixelsToWorkspaceUnits_(e),t=o.utils.Coordinate.sum(this.startXY_,t),this.draggingBubble_.moveTo(t.x,t.y),this.maybeDeleteBubble_()||(this.dragSurface_&&this.dragSurface_.clearAndHide(this.workspace_.getBubbleCanvas()),this.draggingBubble_.setDragging&&this.draggingBubble_.setDragging(!1),this.fireMoveEvent_()),this.workspace_.setResizesEnabled(!0),(t=this.workspace_.getToolbox())&&"function"==typeof t.removeStyle&&(e=this.draggingBubble_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab",t.removeStyle(e)),o.Events.setGroup(!1)},o.BubbleDragger.prototype.fireMoveEvent_=function(){if(this.draggingBubble_.isComment){var t=new o.Events.CommentMove(this.draggingBubble_);t.setOldCoordinate(this.startXY_),t.recordNew(),o.Events.fire(t)}},o.BubbleDragger.prototype.pixelsToWorkspaceUnits_=function(t){return t=new o.utils.Coordinate(t.x/this.workspace_.scale,t.y/this.workspace_.scale),this.workspace_.isMutator&&t.scale(1/this.workspace_.options.parentWorkspace.scale),t},o.BubbleDragger.prototype.moveToDragSurface_=function(){this.draggingBubble_.moveTo(0,0),this.dragSurface_.translateSurface(this.startXY_.x,this.startXY_.y),this.dragSurface_.setBlocksAndShow(this.draggingBubble_.getSvgRoot())},o.Events.Click=function(t,e,i){o.Events.Click.superClass_.constructor.call(this,t?t.workspace.id:e),this.blockId=t?t.id:null,this.targetType=i},o.utils.object.inherits(o.Events.Click,o.Events.UiBase),o.Events.Click.prototype.type=o.Events.CLICK,o.Events.Click.prototype.toJson=function(){var t=o.Events.Click.superClass_.toJson.call(this);return t.targetType=this.targetType,this.blockId&&(t.blockId=this.blockId),t},o.Events.Click.prototype.fromJson=function(t){o.Events.Click.superClass_.fromJson.call(this,t),this.targetType=t.targetType,this.blockId=t.blockId},o.registry.register(o.registry.Type.EVENT,o.Events.CLICK,o.Events.Click),o.WorkspaceDragger=function(t){this.workspace_=t,this.startScrollXY_=new o.utils.Coordinate(t.scrollX,t.scrollY)},o.WorkspaceDragger.prototype.dispose=function(){this.workspace_=null},o.WorkspaceDragger.prototype.startDrag=function(){o.selected&&o.selected.unselect(),this.workspace_.setupDragSurface()},o.WorkspaceDragger.prototype.endDrag=function(t){this.drag(t),this.workspace_.resetDragSurface()},o.WorkspaceDragger.prototype.drag=function(t){t=o.utils.Coordinate.sum(this.startScrollXY_,t),this.workspace_.scroll(t.x,t.y)},o.FlyoutDragger=function(t){o.FlyoutDragger.superClass_.constructor.call(this,t.getWorkspace()),this.scrollbar_=t.scrollbar,this.horizontalLayout_=t.horizontalLayout},o.utils.object.inherits(o.FlyoutDragger,o.WorkspaceDragger),o.FlyoutDragger.prototype.drag=function(t){t=o.utils.Coordinate.sum(this.startScrollXY_,t),this.horizontalLayout_?this.scrollbar_.set(-t.x):this.scrollbar_.set(-t.y)},o.navigation={},o.navigation.loggingCallback=null,o.navigation.STATE_FLYOUT=1,o.navigation.STATE_WS=2,o.navigation.STATE_TOOLBOX=3,o.navigation.WS_MOVE_DISTANCE=40,o.navigation.currentState_=o.navigation.STATE_WS,o.navigation.actionNames={PREVIOUS:"previous",NEXT:"next",IN:"in",OUT:"out",INSERT:"insert",MARK:"mark",DISCONNECT:"disconnect",TOOLBOX:"toolbox",EXIT:"exit",TOGGLE_KEYBOARD_NAV:"toggle_keyboard_nav",MOVE_WS_CURSOR_UP:"move workspace cursor up",MOVE_WS_CURSOR_DOWN:"move workspace cursor down",MOVE_WS_CURSOR_LEFT:"move workspace cursor left",MOVE_WS_CURSOR_RIGHT:"move workspace cursor right"},o.navigation.MARKER_NAME="local_marker_1",o.navigation.getMarker=function(){return o.navigation.getNavigationWorkspace().getMarker(o.navigation.MARKER_NAME)},o.navigation.getNavigationWorkspace=function(){return o.getMainWorkspace()},o.navigation.focusToolbox_=function(t){(t=t.getToolbox())&&(o.navigation.currentState_=o.navigation.STATE_TOOLBOX,o.navigation.resetFlyout_(!1),o.navigation.getMarker().getCurNode()||o.navigation.markAtCursor_(),t.getSelectedItem()||t.selectItemByPosition(0))},o.navigation.focusFlyout_=function(t){o.navigation.currentState_=o.navigation.STATE_FLYOUT;var e=t.getToolbox();t=e?e.getFlyout():t.getFlyout(),o.navigation.getMarker().getCurNode()||o.navigation.markAtCursor_(),t&&t.getWorkspace()&&0<(t=t.getWorkspace().getTopBlocks(!0)).length&&(t=t[0],t=o.ASTNode.createStackNode(t),o.navigation.getFlyoutCursor_().setCurNode(t))},o.navigation.focusWorkspace_=function(t){o.hideChaff();var e=t.getCursor(),i=!!t.getToolbox(),n=t.getTopBlocks(!0);o.navigation.resetFlyout_(i),o.navigation.currentState_=o.navigation.STATE_WS,0<n.length?e.setCurNode(o.ASTNode.createTopNode(n[0])):(i=new o.utils.Coordinate(100,100),t=o.ASTNode.createWorkspaceNode(t,i),e.setCurNode(t))},o.navigation.getFlyoutCursor_=function(){var t=o.navigation.getNavigationWorkspace(),e=null;return t.rendered&&(e=(t=(e=t.getToolbox())?e.getFlyout():t.getFlyout())?t.getWorkspace().getCursor():null),e},o.navigation.insertFromFlyout=function(t){var e=t.getFlyout();if(e&&e.isVisible()){var i=o.navigation.getFlyoutCursor_().getCurNode().getLocation();i.isEnabled()?((e=e.createBlock(i)).render(),e.setConnectionTracking(!0),t.getCursor().setCurNode(o.ASTNode.createBlockNode(e)),o.navigation.modify_()||o.navigation.warn_("Something went wrong while inserting a block from the flyout."),o.navigation.focusWorkspace_(t),t.getCursor().setCurNode(o.ASTNode.createTopNode(e)),o.navigation.removeMark_()):o.navigation.warn_("Can't insert a disabled block.")}else o.navigation.warn_("Trying to insert from the flyout when the flyout does not  exist or is not visible")},o.navigation.resetFlyout_=function(t){o.navigation.getFlyoutCursor_()&&(o.navigation.getFlyoutCursor_().hide(),t&&o.navigation.getNavigationWorkspace().getFlyout().hide())},o.navigation.modifyWarn_=function(){var t=o.navigation.getMarker().getCurNode(),e=o.navigation.getNavigationWorkspace().getCursor().getCurNode();return t?e?(t=t.getType(),e=e.getType(),t==o.ASTNode.types.FIELD?(o.navigation.warn_("Should not have been able to mark a field."),!1):t==o.ASTNode.types.BLOCK?(o.navigation.warn_("Should not have been able to mark a block."),!1):t==o.ASTNode.types.STACK?(o.navigation.warn_("Should not have been able to mark a stack."),!1):e==o.ASTNode.types.FIELD?(o.navigation.warn_("Cannot attach a field to anything else."),!1):e!=o.ASTNode.types.WORKSPACE||(o.navigation.warn_("Cannot attach a workspace to anything else."),!1)):(o.navigation.warn_("Cannot insert with no cursor node."),!1):(o.navigation.warn_("Cannot insert with no marked node."),!1)},o.navigation.moveBlockToWorkspace_=function(t,e){return!!t&&(t.isShadow()?(o.navigation.warn_("Cannot move a shadow block to the workspace."),!1):(t.getParent()&&t.unplug(!1),t.moveTo(e.getWsCoordinate()),!0))},o.navigation.modify_=function(){var t=o.navigation.getMarker().getCurNode(),e=o.navigation.getNavigationWorkspace().getCursor().getCurNode();if(!o.navigation.modifyWarn_())return!1;var i=t.getType(),n=e.getType(),r=e.getLocation(),s=t.getLocation();return t.isConnection()&&e.isConnection()?o.navigation.connect_(r,s):!t.isConnection()||n!=o.ASTNode.types.BLOCK&&n!=o.ASTNode.types.STACK?i==o.ASTNode.types.WORKSPACE?(e=e?e.getSourceBlock():null,o.navigation.moveBlockToWorkspace_(e,t)):(o.navigation.warn_("Unexpected state in Blockly.navigation.modify_."),!1):o.navigation.insertBlock(r,s)},o.navigation.disconnectChild_=function(t,e){var i=t.getSourceBlock(),n=e.getSourceBlock();i.getRootBlock()==n.getRootBlock()&&(-1<i.getDescendants(!1).indexOf(n)?o.navigation.getInferiorConnection_(e).disconnect():o.navigation.getInferiorConnection_(t).disconnect())},o.navigation.moveAndConnect_=function(t,e){if(!t||!e)return!1;var i=t.getSourceBlock();return!!t.getConnectionChecker().canConnect(t,e,!1)&&(o.navigation.disconnectChild_(t,e),e.isSuperior()||i.getRootBlock().positionNearConnection(t,e),e.connect(t),!0)},o.navigation.getInferiorConnection_=function(t){var e=t.getSourceBlock();return t.isSuperior()?e.previousConnection?e.previousConnection:e.outputConnection?e.outputConnection:null:t},o.navigation.getSuperiorConnection_=function(t){return t.isSuperior()?t:t.targetConnection?t.targetConnection:null},o.navigation.connect_=function(t,e){if(!t||!e)return!1;var i=o.navigation.getInferiorConnection_(t),n=o.navigation.getSuperiorConnection_(e),r=o.navigation.getSuperiorConnection_(t),s=o.navigation.getInferiorConnection_(e);return!!(i&&n&&o.navigation.moveAndConnect_(i,n)||r&&s&&o.navigation.moveAndConnect_(r,s)||o.navigation.moveAndConnect_(t,e))||(n=(i=t.getConnectionChecker()).canConnectWithReason(t,e,!1),o.navigation.warn_("Connection failed with error: "+i.getErrorMessage(n,t,e)),!1)},o.navigation.insertBlock=function(t,e){switch(e.type){case o.PREVIOUS_STATEMENT:if(o.navigation.connect_(t.nextConnection,e))return!0;break;case o.NEXT_STATEMENT:if(o.navigation.connect_(t.previousConnection,e))return!0;break;case o.INPUT_VALUE:if(o.navigation.connect_(t.outputConnection,e))return!0;break;case o.OUTPUT_VALUE:for(var i=0;i<t.inputList.length;i++){var n=t.inputList[i].connection;if(n&&n.type===o.INPUT_VALUE&&o.navigation.connect_(n,e))return!0}if(t.outputConnection&&o.navigation.connect_(t.outputConnection,e))return!0}return o.navigation.warn_("This block can not be inserted at the marked location."),!1},o.navigation.disconnectBlocks_=function(t){var e=t.getCursor().getCurNode();if(e.isConnection()){var i=e.getLocation();i.isConnected()?(e=i.isSuperior()?i:i.targetConnection,(i=i.isSuperior()?i.targetConnection:i).getSourceBlock().isShadow()?o.navigation.log_("Cannot disconnect a shadow block"):(e.disconnect(),i.bumpAwayFrom(e),e.getSourceBlock().getRootBlock().bringToFront(),e=o.ASTNode.createConnectionNode(e),t.getCursor().setCurNode(e))):o.navigation.log_("Cannot disconnect unconnected connection")}else o.navigation.log_("Cannot disconnect blocks when the cursor is not on a connection")},o.navigation.markAtCursor_=function(){o.navigation.getMarker().setCurNode(o.navigation.getNavigationWorkspace().getCursor().getCurNode())},o.navigation.removeMark_=function(){var t=o.navigation.getMarker();t.setCurNode(null),t.hide()},o.navigation.setState=function(t){o.navigation.currentState_=t},o.navigation.moveCursorOnBlockDelete=function(t){var e=o.navigation.getNavigationWorkspace();if(e&&(e=e.getCursor())){var i=e.getCurNode();(i=i?i.getSourceBlock():null)===t?i.getParent()?(t=i.previousConnection||i.outputConnection)&&e.setCurNode(o.ASTNode.createConnectionNode(t.targetConnection)):e.setCurNode(o.ASTNode.createWorkspaceNode(i.workspace,i.getRelativeToSurfaceXY())):i&&-1<t.getChildren(!1).indexOf(i)&&e.setCurNode(o.ASTNode.createWorkspaceNode(i.workspace,i.getRelativeToSurfaceXY()))}},o.navigation.moveCursorOnBlockMutation=function(t){var e=o.navigation.getNavigationWorkspace().getCursor();if(e){var i=e.getCurNode();(i=i?i.getSourceBlock():null)===t&&e.setCurNode(o.ASTNode.createBlockNode(i))}},o.navigation.enableKeyboardAccessibility=function(){var t=o.navigation.getNavigationWorkspace();t.keyboardAccessibilityMode||(t.keyboardAccessibilityMode=!0,o.navigation.focusWorkspace_(t))},o.navigation.disableKeyboardAccessibility=function(){var t=o.navigation.getNavigationWorkspace();t.keyboardAccessibilityMode&&(t.keyboardAccessibilityMode=!1,t.getCursor().hide(),o.navigation.getMarker().hide(),o.navigation.getFlyoutCursor_()&&o.navigation.getFlyoutCursor_().hide())},o.navigation.log_=function(t){o.navigation.loggingCallback?o.navigation.loggingCallback("log",t):console.log(t)},o.navigation.warn_=function(t){o.navigation.loggingCallback?o.navigation.loggingCallback("warn",t):console.warn(t)},o.navigation.error_=function(t){o.navigation.loggingCallback?o.navigation.loggingCallback("error",t):console.error(t)},o.navigation.moveWSCursor_=function(t,e,i){var n=t.getCursor(),r=t.getCursor().getCurNode();return r.getType()===o.ASTNode.types.WORKSPACE&&(r=r.getWsCoordinate(),n.setCurNode(o.ASTNode.createWorkspaceNode(t,new o.utils.Coordinate(e*o.navigation.WS_MOVE_DISTANCE+r.x,i*o.navigation.WS_MOVE_DISTANCE+r.y))),!0)},o.navigation.handleEnterForWS_=function(t){var e=(t=t.getCursor().getCurNode()).getType();e==o.ASTNode.types.FIELD?t.getLocation().showEditor():t.isConnection()||e==o.ASTNode.types.WORKSPACE?o.navigation.markAtCursor_():e==o.ASTNode.types.BLOCK?o.navigation.warn_("Cannot mark a block."):e==o.ASTNode.types.STACK&&o.navigation.warn_("Cannot mark a stack.")},o.navigation.registerPrevious=function(){var t={name:o.navigation.actionNames.PREVIOUS,preconditionFn:function(t){return t.keyboardAccessibilityMode},callback:function(t,e,i){switch(e=t.getToolbox(),o.navigation.currentState_){case o.navigation.STATE_WS:return t.getCursor().onBlocklyAction(i);case o.navigation.STATE_FLYOUT:return!(!(t=e?e.getFlyout():t.getFlyout())||!t.onBlocklyAction(i));case o.navigation.STATE_TOOLBOX:return!(!e||"function"!=typeof e.onBlocklyAction)&&e.onBlocklyAction(i);default:return!1}}};o.ShortcutRegistry.registry.register(t),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.W,t.name)},o.navigation.registerOut=function(){var t={name:o.navigation.actionNames.OUT,preconditionFn:function(t){return t.keyboardAccessibilityMode},callback:function(t,e,i){switch(o.navigation.currentState_){case o.navigation.STATE_WS:return t.getCursor().onBlocklyAction(i);case o.navigation.STATE_FLYOUT:return o.navigation.focusToolbox_(t),!0;case o.navigation.STATE_TOOLBOX:return!(!(t=t.getToolbox())||"function"!=typeof t.onBlocklyAction)&&t.onBlocklyAction(i);default:return!1}}};o.ShortcutRegistry.registry.register(t),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.A,t.name)},o.navigation.registerNext=function(){var t={name:o.navigation.actionNames.NEXT,preconditionFn:function(t){return t.keyboardAccessibilityMode},callback:function(t,e,i){switch(e=t.getToolbox(),o.navigation.currentState_){case o.navigation.STATE_WS:return t.getCursor().onBlocklyAction(i);case o.navigation.STATE_FLYOUT:return!(!(t=e?e.getFlyout():t.getFlyout())||!t.onBlocklyAction(i));case o.navigation.STATE_TOOLBOX:return!(!e||"function"!=typeof e.onBlocklyAction)&&e.onBlocklyAction(i);default:return!1}}};o.ShortcutRegistry.registry.register(t),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.S,t.name)},o.navigation.registerIn=function(){var t={name:o.navigation.actionNames.IN,preconditionFn:function(t){return t.keyboardAccessibilityMode},callback:function(t,e,i){switch(o.navigation.currentState_){case o.navigation.STATE_WS:return t.getCursor().onBlocklyAction(i);case o.navigation.STATE_TOOLBOX:return(e=t.getToolbox())&&"function"==typeof e.onBlocklyAction&&e.onBlocklyAction(i)||o.navigation.focusFlyout_(t),!0;default:return!1}}};o.ShortcutRegistry.registry.register(t),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.D,t.name)},o.navigation.registerInsert=function(){var t={name:o.navigation.actionNames.INSERT,preconditionFn:function(t){return t.keyboardAccessibilityMode&&!t.options.readOnly},callback:function(){switch(o.navigation.currentState_){case o.navigation.STATE_WS:return o.navigation.modify_();default:return!1}}};o.ShortcutRegistry.registry.register(t),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.I,t.name)},o.navigation.registerMark=function(){var t={name:o.navigation.actionNames.MARK,preconditionFn:function(t){return t.keyboardAccessibilityMode&&!t.options.readOnly},callback:function(t){switch(o.navigation.currentState_){case o.navigation.STATE_WS:return o.navigation.handleEnterForWS_(t),!0;case o.navigation.STATE_FLYOUT:return o.navigation.insertFromFlyout(t),!0;default:return!1}}};o.ShortcutRegistry.registry.register(t),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.ENTER,t.name)},o.navigation.registerDisconnect=function(){var t={name:o.navigation.actionNames.DISCONNECT,preconditionFn:function(t){return t.keyboardAccessibilityMode&&!t.options.readOnly},callback:function(t){switch(o.navigation.currentState_){case o.navigation.STATE_WS:return o.navigation.disconnectBlocks_(t),!0;default:return!1}}};o.ShortcutRegistry.registry.register(t),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.X,t.name)},o.navigation.registerToolboxFocus=function(){var t={name:o.navigation.actionNames.TOOLBOX,preconditionFn:function(t){return t.keyboardAccessibilityMode&&!t.options.readOnly},callback:function(t){switch(o.navigation.currentState_){case o.navigation.STATE_WS:return t.getToolbox()?o.navigation.focusToolbox_(t):o.navigation.focusFlyout_(t),!0;default:return!1}}};o.ShortcutRegistry.registry.register(t),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.T,t.name)},o.navigation.registerExit=function(){var t={name:o.navigation.actionNames.EXIT,preconditionFn:function(t){return t.keyboardAccessibilityMode},callback:function(t){switch(o.navigation.currentState_){case o.navigation.STATE_FLYOUT:case o.navigation.STATE_TOOLBOX:return o.navigation.focusWorkspace_(t),!0;default:return!1}}};o.ShortcutRegistry.registry.register(t,!0),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.ESC,t.name,!0),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.E,t.name,!0)},o.navigation.registerToggleKeyboardNav=function(){var t={name:o.navigation.actionNames.TOGGLE_KEYBOARD_NAV,callback:function(t){return t.keyboardAccessibilityMode?o.navigation.disableKeyboardAccessibility():o.navigation.enableKeyboardAccessibility(),!0}};o.ShortcutRegistry.registry.register(t);var e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.K,[o.utils.KeyCodes.CTRL,o.utils.KeyCodes.SHIFT]);o.ShortcutRegistry.registry.addKeyMapping(e,t.name)},o.navigation.registerWorkspaceMoveLeft=function(){var t={name:o.navigation.actionNames.MOVE_WS_CURSOR_LEFT,preconditionFn:function(t){return t.keyboardAccessibilityMode&&!t.options.readOnly},callback:function(t){return o.navigation.moveWSCursor_(t,-1,0)}};o.ShortcutRegistry.registry.register(t);var e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.A,[o.utils.KeyCodes.SHIFT]);o.ShortcutRegistry.registry.addKeyMapping(e,t.name)},o.navigation.registerWorkspaceMoveRight=function(){var t={name:o.navigation.actionNames.MOVE_WS_CURSOR_RIGHT,preconditionFn:function(t){return t.keyboardAccessibilityMode&&!t.options.readOnly},callback:function(t){return o.navigation.moveWSCursor_(t,1,0)}};o.ShortcutRegistry.registry.register(t);var e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.D,[o.utils.KeyCodes.SHIFT]);o.ShortcutRegistry.registry.addKeyMapping(e,t.name)},o.navigation.registerWorkspaceMoveUp=function(){var t={name:o.navigation.actionNames.MOVE_WS_CURSOR_UP,preconditionFn:function(t){return t.keyboardAccessibilityMode&&!t.options.readOnly},callback:function(t){return o.navigation.moveWSCursor_(t,0,-1)}};o.ShortcutRegistry.registry.register(t);var e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.W,[o.utils.KeyCodes.SHIFT]);o.ShortcutRegistry.registry.addKeyMapping(e,t.name)},o.navigation.registerWorkspaceMoveDown=function(){var t={name:o.navigation.actionNames.MOVE_WS_CURSOR_DOWN,preconditionFn:function(t){return t.keyboardAccessibilityMode&&!t.options.readOnly},callback:function(t){return o.navigation.moveWSCursor_(t,0,1)}};o.ShortcutRegistry.registry.register(t);var e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.S,[o.utils.KeyCodes.SHIFT]);o.ShortcutRegistry.registry.addKeyMapping(e,t.name)},o.navigation.registerNavigationShortcuts=function(){o.navigation.registerIn(),o.navigation.registerNext(),o.navigation.registerOut(),o.navigation.registerPrevious(),o.navigation.registerWorkspaceMoveDown(),o.navigation.registerWorkspaceMoveLeft(),o.navigation.registerWorkspaceMoveRight(),o.navigation.registerWorkspaceMoveUp(),o.navigation.registerDisconnect(),o.navigation.registerExit(),o.navigation.registerInsert(),o.navigation.registerMark(),o.navigation.registerToggleKeyboardNav(),o.navigation.registerToolboxFocus()},o.Gesture=function(t,e){this.mouseDownXY_=null,this.currentDragDeltaXY_=new o.utils.Coordinate(0,0),this.startWorkspace_=this.targetBlock_=this.startBlock_=this.startField_=this.startBubble_=null,this.creatorWorkspace_=e,this.isDraggingBubble_=this.isDraggingBlock_=this.isDraggingWorkspace_=this.hasExceededDragRadius_=!1,this.mostRecentEvent_=t,this.flyout_=this.workspaceDragger_=this.blockDragger_=this.bubbleDragger_=this.onUpWrapper_=this.onMoveWrapper_=null,this.isEnding_=this.hasStarted_=this.calledUpdateIsDragging_=!1,this.healStack_=!o.DRAG_STACK},o.Gesture.prototype.dispose=function(){o.Touch.clearTouchIdentifier(),o.Tooltip.unblock(),this.creatorWorkspace_.clearGesture(),this.onMoveWrapper_&&o.unbindEvent_(this.onMoveWrapper_),this.onUpWrapper_&&o.unbindEvent_(this.onUpWrapper_),this.blockDragger_&&this.blockDragger_.dispose(),this.workspaceDragger_&&this.workspaceDragger_.dispose(),this.bubbleDragger_&&this.bubbleDragger_.dispose()},o.Gesture.prototype.updateFromEvent_=function(t){var e=new o.utils.Coordinate(t.clientX,t.clientY);this.updateDragDelta_(e)&&(this.updateIsDragging_(),o.longStop_()),this.mostRecentEvent_=t},o.Gesture.prototype.updateDragDelta_=function(t){return this.currentDragDeltaXY_=o.utils.Coordinate.difference(t,this.mouseDownXY_),!this.hasExceededDragRadius_&&(this.hasExceededDragRadius_=o.utils.Coordinate.magnitude(this.currentDragDeltaXY_)>(this.flyout_?o.FLYOUT_DRAG_RADIUS:o.DRAG_RADIUS))},o.Gesture.prototype.updateIsDraggingFromFlyout_=function(){return!(!this.targetBlock_||!this.flyout_.isBlockCreatable_(this.targetBlock_)||this.flyout_.isScrollable()&&!this.flyout_.isDragTowardWorkspace(this.currentDragDeltaXY_)||(this.startWorkspace_=this.flyout_.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),o.Events.getGroup()||o.Events.setGroup(!0),this.startBlock_=null,this.targetBlock_=this.flyout_.createBlock(this.targetBlock_),this.targetBlock_.select(),0))},o.Gesture.prototype.updateIsDraggingBubble_=function(){return!!this.startBubble_&&(this.isDraggingBubble_=!0,this.startDraggingBubble_(),!0)},o.Gesture.prototype.updateIsDraggingBlock_=function(){return!!this.targetBlock_&&(this.flyout_?this.isDraggingBlock_=this.updateIsDraggingFromFlyout_():this.targetBlock_.isMovable()&&(this.isDraggingBlock_=!0),!!this.isDraggingBlock_&&(this.startDraggingBlock_(),!0))},o.Gesture.prototype.updateIsDraggingWorkspace_=function(){(this.flyout_?this.flyout_.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())&&(this.workspaceDragger_=this.flyout_?new o.FlyoutDragger(this.flyout_):new o.WorkspaceDragger(this.startWorkspace_),this.isDraggingWorkspace_=!0,this.workspaceDragger_.startDrag())},o.Gesture.prototype.updateIsDragging_=function(){if(this.calledUpdateIsDragging_)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging_=!0,this.updateIsDraggingBubble_()||this.updateIsDraggingBlock_()||this.updateIsDraggingWorkspace_()},o.Gesture.prototype.startDraggingBlock_=function(){this.blockDragger_=new o.BlockDragger(this.targetBlock_,this.startWorkspace_),this.blockDragger_.startBlockDrag(this.currentDragDeltaXY_,this.healStack_),this.blockDragger_.dragBlock(this.mostRecentEvent_,this.currentDragDeltaXY_)},o.Gesture.prototype.startDraggingBubble_=function(){this.bubbleDragger_=new o.BubbleDragger(this.startBubble_,this.startWorkspace_),this.bubbleDragger_.startBubbleDrag(),this.bubbleDragger_.dragBubble(this.mostRecentEvent_,this.currentDragDeltaXY_)},o.Gesture.prototype.doStart=function(t){o.utils.isTargetInput(t)?this.cancel():(this.hasStarted_=!0,o.blockAnimations.disconnectUiStop(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),o.hideChaff(!!this.flyout_),this.startWorkspace_.markFocused(),this.mostRecentEvent_=t,o.Tooltip.block(),this.targetBlock_&&(!this.targetBlock_.isInFlyout&&t.shiftKey&&this.targetBlock_.workspace.keyboardAccessibilityMode?this.creatorWorkspace_.getCursor().setCurNode(o.ASTNode.createTopNode(this.targetBlock_)):this.targetBlock_.select()),o.utils.isRightButton(t)?this.handleRightClick(t):("touchstart"!=t.type.toLowerCase()&&"pointerdown"!=t.type.toLowerCase()||"mouse"==t.pointerType||o.longStart(t,this),this.mouseDownXY_=new o.utils.Coordinate(t.clientX,t.clientY),this.healStack_=t.altKey||t.ctrlKey||t.metaKey,this.bindMouseEvents(t)))},o.Gesture.prototype.bindMouseEvents=function(t){this.onMoveWrapper_=o.bindEventWithChecks_(document,"mousemove",null,this.handleMove.bind(this)),this.onUpWrapper_=o.bindEventWithChecks_(document,"mouseup",null,this.handleUp.bind(this)),t.preventDefault(),t.stopPropagation()},o.Gesture.prototype.handleMove=function(t){this.updateFromEvent_(t),this.isDraggingWorkspace_?this.workspaceDragger_.drag(this.currentDragDeltaXY_):this.isDraggingBlock_?this.blockDragger_.dragBlock(this.mostRecentEvent_,this.currentDragDeltaXY_):this.isDraggingBubble_&&this.bubbleDragger_.dragBubble(this.mostRecentEvent_,this.currentDragDeltaXY_),t.preventDefault(),t.stopPropagation()},o.Gesture.prototype.handleUp=function(t){this.updateFromEvent_(t),o.longStop_(),this.isEnding_?console.log("Trying to end a gesture recursively."):(this.isEnding_=!0,this.isDraggingBubble_?this.bubbleDragger_.endBubbleDrag(t,this.currentDragDeltaXY_):this.isDraggingBlock_?this.blockDragger_.endBlockDrag(t,this.currentDragDeltaXY_):this.isDraggingWorkspace_?this.workspaceDragger_.endDrag(this.currentDragDeltaXY_):this.isBubbleClick_()?this.doBubbleClick_():this.isFieldClick_()?this.doFieldClick_():this.isBlockClick_()?this.doBlockClick_():this.isWorkspaceClick_()&&this.doWorkspaceClick_(t),t.preventDefault(),t.stopPropagation(),this.dispose())},o.Gesture.prototype.cancel=function(){this.isEnding_||(o.longStop_(),this.isDraggingBubble_?this.bubbleDragger_.endBubbleDrag(this.mostRecentEvent_,this.currentDragDeltaXY_):this.isDraggingBlock_?this.blockDragger_.endBlockDrag(this.mostRecentEvent_,this.currentDragDeltaXY_):this.isDraggingWorkspace_&&this.workspaceDragger_.endDrag(this.currentDragDeltaXY_),this.dispose())},o.Gesture.prototype.handleRightClick=function(t){this.targetBlock_?(this.bringBlockToFront_(),o.hideChaff(!!this.flyout_),this.targetBlock_.showContextMenu(t)):this.startBubble_?this.startBubble_.showContextMenu(t):this.startWorkspace_&&!this.flyout_&&(o.hideChaff(),this.startWorkspace_.showContextMenu(t)),t.preventDefault(),t.stopPropagation(),this.dispose()},o.Gesture.prototype.handleWsStart=function(t,e){if(this.hasStarted_)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace_(e),this.mostRecentEvent_=t,this.doStart(t),this.startWorkspace_.keyboardAccessibilityMode&&o.navigation.setState(o.navigation.STATE_WS)},o.Gesture.prototype.fireWorkspaceClick_=function(t){t=new o.Events.Click(null,t.id,"workspace"),o.Events.fire(t)},o.Gesture.prototype.handleFlyoutStart=function(t,e){if(this.hasStarted_)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout_(e),this.handleWsStart(t,e.getWorkspace())},o.Gesture.prototype.handleBlockStart=function(t,e){if(this.hasStarted_)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(e),this.mostRecentEvent_=t},o.Gesture.prototype.handleBubbleStart=function(t,e){if(this.hasStarted_)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(e),this.mostRecentEvent_=t},o.Gesture.prototype.doBubbleClick_=function(){this.startBubble_.setFocus&&this.startBubble_.setFocus(),this.startBubble_.select&&this.startBubble_.select()},o.Gesture.prototype.doFieldClick_=function(){this.startField_.showEditor(this.mostRecentEvent_),this.bringBlockToFront_()},o.Gesture.prototype.doBlockClick_=function(){if(this.flyout_&&this.flyout_.autoClose)this.targetBlock_.isEnabled()&&(o.Events.getGroup()||o.Events.setGroup(!0),this.flyout_.createBlock(this.targetBlock_).scheduleSnapAndBump());else{var t=new o.Events.Click(this.startBlock_,this.startWorkspace_.id,"block");o.Events.fire(t)}this.bringBlockToFront_(),o.Events.setGroup(!1)},o.Gesture.prototype.doWorkspaceClick_=function(t){var e=this.creatorWorkspace_;t.shiftKey&&e.keyboardAccessibilityMode?(t=new o.utils.Coordinate(t.clientX,t.clientY),t=o.utils.screenToWsCoordinates(e,t),t=o.ASTNode.createWorkspaceNode(e,t),e.getCursor().setCurNode(t)):o.selected&&o.selected.unselect(),this.fireWorkspaceClick_(this.startWorkspace_||e)},o.Gesture.prototype.bringBlockToFront_=function(){this.targetBlock_&&!this.flyout_&&this.targetBlock_.bringToFront()},o.Gesture.prototype.setStartField=function(t){if(this.hasStarted_)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField_||(this.startField_=t)},o.Gesture.prototype.setStartBubble=function(t){this.startBubble_||(this.startBubble_=t)},o.Gesture.prototype.setStartBlock=function(t){this.startBlock_||this.startBubble_||(this.startBlock_=t,t.isInFlyout&&t!=t.getRootBlock()?this.setTargetBlock_(t.getRootBlock()):this.setTargetBlock_(t))},o.Gesture.prototype.setTargetBlock_=function(t){t.isShadow()?this.setTargetBlock_(t.getParent()):this.targetBlock_=t},o.Gesture.prototype.setStartWorkspace_=function(t){this.startWorkspace_||(this.startWorkspace_=t)},o.Gesture.prototype.setStartFlyout_=function(t){this.flyout_||(this.flyout_=t)},o.Gesture.prototype.isBubbleClick_=function(){return!!this.startBubble_&&!this.hasExceededDragRadius_},o.Gesture.prototype.isBlockClick_=function(){return!!this.startBlock_&&!this.hasExceededDragRadius_&&!this.isFieldClick_()},o.Gesture.prototype.isFieldClick_=function(){return!!this.startField_&&this.startField_.isClickable()&&!this.hasExceededDragRadius_&&(!this.flyout_||!this.flyout_.autoClose)},o.Gesture.prototype.isWorkspaceClick_=function(){return!(this.startBlock_||this.startBubble_||this.startField_||this.hasExceededDragRadius_)},o.Gesture.prototype.isDragging=function(){return this.isDraggingWorkspace_||this.isDraggingBlock_||this.isDraggingBubble_},o.Gesture.prototype.hasStarted=function(){return this.hasStarted_},o.Gesture.prototype.getInsertionMarkers=function(){return this.blockDragger_?this.blockDragger_.getInsertionMarkers():[]},o.Gesture.inProgress=function(){for(var t,e=o.Workspace.getAll(),i=0;t=e[i];i++)if(t.currentGesture_)return!0;return!1},o.Field=function(t,e,i){this.value_=this.DEFAULT_VALUE,this.tooltip_=this.validator_=null,this.size_=new o.utils.Size(0,0),this.constants_=this.mouseDownWrapper_=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=this.markerSvg_=this.cursorSvg_=null,i&&this.configure_(i),this.setValue(t),e&&this.setValidator(e)},o.Field.prototype.DEFAULT_VALUE=null,o.Field.prototype.name=void 0,o.Field.prototype.disposed=!1,o.Field.prototype.maxDisplayLength=50,o.Field.prototype.sourceBlock_=null,o.Field.prototype.isDirty_=!0,o.Field.prototype.visible_=!0,o.Field.prototype.clickTarget_=null,o.Field.NBSP="",o.Field.prototype.EDITABLE=!0,o.Field.prototype.SERIALIZABLE=!1,o.Field.prototype.configure_=function(t){var e=t.tooltip;"string"==typeof e&&(e=o.utils.replaceMessageReferences(t.tooltip)),e&&this.setTooltip(e)},o.Field.prototype.setSourceBlock=function(t){if(this.sourceBlock_)throw Error("Field already bound to a block.");this.sourceBlock_=t},o.Field.prototype.getConstants=function(){return!this.constants_&&this.sourceBlock_&&this.sourceBlock_.workspace&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants()),this.constants_},o.Field.prototype.getSourceBlock=function(){return this.sourceBlock_},o.Field.prototype.init=function(){this.fieldGroup_||(this.fieldGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{},null),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip_),this.bindEvents_(),this.initModel())},o.Field.prototype.initView=function(){this.createBorderRect_(),this.createTextElement_()},o.Field.prototype.initModel=function(){},o.Field.prototype.createBorderRect_=function(){this.borderRect_=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect",fill:"white"},this.fieldGroup_)},o.Field.prototype.createTextElement_=function(){this.textElement_=o.utils.dom.createSvgElement(o.utils.Svg.TEXT,{class:"blocklyText"},this.fieldGroup_),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute("dominant-baseline","central"),this.textContent_=document.createTextNode(""),this.textElement_.appendChild(this.textContent_)},o.Field.prototype.bindEvents_=function(){o.Tooltip.bindMouseEvents(this.getClickTarget_()),this.mouseDownWrapper_=o.bindEventWithChecks_(this.getClickTarget_(),"mousedown",this,this.onMouseDown_)},o.Field.prototype.fromXml=function(t){this.setValue(t.textContent)},o.Field.prototype.toXml=function(t){return t.textContent=this.getValue(),t},o.Field.prototype.dispose=function(){o.DropDownDiv.hideIfOwner(this),o.WidgetDiv.hideIfOwner(this),o.Tooltip.unbindMouseEvents(this.getClickTarget_()),this.mouseDownWrapper_&&o.unbindEvent_(this.mouseDownWrapper_),o.utils.dom.removeNode(this.fieldGroup_),this.disposed=!0},o.Field.prototype.updateEditable=function(){var t=this.fieldGroup_;this.EDITABLE&&t&&(this.sourceBlock_.isEditable()?(o.utils.dom.addClass(t,"blocklyEditableText"),o.utils.dom.removeClass(t,"blocklyNonEditableText"),t.style.cursor=this.CURSOR):(o.utils.dom.addClass(t,"blocklyNonEditableText"),o.utils.dom.removeClass(t,"blocklyEditableText"),t.style.cursor=""))},o.Field.prototype.isClickable=function(){return!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&!!this.showEditor_&&"function"==typeof this.showEditor_},o.Field.prototype.isCurrentlyEditable=function(){return this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()},o.Field.prototype.isSerializable=function(){var t=!1;return this.name&&(this.SERIALIZABLE?t=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),t=!0)),t},o.Field.prototype.isVisible=function(){return this.visible_},o.Field.prototype.setVisible=function(t){if(this.visible_!=t){this.visible_=t;var e=this.getSvgRoot();e&&(e.style.display=t?"block":"none")}},o.Field.prototype.setValidator=function(t){this.validator_=t},o.Field.prototype.getValidator=function(){return this.validator_},o.Field.prototype.getSvgRoot=function(){return this.fieldGroup_},o.Field.prototype.applyColour=function(){},o.Field.prototype.render_=function(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_()},o.Field.prototype.showEditor=function(t){this.isClickable()&&this.showEditor_(t)},o.Field.prototype.updateSize_=function(t){var e=this.getConstants(),i=2*(t=null!=t?t:this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0),n=e.FIELD_TEXT_HEIGHT,r=0;this.textElement_&&(i+=r=o.utils.dom.getFastTextWidth(this.textElement_,e.FIELD_TEXT_FONTSIZE,e.FIELD_TEXT_FONTWEIGHT,e.FIELD_TEXT_FONTFAMILY)),this.borderRect_&&(n=Math.max(n,e.FIELD_BORDER_RECT_HEIGHT)),this.size_.height=n,this.size_.width=i,this.positionTextElement_(t,r),this.positionBorderRect_()},o.Field.prototype.positionTextElement_=function(t,e){if(this.textElement_){var o=this.getConstants(),i=this.size_.height/2;this.textElement_.setAttribute("x",this.sourceBlock_.RTL?this.size_.width-e-t:t),this.textElement_.setAttribute("y",o.FIELD_TEXT_BASELINE_CENTER?i:i-o.FIELD_TEXT_HEIGHT/2+o.FIELD_TEXT_BASELINE)}},o.Field.prototype.positionBorderRect_=function(){this.borderRect_&&(this.borderRect_.setAttribute("width",this.size_.width),this.borderRect_.setAttribute("height",this.size_.height),this.borderRect_.setAttribute("rx",this.getConstants().FIELD_BORDER_RECT_RADIUS),this.borderRect_.setAttribute("ry",this.getConstants().FIELD_BORDER_RECT_RADIUS))},o.Field.prototype.getSize=function(){return this.isVisible()?(this.isDirty_?(this.render_(),this.isDirty_=!1):this.visible_&&0==this.size_.width&&(console.warn("Deprecated use of setting size_.width to 0 to rerender a field. Set field.isDirty_ to true instead."),this.render_()),this.size_):new o.utils.Size(0,0)},o.Field.prototype.getScaledBBox=function(){if(this.borderRect_)t=this.borderRect_.getBoundingClientRect(),i=o.utils.style.getPageOffset(this.borderRect_),n=t.width,t=t.height;else{var t=this.sourceBlock_.getHeightWidth(),e=this.sourceBlock_.workspace.scale,i=this.getAbsoluteXY_(),n=t.width*e;t=t.height*e,o.utils.userAgent.GECKO?(i.x+=1.5*e,i.y+=1.5*e):o.utils.userAgent.EDGE||o.utils.userAgent.IE||(i.x-=.5*e,i.y-=.5*e),n+=1*e,t+=1*e}return new o.utils.Rect(i.y,i.y+t,i.x,i.x+n)},o.Field.prototype.getDisplayText_=function(){var t=this.getText();return t?(t.length>this.maxDisplayLength&&(t=t.substring(0,this.maxDisplayLength-2)+""),t=t.replace(/\s/g,o.Field.NBSP),this.sourceBlock_&&this.sourceBlock_.RTL&&(t+=""),t):o.Field.NBSP},o.Field.prototype.getText=function(){if(this.getText_){var t=this.getText_.call(this);if(null!==t)return String(t)}return String(this.getValue())},o.Field.prototype.markDirty=function(){this.isDirty_=!0,this.constants_=null},o.Field.prototype.forceRerender=function(){this.isDirty_=!0,this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours(),this.updateMarkers_())},o.Field.prototype.setValue=function(t){if(null!==t){var e=this.doClassValidation_(t);if(!((t=this.processValidation_(t,e))instanceof Error)){if((e=this.getValidator())&&(e=e.call(this,t),(t=this.processValidation_(t,e))instanceof Error))return;if(!(e=this.sourceBlock_)||!e.disposed){var i=this.getValue();i===t?this.doValueUpdate_(t):(e&&o.Events.isEnabled()&&o.Events.fire(new o.Events.BlockChange(e,"field",this.name||null,i,t)),this.doValueUpdate_(t),this.isDirty_&&this.forceRerender())}}}},o.Field.prototype.processValidation_=function(t,e){return null===e?(this.doValueInvalid_(t),this.isDirty_&&this.forceRerender(),Error()):(void 0!==e&&(t=e),t)},o.Field.prototype.getValue=function(){return this.value_},o.Field.prototype.doClassValidation_=function(t){return null==t?null:t},o.Field.prototype.doValueUpdate_=function(t){this.value_=t,this.isDirty_=!0},o.Field.prototype.doValueInvalid_=function(t){},o.Field.prototype.onMouseDown_=function(t){this.sourceBlock_&&this.sourceBlock_.workspace&&(t=this.sourceBlock_.workspace.getGesture(t))&&t.setStartField(this)},o.Field.prototype.setTooltip=function(t){t||""===t||(t=this.sourceBlock_);var e=this.getClickTarget_();e?e.tooltip=t:this.tooltip_=t},o.Field.prototype.getTooltip=function(){var t=this.getClickTarget_();return t?o.Tooltip.getTooltipOfObject(t):o.Tooltip.getTooltipOfObject({tooltip:this.tooltip_})},o.Field.prototype.getClickTarget_=function(){return this.clickTarget_||this.getSvgRoot()},o.Field.prototype.getAbsoluteXY_=function(){return o.utils.style.getPageOffset(this.getClickTarget_())},o.Field.prototype.referencesVariables=function(){return!1},o.Field.prototype.getParentInput=function(){for(var t=null,e=this.sourceBlock_,o=e.inputList,i=0;i<e.inputList.length;i++)for(var n=o[i],r=n.fieldRow,s=0;s<r.length;s++)if(r[s]===this){t=n;break}return t},o.Field.prototype.getFlipRtl=function(){return!1},o.Field.prototype.isTabNavigable=function(){return!1},o.Field.prototype.onBlocklyAction=function(t){return!1},o.Field.prototype.setCursorSvg=function(t){t?(this.fieldGroup_.appendChild(t),this.cursorSvg_=t):this.cursorSvg_=null},o.Field.prototype.setMarkerSvg=function(t){t?(this.fieldGroup_.appendChild(t),this.markerSvg_=t):this.markerSvg_=null},o.Field.prototype.updateMarkers_=function(){var t=this.sourceBlock_.workspace;t.keyboardAccessibilityMode&&this.cursorSvg_&&t.getCursor().draw(),t.keyboardAccessibilityMode&&this.markerSvg_&&t.getMarker(o.navigation.MARKER_NAME).draw()},o.FieldLabel=function(t,e,i){this.class_=null,o.FieldLabel.superClass_.constructor.call(this,t,null,i),i||(this.class_=e||null)},o.utils.object.inherits(o.FieldLabel,o.Field),o.FieldLabel.prototype.DEFAULT_VALUE="",o.FieldLabel.fromJson=function(t){var e=o.utils.replaceMessageReferences(t.text);return new o.FieldLabel(e,void 0,t)},o.FieldLabel.prototype.EDITABLE=!1,o.FieldLabel.prototype.configure_=function(t){o.FieldLabel.superClass_.configure_.call(this,t),this.class_=t.class},o.FieldLabel.prototype.initView=function(){this.createTextElement_(),this.class_&&o.utils.dom.addClass(this.textElement_,this.class_)},o.FieldLabel.prototype.doClassValidation_=function(t){return null==t?null:String(t)},o.FieldLabel.prototype.setClass=function(t){this.textElement_&&(this.class_&&o.utils.dom.removeClass(this.textElement_,this.class_),t&&o.utils.dom.addClass(this.textElement_,t)),this.class_=t},o.fieldRegistry.register("field_label",o.FieldLabel),o.Input=function(t,e,i,n){if(t!=o.DUMMY_INPUT&&!e)throw Error("Value inputs and statement inputs must have non-empty name.");this.type=t,this.name=e,this.sourceBlock_=i,this.connection=n,this.fieldRow=[]},o.Input.prototype.align=o.ALIGN_LEFT,o.Input.prototype.visible_=!0,o.Input.prototype.getSourceBlock=function(){return this.sourceBlock_},o.Input.prototype.appendField=function(t,e){return this.insertFieldAt(this.fieldRow.length,t,e),this},o.Input.prototype.insertFieldAt=function(t,e,i){if(0>t||t>this.fieldRow.length)throw Error("index "+t+" out of bounds.");return e||""==e&&i?("string"==typeof e&&(e=new o.FieldLabel(e)),e.setSourceBlock(this.sourceBlock_),this.sourceBlock_.rendered&&(e.init(),e.applyColour()),e.name=i,e.setVisible(this.isVisible()),(i=e).prefixField&&(t=this.insertFieldAt(t,i.prefixField)),this.fieldRow.splice(t,0,e),++t,i.suffixField&&(t=this.insertFieldAt(t,i.suffixField)),this.sourceBlock_.rendered&&(this.sourceBlock_=this.sourceBlock_,this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours()),t):t},o.Input.prototype.removeField=function(t,e){for(var o,i=0;o=this.fieldRow[i];i++)if(o.name===t)return o.dispose(),this.fieldRow.splice(i,1),this.sourceBlock_.rendered&&(this.sourceBlock_=this.sourceBlock_,this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours()),!0;if(e)return!1;throw Error('Field "'+t+'" not found.')},o.Input.prototype.isVisible=function(){return this.visible_},o.Input.prototype.setVisible=function(t){var e=[];if(this.visible_==t)return e;this.visible_=t;for(var o,i=0;o=this.fieldRow[i];i++)o.setVisible(t);return this.connection&&(this.connection=this.connection,t?e=this.connection.startTrackingAll():this.connection.stopTrackingAll(),i=this.connection.targetBlock())&&(i.getSvgRoot().style.display=t?"block":"none"),e},o.Input.prototype.markDirty=function(){for(var t,e=0;t=this.fieldRow[e];e++)t.markDirty()},o.Input.prototype.setCheck=function(t){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setCheck(t),this},o.Input.prototype.setAlign=function(t){return this.align=t,this.sourceBlock_.rendered&&(this.sourceBlock_=this.sourceBlock_,this.sourceBlock_.render()),this},o.Input.prototype.setShadowDom=function(t){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setShadowDom(t),this},o.Input.prototype.getShadowDom=function(){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.getShadowDom()},o.Input.prototype.init=function(){if(this.sourceBlock_.workspace.rendered)for(var t=0;t<this.fieldRow.length;t++)this.fieldRow[t].init()},o.Input.prototype.dispose=function(){for(var t,e=0;t=this.fieldRow[e];e++)t.dispose();this.connection&&this.connection.dispose(),this.sourceBlock_=null},o.Block=function(t,e,i){if(o.Generator&&void 0!==o.Generator.prototype[e])throw Error('Block prototypeName "'+e+'" conflicts with Blockly.Generator members.');if(this.id=i&&!t.getBlockById(i)?i:o.utils.genUid(),t.setBlockById(this.id,this),this.previousConnection=this.nextConnection=this.outputConnection=null,this.inputList=[],this.inputsInline=void 0,this.disabled=!1,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.editable_=this.movable_=this.deletable_=!0,this.collapsed_=this.isShadow_=!1,this.comment=this.outputShape_=null,this.commentModel={text:null,pinned:!1,size:new o.utils.Size(160,80)},this.xy_=new o.utils.Coordinate(0,0),this.workspace=t,this.isInFlyout=t.isFlyout,this.isInMutator=t.isMutator,this.RTL=t.RTL,this.isInsertionMarker_=!1,this.hat=void 0,this.rendered=null,this.statementInputCount=0,e){if(this.type=e,!(i=o.Blocks[e])||"object"!=typeof i)throw TypeError("Unknown block type: "+e);o.utils.object.mixin(this,i)}t.addTopBlock(this),t.addTypedBlock(this),(t=o.Events.getGroup())||o.Events.setGroup(!0),e=o.Events.recordUndo;try{"function"==typeof this.init&&(o.Events.recordUndo=!1,this.init(),o.Events.recordUndo=e),o.Events.isEnabled()&&o.Events.fire(new o.Events.BlockCreate(this))}finally{t||o.Events.setGroup(!1),o.Events.recordUndo=e}this.inputsInlineDefault=this.inputsInline,"function"==typeof this.onchange&&this.setOnChange(this.onchange)},o.Block.COLLAPSED_INPUT_NAME="_TEMP_COLLAPSED_INPUT",o.Block.COLLAPSED_FIELD_NAME="_TEMP_COLLAPSED_FIELD",o.Block.prototype.data=null,o.Block.prototype.disposed=!1,o.Block.prototype.hue_=null,o.Block.prototype.colour_="#000000",o.Block.prototype.styleName_=null,o.Block.prototype.dispose=function(t){if(this.workspace){this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.unplug(t),o.Events.isEnabled()&&o.Events.fire(new o.Events.BlockDelete(this)),o.Events.disable();try{this.workspace&&(this.workspace.removeTopBlock(this),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),this.workspace=null),o.selected==this&&(o.selected=null);for(var e=this.childBlocks_.length-1;0<=e;e--)this.childBlocks_[e].dispose(!1);e=0;for(var i;i=this.inputList[e];e++)i.dispose();this.inputList.length=0;var n,r=this.getConnections_(!0);for(e=0;n=r[e];e++)n.dispose()}finally{o.Events.enable(),this.disposed=!0}}},o.Block.prototype.initModel=function(){for(var t,e=0;t=this.inputList[e];e++)for(var o,i=0;o=t.fieldRow[i];i++)o.initModel&&o.initModel()},o.Block.prototype.unplug=function(t){this.outputConnection?this.unplugFromRow_(t):this.previousConnection&&this.unplugFromStack_(t)},o.Block.prototype.unplugFromRow_=function(t){var e=null;this.outputConnection.isConnected()&&(e=this.outputConnection.targetConnection,this.outputConnection.disconnect()),e&&t&&(t=this.getOnlyValueConnection_())&&t.isConnected()&&!t.targetBlock().isShadow()&&((t=t.targetConnection).disconnect(),this.workspace.connectionChecker.canConnect(t,e,!1)?e.connect(t):t.onFailedConnect(e))},o.Block.prototype.getOnlyValueConnection_=function(){for(var t=null,e=0;e<this.inputList.length;e++){var i=this.inputList[e].connection;if(i&&i.type==o.INPUT_VALUE&&i.targetConnection){if(t)return null;t=i}}return t},o.Block.prototype.unplugFromStack_=function(t){var e=null;this.previousConnection.isConnected()&&(e=this.previousConnection.targetConnection,this.previousConnection.disconnect());var o=this.getNextBlock();t&&o&&!o.isShadow()&&((t=this.nextConnection.targetConnection).disconnect(),e&&this.workspace.connectionChecker.canConnect(e,t,!1)&&e.connect(t))},o.Block.prototype.getConnections_=function(t){t=[],this.outputConnection&&t.push(this.outputConnection),this.previousConnection&&t.push(this.previousConnection),this.nextConnection&&t.push(this.nextConnection);for(var e,o=0;e=this.inputList[o];o++)e.connection&&t.push(e.connection);return t},o.Block.prototype.lastConnectionInStack=function(){for(var t=this.nextConnection;t;){var e=t.targetBlock();if(!e)return t;t=e.nextConnection}return null},o.Block.prototype.bumpNeighbours=function(){},o.Block.prototype.getParent=function(){return this.parentBlock_},o.Block.prototype.getInputWithBlock=function(t){for(var e,o=0;e=this.inputList[o];o++)if(e.connection&&e.connection.targetBlock()==t)return e;return null},o.Block.prototype.getSurroundParent=function(){var t=this;do{var e=t;if(!(t=t.getParent()))return null}while(t.getNextBlock()==e);return t},o.Block.prototype.getNextBlock=function(){return this.nextConnection&&this.nextConnection.targetBlock()},o.Block.prototype.getPreviousBlock=function(){return this.previousConnection&&this.previousConnection.targetBlock()},o.Block.prototype.getFirstStatementConnection=function(){for(var t,e=0;t=this.inputList[e];e++)if(t.connection&&t.connection.type==o.NEXT_STATEMENT)return t.connection;return null},o.Block.prototype.getRootBlock=function(){var t=this;do{var e=t;t=e.parentBlock_}while(t);return e},o.Block.prototype.getTopStackBlock=function(){var t=this;do{var e=t.getPreviousBlock()}while(e&&e.getNextBlock()==t&&(t=e));return t},o.Block.prototype.getChildren=function(t){if(!t)return this.childBlocks_;t=[];for(var e,o=0;e=this.inputList[o];o++)e.connection&&(e=e.connection.targetBlock())&&t.push(e);return(o=this.getNextBlock())&&t.push(o),t},o.Block.prototype.setParent=function(t){if(t!=this.parentBlock_){if(this.parentBlock_){if(o.utils.arrayRemove(this.parentBlock_.childBlocks_,this),this.previousConnection&&this.previousConnection.isConnected())throw Error("Still connected to previous block.");if(this.outputConnection&&this.outputConnection.isConnected())throw Error("Still connected to parent block.");this.parentBlock_=null}else this.workspace.removeTopBlock(this);(this.parentBlock_=t)?t.childBlocks_.push(this):this.workspace.addTopBlock(this)}},o.Block.prototype.getDescendants=function(t){for(var e,o=[this],i=this.getChildren(t),n=0;e=i[n];n++)o.push.apply(o,e.getDescendants(t));return o},o.Block.prototype.isDeletable=function(){return this.deletable_&&!this.isShadow_&&!(this.workspace&&this.workspace.options.readOnly)},o.Block.prototype.setDeletable=function(t){this.deletable_=t},o.Block.prototype.isMovable=function(){return this.movable_&&!this.isShadow_&&!(this.workspace&&this.workspace.options.readOnly)},o.Block.prototype.setMovable=function(t){this.movable_=t},o.Block.prototype.isDuplicatable=function(){return!this.workspace.hasBlockLimits()||this.workspace.isCapacityAvailable(o.utils.getBlockTypeCounts(this,!0))},o.Block.prototype.isShadow=function(){return this.isShadow_},o.Block.prototype.setShadow=function(t){this.isShadow_=t},o.Block.prototype.isInsertionMarker=function(){return this.isInsertionMarker_},o.Block.prototype.setInsertionMarker=function(t){this.isInsertionMarker_=t},o.Block.prototype.isEditable=function(){return this.editable_&&!(this.workspace&&this.workspace.options.readOnly)},o.Block.prototype.setEditable=function(t){this.editable_=t,t=0;for(var e;e=this.inputList[t];t++)for(var o,i=0;o=e.fieldRow[i];i++)o.updateEditable()},o.Block.prototype.isDisposed=function(){return this.disposed},o.Block.prototype.getMatchingConnection=function(t,e){var o=this.getConnections_(!0);if(t=t.getConnections_(!0),o.length!=t.length)throw Error("Connection lists did not match in length.");for(var i=0;i<t.length;i++)if(t[i]==e)return o[i];return null},o.Block.prototype.setHelpUrl=function(t){this.helpUrl=t},o.Block.prototype.setTooltip=function(t){this.tooltip=t},o.Block.prototype.getTooltip=function(){return o.Tooltip.getTooltipOfObject(this)},o.Block.prototype.getColour=function(){return this.colour_},o.Block.prototype.getStyleName=function(){return this.styleName_},o.Block.prototype.getHue=function(){return this.hue_},o.Block.prototype.setColour=function(t){t=o.utils.parseBlockColour(t),this.hue_=t.hue,this.colour_=t.hex},o.Block.prototype.setStyle=function(t){this.styleName_=t},o.Block.prototype.setOnChange=function(t){if(t&&"function"!=typeof t)throw Error("onchange must be a function.");this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),(this.onchange=t)&&(this.onchangeWrapper_=t.bind(this),this.workspace.addChangeListener(this.onchangeWrapper_))},o.Block.prototype.getField=function(t){for(var e,o=0;e=this.inputList[o];o++)for(var i,n=0;i=e.fieldRow[n];n++)if(i.name==t)return i;return null},o.Block.prototype.getVars=function(){for(var t,e=[],o=0;t=this.inputList[o];o++)for(var i,n=0;i=t.fieldRow[n];n++)i.referencesVariables()&&e.push(i.getValue());return e},o.Block.prototype.getVarModels=function(){for(var t,e=[],o=0;t=this.inputList[o];o++)for(var i,n=0;i=t.fieldRow[n];n++)i.referencesVariables()&&(i=this.workspace.getVariableById(i.getValue()))&&e.push(i);return e},o.Block.prototype.updateVarName=function(t){for(var e,o=0;e=this.inputList[o];o++)for(var i,n=0;i=e.fieldRow[n];n++)i.referencesVariables()&&t.getId()==i.getValue()&&i.refreshVariableName()},o.Block.prototype.renameVarById=function(t,e){for(var o,i=0;o=this.inputList[i];i++)for(var n,r=0;n=o.fieldRow[r];r++)n.referencesVariables()&&t==n.getValue()&&n.setValue(e)},o.Block.prototype.getFieldValue=function(t){return(t=this.getField(t))?t.getValue():null},o.Block.prototype.setFieldValue=function(t,e){var o=this.getField(e);if(!o)throw Error('Field "'+e+'" not found.');o.setValue(t)},o.Block.prototype.setPreviousStatement=function(t,e){if(t){if(void 0===e&&(e=null),!this.previousConnection){if(this.outputConnection)throw Error("Remove output connection prior to adding previous connection.");this.previousConnection=this.makeConnection_(o.PREVIOUS_STATEMENT)}this.previousConnection.setCheck(e)}else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}},o.Block.prototype.setNextStatement=function(t,e){if(t)void 0===e&&(e=null),this.nextConnection||(this.nextConnection=this.makeConnection_(o.NEXT_STATEMENT)),this.nextConnection.setCheck(e);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}},o.Block.prototype.setOutput=function(t,e){if(t){if(void 0===e&&(e=null),!this.outputConnection){if(this.previousConnection)throw Error("Remove previous connection prior to adding output connection.");this.outputConnection=this.makeConnection_(o.OUTPUT_VALUE)}this.outputConnection.setCheck(e)}else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}},o.Block.prototype.setInputsInline=function(t){this.inputsInline!=t&&(o.Events.fire(new o.Events.BlockChange(this,"inline",null,this.inputsInline,t)),this.inputsInline=t)},o.Block.prototype.getInputsInline=function(){if(null!=this.inputsInline)return this.inputsInline;for(var t=1;t<this.inputList.length;t++)if(this.inputList[t-1].type==o.DUMMY_INPUT&&this.inputList[t].type==o.DUMMY_INPUT)return!1;for(t=1;t<this.inputList.length;t++)if(this.inputList[t-1].type==o.INPUT_VALUE&&this.inputList[t].type==o.DUMMY_INPUT)return!0;return!1},o.Block.prototype.setOutputShape=function(t){this.outputShape_=t},o.Block.prototype.getOutputShape=function(){return this.outputShape_},o.Block.prototype.isEnabled=function(){return!this.disabled},o.Block.prototype.setEnabled=function(t){this.isEnabled()!=t&&(o.Events.fire(new o.Events.BlockChange(this,"disabled",null,this.disabled,!t)),this.disabled=!t)},o.Block.prototype.getInheritedDisabled=function(){for(var t=this.getSurroundParent();t;){if(t.disabled)return!0;t=t.getSurroundParent()}return!1},o.Block.prototype.isCollapsed=function(){return this.collapsed_},o.Block.prototype.setCollapsed=function(t){this.collapsed_!=t&&(o.Events.fire(new o.Events.BlockChange(this,"collapsed",null,this.collapsed_,t)),this.collapsed_=t)},o.Block.prototype.toString=function(t,e){function i(t){var e=t.getCheck();return!e&&t.targetConnection&&(e=t.targetConnection.getCheck()),!!e&&(-1!=e.indexOf("Boolean")||-1!=e.indexOf("Number"))}function n(){a&&a.getType()==l.getType()&&a.getLocation()==l.getLocation()&&(a=null)}var r=[];e=e||"?";var s=o.ASTNode.NAVIGATE_ALL_FIELDS;o.ASTNode.NAVIGATE_ALL_FIELDS=!0;for(var a=o.ASTNode.createBlockNode(this),l=a;a;){switch(a.getType()){case o.ASTNode.types.INPUT:var c=a.getLocation();a.in()?i(c)&&r.push("("):r.push(e);break;case o.ASTNode.types.FIELD:(c=a.getLocation()).name!=o.Block.COLLAPSED_FIELD_NAME&&r.push(c.getText())}if(!(a=(c=a).in()||c.next())){for(a=c.out(),n();a&&!a.next();)a=a.out(),n(),a&&a.getType()==o.ASTNode.types.INPUT&&i(a.getLocation())&&r.push(")");a&&(a=a.next())}}for(o.ASTNode.NAVIGATE_ALL_FIELDS=s,e=2,s=r.length;e<s;e++)"("==r[e-2]&&")"==r[e]&&(r[e-2]=r[e-1],r.splice(e-1,2),s-=2);return r=r.join(" ").replace(/(\() | (\))/gim,"$1$2").trim()||"???",t&&r.length>t&&(r=r.substring(0,t-3)+"..."),r},o.Block.prototype.appendValueInput=function(t){return this.appendInput_(o.INPUT_VALUE,t)},o.Block.prototype.appendStatementInput=function(t){return this.appendInput_(o.NEXT_STATEMENT,t)},o.Block.prototype.appendDummyInput=function(t){return this.appendInput_(o.DUMMY_INPUT,t||"")},o.Block.prototype.jsonInit=function(t){var e=t.type?'Block "'+t.type+'": ':"";if(t.output&&t.previousStatement)throw Error(e+"Must not have both an output and a previousStatement.");if(t.style&&t.style.hat&&(this.hat=t.style.hat,t.style=null),t.style&&t.colour)throw Error(e+"Must not have both a colour and a style.");t.style?this.jsonInitStyle_(t,e):this.jsonInitColour_(t,e);for(var i=0;void 0!==t["message"+i];)this.interpolate_(t["message"+i],t["args"+i]||[],t["lastDummyAlign"+i],e),i++;if(void 0!==t.inputsInline&&this.setInputsInline(t.inputsInline),void 0!==t.output&&this.setOutput(!0,t.output),void 0!==t.outputShape&&this.setOutputShape(t.outputShape),void 0!==t.previousStatement&&this.setPreviousStatement(!0,t.previousStatement),void 0!==t.nextStatement&&this.setNextStatement(!0,t.nextStatement),void 0!==t.tooltip&&(i=t.tooltip,i=o.utils.replaceMessageReferences(i),this.setTooltip(i)),void 0!==t.enableContextMenu&&(i=t.enableContextMenu,this.contextMenu=!!i),void 0!==t.helpUrl&&(i=t.helpUrl,i=o.utils.replaceMessageReferences(i),this.setHelpUrl(i)),"string"==typeof t.extensions&&(console.warn(e+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+t.type+"' block."),t.extensions=[t.extensions]),void 0!==t.mutator&&o.Extensions.apply(t.mutator,this,!0),Array.isArray(t.extensions))for(t=t.extensions,e=0;e<t.length;++e)o.Extensions.apply(t[e],this,!1)},o.Block.prototype.jsonInitColour_=function(t,e){if("colour"in t)if(void 0===t.colour)console.warn(e+"Undefined colour value.");else{t=t.colour;try{this.setColour(t)}catch(o){console.warn(e+"Illegal colour value: ",t)}}},o.Block.prototype.jsonInitStyle_=function(t,e){t=t.style;try{this.setStyle(t)}catch(o){console.warn(e+"Style does not exist: ",t)}},o.Block.prototype.mixin=function(t,e){if(void 0!==e&&"boolean"!=typeof e)throw Error("opt_disableCheck must be a boolean if provided");if(!e){for(var i in e=[],t)void 0!==this[i]&&e.push(i);if(e.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(e))}o.utils.object.mixin(this,t)},o.Block.prototype.interpolate_=function(t,e,i,n){var r=o.utils.tokenizeInterpolation(t),s=[],a=0;t=[];for(var l=0;l<r.length;l++){var c=r[l];if("number"==typeof c){if(0>=c||c>e.length)throw Error('Block "'+this.type+'": Message index %'+c+" out of range.");if(s[c])throw Error('Block "'+this.type+'": Message index %'+c+" duplicated.");s[c]=!0,a++,t.push(e[c-1])}else(c=c.trim())&&t.push(c)}if(a!=e.length)throw Error('Block "'+this.type+'": Message does not reference all '+e.length+" arg(s).");for(t.length&&("string"==typeof t[t.length-1]||o.utils.string.startsWith(t[t.length-1].type,"field_"))&&(l={type:"input_dummy"},i&&(l.align=i),t.push(l)),i={LEFT:o.ALIGN_LEFT,RIGHT:o.ALIGN_RIGHT,CENTRE:o.ALIGN_CENTRE,CENTER:o.ALIGN_CENTRE},e=[],l=0;l<t.length;l++)if("string"==typeof(s=t[l]))e.push([s,void 0]);else{r=a=null;do{if(c=!1,"string"==typeof s)a=new o.FieldLabel(s);else switch(s.type){case"input_value":r=this.appendValueInput(s.name);break;case"input_statement":r=this.appendStatementInput(s.name);break;case"input_dummy":r=this.appendDummyInput(s.name);break;default:!(a=o.fieldRegistry.fromJson(s))&&s.alt&&(s=s.alt,c=!0)}}while(c);if(a)e.push([a,s.name]);else if(r){for(s.check&&r.setCheck(s.check),s.align&&(void 0===(a=i[s.align.toUpperCase()])?console.warn(n+"Illegal align value: ",s.align):r.setAlign(a)),s=0;s<e.length;s++)r.appendField(e[s][0],e[s][1]);e.length=0}}},o.Block.prototype.appendInput_=function(t,e){var i=null;return t!=o.INPUT_VALUE&&t!=o.NEXT_STATEMENT||(i=this.makeConnection_(t)),t==o.NEXT_STATEMENT&&this.statementInputCount++,t=new o.Input(t,e,this,i),this.inputList.push(t),t},o.Block.prototype.moveInputBefore=function(t,e){if(t!=e){for(var o,i=-1,n=e?-1:this.inputList.length,r=0;o=this.inputList[r];r++)if(o.name==t){if(i=r,-1!=n)break}else if(e&&o.name==e&&(n=r,-1!=i))break;if(-1==i)throw Error('Named input "'+t+'" not found.');if(-1==n)throw Error('Reference input "'+e+'" not found.');this.moveNumberedInputBefore(i,n)}},o.Block.prototype.moveNumberedInputBefore=function(t,e){if(t==e)throw Error("Can't move input to itself.");if(t>=this.inputList.length)throw RangeError("Input index "+t+" out of bounds.");if(e>this.inputList.length)throw RangeError("Reference input "+e+" out of bounds.");var o=this.inputList[t];this.inputList.splice(t,1),t<e&&e--,this.inputList.splice(e,0,o)},o.Block.prototype.removeInput=function(t,e){for(var i,n=0;i=this.inputList[n];n++)if(i.name==t)return i.type==o.NEXT_STATEMENT&&this.statementInputCount--,i.dispose(),this.inputList.splice(n,1),!0;if(e)return!1;throw Error("Input not found: "+t)},o.Block.prototype.getInput=function(t){for(var e,o=0;e=this.inputList[o];o++)if(e.name==t)return e;return null},o.Block.prototype.getInputTargetBlock=function(t){return(t=this.getInput(t))&&t.connection&&t.connection.targetBlock()},o.Block.prototype.getCommentText=function(){return this.commentModel.text},o.Block.prototype.setCommentText=function(t){this.commentModel.text!=t&&(o.Events.fire(new o.Events.BlockChange(this,"comment",null,this.commentModel.text,t)),this.comment=this.commentModel.text=t)},o.Block.prototype.setWarningText=function(t,e){},o.Block.prototype.setMutator=function(t){},o.Block.prototype.getRelativeToSurfaceXY=function(){return this.xy_},o.Block.prototype.moveBy=function(t,e){if(this.parentBlock_)throw Error("Block has parent.");var i=new o.Events.BlockMove(this);this.xy_.translate(t,e),i.recordNew(),o.Events.fire(i)},o.Block.prototype.makeConnection_=function(t){return new o.Connection(this,t)},o.Block.prototype.allInputsFilled=function(t){if(void 0===t&&(t=!0),!t&&this.isShadow())return!1;for(var e,o=0;e=this.inputList[o];o++)if(e.connection&&(!(e=e.connection.targetBlock())||!e.allInputsFilled(t)))return!1;return!(o=this.getNextBlock())||o.allInputsFilled(t)},o.Block.prototype.toDevString=function(){var t=this.type?'"'+this.type+'" block':"Block";return this.id&&(t+=' (id="'+this.id+'")'),t},o.blockRendering={},o.blockRendering.IPathObject=function(t,e){},o.utils.aria={},o.utils.aria.ARIA_PREFIX_="aria-",o.utils.aria.ROLE_ATTRIBUTE_="role",o.utils.aria.Role={GRID:"grid",GRIDCELL:"gridcell",GROUP:"group",LISTBOX:"listbox",MENU:"menu",MENUITEM:"menuitem",MENUITEMCHECKBOX:"menuitemcheckbox",OPTION:"option",PRESENTATION:"presentation",ROW:"row",TREE:"tree",TREEITEM:"treeitem"},o.utils.aria.State={ACTIVEDESCENDANT:"activedescendant",COLCOUNT:"colcount",DISABLED:"disabled",EXPANDED:"expanded",INVALID:"invalid",LABEL:"label",LABELLEDBY:"labelledby",LEVEL:"level",ORIENTATION:"orientation",POSINSET:"posinset",ROWCOUNT:"rowcount",SELECTED:"selected",SETSIZE:"setsize",VALUEMAX:"valuemax",VALUEMIN:"valuemin"},o.utils.aria.setRole=function(t,e){t.setAttribute(o.utils.aria.ROLE_ATTRIBUTE_,e)},o.utils.aria.setState=function(t,e,i){Array.isArray(i)&&(i=i.join(" ")),t.setAttribute(o.utils.aria.ARIA_PREFIX_+e,i)},o.utils.KeyCodes={WIN_KEY_FF_LINUX:0,MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS_SIGN:43,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,FF_SEMICOLON:59,FF_EQUALS:61,FF_DASH:173,FF_HASH:163,QUESTION_MARK:63,AT_SIGN:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLL_LOCK:145,FIRST_MEDIA_KEY:166,LAST_MEDIA_KEY:183,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,TILDE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,MAC_WK_CMD_LEFT:91,MAC_WK_CMD_RIGHT:93,WIN_IME:229,VK_NONAME:252,PHANTOM:255},o.Menu=function(){this.menuItems_=[],this.roleName_=this.element_=this.onKeyDownHandler_=this.mouseLeaveHandler_=this.mouseEnterHandler_=this.clickHandler_=this.mouseOverHandler_=this.highlightedItem_=this.openingCoords=null},o.Menu.prototype.addChild=function(t){this.menuItems_.push(t)},o.Menu.prototype.render=function(t){var e=document.createElement("div");e.className="blocklyMenu goog-menu blocklyNonSelectable",e.tabIndex=0,this.roleName_&&o.utils.aria.setRole(e,this.roleName_),this.element_=e;for(var i,n=0;i=this.menuItems_[n];n++)e.appendChild(i.createDom());this.mouseOverHandler_=o.bindEventWithChecks_(e,"mouseover",this,this.handleMouseOver_,!0),this.clickHandler_=o.bindEventWithChecks_(e,"click",this,this.handleClick_,!0),this.mouseEnterHandler_=o.bindEventWithChecks_(e,"mouseenter",this,this.handleMouseEnter_,!0),this.mouseLeaveHandler_=o.bindEventWithChecks_(e,"mouseleave",this,this.handleMouseLeave_,!0),this.onKeyDownHandler_=o.bindEventWithChecks_(e,"keydown",this,this.handleKeyEvent_),t.appendChild(e)},o.Menu.prototype.getElement=function(){return this.element_},o.Menu.prototype.focus=function(){var t=this.getElement();t&&(t.focus({preventScroll:!0}),o.utils.dom.addClass(t,"blocklyFocused"))},o.Menu.prototype.blur_=function(){var t=this.getElement();t&&(t.blur(),o.utils.dom.removeClass(t,"blocklyFocused"))},o.Menu.prototype.setRole=function(t){this.roleName_=t},o.Menu.prototype.dispose=function(){this.mouseOverHandler_&&(o.unbindEvent_(this.mouseOverHandler_),this.mouseOverHandler_=null),this.clickHandler_&&(o.unbindEvent_(this.clickHandler_),this.clickHandler_=null),this.mouseEnterHandler_&&(o.unbindEvent_(this.mouseEnterHandler_),this.mouseEnterHandler_=null),this.mouseLeaveHandler_&&(o.unbindEvent_(this.mouseLeaveHandler_),this.mouseLeaveHandler_=null),this.onKeyDownHandler_&&(o.unbindEvent_(this.onKeyDownHandler_),this.onKeyDownHandler_=null);for(var t,e=0;t=this.menuItems_[e];e++)t.dispose();this.element_=null},o.Menu.prototype.getMenuItem_=function(t){for(var e=this.getElement();t&&t!=e;){if(o.utils.dom.hasClass(t,"blocklyMenuItem"))for(var i,n=0;i=this.menuItems_[n];n++)if(i.getElement()==t)return i;t=t.parentElement}return null},o.Menu.prototype.setHighlighted=function(t){var e=this.highlightedItem_;e&&(e.setHighlighted(!1),this.highlightedItem_=null),t&&(t.setHighlighted(!0),this.highlightedItem_=t,e=this.getElement(),o.utils.style.scrollIntoContainerView(t.getElement(),e),o.utils.aria.setState(e,o.utils.aria.State.ACTIVEDESCENDANT,t.getId()))},o.Menu.prototype.highlightNext=function(){var t=this.menuItems_.indexOf(this.highlightedItem_);this.highlightHelper_(t,1)},o.Menu.prototype.highlightPrevious=function(){var t=this.menuItems_.indexOf(this.highlightedItem_);this.highlightHelper_(0>t?this.menuItems_.length:t,-1)},o.Menu.prototype.highlightFirst_=function(){this.highlightHelper_(-1,1)},o.Menu.prototype.highlightLast_=function(){this.highlightHelper_(this.menuItems_.length,-1)},o.Menu.prototype.highlightHelper_=function(t,e){t+=e;for(var o;o=this.menuItems_[t];){if(o.isEnabled()){this.setHighlighted(o);break}t+=e}},o.Menu.prototype.handleMouseOver_=function(t){(t=this.getMenuItem_(t.target))&&(t.isEnabled()?this.highlightedItem_!=t&&this.setHighlighted(t):this.setHighlighted(null))},o.Menu.prototype.handleClick_=function(t){var e=this.openingCoords;if(this.openingCoords=null,e&&"number"==typeof t.clientX){var i=new o.utils.Coordinate(t.clientX,t.clientY);if(1>o.utils.Coordinate.distance(e,i))return}(t=this.getMenuItem_(t.target))&&t.performAction()},o.Menu.prototype.handleMouseEnter_=function(t){this.focus()},o.Menu.prototype.handleMouseLeave_=function(t){this.getElement()&&(this.blur_(),this.setHighlighted(null))},o.Menu.prototype.handleKeyEvent_=function(t){if(this.menuItems_.length&&!(t.shiftKey||t.ctrlKey||t.metaKey||t.altKey)){var e=this.highlightedItem_;switch(t.keyCode){case o.utils.KeyCodes.ENTER:case o.utils.KeyCodes.SPACE:e&&e.performAction();break;case o.utils.KeyCodes.UP:this.highlightPrevious();break;case o.utils.KeyCodes.DOWN:this.highlightNext();break;case o.utils.KeyCodes.PAGE_UP:case o.utils.KeyCodes.HOME:this.highlightFirst_();break;case o.utils.KeyCodes.PAGE_DOWN:case o.utils.KeyCodes.END:this.highlightLast_();break;default:return}t.preventDefault(),t.stopPropagation()}},o.Menu.prototype.getSize=function(){var t=this.getElement(),e=o.utils.style.getSize(t);return e.height=t.scrollHeight,e},o.MenuItem=function(t,e){this.content_=t,this.value_=e,this.enabled_=!0,this.element_=null,this.rightToLeft_=!1,this.roleName_=null,this.highlight_=this.checked_=this.checkable_=!1,this.actionHandler_=null},o.MenuItem.prototype.createDom=function(){var t=document.createElement("div");t.id=o.utils.IdGenerator.getNextUniqueId(),this.element_=t,t.className="blocklyMenuItem goog-menuitem "+(this.enabled_?"":"blocklyMenuItemDisabled goog-menuitem-disabled ")+(this.checked_?"blocklyMenuItemSelected goog-option-selected ":"")+(this.highlight_?"blocklyMenuItemHighlight goog-menuitem-highlight ":"")+(this.rightToLeft_?"blocklyMenuItemRtl goog-menuitem-rtl ":"");var e=document.createElement("div");if(e.className="blocklyMenuItemContent goog-menuitem-content",this.checkable_){var i=document.createElement("div");i.className="blocklyMenuItemCheckbox goog-menuitem-checkbox",e.appendChild(i)}return i=this.content_,"string"==typeof this.content_&&(i=document.createTextNode(this.content_)),e.appendChild(i),t.appendChild(e),this.roleName_&&o.utils.aria.setRole(t,this.roleName_),o.utils.aria.setState(t,o.utils.aria.State.SELECTED,this.checkable_&&this.checked_||!1),o.utils.aria.setState(t,o.utils.aria.State.DISABLED,!this.enabled_),t},o.MenuItem.prototype.dispose=function(){this.element_=null},o.MenuItem.prototype.getElement=function(){return this.element_},o.MenuItem.prototype.getId=function(){return this.element_.id},o.MenuItem.prototype.getValue=function(){return this.value_},o.MenuItem.prototype.setRightToLeft=function(t){this.rightToLeft_=t},o.MenuItem.prototype.setRole=function(t){this.roleName_=t},o.MenuItem.prototype.setCheckable=function(t){this.checkable_=t},o.MenuItem.prototype.setChecked=function(t){this.checked_=t},o.MenuItem.prototype.setHighlighted=function(t){this.highlight_=t;var e=this.getElement();e&&this.isEnabled()&&(t?(o.utils.dom.addClass(e,"blocklyMenuItemHighlight"),o.utils.dom.addClass(e,"goog-menuitem-highlight")):(o.utils.dom.removeClass(e,"blocklyMenuItemHighlight"),o.utils.dom.removeClass(e,"goog-menuitem-highlight")))},o.MenuItem.prototype.isEnabled=function(){return this.enabled_},o.MenuItem.prototype.setEnabled=function(t){this.enabled_=t},o.MenuItem.prototype.performAction=function(){this.isEnabled()&&this.actionHandler_&&this.actionHandler_(this)},o.MenuItem.prototype.onAction=function(t,e){this.actionHandler_=t.bind(e)},o.ContextMenu={},o.ContextMenu.currentBlock=null,o.ContextMenu.menu_=null,o.ContextMenu.show=function(t,e,i){if(o.WidgetDiv.show(o.ContextMenu,i,o.ContextMenu.dispose),e.length){var n=o.ContextMenu.populate_(e,i);o.ContextMenu.menu_=n,o.ContextMenu.position_(n,t,i),setTimeout((function(){n.focus()}),1),o.ContextMenu.currentBlock=null}else o.ContextMenu.hide()},o.ContextMenu.populate_=function(t,e){var i=new o.Menu;i.setRole(o.utils.aria.Role.MENU);for(var n,r=0;n=t[r];r++){var s=new o.MenuItem(n.text);s.setRightToLeft(e),s.setRole(o.utils.aria.Role.MENUITEM),i.addChild(s),s.setEnabled(n.enabled),n.enabled&&s.onAction((function(t){o.ContextMenu.hide(),this.callback(this.scope)}),n)}return i},o.ContextMenu.position_=function(t,e,i){var n=o.utils.getViewportBBox();e=new o.utils.Rect(e.clientY+n.top,e.clientY+n.top,e.clientX+n.left,e.clientX+n.left),o.ContextMenu.createWidget_(t);var r=t.getSize();i&&(e.left+=r.width,e.right+=r.width,n.left+=r.width,n.right+=r.width),o.WidgetDiv.positionWithAnchor(n,e,r,i),t.focus()},o.ContextMenu.createWidget_=function(t){t.render(o.WidgetDiv.DIV);var e=t.getElement();o.utils.dom.addClass(e,"blocklyContextMenu"),o.bindEventWithChecks_(e,"contextmenu",null,o.utils.noEvent),t.focus()},o.ContextMenu.hide=function(){o.WidgetDiv.hideIfOwner(o.ContextMenu),o.ContextMenu.currentBlock=null},o.ContextMenu.dispose=function(){o.ContextMenu.menu_&&(o.ContextMenu.menu_.dispose(),o.ContextMenu.menu_=null)},o.ContextMenu.callbackFactory=function(t,e){return function(){o.Events.disable();try{var i=o.Xml.domToBlock(e,t.workspace),n=t.getRelativeToSurfaceXY();n.x=t.RTL?n.x-o.SNAP_RADIUS:n.x+o.SNAP_RADIUS,n.y+=2*o.SNAP_RADIUS,i.moveBy(n.x,n.y)}finally{o.Events.enable()}o.Events.isEnabled()&&!i.isShadow()&&o.Events.fire(new o.Events.BlockCreate(i)),i.select()}},o.ContextMenu.commentDeleteOption=function(t){return{text:o.Msg.REMOVE_COMMENT,enabled:!0,callback:function(){o.Events.setGroup(!0),t.dispose(!0,!0),o.Events.setGroup(!1)}}},o.ContextMenu.commentDuplicateOption=function(t){return{text:o.Msg.DUPLICATE_COMMENT,enabled:!0,callback:function(){o.duplicate(t)}}},o.ContextMenu.workspaceCommentOption=function(t,e){if(!o.WorkspaceCommentSvg)throw Error("Missing require for Blockly.WorkspaceCommentSvg");var i={enabled:!o.utils.userAgent.IE};return i.text=o.Msg.ADD_COMMENT,i.callback=function(){var i=new o.WorkspaceCommentSvg(t,o.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT,o.WorkspaceCommentSvg.DEFAULT_SIZE,o.WorkspaceCommentSvg.DEFAULT_SIZE),n=t.getInjectionDiv().getBoundingClientRect();n=new o.utils.Coordinate(e.clientX-n.left,e.clientY-n.top);var r=t.getOriginOffsetInPixels();(n=o.utils.Coordinate.difference(n,r)).scale(1/t.scale),i.moveBy(n.x,n.y),t.rendered&&(i.initSvg(),i.render(),i.select())},i},o.ContextMenuItems={},o.ContextMenuItems.registerUndo=function(){o.ContextMenuRegistry.registry.register({displayText:function(){return o.Msg.UNDO},preconditionFn:function(t){return 0<t.workspace.getUndoStack().length?"enabled":"disabled"},callback:function(t){t.workspace.undo(!1)},scopeType:o.ContextMenuRegistry.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1})},o.ContextMenuItems.registerRedo=function(){o.ContextMenuRegistry.registry.register({displayText:function(){return o.Msg.REDO},preconditionFn:function(t){return 0<t.workspace.getRedoStack().length?"enabled":"disabled"},callback:function(t){t.workspace.undo(!0)},scopeType:o.ContextMenuRegistry.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2})},o.ContextMenuItems.registerCleanup=function(){o.ContextMenuRegistry.registry.register({displayText:function(){return o.Msg.CLEAN_UP},preconditionFn:function(t){return t.workspace.isMovable()?1<t.workspace.getTopBlocks(!1).length?"enabled":"disabled":"hidden"},callback:function(t){t.workspace.cleanUp()},scopeType:o.ContextMenuRegistry.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3})},o.ContextMenuItems.toggleOption_=function(t,e){for(var o=0,i=0;i<e.length;i++)for(var n=e[i];n;)setTimeout(n.setCollapsed.bind(n,t),o),n=n.getNextBlock(),o+=10},o.ContextMenuItems.registerCollapse=function(){o.ContextMenuRegistry.registry.register({displayText:function(){return o.Msg.COLLAPSE_ALL},preconditionFn:function(t){if(t.workspace.options.collapse){t=t.workspace.getTopBlocks(!1);for(var e=0;e<t.length;e++)for(var o=t[e];o;){if(!o.isCollapsed())return"enabled";o=o.getNextBlock()}return"disabled"}return"hidden"},callback:function(t){o.ContextMenuItems.toggleOption_(!0,t.workspace.getTopBlocks(!0))},scopeType:o.ContextMenuRegistry.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4})},o.ContextMenuItems.registerExpand=function(){o.ContextMenuRegistry.registry.register({displayText:function(){return o.Msg.EXPAND_ALL},preconditionFn:function(t){if(t.workspace.options.collapse){t=t.workspace.getTopBlocks(!1);for(var e=0;e<t.length;e++)for(var o=t[e];o;){if(o.isCollapsed())return"enabled";o=o.getNextBlock()}return"disabled"}return"hidden"},callback:function(t){o.ContextMenuItems.toggleOption_(!1,t.workspace.getTopBlocks(!0))},scopeType:o.ContextMenuRegistry.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5})},o.ContextMenuItems.addDeletableBlocks_=function(t,e){if(t.isDeletable())Array.prototype.push.apply(e,t.getDescendants(!1));else{t=t.getChildren(!1);for(var i=0;i<t.length;i++)o.ContextMenuItems.addDeletableBlocks_(t[i],e)}},o.ContextMenuItems.getDeletableBlocks_=function(t){var e=[];t=t.getTopBlocks(!0);for(var i=0;i<t.length;i++)o.ContextMenuItems.addDeletableBlocks_(t[i],e);return e},o.ContextMenuItems.deleteNext_=function(t,e){o.Events.setGroup(e);var i=t.shift();i&&(i.workspace?(i.dispose(!1,!0),setTimeout(o.ContextMenuItems.deleteNext_,10,t,e)):o.ContextMenuItems.deleteNext_(t,e)),o.Events.setGroup(!1)},o.ContextMenuItems.registerDeleteAll=function(){o.ContextMenuRegistry.registry.register({displayText:function(t){if(t.workspace)return 1==(t=o.ContextMenuItems.getDeletableBlocks_(t.workspace).length)?o.Msg.DELETE_BLOCK:o.Msg.DELETE_X_BLOCKS.replace("%1",String(t))},preconditionFn:function(t){if(t.workspace)return 0<o.ContextMenuItems.getDeletableBlocks_(t.workspace).length?"enabled":"disabled"},callback:function(t){if(t.workspace){t.workspace.cancelCurrentGesture();var e=o.ContextMenuItems.getDeletableBlocks_(t.workspace),i=o.utils.genUid();2>e.length?o.ContextMenuItems.deleteNext_(e,i):o.confirm(o.Msg.DELETE_ALL_BLOCKS.replace("%1",e.length),(function(t){t&&o.ContextMenuItems.deleteNext_(e,i)}))}},scopeType:o.ContextMenuRegistry.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6})},o.ContextMenuItems.registerWorkspaceOptions_=function(){o.ContextMenuItems.registerUndo(),o.ContextMenuItems.registerRedo(),o.ContextMenuItems.registerCleanup(),o.ContextMenuItems.registerCollapse(),o.ContextMenuItems.registerExpand(),o.ContextMenuItems.registerDeleteAll()},o.ContextMenuItems.registerDuplicate=function(){o.ContextMenuRegistry.registry.register({displayText:function(){return o.Msg.DUPLICATE_BLOCK},preconditionFn:function(t){return!(t=t.block).isInFlyout&&t.isDeletable()&&t.isMovable()?t.isDuplicatable()?"enabled":"disabled":"hidden"},callback:function(t){t.block&&o.duplicate(t.block)},scopeType:o.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDuplicate",weight:1})},o.ContextMenuItems.registerComment=function(){o.ContextMenuRegistry.registry.register({displayText:function(t){return t.block.getCommentIcon()?o.Msg.REMOVE_COMMENT:o.Msg.ADD_COMMENT},preconditionFn:function(t){return t=t.block,o.utils.userAgent.IE||t.isInFlyout||!t.workspace.options.comments||t.isCollapsed()||!t.isEditable()?"hidden":"enabled"},callback:function(t){(t=t.block).getCommentIcon()?t.setCommentText(null):t.setCommentText("")},scopeType:o.ContextMenuRegistry.ScopeType.BLOCK,id:"blockComment",weight:2})},o.ContextMenuItems.registerInline=function(){o.ContextMenuRegistry.registry.register({displayText:function(t){return t.block.getInputsInline()?o.Msg.EXTERNAL_INPUTS:o.Msg.INLINE_INPUTS},preconditionFn:function(t){if(!(t=t.block).isInFlyout&&t.isMovable()&&!t.isCollapsed())for(var e=1;e<t.inputList.length;e++)if(t.inputList[e-1].type!=o.NEXT_STATEMENT&&t.inputList[e].type!=o.NEXT_STATEMENT)return"enabled";return"hidden"},callback:function(t){t.block.setInputsInline(!t.block.getInputsInline())},scopeType:o.ContextMenuRegistry.ScopeType.BLOCK,id:"blockInline",weight:3})},o.ContextMenuItems.registerCollapseExpandBlock=function(){o.ContextMenuRegistry.registry.register({displayText:function(t){return t.block.isCollapsed()?o.Msg.EXPAND_BLOCK:o.Msg.COLLAPSE_BLOCK},preconditionFn:function(t){return!(t=t.block).isInFlyout&&t.isMovable()?"enabled":"hidden"},callback:function(t){t.block.setCollapsed(!t.block.isCollapsed())},scopeType:o.ContextMenuRegistry.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4})},o.ContextMenuItems.registerDisable=function(){o.ContextMenuRegistry.registry.register({displayText:function(t){return t.block.isEnabled()?o.Msg.DISABLE_BLOCK:o.Msg.ENABLE_BLOCK},preconditionFn:function(t){return!(t=t.block).isInFlyout&&t.workspace.options.disable&&t.isEditable()?t.getInheritedDisabled()?"disabled":"enabled":"hidden"},callback:function(t){t=t.block;var e=o.Events.getGroup();e||o.Events.setGroup(!0),t.setEnabled(!t.isEnabled()),e||o.Events.setGroup(!1)},scopeType:o.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDisable",weight:5})},o.ContextMenuItems.registerDelete=function(){o.ContextMenuRegistry.registry.register({displayText:function(t){var e=t.block;return t=e.getDescendants(!1).length,(e=e.getNextBlock())&&(t-=e.getDescendants(!1).length),1==t?o.Msg.DELETE_BLOCK:o.Msg.DELETE_X_BLOCKS.replace("%1",String(t))},preconditionFn:function(t){return!t.block.isInFlyout&&t.block.isDeletable()?"enabled":"hidden"},callback:function(t){o.Events.setGroup(!0),t.block.dispose(!0,!0),o.Events.setGroup(!1)},scopeType:o.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDelete",weight:6})},o.ContextMenuItems.registerHelp=function(){o.ContextMenuRegistry.registry.register({displayText:function(){return o.Msg.HELP},preconditionFn:function(t){return("function"==typeof(t=t.block).helpUrl?t.helpUrl():t.helpUrl)?"enabled":"hidden"},callback:function(t){t.block.showHelp()},scopeType:o.ContextMenuRegistry.ScopeType.BLOCK,id:"blockHelp",weight:7})},o.ContextMenuItems.registerBlockOptions_=function(){o.ContextMenuItems.registerDuplicate(),o.ContextMenuItems.registerComment(),o.ContextMenuItems.registerInline(),o.ContextMenuItems.registerCollapseExpandBlock(),o.ContextMenuItems.registerDisable(),o.ContextMenuItems.registerDelete(),o.ContextMenuItems.registerHelp()},o.ContextMenuItems.registerDefaultOptions=function(){o.ContextMenuItems.registerWorkspaceOptions_(),o.ContextMenuItems.registerBlockOptions_()},o.ContextMenuRegistry=function(){o.ContextMenuRegistry.registry=this,this.registry_={},o.ContextMenuItems.registerDefaultOptions()},o.ContextMenuRegistry.ScopeType={BLOCK:"block",WORKSPACE:"workspace"},o.ContextMenuRegistry.registry=null,o.ContextMenuRegistry.prototype.register=function(t){if(this.registry_[t.id])throw Error('Menu item with id "'+t.id+'" is already registered.');this.registry_[t.id]=t},o.ContextMenuRegistry.prototype.unregister=function(t){if(!this.registry_[t])throw Error('Menu item with id "'+t+'" not found.');delete this.registry_[t]},o.ContextMenuRegistry.prototype.getItem=function(t){return this.registry_[t]?this.registry_[t]:null},o.ContextMenuRegistry.prototype.getContextMenuOptions=function(t,e){var o=[],i=this.registry_;return Object.keys(i).forEach((function(n){if(n=i[n],t==n.scopeType){var r=n.preconditionFn(e);"hidden"!=r&&(n={text:"function"==typeof n.displayText?n.displayText(e):n.displayText,enabled:"enabled"==r,callback:n.callback,scope:e,weight:n.weight},o.push(n))}})),o.sort((function(t,e){return t.weight-e.weight})),o},new o.ContextMenuRegistry,o.Events.Selected=function(t,e,i){o.Events.Selected.superClass_.constructor.call(this,i),this.oldElementId=t,this.newElementId=e},o.utils.object.inherits(o.Events.Selected,o.Events.UiBase),o.Events.Selected.prototype.type=o.Events.SELECTED,o.Events.Selected.prototype.toJson=function(){var t=o.Events.Selected.superClass_.toJson.call(this);return t.oldElementId=this.oldElementId,t.newElementId=this.newElementId,t},o.Events.Selected.prototype.fromJson=function(t){o.Events.Selected.superClass_.fromJson.call(this,t),this.oldElementId=t.oldElementId,this.newElementId=t.newElementId},o.registry.register(o.registry.Type.EVENT,o.Events.SELECTED,o.Events.Selected),o.RenderedConnection=function(t,e){o.RenderedConnection.superClass_.constructor.call(this,t,e),this.db_=t.workspace.connectionDBList[e],this.dbOpposite_=t.workspace.connectionDBList[o.OPPOSITE_TYPE[e]],this.offsetInBlock_=new o.utils.Coordinate(0,0),this.trackedState_=o.RenderedConnection.TrackedState.WILL_TRACK,this.targetConnection=null},o.utils.object.inherits(o.RenderedConnection,o.Connection),o.RenderedConnection.TrackedState={WILL_TRACK:-1,UNTRACKED:0,TRACKED:1},o.RenderedConnection.prototype.dispose=function(){o.RenderedConnection.superClass_.dispose.call(this),this.trackedState_==o.RenderedConnection.TrackedState.TRACKED&&this.db_.removeConnection(this,this.y)},o.RenderedConnection.prototype.getSourceBlock=function(){return o.RenderedConnection.superClass_.getSourceBlock.call(this)},o.RenderedConnection.prototype.targetBlock=function(){return o.RenderedConnection.superClass_.targetBlock.call(this)},o.RenderedConnection.prototype.distanceFrom=function(t){var e=this.x-t.x;return t=this.y-t.y,Math.sqrt(e*e+t*t)},o.RenderedConnection.prototype.bumpAwayFrom=function(t){if(!this.sourceBlock_.workspace.isDragging()){var e=this.sourceBlock_.getRootBlock();if(!e.isInFlyout){var i=!1;if(!e.isMovable()){if(!(e=t.getSourceBlock().getRootBlock()).isMovable())return;t=this,i=!0}var n=o.selected==e;n||e.addSelect();var r=t.x+o.SNAP_RADIUS+Math.floor(Math.random()*o.BUMP_RANDOMNESS)-this.x,s=t.y+o.SNAP_RADIUS+Math.floor(Math.random()*o.BUMP_RANDOMNESS)-this.y;i&&(s=-s),e.RTL&&(r=t.x-o.SNAP_RADIUS-Math.floor(Math.random()*o.BUMP_RANDOMNESS)-this.x),e.moveBy(r,s),n||e.removeSelect()}}},o.RenderedConnection.prototype.moveTo=function(t,e){this.trackedState_==o.RenderedConnection.TrackedState.WILL_TRACK?(this.db_.addConnection(this,e),this.trackedState_=o.RenderedConnection.TrackedState.TRACKED):this.trackedState_==o.RenderedConnection.TrackedState.TRACKED&&(this.db_.removeConnection(this,this.y),this.db_.addConnection(this,e)),this.x=t,this.y=e},o.RenderedConnection.prototype.moveBy=function(t,e){this.moveTo(this.x+t,this.y+e)},o.RenderedConnection.prototype.moveToOffset=function(t){this.moveTo(t.x+this.offsetInBlock_.x,t.y+this.offsetInBlock_.y)},o.RenderedConnection.prototype.setOffsetInBlock=function(t,e){this.offsetInBlock_.x=t,this.offsetInBlock_.y=e},o.RenderedConnection.prototype.getOffsetInBlock=function(){return this.offsetInBlock_},o.RenderedConnection.prototype.tighten=function(){var t=this.targetConnection.x-this.x,e=this.targetConnection.y-this.y;if(0!=t||0!=e){var i=this.targetBlock(),n=i.getSvgRoot();if(!n)throw Error("block is not rendered.");n=o.utils.getRelativeXY(n),i.getSvgRoot().setAttribute("transform","translate("+(n.x-t)+","+(n.y-e)+")"),i.moveConnections(-t,-e)}},o.RenderedConnection.prototype.closest=function(t,e){return this.dbOpposite_.searchForClosest(this,t,e)},o.RenderedConnection.prototype.highlight=function(){var t=this.sourceBlock_.workspace.getRenderer().getConstants(),e=t.shapeFor(this);this.type==o.INPUT_VALUE||this.type==o.OUTPUT_VALUE?(t=t.TAB_OFFSET_FROM_TOP,e=o.utils.svgPaths.moveBy(0,-t)+o.utils.svgPaths.lineOnAxis("v",t)+e.pathDown+o.utils.svgPaths.lineOnAxis("v",t)):(t=t.NOTCH_OFFSET_LEFT-t.CORNER_RADIUS,e=o.utils.svgPaths.moveBy(-t,0)+o.utils.svgPaths.lineOnAxis("h",t)+e.pathLeft+o.utils.svgPaths.lineOnAxis("h",t)),t=this.sourceBlock_.getRelativeToSurfaceXY(),o.Connection.highlightedPath_=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyHighlightedConnectionPath",d:e,transform:"translate("+(this.x-t.x)+","+(this.y-t.y)+")"+(this.sourceBlock_.RTL?" scale(-1 1)":"")},this.sourceBlock_.getSvgRoot())},o.RenderedConnection.prototype.unhighlight=function(){o.utils.dom.removeNode(o.Connection.highlightedPath_),delete o.Connection.highlightedPath_},o.RenderedConnection.prototype.setTracking=function(t){t&&this.trackedState_==o.RenderedConnection.TrackedState.TRACKED||!t&&this.trackedState_==o.RenderedConnection.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(t?(this.db_.addConnection(this,this.y),this.trackedState_=o.RenderedConnection.TrackedState.TRACKED):(this.trackedState_==o.RenderedConnection.TrackedState.TRACKED&&this.db_.removeConnection(this,this.y),this.trackedState_=o.RenderedConnection.TrackedState.UNTRACKED))},o.RenderedConnection.prototype.stopTrackingAll=function(){if(this.setTracking(!1),this.targetConnection)for(var t=this.targetBlock().getDescendants(!1),e=0;e<t.length;e++){for(var o=t[e],i=o.getConnections_(!0),n=0;n<i.length;n++)i[n].setTracking(!1);for(o=o.getIcons(),n=0;n<o.length;n++)o[n].setVisible(!1)}},o.RenderedConnection.prototype.startTrackingAll=function(){this.setTracking(!0);var t=[];if(this.type!=o.INPUT_VALUE&&this.type!=o.NEXT_STATEMENT)return t;var e=this.targetBlock();if(e){if(e.isCollapsed()){var i=[];e.outputConnection&&i.push(e.outputConnection),e.nextConnection&&i.push(e.nextConnection),e.previousConnection&&i.push(e.previousConnection)}else i=e.getConnections_(!0);for(var n=0;n<i.length;n++)t.push.apply(t,i[n].startTrackingAll());t.length||(t[0]=e)}return t},o.RenderedConnection.prototype.isConnectionAllowed=function(t,e){return o.utils.deprecation.warn("RenderedConnection.prototype.isConnectionAllowed","July 2020","July 2021","Blockly.Workspace.prototype.getConnectionChecker().canConnect"),!(this.distanceFrom(t)>e)&&o.RenderedConnection.superClass_.isConnectionAllowed.call(this,t)},o.RenderedConnection.prototype.onFailedConnect=function(t){this.bumpAwayFrom(t)},o.RenderedConnection.prototype.disconnectInternal_=function(t,e){o.RenderedConnection.superClass_.disconnectInternal_.call(this,t,e),t.rendered&&t.render(),e.rendered&&(e.updateDisabled(),e.render(),e.getSvgRoot().style.display="block")},o.RenderedConnection.prototype.respawnShadow_=function(){o.RenderedConnection.superClass_.respawnShadow_.call(this);var t=this.targetBlock();t&&(t.initSvg(),t.render(!1),(t=this.getSourceBlock()).rendered&&t.render())},o.RenderedConnection.prototype.neighbours=function(t){return this.dbOpposite_.getNeighbours(this,t)},o.RenderedConnection.prototype.connect_=function(t){o.RenderedConnection.superClass_.connect_.call(this,t);var e=this.getSourceBlock();t=t.getSourceBlock();var i=e.rendered,n=t.rendered;i&&e.updateDisabled(),n&&t.updateDisabled(),i&&n&&(this.type==o.NEXT_STATEMENT||this.type==o.PREVIOUS_STATEMENT?t.render():e.render()),(e=e.getInputWithBlock(t))&&(e=e.isVisible(),t.getSvgRoot().style.display=e?"block":"none")},o.RenderedConnection.prototype.onCheckChanged_=function(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||((this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug(),this.sourceBlock_.bumpNeighbours())},o.Marker=function(){this.drawer_=this.curNode_=this.colour=null,this.type="marker"},o.Marker.prototype.setDrawer=function(t){this.drawer_=t},o.Marker.prototype.getDrawer=function(){return this.drawer_},o.Marker.prototype.getCurNode=function(){return this.curNode_},o.Marker.prototype.setCurNode=function(t){var e=this.curNode_;this.curNode_=t,this.drawer_&&this.drawer_.draw(e,this.curNode_)},o.Marker.prototype.draw=function(){this.drawer_&&this.drawer_.draw(this.curNode_,this.curNode_)},o.Marker.prototype.hide=function(){this.drawer_&&this.drawer_.hide()},o.Marker.prototype.dispose=function(){this.getDrawer()&&this.getDrawer().dispose()},o.Cursor=function(){o.Cursor.superClass_.constructor.call(this),this.type="cursor"},o.utils.object.inherits(o.Cursor,o.Marker),o.Cursor.prototype.next=function(){var t=this.getCurNode();if(!t)return null;for(t=t.next();t&&t.next()&&(t.getType()==o.ASTNode.types.NEXT||t.getType()==o.ASTNode.types.BLOCK);)t=t.next();return t&&this.setCurNode(t),t},o.Cursor.prototype.in=function(){var t=this.getCurNode();return t?(t.getType()!=o.ASTNode.types.PREVIOUS&&t.getType()!=o.ASTNode.types.OUTPUT||(t=t.next()),(t=t.in())&&this.setCurNode(t),t):null},o.Cursor.prototype.prev=function(){var t=this.getCurNode();if(!t)return null;for(t=t.prev();t&&t.prev()&&(t.getType()==o.ASTNode.types.NEXT||t.getType()==o.ASTNode.types.BLOCK);)t=t.prev();return t&&this.setCurNode(t),t},o.Cursor.prototype.out=function(){var t=this.getCurNode();return t?((t=t.out())&&t.getType()==o.ASTNode.types.BLOCK&&(t=t.prev()||t),t&&this.setCurNode(t),t):null},o.Cursor.prototype.onBlocklyAction=function(t){if(this.getCurNode()&&this.getCurNode().getType()===o.ASTNode.types.FIELD&&this.getCurNode().getLocation().onBlocklyAction(t))return!0;switch(t.name){case o.navigation.actionNames.PREVIOUS:return this.prev(),!0;case o.navigation.actionNames.OUT:return this.out(),!0;case o.navigation.actionNames.NEXT:return this.next(),!0;case o.navigation.actionNames.IN:return this.in(),!0;default:return!1}},o.BasicCursor=function(){o.BasicCursor.superClass_.constructor.call(this)},o.utils.object.inherits(o.BasicCursor,o.Cursor),o.BasicCursor.prototype.next=function(){var t=this.getCurNode();return t?((t=this.getNextNode_(t,this.validNode_))&&this.setCurNode(t),t):null},o.BasicCursor.prototype.in=function(){return this.next()},o.BasicCursor.prototype.prev=function(){var t=this.getCurNode();return t?((t=this.getPreviousNode_(t,this.validNode_))&&this.setCurNode(t),t):null},o.BasicCursor.prototype.out=function(){return this.prev()},o.BasicCursor.prototype.getNextNode_=function(t,e){if(!t)return null;var o=t.in()||t.next();return e(o)?o:o?this.getNextNode_(o,e):e(t=this.findSiblingOrParent_(t.out()))?t:t?this.getNextNode_(t,e):null},o.BasicCursor.prototype.getPreviousNode_=function(t,e){if(!t)return null;var o=t.prev();return e(o=o?this.getRightMostChild_(o):t.out())?o:o?this.getPreviousNode_(o,e):null},o.BasicCursor.prototype.validNode_=function(t){var e=!1;return(t=t&&t.getType())!=o.ASTNode.types.OUTPUT&&t!=o.ASTNode.types.INPUT&&t!=o.ASTNode.types.FIELD&&t!=o.ASTNode.types.NEXT&&t!=o.ASTNode.types.PREVIOUS&&t!=o.ASTNode.types.WORKSPACE||(e=!0),e},o.BasicCursor.prototype.findSiblingOrParent_=function(t){if(!t)return null;var e=t.next();return e||this.findSiblingOrParent_(t.out())},o.BasicCursor.prototype.getRightMostChild_=function(t){if(!t.in())return t;for(t=t.in();t.next();)t=t.next();return this.getRightMostChild_(t)},o.TabNavigateCursor=function(){o.TabNavigateCursor.superClass_.constructor.call(this)},o.utils.object.inherits(o.TabNavigateCursor,o.BasicCursor),o.TabNavigateCursor.prototype.validNode_=function(t){var e=!1,i=t&&t.getType();return t&&(t=t.getLocation(),i==o.ASTNode.types.FIELD&&t&&t.isTabNavigable()&&t.isClickable()&&(e=!0)),e},o.BlockSvg=function(t,e,i){this.svgGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{},null),this.svgGroup_.translate_="",this.style=t.getRenderer().getConstants().getBlockStyle(null),this.pathObject=t.getRenderer().makePathObject(this.svgGroup_,this.style),this.renderIsInProgress_=this.rendered=!1,this.workspace=t,this.previousConnection=this.nextConnection=this.outputConnection=null,this.useDragSurface_=o.utils.is3dSupported()&&!!t.getBlockDragSurface();var n=this.pathObject.svgPath;n.tooltip=this,o.Tooltip.bindMouseEvents(n),o.BlockSvg.superClass_.constructor.call(this,t,e,i),this.svgGroup_.dataset?this.svgGroup_.dataset.id=this.id:o.utils.userAgent.IE&&this.svgGroup_.setAttribute("data-id",this.id)},o.utils.object.inherits(o.BlockSvg,o.Block),o.BlockSvg.prototype.height=0,o.BlockSvg.prototype.width=0,o.BlockSvg.prototype.warningTextDb_=null,o.BlockSvg.INLINE=-1,o.BlockSvg.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_",o.BlockSvg.prototype.initSvg=function(){if(!this.workspace.rendered)throw TypeError("Workspace is headless.");for(var t,e=0;t=this.inputList[e];e++)t.init();for(t=this.getIcons(),e=0;e<t.length;e++)t[e].createIcon();this.applyColour(),this.pathObject.updateMovable(this.isMovable()),e=this.getSvgRoot(),this.workspace.options.readOnly||this.eventsInit_||!e||o.bindEventWithChecks_(e,"mousedown",this,this.onMouseDown_),this.eventsInit_=!0,e.parentNode||this.workspace.getCanvas().appendChild(e)},o.BlockSvg.prototype.getColourSecondary=function(){return this.style.colourSecondary},o.BlockSvg.prototype.getColourTertiary=function(){return this.style.colourTertiary},o.BlockSvg.prototype.getColourShadow=function(){return o.utils.deprecation.warn("BlockSvg.prototype.getColourShadow","January 2020","January 2021","style.colourSecondary"),this.getColourSecondary()},o.BlockSvg.prototype.getColourBorder=function(){return o.utils.deprecation.warn("BlockSvg.prototype.getColourBorder","January 2020","January 2021","style.colourTertiary"),{colourBorder:this.getColourTertiary(),colourLight:null,colourDark:null}},o.BlockSvg.prototype.select=function(){if(this.isShadow()&&this.getParent())this.getParent().select();else if(o.selected!=this){var t=null;if(o.selected){t=o.selected.id,o.Events.disable();try{o.selected.unselect()}finally{o.Events.enable()}}t=new o.Events.Selected(t,this.id,this.workspace.id),o.Events.fire(t),o.selected=this,this.addSelect()}},o.BlockSvg.prototype.unselect=function(){if(o.selected==this){var t=new o.Events.Selected(this.id,null,this.workspace.id);t.workspaceId=this.workspace.id,o.Events.fire(t),o.selected=null,this.removeSelect()}},o.BlockSvg.prototype.mutator=null,o.BlockSvg.prototype.comment=null,o.BlockSvg.prototype.commentIcon_=null,o.BlockSvg.prototype.warning=null,o.BlockSvg.prototype.getIcons=function(){var t=[];return this.mutator&&t.push(this.mutator),this.commentIcon_&&t.push(this.commentIcon_),this.warning&&t.push(this.warning),t},o.BlockSvg.prototype.setParent=function(t){var e=this.parentBlock_;if(t!=e){o.utils.dom.startTextWidthCache(),o.BlockSvg.superClass_.setParent.call(this,t),o.utils.dom.stopTextWidthCache();var i=this.getSvgRoot();if(!this.workspace.isClearing&&i){var n=this.getRelativeToSurfaceXY();t?(t.getSvgRoot().appendChild(i),t=this.getRelativeToSurfaceXY(),this.moveConnections(t.x-n.x,t.y-n.y)):e&&(this.workspace.getCanvas().appendChild(i),this.translate(n.x,n.y)),this.applyColour()}}},o.BlockSvg.prototype.getRelativeToSurfaceXY=function(){var t=0,e=0,i=this.useDragSurface_?this.workspace.getBlockDragSurface().getGroup():null,n=this.getSvgRoot();if(n)do{var r=o.utils.getRelativeXY(n);t+=r.x,e+=r.y,this.useDragSurface_&&this.workspace.getBlockDragSurface().getCurrentBlock()==n&&(t+=(r=this.workspace.getBlockDragSurface().getSurfaceTranslation()).x,e+=r.y),n=n.parentNode}while(n&&n!=this.workspace.getCanvas()&&n!=i);return new o.utils.Coordinate(t,e)},o.BlockSvg.prototype.moveBy=function(t,e){if(this.parentBlock_)throw Error("Block has parent.");var i=o.Events.isEnabled();if(i)var n=new o.Events.BlockMove(this);var r=this.getRelativeToSurfaceXY();this.translate(r.x+t,r.y+e),this.moveConnections(t,e),i&&(n.recordNew(),o.Events.fire(n)),this.workspace.resizeContents()},o.BlockSvg.prototype.translate=function(t,e){this.getSvgRoot().setAttribute("transform","translate("+t+","+e+")")},o.BlockSvg.prototype.moveToDragSurface=function(){if(this.useDragSurface_){var t=this.getRelativeToSurfaceXY();this.clearTransformAttributes_(),this.workspace.getBlockDragSurface().translateSurface(t.x,t.y),(t=this.getSvgRoot())&&this.workspace.getBlockDragSurface().setBlocksAndShow(t)}},o.BlockSvg.prototype.moveTo=function(t){var e=this.getRelativeToSurfaceXY();this.moveBy(t.x-e.x,t.y-e.y)},o.BlockSvg.prototype.moveOffDragSurface=function(t){this.useDragSurface_&&(this.translate(t.x,t.y),this.workspace.getBlockDragSurface().clearAndHide(this.workspace.getCanvas()))},o.BlockSvg.prototype.moveDuringDrag=function(t){this.useDragSurface_?this.workspace.getBlockDragSurface().translateSurface(t.x,t.y):(this.svgGroup_.translate_="translate("+t.x+","+t.y+")",this.svgGroup_.setAttribute("transform",this.svgGroup_.translate_+this.svgGroup_.skew_))},o.BlockSvg.prototype.clearTransformAttributes_=function(){this.getSvgRoot().removeAttribute("transform")},o.BlockSvg.prototype.snapToGrid=function(){if(this.workspace&&!this.workspace.isDragging()&&!this.getParent()&&!this.isInFlyout){var t=this.workspace.getGrid();if(t&&t.shouldSnap()){var e=t.getSpacing(),o=e/2,i=this.getRelativeToSurfaceXY();t=Math.round((i.x-o)/e)*e+o-i.x,e=Math.round((i.y-o)/e)*e+o-i.y,t=Math.round(t),e=Math.round(e),0==t&&0==e||this.moveBy(t,e)}}},o.BlockSvg.prototype.getBoundingRectangle=function(){var t=this.getRelativeToSurfaceXY(),e=this.getHeightWidth();if(this.RTL)var i=t.x-e.width,n=t.x;else i=t.x,n=t.x+e.width;return new o.utils.Rect(t.y,t.y+e.height,i,n)},o.BlockSvg.prototype.markDirty=function(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(var t,e=0;t=this.inputList[e];e++)t.markDirty()},o.BlockSvg.prototype.setCollapsed=function(t){this.collapsed_!=t&&(o.BlockSvg.superClass_.setCollapsed.call(this,t),t?this.rendered&&this.render():this.updateCollapsed_())},o.BlockSvg.prototype.updateCollapsed_=function(){for(var t,e=this.isCollapsed(),i=o.Block.COLLAPSED_INPUT_NAME,n=o.Block.COLLAPSED_FIELD_NAME,r=0;t=this.inputList[r];r++)t.name!=i&&t.setVisible(!e);if(e){for(t=this.getIcons(),r=0;e=t[r];r++)e.setVisible(!1);r=this.toString(o.COLLAPSE_CHARS),(t=this.getField(n))?t.setValue(r):(t=this.getInput(i)||this.appendDummyInput(i)).appendField(new o.FieldLabel(r),n)}else this.removeInput(i)},o.BlockSvg.prototype.tab=function(t,e){var i=new o.TabNavigateCursor;i.setCurNode(o.ASTNode.createFieldNode(t)),t=i.getCurNode(),i.onBlocklyAction({name:e?o.navigation.actionNames.NEXT:o.navigation.actionNames.PREVIOUS}),(e=i.getCurNode())&&e!==t&&(e.getLocation().showEditor(),this.workspace.keyboardAccessibilityMode&&this.workspace.getCursor().setCurNode(e))},o.BlockSvg.prototype.onMouseDown_=function(t){var e=this.workspace&&this.workspace.getGesture(t);e&&e.handleBlockStart(t,this)},o.BlockSvg.prototype.showHelp=function(){var t="function"==typeof this.helpUrl?this.helpUrl():this.helpUrl;t&&window.open(t)},o.BlockSvg.prototype.generateContextMenu=function(){if(this.workspace.options.readOnly||!this.contextMenu)return null;var t=o.ContextMenuRegistry.registry.getContextMenuOptions(o.ContextMenuRegistry.ScopeType.BLOCK,{block:this});return this.customContextMenu&&this.customContextMenu(t),t},o.BlockSvg.prototype.showContextMenu=function(t){var e=this.generateContextMenu();e&&e.length&&(o.ContextMenu.show(t,e,this.RTL),o.ContextMenu.currentBlock=this)},o.BlockSvg.prototype.moveConnections=function(t,e){if(this.rendered){for(var o=this.getConnections_(!1),i=0;i<o.length;i++)o[i].moveBy(t,e);for(o=this.getIcons(),i=0;i<o.length;i++)o[i].computeIconLocation();for(i=0;i<this.childBlocks_.length;i++)this.childBlocks_[i].moveConnections(t,e)}},o.BlockSvg.prototype.setDragging=function(t){if(t){var e=this.getSvgRoot();e.translate_="",e.skew_="",o.draggingConnections=o.draggingConnections.concat(this.getConnections_(!0)),o.utils.dom.addClass(this.svgGroup_,"blocklyDragging")}else o.draggingConnections=[],o.utils.dom.removeClass(this.svgGroup_,"blocklyDragging");for(e=0;e<this.childBlocks_.length;e++)this.childBlocks_[e].setDragging(t)},o.BlockSvg.prototype.setMovable=function(t){o.BlockSvg.superClass_.setMovable.call(this,t),this.pathObject.updateMovable(t)},o.BlockSvg.prototype.setEditable=function(t){o.BlockSvg.superClass_.setEditable.call(this,t),t=this.getIcons();for(var e=0;e<t.length;e++)t[e].updateEditable()},o.BlockSvg.prototype.setShadow=function(t){o.BlockSvg.superClass_.setShadow.call(this,t),this.applyColour()},o.BlockSvg.prototype.setInsertionMarker=function(t){this.isInsertionMarker_!=t&&(this.isInsertionMarker_=t)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))},o.BlockSvg.prototype.getSvgRoot=function(){return this.svgGroup_},o.BlockSvg.prototype.dispose=function(t,e){if(this.workspace){o.Tooltip.dispose(),o.Tooltip.unbindMouseEvents(this.pathObject.svgPath),o.utils.dom.startTextWidthCache();var i=this.workspace;if(o.selected==this&&(this.unselect(),this.workspace.cancelCurrentGesture()),o.ContextMenu.currentBlock==this&&o.ContextMenu.hide(),this.workspace.keyboardAccessibilityMode&&o.navigation.moveCursorOnBlockDelete(this),e&&this.rendered&&(this.unplug(t),o.blockAnimations.disposeUiEffect(this)),this.rendered=!1,this.warningTextDb_){for(var n in this.warningTextDb_)clearTimeout(this.warningTextDb_[n]);this.warningTextDb_=null}for(e=this.getIcons(),n=0;n<e.length;n++)e[n].dispose();o.BlockSvg.superClass_.dispose.call(this,!!t),o.utils.dom.removeNode(this.svgGroup_),i.resizeContents(),this.svgGroup_=null,o.utils.dom.stopTextWidthCache()}},o.BlockSvg.prototype.toCopyData=function(){if(this.isInsertionMarker_)return null;var t=o.Xml.blockToDom(this,!0);o.Xml.deleteNext(t);var e=this.getRelativeToSurfaceXY();return t.setAttribute("x",this.RTL?-e.x:e.x),t.setAttribute("y",e.y),{xml:t,source:this.workspace,typeCounts:o.utils.getBlockTypeCounts(this,!0)}},o.BlockSvg.prototype.applyColour=function(){this.pathObject.applyColour(this);for(var t=this.getIcons(),e=0;e<t.length;e++)t[e].applyColour();for(t=0;e=this.inputList[t];t++)for(var o,i=0;o=e.fieldRow[i];i++)o.applyColour()},o.BlockSvg.prototype.updateDisabled=function(){var t=this.getChildren(!1);if(this.applyColour(),!this.isCollapsed())for(var e,o=0;e=t[o];o++)e.rendered&&e.updateDisabled()},o.BlockSvg.prototype.getCommentIcon=function(){return this.commentIcon_},o.BlockSvg.prototype.setCommentText=function(t){if(!o.Comment)throw Error("Missing require for Blockly.Comment");this.commentModel.text!=t&&(o.BlockSvg.superClass_.setCommentText.call(this,t),t=null!=t,!!this.commentIcon_==t?this.commentIcon_.updateText():(t?this.comment=this.commentIcon_=new o.Comment(this):(this.commentIcon_.dispose(),this.comment=this.commentIcon_=null),this.rendered&&(this.render(),this.bumpNeighbours())))},o.BlockSvg.prototype.setWarningText=function(t,e){if(!o.Warning)throw Error("Missing require for Blockly.Warning");this.warningTextDb_||(this.warningTextDb_=Object.create(null));var i=e||"";if(i)this.warningTextDb_[i]&&(clearTimeout(this.warningTextDb_[i]),delete this.warningTextDb_[i]);else for(var n in this.warningTextDb_)clearTimeout(this.warningTextDb_[n]),delete this.warningTextDb_[n];if(this.workspace.isDragging()){var r=this;this.warningTextDb_[i]=setTimeout((function(){r.workspace&&(delete r.warningTextDb_[i],r.setWarningText(t,i))}),100)}else{if(this.isInFlyout&&(t=null),e=!1,"string"==typeof t){n=this.getSurroundParent();for(var s=null;n;)n.isCollapsed()&&(s=n),n=n.getSurroundParent();s&&s.setWarningText(o.Msg.COLLAPSED_WARNINGS_WARNING,o.BlockSvg.COLLAPSED_WARNING_ID),this.warning||(this.warning=new o.Warning(this),e=!0),this.warning.setText(t,i)}else this.warning&&!i?(this.warning.dispose(),e=!0):this.warning&&(e=this.warning.getText(),this.warning.setText("",i),(n=this.warning.getText())||this.warning.dispose(),e=e!=n);e&&this.rendered&&(this.render(),this.bumpNeighbours())}},o.BlockSvg.prototype.setMutator=function(t){this.mutator&&this.mutator!==t&&this.mutator.dispose(),t&&(t.setBlock(this),this.mutator=t,t.createIcon()),this.rendered&&(this.render(),this.bumpNeighbours())},o.BlockSvg.prototype.setEnabled=function(t){this.isEnabled()!=t&&(o.BlockSvg.superClass_.setEnabled.call(this,t),this.rendered&&!this.getInheritedDisabled()&&this.updateDisabled())},o.BlockSvg.prototype.setHighlighted=function(t){this.rendered&&this.pathObject.updateHighlighted(t)},o.BlockSvg.prototype.addSelect=function(){this.pathObject.updateSelected(!0)},o.BlockSvg.prototype.removeSelect=function(){this.pathObject.updateSelected(!1)},o.BlockSvg.prototype.setDeleteStyle=function(t){this.pathObject.updateDraggingDelete(t)},o.BlockSvg.prototype.getColour=function(){return this.style.colourPrimary},o.BlockSvg.prototype.setColour=function(t){o.BlockSvg.superClass_.setColour.call(this,t),t=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_),this.pathObject.setStyle(t.style),this.style=t.style,this.styleName_=t.name,this.applyColour()},o.BlockSvg.prototype.setStyle=function(t){var e=this.workspace.getRenderer().getConstants().getBlockStyle(t);if(this.styleName_=t,!e)throw Error("Invalid style name: "+t);this.hat=e.hat,this.pathObject.setStyle(e),this.colour_=e.colourPrimary,this.style=e,this.applyColour()},o.BlockSvg.prototype.bringToFront=function(){var t=this;do{var e=t.getSvgRoot(),o=e.parentNode,i=o.childNodes;i[i.length-1]!==e&&o.appendChild(e),t=t.getParent()}while(t)},o.BlockSvg.prototype.setPreviousStatement=function(t,e){o.BlockSvg.superClass_.setPreviousStatement.call(this,t,e),this.rendered&&(this.render(),this.bumpNeighbours())},o.BlockSvg.prototype.setNextStatement=function(t,e){o.BlockSvg.superClass_.setNextStatement.call(this,t,e),this.rendered&&(this.render(),this.bumpNeighbours())},o.BlockSvg.prototype.setOutput=function(t,e){o.BlockSvg.superClass_.setOutput.call(this,t,e),this.rendered&&(this.render(),this.bumpNeighbours())},o.BlockSvg.prototype.setInputsInline=function(t){o.BlockSvg.superClass_.setInputsInline.call(this,t),this.rendered&&(this.render(),this.bumpNeighbours())},o.BlockSvg.prototype.removeInput=function(t,e){return t=o.BlockSvg.superClass_.removeInput.call(this,t,e),this.rendered&&(this.render(),this.bumpNeighbours()),t},o.BlockSvg.prototype.moveNumberedInputBefore=function(t,e){o.BlockSvg.superClass_.moveNumberedInputBefore.call(this,t,e),this.rendered&&(this.render(),this.bumpNeighbours())},o.BlockSvg.prototype.appendInput_=function(t,e){return t=o.BlockSvg.superClass_.appendInput_.call(this,t,e),this.rendered&&(this.render(),this.bumpNeighbours()),t},o.BlockSvg.prototype.setConnectionTracking=function(t){if(this.previousConnection&&this.previousConnection.setTracking(t),this.outputConnection&&this.outputConnection.setTracking(t),this.nextConnection){this.nextConnection.setTracking(t);var e=this.nextConnection.targetBlock();e&&e.setConnectionTracking(t)}if(!this.collapsed_)for(e=0;e<this.inputList.length;e++){var o=this.inputList[e].connection;o&&(o.setTracking(t),(o=o.targetBlock())&&o.setConnectionTracking(t))}},o.BlockSvg.prototype.getConnections_=function(t){var e=[];if((t||this.rendered)&&(this.outputConnection&&e.push(this.outputConnection),this.previousConnection&&e.push(this.previousConnection),this.nextConnection&&e.push(this.nextConnection),t||!this.collapsed_)){t=0;for(var o;o=this.inputList[t];t++)o.connection&&e.push(o.connection)}return e},o.BlockSvg.prototype.lastConnectionInStack=function(){return o.BlockSvg.superClass_.lastConnectionInStack.call(this)},o.BlockSvg.prototype.getMatchingConnection=function(t,e){return o.BlockSvg.superClass_.getMatchingConnection.call(this,t,e)},o.BlockSvg.prototype.makeConnection_=function(t){return new o.RenderedConnection(this,t)},o.BlockSvg.prototype.bumpNeighbours=function(){if(this.workspace&&!this.workspace.isDragging()){var t=this.getRootBlock();if(!t.isInFlyout)for(var e,i=this.getConnections_(!1),n=0;e=i[n];n++){e.isConnected()&&e.isSuperior()&&e.targetBlock().bumpNeighbours();for(var r,s=e.neighbours(o.SNAP_RADIUS),a=0;r=s[a];a++)e.isConnected()&&r.isConnected()||r.getSourceBlock().getRootBlock()!=t&&(e.isSuperior()?r.bumpAwayFrom(e):e.bumpAwayFrom(r))}}},o.BlockSvg.prototype.scheduleSnapAndBump=function(){var t=this,e=o.Events.getGroup();setTimeout((function(){o.Events.setGroup(e),t.snapToGrid(),o.Events.setGroup(!1)}),o.BUMP_DELAY/2),setTimeout((function(){o.Events.setGroup(e),t.bumpNeighbours(),o.Events.setGroup(!1)}),o.BUMP_DELAY)},o.BlockSvg.prototype.positionNearConnection=function(t,e){t.type!=o.NEXT_STATEMENT&&t.type!=o.INPUT_VALUE||this.moveBy(e.x-t.x,e.y-t.y)},o.BlockSvg.prototype.getParent=function(){return o.BlockSvg.superClass_.getParent.call(this)},o.BlockSvg.prototype.getRootBlock=function(){return o.BlockSvg.superClass_.getRootBlock.call(this)},o.BlockSvg.prototype.render=function(t){if(!this.renderIsInProgress_){this.renderIsInProgress_=!0;try{if(this.rendered=!0,o.utils.dom.startTextWidthCache(),this.isCollapsed()&&this.updateCollapsed_(),this.workspace.getRenderer().render(this),this.updateConnectionLocations_(),!1!==t){var e=this.getParent();e?e.render(!0):this.workspace.resizeContents()}o.utils.dom.stopTextWidthCache(),this.updateMarkers_()}finally{this.renderIsInProgress_=!1}}},o.BlockSvg.prototype.updateMarkers_=function(){this.workspace.keyboardAccessibilityMode&&this.pathObject.cursorSvg&&this.workspace.getCursor().draw(),this.workspace.keyboardAccessibilityMode&&this.pathObject.markerSvg&&this.workspace.getMarker(o.navigation.MARKER_NAME).draw()},o.BlockSvg.prototype.updateConnectionLocations_=function(){var t=this.getRelativeToSurfaceXY();this.previousConnection&&this.previousConnection.moveToOffset(t),this.outputConnection&&this.outputConnection.moveToOffset(t);for(var e=0;e<this.inputList.length;e++){var o=this.inputList[e].connection;o&&(o.moveToOffset(t),o.isConnected()&&o.tighten())}this.nextConnection&&(this.nextConnection.moveToOffset(t),this.nextConnection.isConnected()&&this.nextConnection.tighten())},o.BlockSvg.prototype.setCursorSvg=function(t){this.pathObject.setCursorSvg(t)},o.BlockSvg.prototype.setMarkerSvg=function(t){this.pathObject.setMarkerSvg(t)},o.BlockSvg.prototype.getHeightWidth=function(){var t=this.height,e=this.width,o=this.getNextBlock();if(o){o=o.getHeightWidth();var i=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;t+=o.height-i,e=Math.max(e,o.width)}return{height:t,width:e}},o.BlockSvg.prototype.fadeForReplacement=function(t){this.pathObject.updateReplacementFade(t)},o.BlockSvg.prototype.highlightShapeForInput=function(t,e){this.pathObject.updateShapeForInputHighlight(t,e)},o.blockRendering.useDebugger=!1,o.blockRendering.register=function(t,e){o.registry.register(o.registry.Type.RENDERER,t,e)},o.blockRendering.unregister=function(t){o.registry.unregister(o.registry.Type.RENDERER,t)},o.blockRendering.startDebugger=function(){o.blockRendering.useDebugger=!0},o.blockRendering.stopDebugger=function(){o.blockRendering.useDebugger=!1},o.blockRendering.init=function(t,e,i){return(t=new(o.registry.getClass(o.registry.Type.RENDERER,t))(t)).init(e,i),t},o.ConnectionDB=function(t){this.connections_=[],this.connectionChecker_=t},o.ConnectionDB.prototype.addConnection=function(t,e){e=this.calculateIndexForYPos_(e),this.connections_.splice(e,0,t)},o.ConnectionDB.prototype.findIndexOfConnection_=function(t,e){if(!this.connections_.length)return-1;var o=this.calculateIndexForYPos_(e);if(o>=this.connections_.length)return-1;e=t.y;for(var i=o;0<=i&&this.connections_[i].y==e;){if(this.connections_[i]==t)return i;i--}for(;o<this.connections_.length&&this.connections_[o].y==e;){if(this.connections_[o]==t)return o;o++}return-1},o.ConnectionDB.prototype.calculateIndexForYPos_=function(t){if(!this.connections_.length)return 0;for(var e=0,o=this.connections_.length;e<o;){var i=Math.floor((e+o)/2);if(this.connections_[i].y<t)e=i+1;else{if(!(this.connections_[i].y>t)){e=i;break}o=i}}return e},o.ConnectionDB.prototype.removeConnection=function(t,e){if(-1==(t=this.findIndexOfConnection_(t,e)))throw Error("Unable to find connection in connectionDB.");this.connections_.splice(t,1)},o.ConnectionDB.prototype.getNeighbours=function(t,e){function o(t){var o=n-i[t].x,s=r-i[t].y;return Math.sqrt(o*o+s*s)<=e&&l.push(i[t]),s<e}var i=this.connections_,n=t.x,r=t.y;t=0;for(var s=i.length-2,a=s;t<a;)i[a].y<r?t=a:s=a,a=Math.floor((t+s)/2);var l=[];if(s=t=a,i.length){for(;0<=t&&o(t);)t--;do{s++}while(s<i.length&&o(s))}return l},o.ConnectionDB.prototype.isInYRange_=function(t,e,o){return Math.abs(this.connections_[t].y-e)<=o},o.ConnectionDB.prototype.searchForClosest=function(t,e,o){if(!this.connections_.length)return{connection:null,radius:e};var i=t.y,n=t.x;t.x=n+o.x,t.y=i+o.y;var r=this.calculateIndexForYPos_(t.y);o=null;for(var s,a=e,l=r-1;0<=l&&this.isInYRange_(l,t.y,e);)s=this.connections_[l],this.connectionChecker_.canConnect(t,s,!0,a)&&(o=s,a=s.distanceFrom(t)),l--;for(;r<this.connections_.length&&this.isInYRange_(r,t.y,e);)s=this.connections_[r],this.connectionChecker_.canConnect(t,s,!0,a)&&(o=s,a=s.distanceFrom(t)),r++;return t.x=n,t.y=i,{connection:o,radius:a}},o.ConnectionDB.init=function(t){var e=[];return e[o.INPUT_VALUE]=new o.ConnectionDB(t),e[o.OUTPUT_VALUE]=new o.ConnectionDB(t),e[o.NEXT_STATEMENT]=new o.ConnectionDB(t),e[o.PREVIOUS_STATEMENT]=new o.ConnectionDB(t),e},o.Events.ThemeChange=function(t,e){o.Events.ThemeChange.superClass_.constructor.call(this,e),this.themeName=t},o.utils.object.inherits(o.Events.ThemeChange,o.Events.UiBase),o.Events.ThemeChange.prototype.type=o.Events.THEME_CHANGE,o.Events.ThemeChange.prototype.toJson=function(){var t=o.Events.ThemeChange.superClass_.toJson.call(this);return t.themeName=this.themeName,t},o.Events.ThemeChange.prototype.fromJson=function(t){o.Events.ThemeChange.superClass_.fromJson.call(this,t),this.themeName=t.themeName},o.registry.register(o.registry.Type.EVENT,o.Events.THEME_CHANGE,o.Events.ThemeChange),o.Events.ViewportChange=function(t,e,i,n){o.Events.ViewportChange.superClass_.constructor.call(this,n),this.viewTop=t,this.viewLeft=e,this.scale=i},o.utils.object.inherits(o.Events.ViewportChange,o.Events.UiBase),o.Events.ViewportChange.prototype.type=o.Events.VIEWPORT_CHANGE,o.Events.ViewportChange.prototype.toJson=function(){var t=o.Events.ViewportChange.superClass_.toJson.call(this);return t.viewTop=this.viewTop,t.viewLeft=this.viewLeft,t.scale=this.scale,t},o.Events.ViewportChange.prototype.fromJson=function(t){o.Events.ViewportChange.superClass_.fromJson.call(this,t),this.viewTop=t.viewTop,this.viewLeft=t.viewLeft,this.scale=t.scale},o.registry.register(o.registry.Type.EVENT,o.Events.VIEWPORT_CHANGE,o.Events.ViewportChange),o.MarkerManager=function(t){this.cursorSvg_=this.cursor_=null,this.markers_={},this.workspace_=t},o.MarkerManager.prototype.registerMarker=function(t,e){this.markers_[t]&&this.unregisterMarker(t),e.setDrawer(this.workspace_.getRenderer().makeMarkerDrawer(this.workspace_,e)),this.setMarkerSvg(e.getDrawer().createDom()),this.markers_[t]=e},o.MarkerManager.prototype.unregisterMarker=function(t){var e=this.markers_[t];if(!e)throw Error("Marker with id "+t+" does not exist. Can only unregistermarkers that exist.");e.dispose(),delete this.markers_[t]},o.MarkerManager.prototype.getCursor=function(){return this.cursor_},o.MarkerManager.prototype.getMarker=function(t){return this.markers_[t]},o.MarkerManager.prototype.setCursor=function(t){this.cursor_&&this.cursor_.getDrawer()&&this.cursor_.getDrawer().dispose(),(this.cursor_=t)&&(t=this.workspace_.getRenderer().makeMarkerDrawer(this.workspace_,this.cursor_),this.cursor_.setDrawer(t),this.setCursorSvg(this.cursor_.getDrawer().createDom()))},o.MarkerManager.prototype.setCursorSvg=function(t){t?(this.workspace_.getBlockCanvas().appendChild(t),this.cursorSvg_=t):this.cursorSvg_=null},o.MarkerManager.prototype.setMarkerSvg=function(t){t?this.workspace_.getBlockCanvas()&&(this.cursorSvg_?this.workspace_.getBlockCanvas().insertBefore(t,this.cursorSvg_):this.workspace_.getBlockCanvas().appendChild(t)):this.markerSvg_=null},o.MarkerManager.prototype.updateMarkers=function(){this.workspace_.keyboardAccessibilityMode&&this.cursorSvg_&&this.workspace_.getCursor().draw()},o.MarkerManager.prototype.dispose=function(){for(var t,e=Object.keys(this.markers_),o=0;t=e[o];o++)this.unregisterMarker(t);this.markers_=null,this.cursor_&&(this.cursor_.dispose(),this.cursor_=null)},o.ThemeManager=function(t,e){this.workspace_=t,this.theme_=e,this.subscribedWorkspaces_=[],this.componentDB_=Object.create(null)},o.ThemeManager.prototype.getTheme=function(){return this.theme_},o.ThemeManager.prototype.setTheme=function(t){var e,i=this.theme_;for(this.theme_=t,(t=this.workspace_.getInjectionDiv())&&(i&&o.utils.dom.removeClass(t,i.getClassName()),o.utils.dom.addClass(t,this.theme_.getClassName())),i=0;t=this.subscribedWorkspaces_[i];i++)t.refreshTheme();for(i=0,t=Object.keys(this.componentDB_);e=t[i];i++)for(var n,r=0;n=this.componentDB_[e][r];r++){var s=n.element;n=n.propertyName;var a=this.theme_&&this.theme_.getComponentStyle(e);s.style[n]=a||""}o.hideChaff()},o.ThemeManager.prototype.subscribeWorkspace=function(t){this.subscribedWorkspaces_.push(t)},o.ThemeManager.prototype.unsubscribeWorkspace=function(t){if(0>(t=this.subscribedWorkspaces_.indexOf(t)))throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.");this.subscribedWorkspaces_.splice(t,1)},o.ThemeManager.prototype.subscribe=function(t,e,o){this.componentDB_[e]||(this.componentDB_[e]=[]),this.componentDB_[e].push({element:t,propertyName:o}),e=this.theme_&&this.theme_.getComponentStyle(e),t.style[o]=e||""},o.ThemeManager.prototype.unsubscribe=function(t){if(t)for(var e,o=Object.keys(this.componentDB_),i=0;e=o[i];i++){for(var n=this.componentDB_[e],r=n.length-1;0<=r;r--)n[r].element===t&&n.splice(r,1);this.componentDB_[e].length||delete this.componentDB_[e]}},o.ThemeManager.prototype.dispose=function(){this.componentDB_=this.subscribedWorkspaces_=this.theme_=this.owner_=null},o.TouchGesture=function(t,e){o.TouchGesture.superClass_.constructor.call(this,t,e),this.isMultiTouch_=!1,this.cachedPoints_=Object.create(null),this.startDistance_=this.previousScale_=0,this.isPinchZoomEnabled_=this.onStartWrapper_=null},o.utils.object.inherits(o.TouchGesture,o.Gesture),o.TouchGesture.ZOOM_IN_MULTIPLIER=5,o.TouchGesture.ZOOM_OUT_MULTIPLIER=6,o.TouchGesture.prototype.doStart=function(t){this.isPinchZoomEnabled_=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch,o.TouchGesture.superClass_.doStart.call(this,t),!this.isEnding_&&o.Touch.isTouchEvent(t)&&this.handleTouchStart(t)},o.TouchGesture.prototype.bindMouseEvents=function(t){this.onStartWrapper_=o.bindEventWithChecks_(document,"mousedown",null,this.handleStart.bind(this),!0),this.onMoveWrapper_=o.bindEventWithChecks_(document,"mousemove",null,this.handleMove.bind(this),!0),this.onUpWrapper_=o.bindEventWithChecks_(document,"mouseup",null,this.handleUp.bind(this),!0),t.preventDefault(),t.stopPropagation()},o.TouchGesture.prototype.handleStart=function(t){!this.isDragging()&&o.Touch.isTouchEvent(t)&&(this.handleTouchStart(t),this.isMultiTouch()&&o.longStop_())},o.TouchGesture.prototype.handleMove=function(t){this.isDragging()?o.Touch.shouldHandleEvent(t)&&o.TouchGesture.superClass_.handleMove.call(this,t):this.isMultiTouch()?(o.Touch.isTouchEvent(t)&&this.handleTouchMove(t),o.longStop_()):o.TouchGesture.superClass_.handleMove.call(this,t)},o.TouchGesture.prototype.handleUp=function(t){o.Touch.isTouchEvent(t)&&!this.isDragging()&&this.handleTouchEnd(t),!this.isMultiTouch()||this.isDragging()?o.Touch.shouldHandleEvent(t)&&o.TouchGesture.superClass_.handleUp.call(this,t):(t.preventDefault(),t.stopPropagation(),this.dispose())},o.TouchGesture.prototype.isMultiTouch=function(){return this.isMultiTouch_},o.TouchGesture.prototype.dispose=function(){o.TouchGesture.superClass_.dispose.call(this),this.onStartWrapper_&&o.unbindEvent_(this.onStartWrapper_)},o.TouchGesture.prototype.handleTouchStart=function(t){var e=o.Touch.getTouchIdentifierFromEvent(t);this.cachedPoints_[e]=this.getTouchPoint(t),2==(e=Object.keys(this.cachedPoints_)).length&&(this.startDistance_=o.utils.Coordinate.distance(this.cachedPoints_[e[0]],this.cachedPoints_[e[1]]),this.isMultiTouch_=!0,t.preventDefault())},o.TouchGesture.prototype.handleTouchMove=function(t){var e=o.Touch.getTouchIdentifierFromEvent(t);this.cachedPoints_[e]=this.getTouchPoint(t),e=Object.keys(this.cachedPoints_),this.isPinchZoomEnabled_&&2===e.length?this.handlePinch_(t):o.TouchGesture.superClass_.handleMove.call(this,t)},o.TouchGesture.prototype.handlePinch_=function(t){var e=Object.keys(this.cachedPoints_);if(e=o.utils.Coordinate.distance(this.cachedPoints_[e[0]],this.cachedPoints_[e[1]])/this.startDistance_,0<this.previousScale_&&1/0>this.previousScale_){var i=e-this.previousScale_;i=0<i?i*o.TouchGesture.ZOOM_IN_MULTIPLIER:i*o.TouchGesture.ZOOM_OUT_MULTIPLIER;var n=this.startWorkspace_,r=o.utils.mouseToSvg(t,n.getParentSvg(),n.getInverseScreenCTM());n.zoom(r.x,r.y,i)}this.previousScale_=e,t.preventDefault()},o.TouchGesture.prototype.handleTouchEnd=function(t){t=o.Touch.getTouchIdentifierFromEvent(t),this.cachedPoints_[t]&&delete this.cachedPoints_[t],2>Object.keys(this.cachedPoints_).length&&(this.cachedPoints_=Object.create(null),this.previousScale_=0)},o.TouchGesture.prototype.getTouchPoint=function(t){return this.startWorkspace_?new o.utils.Coordinate(t.pageX?t.pageX:t.changedTouches[0].pageX,t.pageY?t.pageY:t.changedTouches[0].pageY):null},o.WorkspaceAudio=function(t){this.parentWorkspace_=t,this.SOUNDS_=Object.create(null)},o.WorkspaceAudio.prototype.lastSound_=null,o.WorkspaceAudio.prototype.dispose=function(){this.SOUNDS_=this.parentWorkspace_=null},o.WorkspaceAudio.prototype.load=function(t,e){if(t.length){try{var i=new o.utils.global.Audio}catch(t){return}for(var n,r=0;r<t.length;r++){var s=t[r],a=s.match(/\.(\w+)$/);if(a&&i.canPlayType("audio/"+a[1])){n=new o.utils.global.Audio(s);break}}n&&n.play&&(this.SOUNDS_[e]=n)}},o.WorkspaceAudio.prototype.preload=function(){for(var t in this.SOUNDS_){var e=this.SOUNDS_[t];e.volume=.01;var i=e.play();if(void 0!==i?i.then(e.pause).catch((function(){})):e.pause(),o.utils.userAgent.IPAD||o.utils.userAgent.IPHONE)break}},o.WorkspaceAudio.prototype.play=function(t,e){var i=this.SOUNDS_[t];i?(t=new Date,null!=this.lastSound_&&t-this.lastSound_<o.SOUND_LIMIT||(this.lastSound_=t,(i=o.utils.userAgent.IPAD||o.utils.userAgent.ANDROID?i:i.cloneNode()).volume=void 0===e?1:e,i.play())):this.parentWorkspace_&&this.parentWorkspace_.getAudioManager().play(t,e)},o.WorkspaceSvg=function(t,e,i){o.WorkspaceSvg.superClass_.constructor.call(this,t),this.getMetrics=t.getMetrics||o.WorkspaceSvg.getTopLevelWorkspaceMetrics_,this.setMetrics=t.setMetrics||o.WorkspaceSvg.setTopLevelWorkspaceMetrics_,this.connectionDBList=o.ConnectionDB.init(this.connectionChecker),e&&(this.blockDragSurface_=e),i&&(this.workspaceDragSurface_=i),this.useWorkspaceDragSurface_=!!this.workspaceDragSurface_&&o.utils.is3dSupported(),this.highlightedBlocks_=[],this.audioManager_=new o.WorkspaceAudio(t.parentWorkspace),this.grid_=this.options.gridPattern?new o.Grid(this.options.gridPattern,t.gridOptions):null,this.markerManager_=new o.MarkerManager(this),this.toolboxCategoryCallbacks_={},this.flyoutButtonCallbacks_={},o.Variables&&o.Variables.flyoutCategory&&this.registerToolboxCategoryCallback(o.VARIABLE_CATEGORY_NAME,o.Variables.flyoutCategory),o.VariablesDynamic&&o.VariablesDynamic.flyoutCategory&&this.registerToolboxCategoryCallback(o.VARIABLE_DYNAMIC_CATEGORY_NAME,o.VariablesDynamic.flyoutCategory),o.Procedures&&o.Procedures.flyoutCategory&&(this.registerToolboxCategoryCallback(o.PROCEDURE_CATEGORY_NAME,o.Procedures.flyoutCategory),this.addChangeListener(o.Procedures.mutatorOpenListener)),this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new o.ThemeManager(this,this.options.theme||o.Themes.Classic),this.themeManager_.subscribeWorkspace(this),this.renderer_=o.blockRendering.init(this.options.renderer||"geras",this.getTheme(),this.options.rendererOverrides),this.cachedParentSvg_=null,this.keyboardAccessibilityMode=!1,this.topBoundedElements_=[]},o.utils.object.inherits(o.WorkspaceSvg,o.Workspace),o.WorkspaceSvg.prototype.resizeHandlerWrapper_=null,o.WorkspaceSvg.prototype.rendered=!0,o.WorkspaceSvg.prototype.isVisible_=!0,o.WorkspaceSvg.prototype.isFlyout=!1,o.WorkspaceSvg.prototype.isMutator=!1,o.WorkspaceSvg.prototype.resizesEnabled_=!0,o.WorkspaceSvg.prototype.scrollX=0,o.WorkspaceSvg.prototype.scrollY=0,o.WorkspaceSvg.prototype.startScrollX=0,o.WorkspaceSvg.prototype.startScrollY=0,o.WorkspaceSvg.prototype.dragDeltaXY_=null,o.WorkspaceSvg.prototype.scale=1,o.WorkspaceSvg.prototype.oldScale_=1,o.WorkspaceSvg.prototype.oldTop_=0,o.WorkspaceSvg.prototype.oldLeft_=0,o.WorkspaceSvg.prototype.trashcan=null,o.WorkspaceSvg.prototype.scrollbar=null,o.WorkspaceSvg.prototype.flyout_=null,o.WorkspaceSvg.prototype.toolbox_=null,o.WorkspaceSvg.prototype.currentGesture_=null,o.WorkspaceSvg.prototype.blockDragSurface_=null,o.WorkspaceSvg.prototype.workspaceDragSurface_=null,o.WorkspaceSvg.prototype.useWorkspaceDragSurface_=!1,o.WorkspaceSvg.prototype.isDragSurfaceActive_=!1,o.WorkspaceSvg.prototype.injectionDiv_=null,o.WorkspaceSvg.prototype.lastRecordedPageScroll_=null,o.WorkspaceSvg.prototype.targetWorkspace=null,o.WorkspaceSvg.prototype.inverseScreenCTM_=null,o.WorkspaceSvg.prototype.inverseScreenCTMDirty_=!0,o.WorkspaceSvg.prototype.getMarkerManager=function(){return this.markerManager_},o.WorkspaceSvg.prototype.setCursorSvg=function(t){this.markerManager_.setCursorSvg(t)},o.WorkspaceSvg.prototype.setMarkerSvg=function(t){this.markerManager_.setMarkerSvg(t)},o.WorkspaceSvg.prototype.getMarker=function(t){return this.markerManager_?this.markerManager_.getMarker(t):null},o.WorkspaceSvg.prototype.getCursor=function(){return this.markerManager_?this.markerManager_.getCursor():null},o.WorkspaceSvg.prototype.getRenderer=function(){return this.renderer_},o.WorkspaceSvg.prototype.getThemeManager=function(){return this.themeManager_},o.WorkspaceSvg.prototype.getTheme=function(){return this.themeManager_.getTheme()},o.WorkspaceSvg.prototype.setTheme=function(t){t||(t=o.Themes.Classic),this.themeManager_.setTheme(t)},o.WorkspaceSvg.prototype.refreshTheme=function(){this.svgGroup_&&this.renderer_.refreshDom(this.svgGroup_,this.getTheme()),this.updateBlockStyles_(this.getAllBlocks(!1).filter((function(t){return void 0!==t.getStyleName()}))),this.refreshToolboxSelection(),this.toolbox_&&this.toolbox_.refreshTheme(),this.isVisible()&&this.setVisible(!0);var t=new o.Events.ThemeChange(this.getTheme().name,this.id);o.Events.fire(t)},o.WorkspaceSvg.prototype.updateBlockStyles_=function(t){for(var e,o=0;e=t[o];o++){var i=e.getStyleName();i&&(e.setStyle(i),e.mutator&&e.mutator.updateBlockStyle())}},o.WorkspaceSvg.prototype.getInverseScreenCTM=function(){if(this.inverseScreenCTMDirty_){var t=this.getParentSvg().getScreenCTM();t&&(this.inverseScreenCTM_=t.inverse(),this.inverseScreenCTMDirty_=!1)}return this.inverseScreenCTM_},o.WorkspaceSvg.prototype.updateInverseScreenCTM=function(){this.inverseScreenCTMDirty_=!0},o.WorkspaceSvg.prototype.isVisible=function(){return this.isVisible_},o.WorkspaceSvg.prototype.getSvgXY=function(t){var e=0,i=0,n=1;(o.utils.dom.containsNode(this.getCanvas(),t)||o.utils.dom.containsNode(this.getBubbleCanvas(),t))&&(n=this.scale);do{var r=o.utils.getRelativeXY(t);t!=this.getCanvas()&&t!=this.getBubbleCanvas()||(n=1),e+=r.x*n,i+=r.y*n,t=t.parentNode}while(t&&t!=this.getParentSvg());return new o.utils.Coordinate(e,i)},o.WorkspaceSvg.prototype.getOriginOffsetInPixels=function(){return o.utils.getInjectionDivXY_(this.getCanvas())},o.WorkspaceSvg.prototype.getInjectionDiv=function(){if(!this.injectionDiv_)for(var t=this.svgGroup_;t;){if(-1!=(" "+(t.getAttribute("class")||"")+" ").indexOf(" injectionDiv ")){this.injectionDiv_=t;break}t=t.parentNode}return this.injectionDiv_},o.WorkspaceSvg.prototype.getBlockCanvas=function(){return this.svgBlockCanvas_},o.WorkspaceSvg.prototype.setResizeHandlerWrapper=function(t){this.resizeHandlerWrapper_=t},o.WorkspaceSvg.prototype.createDom=function(t){if(this.svgGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:"blocklyWorkspace"},null),t&&(this.svgBackground_=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{height:"100%",width:"100%",class:t},this.svgGroup_),"blocklyMainBackground"==t&&this.grid_?this.svgBackground_.style.fill="url(#"+this.grid_.getPatternId()+")":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill")),this.svgBlockCanvas_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:"blocklyBlockCanvas"},this.svgGroup_),this.svgBubbleCanvas_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:"blocklyBubbleCanvas"},this.svgGroup_),this.isFlyout||(o.bindEventWithChecks_(this.svgGroup_,"mousedown",this,this.onMouseDown_,!1,!0),o.bindEventWithChecks_(this.svgGroup_,"wheel",this,this.onMouseWheel_)),this.options.hasCategories){if(!o.Toolbox)throw Error("Missing require for Blockly.Toolbox");this.toolbox_=new(o.registry.getClassFromOptions(o.registry.Type.TOOLBOX,this.options))(this)}return this.grid_&&this.grid_.update(this.scale),this.recordDeleteAreas(),this.markerManager_.setCursor(new o.Cursor),this.markerManager_.registerMarker(o.navigation.MARKER_NAME,new o.Marker),this.renderer_.createDom(this.svgGroup_,this.getTheme()),this.svgGroup_},o.WorkspaceSvg.prototype.dispose=function(){if(this.rendered=!1,this.currentGesture_&&this.currentGesture_.cancel(),this.svgGroup_&&(o.utils.dom.removeNode(this.svgGroup_),this.svgGroup_=null),this.svgBubbleCanvas_=this.svgBlockCanvas_=null,this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=null),this.flyout_&&(this.flyout_.dispose(),this.flyout_=null),this.trashcan&&(this.trashcan.dispose(),this.trashcan=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.zoomControls_&&(this.zoomControls_.dispose(),this.zoomControls_=null),this.audioManager_&&(this.audioManager_.dispose(),this.audioManager_=null),this.grid_&&(this.grid_.dispose(),this.grid_=null),this.renderer_.dispose(),this.markerManager_&&(this.markerManager_.dispose(),this.markerManager_=null),o.WorkspaceSvg.superClass_.dispose.call(this),this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||(this.themeManager_.dispose(),this.themeManager_=null)),this.flyoutButtonCallbacks_=this.toolboxCategoryCallbacks_=this.connectionDBList=null,!this.options.parentWorkspace){var t=this.getParentSvg();t&&t.parentNode&&o.utils.dom.removeNode(t.parentNode)}this.resizeHandlerWrapper_&&(o.unbindEvent_(this.resizeHandlerWrapper_),this.resizeHandlerWrapper_=null)},o.WorkspaceSvg.prototype.newBlock=function(t,e){return new o.BlockSvg(this,t,e)},o.WorkspaceSvg.prototype.addTrashcan=function(){if(!o.Trashcan)throw Error("Missing require for Blockly.Trashcan");this.trashcan=new o.Trashcan(this);var t=this.trashcan.createDom();this.svgGroup_.insertBefore(t,this.svgBlockCanvas_)},o.WorkspaceSvg.prototype.addZoomControls=function(){if(!o.ZoomControls)throw Error("Missing require for Blockly.ZoomControls");this.zoomControls_=new o.ZoomControls(this);var t=this.zoomControls_.createDom();this.svgGroup_.appendChild(t)},o.WorkspaceSvg.prototype.addFlyout=function(t){var e=new o.Options({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides});if(e.toolboxPosition=this.options.toolboxPosition,this.horizontalLayout){if(!o.HorizontalFlyout)throw Error("Missing require for Blockly.HorizontalFlyout");this.flyout_=new o.HorizontalFlyout(e)}else{if(!o.VerticalFlyout)throw Error("Missing require for Blockly.VerticalFlyout");this.flyout_=new o.VerticalFlyout(e)}return this.flyout_.autoClose=!1,this.flyout_.getWorkspace().setVisible(!0),this.flyout_.createDom(t)},o.WorkspaceSvg.prototype.getFlyout=function(t){return this.flyout_||t?this.flyout_:this.toolbox_?this.toolbox_.getFlyout():null},o.WorkspaceSvg.prototype.getToolbox=function(){return this.toolbox_},o.WorkspaceSvg.prototype.updateScreenCalculations_=function(){this.updateInverseScreenCTM(),this.recordDeleteAreas()},o.WorkspaceSvg.prototype.resizeContents=function(){this.resizesEnabled_&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())},o.WorkspaceSvg.prototype.resize=function(){this.toolbox_&&this.toolbox_.position(),this.flyout_&&this.flyout_.position(),this.trashcan&&this.trashcan.position(),this.zoomControls_&&this.zoomControls_.position(),this.scrollbar&&this.scrollbar.resize(),this.updateScreenCalculations_()},o.WorkspaceSvg.prototype.updateScreenCalculationsIfScrolled=function(){var t=o.utils.getDocumentScroll();o.utils.Coordinate.equals(this.lastRecordedPageScroll_,t)||(this.lastRecordedPageScroll_=t,this.updateScreenCalculations_())},o.WorkspaceSvg.prototype.getCanvas=function(){return this.svgBlockCanvas_},o.WorkspaceSvg.prototype.getBubbleCanvas=function(){return this.svgBubbleCanvas_},o.WorkspaceSvg.prototype.getParentSvg=function(){if(!this.cachedParentSvg_)for(var t=this.svgGroup_;t;){if("svg"==t.tagName){this.cachedParentSvg_=t;break}t=t.parentNode}return this.cachedParentSvg_},o.WorkspaceSvg.prototype.maybeFireViewportChangeEvent=function(){if(o.Events.isEnabled()){var t=this.scale,e=-this.scrollY,i=-this.scrollX;t==this.oldScale_&&1>Math.abs(e-this.oldTop_)&&1>Math.abs(i-this.oldLeft_)||(this.oldScale_=t,this.oldTop_=e,this.oldLeft_=i,t=new o.Events.ViewportChange(e,i,t,this.id),o.Events.fire(t))}},o.WorkspaceSvg.prototype.translate=function(t,e){if(this.useWorkspaceDragSurface_&&this.isDragSurfaceActive_)this.workspaceDragSurface_.translateSurface(t,e);else{var o="translate("+t+","+e+") scale("+this.scale+")";this.svgBlockCanvas_.setAttribute("transform",o),this.svgBubbleCanvas_.setAttribute("transform",o)}this.blockDragSurface_&&this.blockDragSurface_.translateAndScaleGroup(t,e,this.scale),this.grid_&&this.grid_.moveTo(t,e),this.maybeFireViewportChangeEvent()},o.WorkspaceSvg.prototype.resetDragSurface=function(){if(this.useWorkspaceDragSurface_){this.isDragSurfaceActive_=!1;var t=this.workspaceDragSurface_.getSurfaceTranslation();this.workspaceDragSurface_.clearAndHide(this.svgGroup_),t="translate("+t.x+","+t.y+") scale("+this.scale+")",this.svgBlockCanvas_.setAttribute("transform",t),this.svgBubbleCanvas_.setAttribute("transform",t)}},o.WorkspaceSvg.prototype.setupDragSurface=function(){if(this.useWorkspaceDragSurface_&&!this.isDragSurfaceActive_){this.isDragSurfaceActive_=!0;var t=this.svgBlockCanvas_.previousSibling,e=parseInt(this.getParentSvg().getAttribute("width"),10),i=parseInt(this.getParentSvg().getAttribute("height"),10),n=o.utils.getRelativeXY(this.getCanvas());this.workspaceDragSurface_.setContentsAndShow(this.getCanvas(),this.getBubbleCanvas(),t,e,i,this.scale),this.workspaceDragSurface_.translateSurface(n.x,n.y)}},o.WorkspaceSvg.prototype.getBlockDragSurface=function(){return this.blockDragSurface_},o.WorkspaceSvg.prototype.getWidth=function(){var t=this.getMetrics();return t?t.viewWidth/this.scale:0},o.WorkspaceSvg.prototype.setVisible=function(t){if(this.isVisible_=t,this.svgGroup_)if(this.scrollbar&&this.scrollbar.setContainerVisible(t),this.getFlyout()&&this.getFlyout().setContainerVisible(t),this.getParentSvg().style.display=t?"block":"none",this.toolbox_&&this.toolbox_.setVisible(t),t){for(var e=(t=this.getAllBlocks(!1)).length-1;0<=e;e--)t[e].markDirty();this.render(),this.toolbox_&&this.toolbox_.position()}else o.hideChaff(!0)},o.WorkspaceSvg.prototype.render=function(){for(var t=this.getAllBlocks(!1),e=t.length-1;0<=e;e--)t[e].render(!1);if(this.currentGesture_)for(t=this.currentGesture_.getInsertionMarkers(),e=0;e<t.length;e++)t[e].render(!1);this.markerManager_.updateMarkers()},o.WorkspaceSvg.prototype.highlightBlock=function(t,e){if(void 0===e){for(var i,n=0;i=this.highlightedBlocks_[n];n++)i.setHighlighted(!1);this.highlightedBlocks_.length=0}(i=t?this.getBlockById(t):null)&&((t=void 0===e||e)?-1==this.highlightedBlocks_.indexOf(i)&&this.highlightedBlocks_.push(i):o.utils.arrayRemove(this.highlightedBlocks_,i),i.setHighlighted(t))},o.WorkspaceSvg.prototype.paste=function(t){!this.rendered||!t.tagName||t.getElementsByTagName("block").length>=this.remainingCapacity()||(this.currentGesture_&&this.currentGesture_.cancel(),"comment"==t.tagName.toLowerCase()?this.pasteWorkspaceComment_(t):this.pasteBlock_(t))},o.WorkspaceSvg.prototype.pasteBlock_=function(t){o.Events.disable();try{var e=o.Xml.domToBlock(t,this),i=this.getMarker(o.navigation.MARKER_NAME).getCurNode();if(this.keyboardAccessibilityMode&&i&&i.isConnection()){var n=i.getLocation();return void o.navigation.insertBlock(e,n)}var r=parseInt(t.getAttribute("x"),10),s=parseInt(t.getAttribute("y"),10);if(!isNaN(r)&&!isNaN(s)){this.RTL&&(r=-r);do{t=!1;var a,l=this.getAllBlocks(!1);for(i=0;a=l[i];i++){var c=a.getRelativeToSurfaceXY();if(1>=Math.abs(r-c.x)&&1>=Math.abs(s-c.y)){t=!0;break}}if(!t){var u,h=e.getConnections_(!1);for(i=0;u=h[i];i++)if(u.closest(o.SNAP_RADIUS,new o.utils.Coordinate(r,s)).connection){t=!0;break}}t&&(r=this.RTL?r-o.SNAP_RADIUS:r+o.SNAP_RADIUS,s+=2*o.SNAP_RADIUS)}while(t);e.moveBy(r,s)}}finally{o.Events.enable()}o.Events.isEnabled()&&!e.isShadow()&&o.Events.fire(new o.Events.BlockCreate(e)),e.select()},o.WorkspaceSvg.prototype.pasteWorkspaceComment_=function(t){o.Events.disable();try{var e=o.WorkspaceCommentSvg.fromXml(t,this),i=parseInt(t.getAttribute("x"),10),n=parseInt(t.getAttribute("y"),10);isNaN(i)||isNaN(n)||(this.RTL&&(i=-i),e.moveBy(i+50,n+50))}finally{o.Events.enable()}o.Events.isEnabled()&&o.WorkspaceComment.fireCreateEvent(e),e.select()},o.WorkspaceSvg.prototype.refreshToolboxSelection=function(){var t=this.isFlyout?this.targetWorkspace:this;t&&!t.currentGesture_&&t.toolbox_&&t.toolbox_.getFlyout()&&t.toolbox_.refreshSelection()},o.WorkspaceSvg.prototype.renameVariableById=function(t,e){o.WorkspaceSvg.superClass_.renameVariableById.call(this,t,e),this.refreshToolboxSelection()},o.WorkspaceSvg.prototype.deleteVariableById=function(t){o.WorkspaceSvg.superClass_.deleteVariableById.call(this,t),this.refreshToolboxSelection()},o.WorkspaceSvg.prototype.createVariable=function(t,e,i){return t=o.WorkspaceSvg.superClass_.createVariable.call(this,t,e,i),this.refreshToolboxSelection(),t},o.WorkspaceSvg.prototype.recordDeleteAreas=function(){this.deleteAreaTrash_=this.trashcan&&this.svgGroup_.parentNode?this.trashcan.getClientRect():null,this.deleteAreaToolbox_=this.flyout_?this.flyout_.getClientRect():this.toolbox_&&"function"==typeof this.toolbox_.getClientRect?this.toolbox_.getClientRect():null},o.WorkspaceSvg.prototype.isDeleteArea=function(t){return this.deleteAreaTrash_&&this.deleteAreaTrash_.contains(t.clientX,t.clientY)?o.DELETE_AREA_TRASH:this.deleteAreaToolbox_&&this.deleteAreaToolbox_.contains(t.clientX,t.clientY)?o.DELETE_AREA_TOOLBOX:o.DELETE_AREA_NONE},o.WorkspaceSvg.prototype.onMouseDown_=function(t){var e=this.getGesture(t);e&&e.handleWsStart(t,this)},o.WorkspaceSvg.prototype.startDrag=function(t,e){(t=o.utils.mouseToSvg(t,this.getParentSvg(),this.getInverseScreenCTM())).x/=this.scale,t.y/=this.scale,this.dragDeltaXY_=o.utils.Coordinate.difference(e,t)},o.WorkspaceSvg.prototype.moveDrag=function(t){return(t=o.utils.mouseToSvg(t,this.getParentSvg(),this.getInverseScreenCTM())).x/=this.scale,t.y/=this.scale,o.utils.Coordinate.sum(this.dragDeltaXY_,t)},o.WorkspaceSvg.prototype.isDragging=function(){return null!=this.currentGesture_&&this.currentGesture_.isDragging()},o.WorkspaceSvg.prototype.isDraggable=function(){return this.options.moveOptions&&this.options.moveOptions.drag},o.WorkspaceSvg.prototype.isContentBounded=function(){return this.options.moveOptions&&this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.controls||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch},o.WorkspaceSvg.prototype.isMovable=function(){return this.options.moveOptions&&this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch},o.WorkspaceSvg.prototype.onMouseWheel_=function(t){if(o.Gesture.inProgress())t.preventDefault(),t.stopPropagation();else{var e=this.options.zoomOptions&&this.options.zoomOptions.wheel,i=this.options.moveOptions&&this.options.moveOptions.wheel;if(e||i){var n=o.utils.getScrollDeltaPixels(t);!e||!t.ctrlKey&&i?(e=this.scrollX-n.x,i=this.scrollY-n.y,t.shiftKey&&!n.x&&(e=this.scrollX-n.y,i=this.scrollY),this.scroll(e,i)):(n=-n.y/50,e=o.utils.mouseToSvg(t,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(e.x,e.y,n)),t.preventDefault()}}},o.WorkspaceSvg.prototype.getBlocksBoundingBox=function(){var t=this.getTopBoundedElements();if(!t.length)return new o.utils.Rect(0,0,0,0);for(var e=t[0].getBoundingRectangle(),i=1;i<t.length;i++){var n=t[i].getBoundingRectangle();n.top<e.top&&(e.top=n.top),n.bottom>e.bottom&&(e.bottom=n.bottom),n.left<e.left&&(e.left=n.left),n.right>e.right&&(e.right=n.right)}return e},o.WorkspaceSvg.prototype.cleanUp=function(){this.setResizesEnabled(!1),o.Events.setGroup(!0);for(var t,e=this.getTopBlocks(!0),i=0,n=0;t=e[n];n++)if(t.isMovable()){var r=t.getRelativeToSurfaceXY();t.moveBy(-r.x,i-r.y),t.snapToGrid(),i=t.getRelativeToSurfaceXY().y+t.getHeightWidth().height+this.renderer_.getConstants().MIN_BLOCK_HEIGHT}o.Events.setGroup(!1),this.setResizesEnabled(!0)},o.WorkspaceSvg.prototype.showContextMenu=function(t){if(!this.options.readOnly&&!this.isFlyout){var e=o.ContextMenuRegistry.registry.getContextMenuOptions(o.ContextMenuRegistry.ScopeType.WORKSPACE,{workspace:this});this.configureContextMenu&&this.configureContextMenu(e,t),o.ContextMenu.show(t,e,this.RTL)}},o.WorkspaceSvg.prototype.updateToolbox=function(t){if(t=o.utils.toolbox.convertToolboxDefToJson(t)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(o.utils.toolbox.hasCategories(t)){if(!this.toolbox_)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=t,this.toolbox_.render(t)}else{if(!this.flyout_)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=t,this.flyout_.show(t)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")},o.WorkspaceSvg.prototype.markFocused=function(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(o.mainWorkspace=this,this.setBrowserFocus())},o.WorkspaceSvg.prototype.setBrowserFocus=function(){document.activeElement&&document.activeElement.blur&&document.activeElement.blur();try{this.getParentSvg().focus({preventScroll:!0})}catch(t){try{this.getParentSvg().parentNode.setActive()}catch(t){this.getParentSvg().parentNode.focus({preventScroll:!0})}}},o.WorkspaceSvg.prototype.zoom=function(t,e,o){o=Math.pow(this.options.zoomOptions.scaleSpeed,o);var i=this.scale*o;if(this.scale!=i){i>this.options.zoomOptions.maxScale?o=this.options.zoomOptions.maxScale/this.scale:i<this.options.zoomOptions.minScale&&(o=this.options.zoomOptions.minScale/this.scale);var n=this.getCanvas().getCTM(),r=this.getParentSvg().createSVGPoint();r.x=t,r.y=e,t=(r=r.matrixTransform(n.inverse())).x,e=r.y,n=n.translate(t*(1-o),e*(1-o)).scale(o),this.scrollX=n.e,this.scrollY=n.f,this.setScale(i)}},o.WorkspaceSvg.prototype.zoomCenter=function(t){var e=this.getMetrics();if(this.flyout_){var o=e.svgWidth?e.svgWidth/2:0;e=e.svgHeight?e.svgHeight/2:0}else o=e.viewWidth/2+e.absoluteLeft,e=e.viewHeight/2+e.absoluteTop;this.zoom(o,e,t)},o.WorkspaceSvg.prototype.zoomToFit=function(){if(this.isMovable()){var t=this.getMetrics(),e=t.viewWidth;t=t.viewHeight;var i=this.getBlocksBoundingBox(),n=i.right-i.left;if(i=i.bottom-i.top,n){this.flyout_&&(this.horizontalLayout?(t+=this.flyout_.getHeight(),i+=this.flyout_.getHeight()/this.scale):(e+=this.flyout_.getWidth(),n+=this.flyout_.getWidth()/this.scale)),e/=n,t/=i,o.Events.disable();try{this.setScale(Math.min(e,t)),this.scrollCenter()}finally{o.Events.enable()}this.maybeFireViewportChangeEvent()}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")},o.WorkspaceSvg.prototype.beginCanvasTransition=function(){o.utils.dom.addClass(this.svgBlockCanvas_,"blocklyCanvasTransitioning"),o.utils.dom.addClass(this.svgBubbleCanvas_,"blocklyCanvasTransitioning")},o.WorkspaceSvg.prototype.endCanvasTransition=function(){o.utils.dom.removeClass(this.svgBlockCanvas_,"blocklyCanvasTransitioning"),o.utils.dom.removeClass(this.svgBubbleCanvas_,"blocklyCanvasTransitioning")},o.WorkspaceSvg.prototype.scrollCenter=function(){if(this.isMovable()){var t=this.getMetrics(),e=(t.contentWidth-t.viewWidth)/2,o=(t.contentHeight-t.viewHeight)/2;e=-e-t.contentLeft,o=-o-t.contentTop,this.scroll(e,o)}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")},o.WorkspaceSvg.prototype.centerOnBlock=function(t){if(this.isMovable()){if(t=t?this.getBlockById(t):null){var e=t.getRelativeToSurfaceXY(),o=t.getHeightWidth(),i=this.scale;t=(e.x+(this.RTL?-1:1)*o.width/2)*i,e=(e.y+o.height/2)*i,o=this.getMetrics(),this.scroll(-(t-o.viewWidth/2),-(e-o.viewHeight/2))}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")},o.WorkspaceSvg.prototype.setScale=function(t){this.options.zoomOptions.maxScale&&t>this.options.zoomOptions.maxScale?t=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&t<this.options.zoomOptions.minScale&&(t=this.options.zoomOptions.minScale),this.scale=t,o.hideChaff(!1),this.flyout_&&(this.flyout_.reflow(),this.recordDeleteAreas()),this.grid_&&this.grid_.update(this.scale),t=this.getMetrics(),this.scrollX-=t.absoluteLeft,this.scrollY-=t.absoluteTop,t.viewLeft+=t.absoluteLeft,t.viewTop+=t.absoluteTop,this.scroll(this.scrollX,this.scrollY),this.scrollbar&&(this.flyout_?(this.scrollbar.hScroll.resizeViewHorizontal(t),this.scrollbar.vScroll.resizeViewVertical(t)):(this.scrollbar.hScroll.resizeContentHorizontal(t),this.scrollbar.vScroll.resizeContentVertical(t)))},o.WorkspaceSvg.prototype.getScale=function(){return this.options.parentWorkspace?this.options.parentWorkspace.getScale():this.scale},o.WorkspaceSvg.prototype.scroll=function(t,e){o.hideChaff(!0);var i=this.getMetrics(),n=i.contentWidth+i.contentLeft-i.viewWidth,r=i.contentHeight+i.contentTop-i.viewHeight;t=Math.min(t,-i.contentLeft),e=Math.min(e,-i.contentTop),t=Math.max(t,-n),e=Math.max(e,-r),this.scrollX=t,this.scrollY=e,this.scrollbar&&(this.scrollbar.hScroll.setHandlePosition(-(t+i.contentLeft)*this.scrollbar.hScroll.ratio),this.scrollbar.vScroll.setHandlePosition(-(e+i.contentTop)*this.scrollbar.vScroll.ratio)),t+=i.absoluteLeft,e+=i.absoluteTop,this.translate(t,e)},o.WorkspaceSvg.getDimensionsPx_=function(t){var e=0,i=0;return t&&(e=t.getWidth(),i=t.getHeight()),new o.utils.Size(e,i)},o.WorkspaceSvg.getContentDimensions_=function(t,e){return t.isContentBounded()?o.WorkspaceSvg.getContentDimensionsBounded_(t,e):o.WorkspaceSvg.getContentDimensionsExact_(t)},o.WorkspaceSvg.getContentDimensionsExact_=function(t){var e=t.getBlocksBoundingBox(),o=t.scale;t=e.top*o;var i=e.bottom*o,n=e.left*o;return{top:t,bottom:i,left:n,right:e=e.right*o,width:e-n,height:i-t}},o.WorkspaceSvg.getContentDimensionsBounded_=function(t,e){t=o.WorkspaceSvg.getContentDimensionsExact_(t);var i=e.width,n=i/2,r=(e=e.height)/2,s=Math.min(t.left-n,t.right-i),a=Math.min(t.top-r,t.bottom-e);return{left:s,top:a,height:Math.max(t.bottom+r,t.top+e)-a,width:Math.max(t.right+n,t.left+i)-s}},o.WorkspaceSvg.getTopLevelWorkspaceMetrics_=function(){var t=o.WorkspaceSvg.getDimensionsPx_(this.toolbox_),e=o.WorkspaceSvg.getDimensionsPx_(this.flyout_),i=o.svgSize(this.getParentSvg()),n={height:i.height,width:i.width};this.toolbox_?this.toolboxPosition==o.TOOLBOX_AT_TOP||this.toolboxPosition==o.TOOLBOX_AT_BOTTOM?n.height-=t.height:this.toolboxPosition!=o.TOOLBOX_AT_LEFT&&this.toolboxPosition!=o.TOOLBOX_AT_RIGHT||(n.width-=t.width):this.flyout_&&(this.toolboxPosition==o.TOOLBOX_AT_TOP||this.toolboxPosition==o.TOOLBOX_AT_BOTTOM?n.height-=e.height:this.toolboxPosition!=o.TOOLBOX_AT_LEFT&&this.toolboxPosition!=o.TOOLBOX_AT_RIGHT||(n.width-=e.width));var r=o.WorkspaceSvg.getContentDimensions_(this,n),s=0;this.toolbox_&&this.toolboxPosition==o.TOOLBOX_AT_LEFT?s=t.width:this.flyout_&&this.toolboxPosition==o.TOOLBOX_AT_LEFT&&(s=e.width);var a=0;return this.toolbox_&&this.toolboxPosition==o.TOOLBOX_AT_TOP?a=t.height:this.flyout_&&this.toolboxPosition==o.TOOLBOX_AT_TOP&&(a=e.height),{contentHeight:r.height,contentWidth:r.width,contentTop:r.top,contentLeft:r.left,viewHeight:n.height,viewWidth:n.width,viewTop:-this.scrollY,viewLeft:-this.scrollX,absoluteTop:a,absoluteLeft:s,svgHeight:i.height,svgWidth:i.width,toolboxWidth:t.width,toolboxHeight:t.height,toolboxPosition:this.toolboxPosition,flyoutWidth:e.width,flyoutHeight:e.height}},o.WorkspaceSvg.setTopLevelWorkspaceMetrics_=function(t){var e=this.getMetrics();"number"==typeof t.x&&(this.scrollX=-e.contentWidth*t.x-e.contentLeft),"number"==typeof t.y&&(this.scrollY=-e.contentHeight*t.y-e.contentTop),this.translate(this.scrollX+e.absoluteLeft,this.scrollY+e.absoluteTop)},o.WorkspaceSvg.prototype.getBlockById=function(t){return o.WorkspaceSvg.superClass_.getBlockById.call(this,t)},o.WorkspaceSvg.prototype.getTopBlocks=function(t){return o.WorkspaceSvg.superClass_.getTopBlocks.call(this,t)},o.WorkspaceSvg.prototype.addTopBlock=function(t){this.addTopBoundedElement(t),o.WorkspaceSvg.superClass_.addTopBlock.call(this,t)},o.WorkspaceSvg.prototype.removeTopBlock=function(t){this.removeTopBoundedElement(t),o.WorkspaceSvg.superClass_.removeTopBlock.call(this,t)},o.WorkspaceSvg.prototype.addTopComment=function(t){this.addTopBoundedElement(t),o.WorkspaceSvg.superClass_.addTopComment.call(this,t)},o.WorkspaceSvg.prototype.removeTopComment=function(t){this.removeTopBoundedElement(t),o.WorkspaceSvg.superClass_.removeTopComment.call(this,t)},o.WorkspaceSvg.prototype.addTopBoundedElement=function(t){this.topBoundedElements_.push(t)},o.WorkspaceSvg.prototype.removeTopBoundedElement=function(t){o.utils.arrayRemove(this.topBoundedElements_,t)},o.WorkspaceSvg.prototype.getTopBoundedElements=function(){return[].concat(this.topBoundedElements_)},o.WorkspaceSvg.prototype.setResizesEnabled=function(t){var e=!this.resizesEnabled_&&t;this.resizesEnabled_=t,e&&this.resizeContents()},o.WorkspaceSvg.prototype.clear=function(){this.setResizesEnabled(!1),o.WorkspaceSvg.superClass_.clear.call(this),this.topBoundedElements_=[],this.setResizesEnabled(!0)},o.WorkspaceSvg.prototype.registerButtonCallback=function(t,e){if("function"!=typeof e)throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks_[t]=e},o.WorkspaceSvg.prototype.getButtonCallback=function(t){return(t=this.flyoutButtonCallbacks_[t])?t:null},o.WorkspaceSvg.prototype.removeButtonCallback=function(t){this.flyoutButtonCallbacks_[t]=null},o.WorkspaceSvg.prototype.registerToolboxCategoryCallback=function(t,e){if("function"!=typeof e)throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks_[t]=e},o.WorkspaceSvg.prototype.getToolboxCategoryCallback=function(t){return this.toolboxCategoryCallbacks_[t]||null},o.WorkspaceSvg.prototype.removeToolboxCategoryCallback=function(t){this.toolboxCategoryCallbacks_[t]=null},o.WorkspaceSvg.prototype.getGesture=function(t){var e="mousedown"==t.type||"touchstart"==t.type||"pointerdown"==t.type,i=this.currentGesture_;return i?e&&i.hasStarted()?(console.warn("Tried to start the same gesture twice."),i.cancel(),null):i:e?this.currentGesture_=new o.TouchGesture(t,this):null},o.WorkspaceSvg.prototype.clearGesture=function(){this.currentGesture_=null},o.WorkspaceSvg.prototype.cancelCurrentGesture=function(){this.currentGesture_&&this.currentGesture_.cancel()},o.WorkspaceSvg.prototype.getAudioManager=function(){return this.audioManager_},o.WorkspaceSvg.prototype.getGrid=function(){return this.grid_},o.inject=function(t,e){if(o.checkBlockColourConstants(),o.shadowRoot=e.shadowRoot,o.parentContainer=e.shadowRoot,"string"==typeof t&&(t=document.getElementById(t)||document.querySelector(t)),!t||!o.utils.dom.containsNode(o.shadowRoot||document,t))throw Error("Error: container is not in current document.");e=new o.Options(e||{});var i=document.createElement("div");i.className="injectionDiv",i.tabIndex=0,o.utils.aria.setState(i,o.utils.aria.State.LABEL,o.Msg.WORKSPACE_ARIA_LABEL),t.appendChild(i),t=o.createDom_(i,e);var n=new o.BlockDragSurfaceSvg(i),r=new o.WorkspaceDragSurfaceSvg(i),s=o.createMainWorkspace_(t,e,n,r);return o.init_(s),o.mainWorkspace=s,o.svgResize(s),i.addEventListener("focusin",(function(){o.mainWorkspace=s})),s},o.createDom_=function(t,e){t.setAttribute("dir","LTR"),o.Css.inject(e.hasCss,e.pathToMedia),t=o.utils.dom.createSvgElement(o.utils.Svg.SVG,{xmlns:o.utils.dom.SVG_NS,"xmlns:html":o.utils.dom.HTML_NS,"xmlns:xlink":o.utils.dom.XLINK_NS,version:"1.1",class:"blocklySvg",tabindex:"0"},t);var i=o.utils.dom.createSvgElement(o.utils.Svg.DEFS,{},t),n=String(Math.random()).substring(2);return e.gridPattern=o.Grid.createDom(n,e.gridOptions,i),t},o.createMainWorkspace_=function(t,e,i,n){e.parentWorkspace=null;var r=new o.WorkspaceSvg(e,i,n);return e=r.options,r.scale=e.zoomOptions.startScale,t.appendChild(r.createDom("blocklyMainBackground")),o.utils.dom.addClass(r.getInjectionDiv(),r.getRenderer().getClassName()),o.utils.dom.addClass(r.getInjectionDiv(),r.getTheme().getClassName()),!e.hasCategories&&e.languageTree&&(i=r.addFlyout(o.utils.Svg.SVG),o.utils.dom.insertAfter(i,t)),e.hasTrashcan&&r.addTrashcan(),e.zoomOptions&&e.zoomOptions.controls&&r.addZoomControls(),r.getThemeManager().subscribe(t,"workspaceBackgroundColour","background-color"),r.translate(0,0),e.readOnly||r.isMovable()||r.addChangeListener((function(t){if(!r.isDragging()&&!r.isMovable()&&-1!=o.Events.BUMP_EVENTS.indexOf(t.type)){var e=Object.create(null),i=r.getMetrics(),n=r.scale;if(e.RTL=r.RTL,e.viewLeft=i.viewLeft/n,e.viewTop=i.viewTop/n,e.viewRight=(i.viewLeft+i.viewWidth)/n,e.viewBottom=(i.viewTop+i.viewHeight)/n,r.isContentBounded()?(i=r.getBlocksBoundingBox(),e.contentLeft=i.left,e.contentTop=i.top,e.contentRight=i.right,e.contentBottom=i.bottom):(e.contentLeft=i.contentLeft/n,e.contentTop=i.contentTop/n,e.contentRight=(i.contentLeft+i.contentWidth)/n,e.contentBottom=(i.contentTop+i.contentHeight)/n),e.contentTop<e.viewTop||e.contentBottom>e.viewBottom||e.contentLeft<e.viewLeft||e.contentRight>e.viewRight){switch(i=null,t&&(i=o.Events.getGroup(),o.Events.setGroup(t.group)),t.type){case o.Events.BLOCK_CREATE:case o.Events.BLOCK_MOVE:var s=r.getBlockById(t.blockId);s&&(s=s.getRootBlock());break;case o.Events.COMMENT_CREATE:case o.Events.COMMENT_MOVE:s=r.getCommentById(t.commentId)}if(s){(n=s.getBoundingRectangle()).height=n.bottom-n.top,n.width=n.right-n.left;var a=e.viewTop,l=e.viewBottom-n.height;l=Math.max(a,l),a=o.utils.math.clamp(a,n.top,l)-n.top,l=e.viewLeft;var c=e.viewRight-n.width;e.RTL?l=Math.min(c,l):c=Math.max(l,c),e=o.utils.math.clamp(l,n.left,c)-n.left,s.moveBy(e,a)}t&&(!t.group&&s&&console.warn("Moved object in bounds but there was no event group. This may break undo."),null!==i&&o.Events.setGroup(i))}}})),o.svgResize(r),o.WidgetDiv.createDom(),o.DropDownDiv.createDom(),o.Tooltip.createDom(),r},o.init_=function(t){var e=t.options,i=t.getParentSvg();if(o.bindEventWithChecks_(i.parentNode,"contextmenu",null,(function(t){o.utils.isTargetInput(t)||t.preventDefault()})),i=o.bindEventWithChecks_(window,"resize",null,(function(){o.hideChaff(!0),o.svgResize(t)})),t.setResizeHandlerWrapper(i),o.inject.bindDocumentEvents_(),e.languageTree){i=t.getToolbox();var n=t.getFlyout(!0);i?i.init():n&&(n.init(t),n.show(e.languageTree),"function"==typeof n.scrollToStart&&n.scrollToStart())}i=o.Scrollbar.scrollbarThickness,e.hasTrashcan&&(i=t.trashcan.init(i)),e.zoomOptions&&e.zoomOptions.controls&&t.zoomControls_.init(i),e.moveOptions&&e.moveOptions.scrollbars?(t.scrollbar=new o.ScrollbarPair(t),t.scrollbar.resize()):t.setMetrics({x:.5,y:.5}),e.hasSounds&&o.inject.loadSounds_(e.pathToMedia,t)},o.inject.bindDocumentEvents_=function(){o.documentEventsBound_||(o.bindEventWithChecks_(document,"scroll",null,(function(){for(var t,e=o.Workspace.getAll(),i=0;t=e[i];i++)t.updateInverseScreenCTM&&t.updateInverseScreenCTM()})),o.bindEventWithChecks_(document,"keydown",null,o.onKeyDown),o.bindEvent_(document,"touchend",null,o.longStop_),o.bindEvent_(document,"touchcancel",null,o.longStop_),o.utils.userAgent.IPAD&&o.bindEventWithChecks_(window,"orientationchange",document,(function(){o.svgResize(o.getMainWorkspace())}))),o.documentEventsBound_=!0},o.inject.loadSounds_=function(t,e){var i=e.getAudioManager();i.load([t+"click.mp3",t+"click.wav",t+"click.ogg"],"click"),i.load([t+"disconnect.wav",t+"disconnect.mp3",t+"disconnect.ogg"],"disconnect"),i.load([t+"delete.mp3",t+"delete.ogg",t+"delete.wav"],"delete");var n=[];t=function(){for(;n.length;)o.unbindEvent_(n.pop());i.preload()},n.push(o.bindEventWithChecks_(document,"mousemove",null,t,!0)),n.push(o.bindEventWithChecks_(document,"touchstart",null,t,!0))},o.Names=function(t,e){if(this.variablePrefix_=e||"",this.reservedDict_=Object.create(null),t)for(t=t.split(","),e=0;e<t.length;e++)this.reservedDict_[t[e]]=!0;this.reset()},o.Names.DEVELOPER_VARIABLE_TYPE="DEVELOPER_VARIABLE",o.Names.prototype.reset=function(){this.db_=Object.create(null),this.dbReverse_=Object.create(null),this.variableMap_=null},o.Names.prototype.setVariableMap=function(t){this.variableMap_=t},o.Names.prototype.getNameForUserVariable_=function(t){return this.variableMap_?(t=this.variableMap_.getVariableById(t))?t.name:null:(console.log("Deprecated call to Blockly.Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:\nBlockly.YourGeneratorName.variableDB_.setVariableMap(workspace.getVariableMap());"),null)},o.Names.prototype.getName=function(t,e){if(e==o.VARIABLE_CATEGORY_NAME){var i=this.getNameForUserVariable_(t);i&&(t=i)}i=t.toLowerCase()+"_"+e;var n=e==o.VARIABLE_CATEGORY_NAME||e==o.Names.DEVELOPER_VARIABLE_TYPE?this.variablePrefix_:"";return i in this.db_?n+this.db_[i]:(t=this.getDistinctName(t,e),this.db_[i]=t.substr(n.length),t)},o.Names.prototype.getDistinctName=function(t,e){t=this.safeName_(t);for(var i="";this.dbReverse_[t+i]||t+i in this.reservedDict_;)i=i?i+1:2;return t+=i,this.dbReverse_[t]=!0,(e==o.VARIABLE_CATEGORY_NAME||e==o.Names.DEVELOPER_VARIABLE_TYPE?this.variablePrefix_:"")+t},o.Names.prototype.safeName_=function(t){return t?(t=encodeURI(t.replace(/ /g,"_")).replace(/[^\w]/g,"_"),-1!="0123456789".indexOf(t[0])&&(t="my_"+t)):t=o.Msg.UNNAMED_KEY||"unnamed",t},o.Names.equals=function(t,e){return t.toLowerCase()==e.toLowerCase()},o.Procedures={},o.Procedures.NAME_TYPE=o.PROCEDURE_CATEGORY_NAME,o.Procedures.DEFAULT_ARG="x",o.Procedures.allProcedures=function(t){var e=t.getBlocksByType("procedures_defnoreturn",!1).map((function(t){return t.getProcedureDef()}));return t=t.getBlocksByType("procedures_defreturn",!1).map((function(t){return t.getProcedureDef()})),e.sort(o.Procedures.procTupleComparator_),t.sort(o.Procedures.procTupleComparator_),[e,t]},o.Procedures.procTupleComparator_=function(t,e){return t[0].toLowerCase().localeCompare(e[0].toLowerCase())},o.Procedures.findLegalName=function(t,e){if(e.isInFlyout)return t;for(t=t||o.Msg.UNNAMED_KEY||"unnamed";!o.Procedures.isLegalName_(t,e.workspace,e);){var i=t.match(/^(.*?)(\d+)$/);t=i?i[1]+(parseInt(i[2],10)+1):t+"2"}return t},o.Procedures.isLegalName_=function(t,e,i){return!o.Procedures.isNameUsed(t,e,i)},o.Procedures.isNameUsed=function(t,e,i){e=e.getAllBlocks(!1);for(var n=0;n<e.length;n++)if(e[n]!=i&&e[n].getProcedureDef){var r=e[n].getProcedureDef();if(o.Names.equals(r[0],t))return!0}return!1},o.Procedures.rename=function(t){t=t.trim();var e=o.Procedures.findLegalName(t,this.getSourceBlock()),i=this.getValue();if(i!=t&&i!=e){t=this.getSourceBlock().workspace.getAllBlocks(!1);for(var n=0;n<t.length;n++)t[n].renameProcedure&&t[n].renameProcedure(i,e)}return e},o.Procedures.flyoutCategory=function(t){function e(t,e){for(var n=0;n<t.length;n++){var r=t[n][0],s=t[n][1],a=o.utils.xml.createElement("block");a.setAttribute("type",e),a.setAttribute("gap",16);var l=o.utils.xml.createElement("mutation");for(l.setAttribute("name",r),a.appendChild(l),r=0;r<s.length;r++){var c=o.utils.xml.createElement("arg");c.setAttribute("name",s[r]),l.appendChild(c)}i.push(a)}}var i=[];if(o.Blocks.procedures_defnoreturn){var n=o.utils.xml.createElement("block");n.setAttribute("type","procedures_defnoreturn"),n.setAttribute("gap",16);var r=o.utils.xml.createElement("field");r.setAttribute("name","NAME"),r.appendChild(o.utils.xml.createTextNode(o.Msg.PROCEDURES_DEFNORETURN_PROCEDURE)),n.appendChild(r),i.push(n)}return o.Blocks.procedures_defreturn&&((n=o.utils.xml.createElement("block")).setAttribute("type","procedures_defreturn"),n.setAttribute("gap",16),(r=o.utils.xml.createElement("field")).setAttribute("name","NAME"),r.appendChild(o.utils.xml.createTextNode(o.Msg.PROCEDURES_DEFRETURN_PROCEDURE)),n.appendChild(r),i.push(n)),o.Blocks.procedures_ifreturn&&((n=o.utils.xml.createElement("block")).setAttribute("type","procedures_ifreturn"),n.setAttribute("gap",16),i.push(n)),i.length&&i[i.length-1].setAttribute("gap",24),e((t=o.Procedures.allProcedures(t))[0],"procedures_callnoreturn"),e(t[1],"procedures_callreturn"),i},o.Procedures.updateMutatorFlyout_=function(t){for(var e,i=[],n=t.getBlocksByType("procedures_mutatorarg",!1),r=0;e=n[r];r++)i.push(e.getFieldValue("NAME"));n=o.utils.xml.createElement("xml"),(r=o.utils.xml.createElement("block")).setAttribute("type","procedures_mutatorarg"),(e=o.utils.xml.createElement("field")).setAttribute("name","NAME"),i=o.Variables.generateUniqueNameFromOptions(o.Procedures.DEFAULT_ARG,i),i=o.utils.xml.createTextNode(i),e.appendChild(i),r.appendChild(e),n.appendChild(r),t.updateToolbox(n)},o.Procedures.mutatorOpenListener=function(t){if(t.type==o.Events.BUBBLE_OPEN&&"mutator"===t.bubbleType&&t.isOpen){var e=(t=o.Workspace.getById(t.workspaceId).getBlockById(t.blockId)).type;"procedures_defnoreturn"!=e&&"procedures_defreturn"!=e||(t=t.mutator.getWorkspace(),o.Procedures.updateMutatorFlyout_(t),t.addChangeListener(o.Procedures.mutatorChangeListener_))}},o.Procedures.mutatorChangeListener_=function(t){t.type!=o.Events.BLOCK_CREATE&&t.type!=o.Events.BLOCK_DELETE&&t.type!=o.Events.BLOCK_CHANGE||(t=o.Workspace.getById(t.workspaceId),o.Procedures.updateMutatorFlyout_(t))},o.Procedures.getCallers=function(t,e){var i=[];e=e.getAllBlocks(!1);for(var n=0;n<e.length;n++)if(e[n].getProcedureCall){var r=e[n].getProcedureCall();r&&o.Names.equals(r,t)&&i.push(e[n])}return i},o.Procedures.mutateCallers=function(t){var e,i=o.Events.recordUndo,n=t.getProcedureDef()[0],r=t.mutationToDom(!0);for(t=o.Procedures.getCallers(n,t.workspace),n=0;e=t[n];n++){var s=e.mutationToDom();s=s&&o.Xml.domToText(s),e.domToMutation(r);var a=e.mutationToDom();s!=(a=a&&o.Xml.domToText(a))&&(o.Events.recordUndo=!1,o.Events.fire(new o.Events.BlockChange(e,"mutation",null,s,a)),o.Events.recordUndo=i)}},o.Procedures.getDefinition=function(t,e){e=e.getTopBlocks(!1);for(var i=0;i<e.length;i++)if(e[i].getProcedureDef){var n=e[i].getProcedureDef();if(n&&o.Names.equals(n[0],t))return e[i]}return null},o.ShortcutItems={},o.ShortcutItems.names={ESCAPE:"escape",DELETE:"delete",COPY:"copy",CUT:"cut",PASTE:"paste",UNDO:"undo",REDO:"redo"},o.ShortcutItems.registerEscape=function(){var t={name:o.ShortcutItems.names.ESCAPE,preconditionFn:function(t){return!t.options.readOnly},callback:function(){return o.hideChaff(),!0}};o.ShortcutRegistry.registry.register(t),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.ESC,t.name)},o.ShortcutItems.registerDelete=function(){var t={name:o.ShortcutItems.names.DELETE,preconditionFn:function(t){return!t.options.readOnly&&o.selected&&o.selected.isDeletable()},callback:function(t,e){return e.preventDefault(),!o.Gesture.inProgress()&&(o.deleteBlock(o.selected),!0)}};o.ShortcutRegistry.registry.register(t),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.DELETE,t.name),o.ShortcutRegistry.registry.addKeyMapping(o.utils.KeyCodes.BACKSPACE,t.name)},o.ShortcutItems.registerCopy=function(){var t={name:o.ShortcutItems.names.COPY,preconditionFn:function(t){return!t.options.readOnly&&!o.Gesture.inProgress()&&o.selected&&o.selected.isDeletable()&&o.selected.isMovable()},callback:function(){return o.hideChaff(),o.copy(o.selected),!0}};o.ShortcutRegistry.registry.register(t);var e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.C,[o.utils.KeyCodes.CTRL]);o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.C,[o.utils.KeyCodes.ALT]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.C,[o.utils.KeyCodes.META]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name)},o.ShortcutItems.registerCut=function(){var t={name:o.ShortcutItems.names.CUT,preconditionFn:function(t){return!t.options.readOnly&&!o.Gesture.inProgress()&&o.selected&&o.selected.isDeletable()&&o.selected.isMovable()&&!o.selected.workspace.isFlyout},callback:function(){return o.copy(o.selected),o.deleteBlock(o.selected),!0}};o.ShortcutRegistry.registry.register(t);var e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.X,[o.utils.KeyCodes.CTRL]);o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.X,[o.utils.KeyCodes.ALT]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.X,[o.utils.KeyCodes.META]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name)},o.ShortcutItems.registerPaste=function(){var t={name:o.ShortcutItems.names.PASTE,preconditionFn:function(t){return!t.options.readOnly&&!o.Gesture.inProgress()},callback:function(){return o.paste()}};o.ShortcutRegistry.registry.register(t);var e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.V,[o.utils.KeyCodes.CTRL]);o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.V,[o.utils.KeyCodes.ALT]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.V,[o.utils.KeyCodes.META]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name)},o.ShortcutItems.registerUndo=function(){var t={name:o.ShortcutItems.names.UNDO,preconditionFn:function(t){return!t.options.readOnly&&!o.Gesture.inProgress()},callback:function(t){return o.hideChaff(),t.undo(!1),!0}};o.ShortcutRegistry.registry.register(t);var e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.Z,[o.utils.KeyCodes.CTRL]);o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.Z,[o.utils.KeyCodes.ALT]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.Z,[o.utils.KeyCodes.META]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name)},o.ShortcutItems.registerRedo=function(){var t={name:o.ShortcutItems.names.REDO,preconditionFn:function(t){return!o.Gesture.inProgress()&&!t.options.readOnly},callback:function(t){return o.hideChaff(),t.undo(!0),!0}};o.ShortcutRegistry.registry.register(t);var e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.Z,[o.utils.KeyCodes.SHIFT,o.utils.KeyCodes.CTRL]);o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.Z,[o.utils.KeyCodes.SHIFT,o.utils.KeyCodes.ALT]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.Z,[o.utils.KeyCodes.SHIFT,o.utils.KeyCodes.META]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name),e=o.ShortcutRegistry.registry.createSerializedKey(o.utils.KeyCodes.Y,[o.utils.KeyCodes.CTRL]),o.ShortcutRegistry.registry.addKeyMapping(e,t.name)},o.ShortcutItems.registerDefaultShortcuts=function(){o.ShortcutItems.registerEscape(),o.ShortcutItems.registerDelete(),o.ShortcutItems.registerCopy(),o.ShortcutItems.registerCut(),o.ShortcutItems.registerPaste(),o.ShortcutItems.registerUndo(),o.ShortcutItems.registerRedo()},o.ShortcutRegistry=function(){o.ShortcutRegistry.registry=this,this.registry_=Object.create(null),this.keyMap_=Object.create(null),o.ShortcutItems.registerDefaultShortcuts(),o.navigation.registerNavigationShortcuts()},o.ShortcutRegistry.modifierKeys={Shift:o.utils.KeyCodes.SHIFT,Control:o.utils.KeyCodes.CTRL,Alt:o.utils.KeyCodes.ALT,Meta:o.utils.KeyCodes.META},o.ShortcutRegistry.prototype.register=function(t,e){if(this.registry_[t.name]&&!e)throw Error('Shortcut with name "'+t.name+'" already exists.');this.registry_[t.name]=t},o.ShortcutRegistry.prototype.unregister=function(t){return this.registry_[t]?(this.removeAllKeyMappings(t),delete this.registry_[t],!0):(console.warn('Keyboard shortcut with name "'+t+'" not found.'),!1)},o.ShortcutRegistry.prototype.addKeyMapping=function(t,e,o){var i=this.keyMap_[t];if(i&&!o)throw Error('Shortcut with name "'+e+'" collides with shortcuts '+i.toString());i&&o?i.unshift(e):this.keyMap_[t]=[e]},o.ShortcutRegistry.prototype.removeKeyMapping=function(t,e,o){var i=this.keyMap_[t];if(!i&&!o)return console.warn('No keyboard shortcut with name "'+e+'" registered with key code "'+t+'"'),!1;var n=i.indexOf(e);return-1<n?(i.splice(n,1),0==i.length&&delete this.keyMap_[t],!0):(o||console.warn('No keyboard shortcut with name "'+e+'" registered with key code "'+t+'"'),!1)},o.ShortcutRegistry.prototype.removeAllKeyMappings=function(t){for(var e in this.keyMap_)this.removeKeyMapping(e,t,!0)},o.ShortcutRegistry.prototype.setKeyMap=function(t){this.keyMap_=t},o.ShortcutRegistry.prototype.getKeyMap=function(){return o.utils.object.deepMerge(Object.create(null),this.keyMap_)},o.ShortcutRegistry.prototype.getRegistry=function(){return o.utils.object.deepMerge(Object.create(null),this.registry_)},o.ShortcutRegistry.prototype.onKeyDown=function(t,e){var o=this.serializeKeyEvent_(e);if(!(o=this.getShortcutNamesByKeyCode(o)))return!1;for(var i,n=0;i=o[n];n++)if((!(i=this.registry_[i]).preconditionFn||i.preconditionFn(t))&&i.callback&&i.callback(t,e,i))return!0;return!1},o.ShortcutRegistry.prototype.getShortcutNamesByKeyCode=function(t){return this.keyMap_[t]||[]},o.ShortcutRegistry.prototype.getKeyCodesByShortcutName=function(t){var e,o=[];for(e in this.keyMap_)-1<this.keyMap_[e].indexOf(t)&&o.push(e);return o},o.ShortcutRegistry.prototype.serializeKeyEvent_=function(t){var e,i="";for(e in o.ShortcutRegistry.modifierKeys)t.getModifierState(e)&&(""!=i&&(i+="+"),i+=e);return""!=i&&t.keyCode?i=i+"+"+t.keyCode:t.keyCode&&(i=t.keyCode.toString()),i},o.ShortcutRegistry.prototype.checkModifiers_=function(t){for(var e,i=o.utils.object.values(o.ShortcutRegistry.modifierKeys),n=0;e=t[n];n++)if(0>i.indexOf(e))throw Error(e+" is not a valid modifier key.")},o.ShortcutRegistry.prototype.createSerializedKey=function(t,e){var i="";if(e)for(var n in this.checkModifiers_(e),o.ShortcutRegistry.modifierKeys)-1<e.indexOf(o.ShortcutRegistry.modifierKeys[n])&&(""!=i&&(i+="+"),i+=n);return""!=i&&t?i=i+"+"+t:t&&(i=t.toString()),i},new o.ShortcutRegistry,o.VariableModel=function(t,e,i,n){this.workspace=t,this.name=e,this.type=i||"",this.id_=n||o.utils.genUid(),o.Events.fire(new o.Events.VarCreate(this))},o.VariableModel.prototype.getId=function(){return this.id_},o.VariableModel.compareByName=function(t,e){return(t=t.name.toLowerCase())<(e=e.name.toLowerCase())?-1:t==e?0:1},o.Variables={},o.Variables.NAME_TYPE=o.VARIABLE_CATEGORY_NAME,o.Variables.allUsedVarModels=function(t){var e=t.getAllBlocks(!1);t=Object.create(null);for(var o=0;o<e.length;o++){var i=e[o].getVarModels();if(i)for(var n=0;n<i.length;n++){var r=i[n],s=r.getId();s&&(t[s]=r)}}for(s in e=[],t)e.push(t[s]);return e},o.Variables.ALL_DEVELOPER_VARS_WARNINGS_BY_BLOCK_TYPE_={},o.Variables.allDeveloperVariables=function(t){t=t.getAllBlocks(!1);for(var e,i=Object.create(null),n=0;e=t[n];n++){var r=e.getDeveloperVariables;if(!r&&e.getDeveloperVars&&(r=e.getDeveloperVars,o.Variables.ALL_DEVELOPER_VARS_WARNINGS_BY_BLOCK_TYPE_[e.type]||(console.warn("Function getDeveloperVars() deprecated. Use getDeveloperVariables() (block type '"+e.type+"')"),o.Variables.ALL_DEVELOPER_VARS_WARNINGS_BY_BLOCK_TYPE_[e.type]=!0)),r)for(e=r(),r=0;r<e.length;r++)i[e[r]]=!0}return Object.keys(i)},o.Variables.flyoutCategory=function(t){var e=[],i=document.createElement("button");return i.setAttribute("text","%{BKY_NEW_VARIABLE}"),i.setAttribute("callbackKey","CREATE_VARIABLE"),t.registerButtonCallback("CREATE_VARIABLE",(function(t){o.Variables.createVariableButtonHandler(t.getTargetWorkspace())})),e.push(i),t=o.Variables.flyoutCategoryBlocks(t),e.concat(t)},o.Variables.flyoutCategoryBlocks=function(t){var e=[];if(0<(t=t.getVariablesOfType("")).length){var i=t[t.length-1];if(o.Blocks.variables_set){var n=o.utils.xml.createElement("block");n.setAttribute("type","variables_set"),n.setAttribute("gap",o.Blocks.math_change?8:24),n.appendChild(o.Variables.generateVariableFieldDom(i)),e.push(n)}if(o.Blocks.math_change&&((n=o.utils.xml.createElement("block")).setAttribute("type","math_change"),n.setAttribute("gap",o.Blocks.variables_get?20:8),n.appendChild(o.Variables.generateVariableFieldDom(i)),i=o.Xml.textToDom('<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value>'),n.appendChild(i),e.push(n)),o.Blocks.variables_get){t.sort(o.VariableModel.compareByName),i=0;for(var r;r=t[i];i++)(n=o.utils.xml.createElement("block")).setAttribute("type","variables_get"),n.setAttribute("gap",8),n.appendChild(o.Variables.generateVariableFieldDom(r)),e.push(n)}}return e},o.Variables.VAR_LETTER_OPTIONS="ijkmnopqrstuvwxyzabcdefgh",o.Variables.generateUniqueName=function(t){return o.Variables.generateUniqueNameFromOptions(o.Variables.VAR_LETTER_OPTIONS.charAt(0),t.getAllVariableNames())},o.Variables.generateUniqueNameFromOptions=function(t,e){if(!e.length)return t;for(var i=o.Variables.VAR_LETTER_OPTIONS,n="",r=i.indexOf(t);;){for(var s=!1,a=0;a<e.length;a++)if(e[a].toLowerCase()==t){s=!0;break}if(!s)return t;++r==i.length&&(r=0,n=Number(n)+1),t=i.charAt(r)+n}},o.Variables.createVariableButtonHandler=function(t,e,i){var n=i||"",r=function(i){o.Variables.promptName(o.Msg.NEW_VARIABLE_TITLE,i,(function(i){if(i){var s=o.Variables.nameUsedWithAnyType(i,t);if(s){if(s.type==n)var a=o.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",s.name);else a=(a=o.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE).replace("%1",s.name).replace("%2",s.type);o.alert(a,(function(){r(i)}))}else t.createVariable(i,n),e&&e(i)}else e&&e(null)}))};r("")},o.Variables.createVariable=o.Variables.createVariableButtonHandler,o.Variables.renameVariable=function(t,e,i){var n=function(r){var s=o.Msg.RENAME_VARIABLE_TITLE.replace("%1",e.name);o.Variables.promptName(s,r,(function(r){if(r){var s=o.Variables.nameUsedWithOtherType_(r,e.type,t);s?(s=o.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",s.name).replace("%2",s.type),o.alert(s,(function(){n(r)}))):(t.renameVariableById(e.getId(),r),i&&i(r))}else i&&i(null)}))};n("")},o.Variables.promptName=function(t,e,i){o.prompt(t,e,(function(t){t&&((t=t.replace(/[\s\xa0]+/g," ").trim())==o.Msg.RENAME_VARIABLE||t==o.Msg.NEW_VARIABLE)&&(t=null),i(t)}))},o.Variables.nameUsedWithOtherType_=function(t,e,o){o=o.getVariableMap().getAllVariables(),t=t.toLowerCase();for(var i,n=0;i=o[n];n++)if(i.name.toLowerCase()==t&&i.type!=e)return i;return null},o.Variables.nameUsedWithAnyType=function(t,e){e=e.getVariableMap().getAllVariables(),t=t.toLowerCase();for(var o,i=0;o=e[i];i++)if(o.name.toLowerCase()==t)return o;return null},o.Variables.generateVariableFieldDom=function(t){var e=o.utils.xml.createElement("field");return e.setAttribute("name","VAR"),e.setAttribute("id",t.getId()),e.setAttribute("variabletype",t.type),t=o.utils.xml.createTextNode(t.name),e.appendChild(t),e},o.Variables.getOrCreateVariablePackage=function(t,e,i,n){var r=o.Variables.getVariable(t,e,i,n);return r||(r=o.Variables.createVariable_(t,e,i,n)),r},o.Variables.getVariable=function(t,e,o,i){var n=t.getPotentialVariableMap(),r=null;if(e&&(!(r=t.getVariableById(e))&&n&&(r=n.getVariableById(e)),r))return r;if(o){if(null==i)throw Error("Tried to look up a variable by name without a type");!(r=t.getVariable(o,i))&&n&&(r=n.getVariable(o,i))}return r},o.Variables.createVariable_=function(t,e,i,n){var r=t.getPotentialVariableMap();return i||(i=o.Variables.generateUniqueName(t.isFlyout?t.targetWorkspace:t)),r?r.createVariable(i,n,e):t.createVariable(i,n,e)},o.Variables.getAddedVariables=function(t,e){t=t.getAllVariables();var o=[];if(e.length!=t.length)for(var i=0;i<t.length;i++){var n=t[i];-1==e.indexOf(n)&&o.push(n)}return o},o.WidgetDiv={},o.WidgetDiv.owner_=null,o.WidgetDiv.dispose_=null,o.WidgetDiv.rendererClassName_="",o.WidgetDiv.themeClassName_="",o.WidgetDiv.createDom=function(){o.WidgetDiv.DIV||(o.WidgetDiv.DIV=document.createElement("div"),o.WidgetDiv.DIV.className="blocklyWidgetDiv",(o.parentContainer||document.body).appendChild(o.WidgetDiv.DIV))},o.WidgetDiv.show=function(t,e,i){o.WidgetDiv.hide(),o.WidgetDiv.owner_=t,o.WidgetDiv.dispose_=i,(t=o.WidgetDiv.DIV).style.direction=e?"rtl":"ltr",t.style.display="block",e=o.getMainWorkspace(),o.WidgetDiv.rendererClassName_=e.getRenderer().getClassName(),o.WidgetDiv.themeClassName_=e.getTheme().getClassName(),o.utils.dom.addClass(t,o.WidgetDiv.rendererClassName_),o.utils.dom.addClass(t,o.WidgetDiv.themeClassName_)},o.WidgetDiv.hide=function(){if(o.WidgetDiv.isVisible()){o.WidgetDiv.owner_=null;var t=o.WidgetDiv.DIV;t.style.display="none",t.style.left="",t.style.top="",o.WidgetDiv.dispose_&&o.WidgetDiv.dispose_(),o.WidgetDiv.dispose_=null,t.textContent="",o.WidgetDiv.rendererClassName_&&(o.utils.dom.removeClass(t,o.WidgetDiv.rendererClassName_),o.WidgetDiv.rendererClassName_=""),o.WidgetDiv.themeClassName_&&(o.utils.dom.removeClass(t,o.WidgetDiv.themeClassName_),o.WidgetDiv.themeClassName_=""),o.getMainWorkspace().markFocused()}},o.WidgetDiv.isVisible=function(){return!!o.WidgetDiv.owner_},o.WidgetDiv.hideIfOwner=function(t){o.WidgetDiv.owner_==t&&o.WidgetDiv.hide()},o.WidgetDiv.positionInternal_=function(t,e,i){o.WidgetDiv.DIV.style.left=t+"px",o.WidgetDiv.DIV.style.top=e+"px",o.WidgetDiv.DIV.style.height=i+"px"},o.WidgetDiv.positionWithAnchor=function(t,e,i,n){var r=o.WidgetDiv.calculateY_(t,e,i);t=o.WidgetDiv.calculateX_(t,e,i,n),0>r?o.WidgetDiv.positionInternal_(t,0,i.height+r):o.WidgetDiv.positionInternal_(t,r,i.height)},o.WidgetDiv.calculateX_=function(t,e,o,i){return i?(e=Math.max(e.right-o.width,t.left),Math.min(e,t.right-o.width)):(e=Math.min(e.left,t.right-o.width),Math.max(e,t.left))},o.WidgetDiv.calculateY_=function(t,e,o){return e.bottom+o.height>=t.bottom?e.top-o.height:e.bottom},o.VERSION="4.20201217.0",o.mainWorkspace=null,o.selected=null,o.draggingConnections=[],o.clipboardXml_=null,o.clipboardSource_=null,o.clipboardTypeCounts_=null,o.cache3dSupported_=null,o.parentContainer=null,o.svgSize=function(t){return new o.utils.Size(t.cachedWidth_,t.cachedHeight_)},o.resizeSvgContents=function(t){t.resizeContents()},o.svgResize=function(t){for(;t.options.parentWorkspace;)t=t.options.parentWorkspace;var e=t.getParentSvg(),o=e.parentNode;if(o){var i=o.offsetWidth;o=o.offsetHeight,e.cachedWidth_!=i&&(e.setAttribute("width",i+"px"),e.cachedWidth_=i),e.cachedHeight_!=o&&(e.setAttribute("height",o+"px"),e.cachedHeight_=o),t.resize()}},o.onKeyDown=function(t){var e=o.mainWorkspace;e&&!(o.utils.isTargetInput(t)||e.rendered&&!e.isVisible())&&o.ShortcutRegistry.registry.onKeyDown(e,t)},o.deleteBlock=function(t){t.workspace.isFlyout||(o.Events.setGroup(!0),o.hideChaff(),t.dispose(!0,!0),o.Events.setGroup(!1))},o.copy=function(t){(t=t.toCopyData())&&(o.clipboardXml_=t.xml,o.clipboardSource_=t.source,o.clipboardTypeCounts_=t.typeCounts)},o.paste=function(){if(!o.clipboardXml_)return!1;var t=o.clipboardSource_;return t.isFlyout&&(t=t.targetWorkspace),!(!o.clipboardTypeCounts_||!t.isCapacityAvailable(o.clipboardTypeCounts_)||(o.Events.setGroup(!0),t.paste(o.clipboardXml_),o.Events.setGroup(!1),0))},o.duplicate=function(t){var e=o.clipboardXml_,i=o.clipboardSource_;o.copy(t),t.workspace.paste(o.clipboardXml_),o.clipboardXml_=e,o.clipboardSource_=i},o.onContextMenu_=function(t){o.utils.isTargetInput(t)||t.preventDefault()},o.hideChaff=function(t){o.Tooltip.hide(),o.WidgetDiv.hide(),o.DropDownDiv.hideWithoutAnimation(),t||((t=o.getMainWorkspace()).trashcan&&t.trashcan.flyout&&t.trashcan.closeFlyout(),(t=t.getToolbox())&&t.getFlyout()&&t.getFlyout().autoClose&&t.clearSelection())},o.getMainWorkspace=function(){return o.mainWorkspace},o.alert=function(t,e){alert(t),e&&e()},o.confirm=function(t,e){e(confirm(t))},o.prompt=function(t,e,o){o(prompt(t,e))},o.jsonInitFactory_=function(t){return function(){this.jsonInit(t)}},o.defineBlocksWithJsonArray=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i){var n=i.type;null==n||""===n?console.warn("Block definition #"+e+" in JSON array is missing a type attribute. Skipping."):(o.Blocks[n]&&console.warn("Block definition #"+e+' in JSON array overwrites prior definition of "'+n+'".'),o.Blocks[n]={init:o.jsonInitFactory_(i)})}else console.warn("Block definition #"+e+" in JSON array is "+i+". Skipping.")}},o.bindEventWithChecks_=function(t,e,i,n,r,s){var a=!1,l=function(t){var e=!r;t=o.Touch.splitEventByTouches(t);for(var s,l=0;s=t[l];l++)e&&!o.Touch.shouldHandleEvent(s)||(o.Touch.setClientFromTouch(s),i?n.call(i,s):n(s),a=!0)},c=[];if(o.utils.global.PointerEvent&&e in o.Touch.TOUCH_MAP)for(var u,h=0;u=o.Touch.TOUCH_MAP[e][h];h++)t.addEventListener(u,l,!1),c.push([t,u,l]);else if(t.addEventListener(e,l,!1),c.push([t,e,l]),e in o.Touch.TOUCH_MAP){var _=function(t){l(t),a&&!s&&t.preventDefault()};for(h=0;u=o.Touch.TOUCH_MAP[e][h];h++)t.addEventListener(u,_,!1),c.push([t,u,_])}return c},o.bindEvent_=function(t,e,i,n){var r=function(t){i?n.call(i,t):n(t)},s=[];if(o.utils.global.PointerEvent&&e in o.Touch.TOUCH_MAP)for(var a,l=0;a=o.Touch.TOUCH_MAP[e][l];l++)t.addEventListener(a,r,!1),s.push([t,a,r]);else if(t.addEventListener(e,r,!1),s.push([t,e,r]),e in o.Touch.TOUCH_MAP){var c=function(t){if(t.changedTouches&&1==t.changedTouches.length){var e=t.changedTouches[0];t.clientX=e.clientX,t.clientY=e.clientY}r(t),t.preventDefault()};for(l=0;a=o.Touch.TOUCH_MAP[e][l];l++)t.addEventListener(a,c,!1),s.push([t,a,c])}return s},o.unbindEvent_=function(t){for(;t.length;){var e=t.pop(),o=e[2];e[0].removeEventListener(e[1],o,!1)}return o},o.isNumber=function(t){return/^\s*-?\d+(\.\d+)?\s*$/.test(t)},o.hueToHex=function(t){return o.utils.colour.hsvToHex(t,o.HSV_SATURATION,255*o.HSV_VALUE)},o.checkBlockColourConstants=function(){o.checkBlockColourConstant_("LOGIC_HUE",["Blocks","logic","HUE"],void 0),o.checkBlockColourConstant_("LOGIC_HUE",["Constants","Logic","HUE"],210),o.checkBlockColourConstant_("LOOPS_HUE",["Blocks","loops","HUE"],void 0),o.checkBlockColourConstant_("LOOPS_HUE",["Constants","Loops","HUE"],120),o.checkBlockColourConstant_("MATH_HUE",["Blocks","math","HUE"],void 0),o.checkBlockColourConstant_("MATH_HUE",["Constants","Math","HUE"],230),o.checkBlockColourConstant_("TEXTS_HUE",["Blocks","texts","HUE"],void 0),o.checkBlockColourConstant_("TEXTS_HUE",["Constants","Text","HUE"],160),o.checkBlockColourConstant_("LISTS_HUE",["Blocks","lists","HUE"],void 0),o.checkBlockColourConstant_("LISTS_HUE",["Constants","Lists","HUE"],260),o.checkBlockColourConstant_("COLOUR_HUE",["Blocks","colour","HUE"],void 0),o.checkBlockColourConstant_("COLOUR_HUE",["Constants","Colour","HUE"],20),o.checkBlockColourConstant_("VARIABLES_HUE",["Blocks","variables","HUE"],void 0),o.checkBlockColourConstant_("VARIABLES_HUE",["Constants","Variables","HUE"],330),o.checkBlockColourConstant_("VARIABLES_DYNAMIC_HUE",["Constants","VariablesDynamic","HUE"],310),o.checkBlockColourConstant_("PROCEDURES_HUE",["Blocks","procedures","HUE"],void 0)},o.checkBlockColourConstant_=function(t,e,i){for(var n="Blockly",r=o,s=0;s<e.length;++s)n+="."+e[s],r&&(r=r[e[s]]);r&&r!==i&&(t=(void 0===i?'%1 has been removed. Use Blockly.Msg["%2"].':'%1 is deprecated and unused. Override Blockly.Msg["%2"].').replace("%1",n).replace("%2",t),console.warn(t))},o.setParentContainer=function(t){o.parentContainer=t},o.Events.BubbleOpen=function(t,e,i){o.Events.BubbleOpen.superClass_.constructor.call(this,t?t.workspace.id:void 0),this.blockId=t?t.id:null,this.isOpen=e,this.bubbleType=i},o.utils.object.inherits(o.Events.BubbleOpen,o.Events.UiBase),o.Events.BubbleOpen.prototype.type=o.Events.BUBBLE_OPEN,o.Events.BubbleOpen.prototype.toJson=function(){var t=o.Events.BubbleOpen.superClass_.toJson.call(this);return t.isOpen=this.isOpen,t.bubbleType=this.bubbleType,t.blockId=this.blockId,t},o.Events.BubbleOpen.prototype.fromJson=function(t){o.Events.BubbleOpen.superClass_.fromJson.call(this,t),this.isOpen=t.isOpen,this.bubbleType=t.bubbleType,this.blockId=t.blockId},o.registry.register(o.registry.Type.EVENT,o.Events.BUBBLE_OPEN,o.Events.BubbleOpen),o.Icon=function(t){this.block_=t,this.iconGroup_=null},o.Icon.prototype.collapseHidden=!0,o.Icon.prototype.SIZE=17,o.Icon.prototype.bubble_=null,o.Icon.prototype.iconXY_=null,o.Icon.prototype.createIcon=function(){this.iconGroup_||(this.iconGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:"blocklyIconGroup"},null),this.block_.isInFlyout&&o.utils.dom.addClass(this.iconGroup_,"blocklyIconGroupReadonly"),this.drawIcon_(this.iconGroup_),this.block_.getSvgRoot().appendChild(this.iconGroup_),o.bindEventWithChecks_(this.iconGroup_,"mouseup",this,this.iconClick_),this.updateEditable())},o.Icon.prototype.dispose=function(){o.utils.dom.removeNode(this.iconGroup_),this.iconGroup_=null,this.setVisible(!1),this.block_=null},o.Icon.prototype.updateEditable=function(){},o.Icon.prototype.isVisible=function(){return!!this.bubble_},o.Icon.prototype.iconClick_=function(t){this.block_.workspace.isDragging()||this.block_.isInFlyout||o.utils.isRightButton(t)||this.setVisible(!this.isVisible())},o.Icon.prototype.applyColour=function(){this.isVisible()&&this.bubble_.setColour(this.block_.style.colourPrimary)},o.Icon.prototype.setIconLocation=function(t){this.iconXY_=t,this.isVisible()&&this.bubble_.setAnchorLocation(t)},o.Icon.prototype.computeIconLocation=function(){var t=this.block_.getRelativeToSurfaceXY(),e=o.utils.getRelativeXY(this.iconGroup_);t=new o.utils.Coordinate(t.x+e.x+this.SIZE/2,t.y+e.y+this.SIZE/2),o.utils.Coordinate.equals(this.getIconLocation(),t)||this.setIconLocation(t)},o.Icon.prototype.getIconLocation=function(){return this.iconXY_},o.Icon.prototype.getCorrectedSize=function(){return new o.utils.Size(o.Icon.prototype.SIZE,o.Icon.prototype.SIZE-2)},o.Warning=function(t){o.Warning.superClass_.constructor.call(this,t),this.createIcon(),this.text_={}},o.utils.object.inherits(o.Warning,o.Icon),o.Warning.prototype.collapseHidden=!1,o.Warning.prototype.drawIcon_=function(t){o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},t),o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},t),o.utils.dom.createSvgElement(o.utils.Svg.RECT,{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},t)},o.Warning.prototype.setVisible=function(t){t!=this.isVisible()&&(o.Events.fire(new o.Events.BubbleOpen(this.block_,t,"warning")),t?this.createBubble_():this.disposeBubble_())},o.Warning.prototype.createBubble_=function(){this.paragraphElement_=o.Bubble.textToDom(this.getText()),this.bubble_=o.Bubble.createNonEditableBubble(this.paragraphElement_,this.block_,this.iconXY_),this.applyColour()},o.Warning.prototype.disposeBubble_=function(){this.bubble_.dispose(),this.paragraphElement_=this.bubble_=null},o.Warning.prototype.setText=function(t,e){this.text_[e]!=t&&(t?this.text_[e]=t:delete this.text_[e],this.isVisible()&&(this.setVisible(!1),this.setVisible(!0)))},o.Warning.prototype.getText=function(){var t,e=[];for(t in this.text_)e.push(this.text_[t]);return e.join("\n")},o.Warning.prototype.dispose=function(){this.block_.warning=null,o.Icon.prototype.dispose.call(this)},o.Comment=function(t){o.Comment.superClass_.constructor.call(this,t),this.model_=t.commentModel,this.model_.text=this.model_.text||"",this.cachedText_="",this.onInputWrapper_=this.onChangeWrapper_=this.onWheelWrapper_=this.onMouseUpWrapper_=null,this.createIcon()},o.utils.object.inherits(o.Comment,o.Icon),o.Comment.prototype.drawIcon_=function(t){o.utils.dom.createSvgElement(o.utils.Svg.CIRCLE,{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},t),o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},t),o.utils.dom.createSvgElement(o.utils.Svg.RECT,{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},t)},o.Comment.prototype.createEditor_=function(){this.foreignObject_=o.utils.dom.createSvgElement(o.utils.Svg.FOREIGNOBJECT,{x:o.Bubble.BORDER_WIDTH,y:o.Bubble.BORDER_WIDTH},null);var t=document.createElementNS(o.utils.dom.HTML_NS,"body");t.setAttribute("xmlns",o.utils.dom.HTML_NS),t.className="blocklyMinimalBody";var e=this.textarea_=document.createElementNS(o.utils.dom.HTML_NS,"textarea");return e.className="blocklyCommentTextarea",e.setAttribute("dir",this.block_.RTL?"RTL":"LTR"),e.value=this.model_.text,this.resizeTextarea_(),t.appendChild(e),this.foreignObject_.appendChild(t),this.onMouseUpWrapper_=o.bindEventWithChecks_(e,"mouseup",this,this.startEdit_,!0,!0),this.onWheelWrapper_=o.bindEventWithChecks_(e,"wheel",this,(function(t){t.stopPropagation()})),this.onChangeWrapper_=o.bindEventWithChecks_(e,"change",this,(function(t){this.cachedText_!=this.model_.text&&o.Events.fire(new o.Events.BlockChange(this.block_,"comment",null,this.cachedText_,this.model_.text))})),this.onInputWrapper_=o.bindEventWithChecks_(e,"input",this,(function(t){this.model_.text=e.value})),setTimeout(e.focus.bind(e),0),this.foreignObject_},o.Comment.prototype.updateEditable=function(){o.Comment.superClass_.updateEditable.call(this),this.isVisible()&&(this.disposeBubble_(),this.createBubble_())},o.Comment.prototype.onBubbleResize_=function(){this.isVisible()&&(this.model_.size=this.bubble_.getBubbleSize(),this.resizeTextarea_())},o.Comment.prototype.resizeTextarea_=function(){var t=this.model_.size,e=2*o.Bubble.BORDER_WIDTH,i=t.width-e;t=t.height-e,this.foreignObject_.setAttribute("width",i),this.foreignObject_.setAttribute("height",t),this.textarea_.style.width=i-4+"px",this.textarea_.style.height=t-4+"px"},o.Comment.prototype.setVisible=function(t){t!=this.isVisible()&&(o.Events.fire(new o.Events.BubbleOpen(this.block_,t,"comment")),(this.model_.pinned=t)?this.createBubble_():this.disposeBubble_())},o.Comment.prototype.createBubble_=function(){!this.block_.isEditable()||o.utils.userAgent.IE?this.createNonEditableBubble_():this.createEditableBubble_()},o.Comment.prototype.createEditableBubble_=function(){this.bubble_=new o.Bubble(this.block_.workspace,this.createEditor_(),this.block_.pathObject.svgPath,this.iconXY_,this.model_.size.width,this.model_.size.height),this.bubble_.setSvgId(this.block_.id),this.bubble_.registerResizeEvent(this.onBubbleResize_.bind(this)),this.applyColour()},o.Comment.prototype.createNonEditableBubble_=function(){this.paragraphElement_=o.Bubble.textToDom(this.block_.getCommentText()),this.bubble_=o.Bubble.createNonEditableBubble(this.paragraphElement_,this.block_,this.iconXY_),this.applyColour()},o.Comment.prototype.disposeBubble_=function(){this.onMouseUpWrapper_&&(o.unbindEvent_(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onWheelWrapper_&&(o.unbindEvent_(this.onWheelWrapper_),this.onWheelWrapper_=null),this.onChangeWrapper_&&(o.unbindEvent_(this.onChangeWrapper_),this.onChangeWrapper_=null),this.onInputWrapper_&&(o.unbindEvent_(this.onInputWrapper_),this.onInputWrapper_=null),this.bubble_.dispose(),this.paragraphElement_=this.foreignObject_=this.textarea_=this.bubble_=null},o.Comment.prototype.startEdit_=function(t){this.bubble_.promote()&&this.textarea_.focus(),this.cachedText_=this.model_.text},o.Comment.prototype.getBubbleSize=function(){return this.model_.size},o.Comment.prototype.setBubbleSize=function(t,e){this.bubble_?this.bubble_.setBubbleSize(t,e):(this.model_.size.width=t,this.model_.size.height=e)},o.Comment.prototype.updateText=function(){this.textarea_?this.textarea_.value=this.model_.text:this.paragraphElement_&&(this.paragraphElement_.firstChild.textContent=this.model_.text)},o.Comment.prototype.dispose=function(){this.block_.comment=null,o.Icon.prototype.dispose.call(this)},o.Css.register(".blocklyCommentTextarea {,background-color: #fef49c;,border: 0;,outline: 0;,margin: 0;,padding: 3px;,resize: none;,display: block;,text-overflow: hidden;,}".split(",")),o.FlyoutCursor=function(){o.FlyoutCursor.superClass_.constructor.call(this)},o.utils.object.inherits(o.FlyoutCursor,o.Cursor),o.FlyoutCursor.prototype.onBlocklyAction=function(t){switch(t.name){case o.navigation.actionNames.PREVIOUS:return this.prev(),!0;case o.navigation.actionNames.NEXT:return this.next(),!0;default:return!1}},o.FlyoutCursor.prototype.next=function(){var t=this.getCurNode();return t?((t=t.next())&&this.setCurNode(t),t):null},o.FlyoutCursor.prototype.in=function(){return null},o.FlyoutCursor.prototype.prev=function(){var t=this.getCurNode();return t?((t=t.prev())&&this.setCurNode(t),t):null},o.FlyoutCursor.prototype.out=function(){return null},o.Flyout=function(t){t.getMetrics=this.getMetrics_.bind(this),t.setMetrics=this.setMetrics_.bind(this),this.workspace_=new o.WorkspaceSvg(t),this.workspace_.isFlyout=!0,this.workspace_.setVisible(this.isVisible_),this.RTL=!!t.RTL,this.horizontalLayout=!1,this.toolboxPosition_=t.toolboxPosition,this.eventWrappers_=[],this.mats_=[],this.buttons_=[],this.listeners_=[],this.permanentlyDisabled_=[],this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH,this.targetWorkspace=null},o.Flyout.prototype.autoClose=!0,o.Flyout.prototype.isVisible_=!1,o.Flyout.prototype.containerVisible_=!0,o.Flyout.prototype.CORNER_RADIUS=8,o.Flyout.prototype.MARGIN=o.Flyout.prototype.CORNER_RADIUS,o.Flyout.prototype.GAP_X=3*o.Flyout.prototype.MARGIN,o.Flyout.prototype.GAP_Y=3*o.Flyout.prototype.MARGIN,o.Flyout.prototype.SCROLLBAR_PADDING=2,o.Flyout.prototype.width_=0,o.Flyout.prototype.height_=0,o.Flyout.prototype.dragAngleRange_=70,o.Flyout.prototype.createDom=function(t){return this.svgGroup_=o.utils.dom.createSvgElement(t,{class:"blocklyFlyout",style:"display: none"},null),this.svgBackground_=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity"),this.workspace_.getMarkerManager().setCursor(new o.FlyoutCursor),this.svgGroup_},o.Flyout.prototype.init=function(t){this.targetWorkspace=t,this.workspace_.targetWorkspace=t,this.scrollbar=new o.Scrollbar(this.workspace_,this.horizontalLayout,!1,"blocklyFlyoutScrollbar"),this.hide(),Array.prototype.push.apply(this.eventWrappers_,o.bindEventWithChecks_(this.svgGroup_,"wheel",this,this.wheel_)),this.autoClose||(this.filterWrapper_=this.filterForCapacity_.bind(this),this.targetWorkspace.addChangeListener(this.filterWrapper_)),Array.prototype.push.apply(this.eventWrappers_,o.bindEventWithChecks_(this.svgBackground_,"mousedown",this,this.onMouseDown_)),this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace),this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap()),this.workspace_.createPotentialVariableMap()},o.Flyout.prototype.dispose=function(){this.hide(),o.unbindEvent_(this.eventWrappers_),this.filterWrapper_&&(this.targetWorkspace.removeChangeListener(this.filterWrapper_),this.filterWrapper_=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.targetWorkspace=null,this.workspace_.dispose(),this.workspace_=null),this.svgGroup_&&(o.utils.dom.removeNode(this.svgGroup_),this.svgGroup_=null),this.targetWorkspace=this.svgBackground_=null},o.Flyout.prototype.getWidth=function(){return this.width_},o.Flyout.prototype.getHeight=function(){return this.height_},o.Flyout.prototype.getWorkspace=function(){return this.workspace_},o.Flyout.prototype.isVisible=function(){return this.isVisible_},o.Flyout.prototype.setVisible=function(t){var e=t!=this.isVisible();this.isVisible_=t,e&&this.updateDisplay_()},o.Flyout.prototype.setContainerVisible=function(t){var e=t!=this.containerVisible_;this.containerVisible_=t,e&&this.updateDisplay_()},o.Flyout.prototype.updateDisplay_=function(){var t=!!this.containerVisible_&&this.isVisible();this.svgGroup_.style.display=t?"block":"none",this.scrollbar.setContainerVisible(t)},o.Flyout.prototype.positionAt_=function(t,e,i,n){this.svgGroup_.setAttribute("width",t),this.svgGroup_.setAttribute("height",e),"svg"==this.svgGroup_.tagName?o.utils.dom.setCssTransform(this.svgGroup_,"translate("+i+"px,"+n+"px)"):this.svgGroup_.setAttribute("transform","translate("+i+","+n+")"),this.scrollbar&&(this.scrollbar.setOrigin(i,n),this.scrollbar.resize(),this.scrollbar.setPosition(this.scrollbar.position.x,this.scrollbar.position.y))},o.Flyout.prototype.hide=function(){if(this.isVisible()){this.setVisible(!1);for(var t,e=0;t=this.listeners_[e];e++)o.unbindEvent_(t);this.listeners_.length=0,this.reflowWrapper_&&(this.workspace_.removeChangeListener(this.reflowWrapper_),this.reflowWrapper_=null)}},o.Flyout.prototype.show=function(t){this.workspace_.setResizesEnabled(!1),this.hide(),this.clearOldBlocks_(),"string"==typeof t&&(t=this.getDynamicCategoryContents_(t)),this.setVisible(!0),t=o.utils.toolbox.convertFlyoutDefToJsonArray(t),t=this.createFlyoutInfo_(t),this.layout_(t.contents,t.gaps),this.listeners_.push(o.bindEventWithChecks_(this.svgBackground_,"mouseover",this,(function(){for(var t,e=this.workspace_.getTopBlocks(!1),o=0;t=e[o];o++)t.removeSelect()}))),this.horizontalLayout?this.height_=0:this.width_=0,this.workspace_.setResizesEnabled(!0),this.reflow(),this.filterForCapacity_(),this.position(),this.reflowWrapper_=this.reflow.bind(this),this.workspace_.addChangeListener(this.reflowWrapper_)},o.Flyout.prototype.createFlyoutInfo_=function(t){var e=[],i=[];this.permanentlyDisabled_.length=0;for(var n,r=this.horizontalLayout?this.GAP_X:this.GAP_Y,s=0;n=t[s];s++)switch(n.custom&&(n=this.getDynamicCategoryContents_(n.custom),n=o.utils.toolbox.convertFlyoutDefToJsonArray(n),t.splice.apply(t,[s,1].concat(n)),n=t[s]),n.kind.toUpperCase()){case"BLOCK":var a=n,l=this.getBlockXml_(a);n=this.createBlock_(l),a=parseInt(a.gap||l.getAttribute("gap"),10),i.push(isNaN(a)?r:a),e.push({type:"block",block:n});break;case"SEP":this.addSeparatorGap_(n,i,r);break;case"LABEL":n=this.createButton_(n,!0),e.push({type:"button",button:n}),i.push(r);break;case"BUTTON":n=this.createButton_(n,!1),e.push({type:"button",button:n}),i.push(r)}return{contents:e,gaps:i}},o.Flyout.prototype.getDynamicCategoryContents_=function(t){if("function"!=typeof(t=this.workspace_.targetWorkspace.getToolboxCategoryCallback(t)))throw TypeError("Couldn't find a callback function when opening a toolbox category.");if(t=t(this.workspace_.targetWorkspace),!Array.isArray(t))throw new TypeError("Result of toolbox category callback must be an array.");return t},o.Flyout.prototype.createButton_=function(t,e){if(!o.FlyoutButton)throw Error("Missing require for Blockly.FlyoutButton");return new o.FlyoutButton(this.workspace_,this.targetWorkspace,t,e)},o.Flyout.prototype.createBlock_=function(t){return(t=o.Xml.domToBlock(t,this.workspace_)).isEnabled()||this.permanentlyDisabled_.push(t),t},o.Flyout.prototype.getBlockXml_=function(t){var e=null,i=t.blockxml;if(i&&"string"!=typeof i?e=i:i&&"string"==typeof i?(e=o.Xml.textToDom(i),t.blockxml=e):t.type&&((e=o.utils.xml.createElement("xml")).setAttribute("type",t.type),e.setAttribute("disabled",t.disabled),t.blockxml=e),!e)throw Error("Error: Invalid block definition. Block definition must have blockxml or type.");return e},o.Flyout.prototype.addSeparatorGap_=function(t,e,o){t=parseInt(t.gap,10),!isNaN(t)&&0<e.length?e[e.length-1]=t:e.push(o)},o.Flyout.prototype.clearOldBlocks_=function(){for(var t,e=this.workspace_.getTopBlocks(!1),i=0;t=e[i];i++)t.workspace==this.workspace_&&t.dispose(!1,!1);for(i=0;i<this.mats_.length;i++)(e=this.mats_[i])&&(o.Tooltip.unbindMouseEvents(e),o.utils.dom.removeNode(e));for(i=this.mats_.length=0;e=this.buttons_[i];i++)e.dispose();this.buttons_.length=0,this.workspace_.getPotentialVariableMap().clear()},o.Flyout.prototype.addBlockListeners_=function(t,e,i){this.listeners_.push(o.bindEventWithChecks_(t,"mousedown",null,this.blockMouseDown_(e))),this.listeners_.push(o.bindEventWithChecks_(i,"mousedown",null,this.blockMouseDown_(e))),this.listeners_.push(o.bindEvent_(t,"mouseenter",e,e.addSelect)),this.listeners_.push(o.bindEvent_(t,"mouseleave",e,e.removeSelect)),this.listeners_.push(o.bindEvent_(i,"mouseenter",e,e.addSelect)),this.listeners_.push(o.bindEvent_(i,"mouseleave",e,e.removeSelect))},o.Flyout.prototype.blockMouseDown_=function(t){var e=this;return function(o){var i=e.targetWorkspace.getGesture(o);i&&(i.setStartBlock(t),i.handleFlyoutStart(o,e))}},o.Flyout.prototype.onMouseDown_=function(t){var e=this.targetWorkspace.getGesture(t);e&&e.handleFlyoutStart(t,this)},o.Flyout.prototype.isBlockCreatable_=function(t){return t.isEnabled()},o.Flyout.prototype.createBlock=function(t){var e=null;o.Events.disable();var i=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{e=this.placeNewBlock_(t)}finally{o.Events.enable()}if(o.hideChaff(),t=o.Variables.getAddedVariables(this.targetWorkspace,i),o.Events.isEnabled()){for(o.Events.setGroup(!0),i=0;i<t.length;i++)o.Events.fire(new o.Events.VarCreate(t[i]));o.Events.fire(new o.Events.Create(e))}return this.autoClose?this.hide():this.filterForCapacity_(),e},o.Flyout.prototype.initFlyoutButton_=function(t,e,i){var n=t.createDom();t.moveTo(e,i),t.show(),this.listeners_.push(o.bindEventWithChecks_(n,"mousedown",this,this.onMouseDown_)),this.buttons_.push(t)},o.Flyout.prototype.createRect_=function(t,e,i,n,r){return(e=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{"fill-opacity":0,x:e,y:i,height:n.height,width:n.width},null)).tooltip=t,o.Tooltip.bindMouseEvents(e),this.workspace_.getCanvas().insertBefore(e,t.getSvgRoot()),t.flyoutRect_=e,this.mats_[r]=e},o.Flyout.prototype.moveRectToBlock_=function(t,e){var o=e.getHeightWidth();t.setAttribute("width",o.width),t.setAttribute("height",o.height),e=e.getRelativeToSurfaceXY(),t.setAttribute("y",e.y),t.setAttribute("x",this.RTL?e.x-o.width:e.x)},o.Flyout.prototype.filterForCapacity_=function(){for(var t,e=this.workspace_.getTopBlocks(!1),i=0;t=e[i];i++)if(-1==this.permanentlyDisabled_.indexOf(t))for(var n=this.targetWorkspace.isCapacityAvailable(o.utils.getBlockTypeCounts(t));t;)t.setEnabled(n),t=t.getNextBlock()},o.Flyout.prototype.reflow=function(){this.reflowWrapper_&&this.workspace_.removeChangeListener(this.reflowWrapper_),this.reflowInternal_(),this.reflowWrapper_&&this.workspace_.addChangeListener(this.reflowWrapper_)},o.Flyout.prototype.isScrollable=function(){return!!this.scrollbar&&this.scrollbar.isVisible()},o.Flyout.prototype.placeNewBlock_=function(t){var e=this.targetWorkspace;if(!t.getSvgRoot())throw Error("oldBlock is not rendered.");var i=o.Xml.blockToDom(t,!0);if(e.setResizesEnabled(!1),!(i=o.Xml.domToBlock(i,e)).getSvgRoot())throw Error("block is not rendered.");var n=e.getOriginOffsetInPixels(),r=this.workspace_.getOriginOffsetInPixels();return(t=t.getRelativeToSurfaceXY()).scale(this.workspace_.scale),t=o.utils.Coordinate.sum(r,t),(n=o.utils.Coordinate.difference(t,n)).scale(1/e.scale),i.moveBy(n.x,n.y),i},o.Flyout.prototype.onBlocklyAction=function(t){return this.workspace_.getCursor().onBlocklyAction(t)},o.HorizontalFlyout=function(t){o.HorizontalFlyout.superClass_.constructor.call(this,t),this.horizontalLayout=!0},o.utils.object.inherits(o.HorizontalFlyout,o.Flyout),o.HorizontalFlyout.prototype.getMetrics_=function(){if(!this.isVisible())return null;try{var t=this.workspace_.getCanvas().getBBox()}catch(e){t={height:0,y:0,width:0,x:0}}var e=this.SCROLLBAR_PADDING,i=this.SCROLLBAR_PADDING;this.toolboxPosition_==o.TOOLBOX_AT_BOTTOM&&(e=0);var n=this.height_;return this.toolboxPosition_==o.TOOLBOX_AT_TOP&&(n-=this.SCROLLBAR_PADDING),{contentHeight:(t.height+2*this.MARGIN)*this.workspace_.scale,contentWidth:(t.width+2*this.MARGIN)*this.workspace_.scale,contentTop:0,contentLeft:0,viewHeight:n,viewWidth:this.width_-2*this.SCROLLBAR_PADDING,viewTop:-this.workspace_.scrollY,viewLeft:-this.workspace_.scrollX,absoluteTop:e,absoluteLeft:i}},o.HorizontalFlyout.prototype.setMetrics_=function(t){var e=this.getMetrics_();e&&("number"==typeof t.x&&(this.workspace_.scrollX=-e.contentWidth*t.x),this.workspace_.translate(this.workspace_.scrollX+e.absoluteLeft,this.workspace_.scrollY+e.absoluteTop))},o.HorizontalFlyout.prototype.getX=function(){return 0},o.HorizontalFlyout.prototype.getY=function(){var t=this.targetWorkspace.getMetrics();return t?this.targetWorkspace.toolboxPosition==this.toolboxPosition_?t.toolboxHeight?this.toolboxPosition_==o.TOOLBOX_AT_TOP?t.toolboxHeight:t.viewHeight-this.height_:this.toolboxPosition_==o.TOOLBOX_AT_TOP?0:t.viewHeight:this.toolboxPosition_==o.TOOLBOX_AT_TOP?0:t.viewHeight+t.absoluteTop-this.height_:0},o.HorizontalFlyout.prototype.position=function(){if(this.isVisible()){var t=this.targetWorkspace.getMetrics();if(t){this.width_=t.viewWidth,this.setBackgroundPath_(t.viewWidth-2*this.CORNER_RADIUS,this.height_-this.CORNER_RADIUS),t=this.getX();var e=this.getY();this.positionAt_(this.width_,this.height_,t,e)}}},o.HorizontalFlyout.prototype.setBackgroundPath_=function(t,e){var i=this.toolboxPosition_==o.TOOLBOX_AT_TOP,n=["M 0,"+(i?0:this.CORNER_RADIUS)];i?(n.push("h",t+2*this.CORNER_RADIUS),n.push("v",e),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("h",-t),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),n.push("h",t),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("v",e),n.push("h",-t-2*this.CORNER_RADIUS)),n.push("z"),this.svgBackground_.setAttribute("d",n.join(" "))},o.HorizontalFlyout.prototype.scrollToStart=function(){this.scrollbar.set(this.RTL?1/0:0)},o.HorizontalFlyout.prototype.wheel_=function(t){var e=o.utils.getScrollDeltaPixels(t),i=e.x||e.y;i&&(i=(e=this.getMetrics_()).viewLeft+i,i=Math.min(i,e.contentWidth-e.viewWidth),i=Math.max(i,0),this.scrollbar.set(i),o.WidgetDiv.hide(),o.DropDownDiv.hideWithoutAnimation()),t.preventDefault(),t.stopPropagation()},o.HorizontalFlyout.prototype.layout_=function(t,e){this.workspace_.scale=this.targetWorkspace.scale;var o=this.MARGIN,i=o+this.tabWidth_;this.RTL&&(t=t.reverse());for(var n,r=0;n=t[r];r++)if("block"==n.type){for(var s,a=(n=n.block).getDescendants(!1),l=0;s=a[l];l++)s.isInFlyout=!0;n.render(),a=n.getSvgRoot(),l=n.getHeightWidth(),s=n.outputConnection?this.tabWidth_:0,s=this.RTL?i+l.width:i-s,n.moveBy(s,o),s=this.createRect_(n,s,o,l,r),i+=l.width+e[r],this.addBlockListeners_(a,n,s)}else"button"==n.type&&(this.initFlyoutButton_(n.button,i,o),i+=n.button.width+e[r])},o.HorizontalFlyout.prototype.isDragTowardWorkspace=function(t){t=Math.atan2(t.y,t.x)/Math.PI*180;var e=this.dragAngleRange_;return t<90+e&&t>90-e||t>-90-e&&t<-90+e},o.HorizontalFlyout.prototype.getClientRect=function(){if(!this.svgGroup_)return null;var t=this.svgGroup_.getBoundingClientRect(),e=t.top;return this.toolboxPosition_==o.TOOLBOX_AT_TOP?new o.utils.Rect(-1e9,e+t.height,-1e9,1e9):new o.utils.Rect(e,1e9,-1e9,1e9)},o.HorizontalFlyout.prototype.reflowInternal_=function(){this.workspace_.scale=this.targetWorkspace.scale;for(var t,e=0,i=this.workspace_.getTopBlocks(!1),n=0;t=i[n];n++)e=Math.max(e,t.getHeightWidth().height);if(e+=1.5*this.MARGIN,e*=this.workspace_.scale,e+=o.Scrollbar.scrollbarThickness,this.height_!=e){for(n=0;t=i[n];n++)t.flyoutRect_&&this.moveRectToBlock_(t.flyoutRect_,t);this.targetWorkspace.toolboxPosition!=this.toolboxPosition_||this.toolboxPosition_!=o.TOOLBOX_AT_TOP||this.targetWorkspace.getToolbox()||this.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+e),this.height_=e,this.position()}},o.registry.register(o.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,o.registry.DEFAULT,o.HorizontalFlyout),o.VerticalFlyout=function(t){o.VerticalFlyout.superClass_.constructor.call(this,t)},o.utils.object.inherits(o.VerticalFlyout,o.Flyout),o.VerticalFlyout.registryName="verticalFlyout",o.VerticalFlyout.prototype.getMetrics_=function(){if(!this.isVisible())return null;try{var t=this.workspace_.getCanvas().getBBox()}catch(e){t={height:0,y:0,width:0,x:0}}var e=this.SCROLLBAR_PADDING,o=this.height_-2*this.SCROLLBAR_PADDING,i=this.width_;return this.RTL||(i-=this.SCROLLBAR_PADDING),{contentHeight:t.height*this.workspace_.scale+2*this.MARGIN,contentWidth:t.width*this.workspace_.scale+2*this.MARGIN,contentTop:t.y,contentLeft:t.x,viewHeight:o,viewWidth:i,viewTop:-this.workspace_.scrollY+t.y,viewLeft:-this.workspace_.scrollX,absoluteTop:e,absoluteLeft:0}},o.VerticalFlyout.prototype.setMetrics_=function(t){var e=this.getMetrics_();e&&("number"==typeof t.y&&(this.workspace_.scrollY=-e.contentHeight*t.y),this.workspace_.translate(this.workspace_.scrollX+e.absoluteLeft,this.workspace_.scrollY+e.absoluteTop))},o.VerticalFlyout.prototype.getX=function(){var t=this.targetWorkspace.getMetrics();return t?this.targetWorkspace.toolboxPosition==this.toolboxPosition_?t.toolboxWidth?this.toolboxPosition_==o.TOOLBOX_AT_LEFT?t.toolboxWidth:t.viewWidth-this.width_:this.toolboxPosition_==o.TOOLBOX_AT_LEFT?0:t.viewWidth:this.toolboxPosition_==o.TOOLBOX_AT_LEFT?0:t.viewWidth+t.absoluteLeft-this.width_:0},o.VerticalFlyout.prototype.getY=function(){return 0},o.VerticalFlyout.prototype.position=function(){if(this.isVisible()){var t=this.targetWorkspace.getMetrics();if(t){this.height_=t.viewHeight,this.setBackgroundPath_(this.width_-this.CORNER_RADIUS,t.viewHeight-2*this.CORNER_RADIUS),t=this.getX();var e=this.getY();this.positionAt_(this.width_,this.height_,t,e)}}},o.VerticalFlyout.prototype.setBackgroundPath_=function(t,e){var i=this.toolboxPosition_==o.TOOLBOX_AT_RIGHT,n=t+this.CORNER_RADIUS;(n=["M "+(i?n:0)+",0"]).push("h",i?-t:t),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,i?0:1,i?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("v",Math.max(0,e)),n.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,i?0:1,i?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),n.push("h",i?t:-t),n.push("z"),this.svgBackground_.setAttribute("d",n.join(" "))},o.VerticalFlyout.prototype.scrollToStart=function(){this.scrollbar.set(0)},o.VerticalFlyout.prototype.wheel_=function(t){var e=o.utils.getScrollDeltaPixels(t);if(e.y){var i=this.getMetrics_();e=i.viewTop-i.contentTop+e.y,e=Math.min(e,i.contentHeight-i.viewHeight),e=Math.max(e,0),this.scrollbar.set(e),o.WidgetDiv.hide(),o.DropDownDiv.hideWithoutAnimation()}t.preventDefault(),t.stopPropagation()},o.VerticalFlyout.prototype.layout_=function(t,e){this.workspace_.scale=this.targetWorkspace.scale;for(var o,i=this.MARGIN,n=this.RTL?i:i+this.tabWidth_,r=0;o=t[r];r++)if("block"==o.type){for(var s,a=(o=o.block).getDescendants(!1),l=0;s=a[l];l++)s.isInFlyout=!0;o.render(),a=o.getSvgRoot(),l=o.getHeightWidth(),s=o.outputConnection?n-this.tabWidth_:n,o.moveBy(s,i),s=this.createRect_(o,this.RTL?s-l.width:s,i,l,r),this.addBlockListeners_(a,o,s),i+=l.height+e[r]}else"button"==o.type&&(this.initFlyoutButton_(o.button,n,i),i+=o.button.height+e[r])},o.VerticalFlyout.prototype.isDragTowardWorkspace=function(t){t=Math.atan2(t.y,t.x)/Math.PI*180;var e=this.dragAngleRange_;return t<e&&t>-e||t<-180+e||t>180-e},o.VerticalFlyout.prototype.getClientRect=function(){if(!this.svgGroup_)return null;var t=this.svgGroup_.getBoundingClientRect(),e=t.left;return this.toolboxPosition_==o.TOOLBOX_AT_LEFT?new o.utils.Rect(-1e9,1e9,-1e9,e+t.width):new o.utils.Rect(-1e9,1e9,e,1e9)},o.VerticalFlyout.prototype.reflowInternal_=function(){this.workspace_.scale=this.targetWorkspace.scale;for(var t,e=0,i=this.workspace_.getTopBlocks(!1),n=0;t=i[n];n++){var r=t.getHeightWidth().width;t.outputConnection&&(r-=this.tabWidth_),e=Math.max(e,r)}for(n=0;t=this.buttons_[n];n++)e=Math.max(e,t.width);if(e+=1.5*this.MARGIN+this.tabWidth_,e*=this.workspace_.scale,e+=o.Scrollbar.scrollbarThickness,this.width_!=e){for(n=0;t=i[n];n++){if(this.RTL){r=t.getRelativeToSurfaceXY().x;var s=e/this.workspace_.scale-this.MARGIN;t.outputConnection||(s-=this.tabWidth_),t.moveBy(s-r,0)}t.flyoutRect_&&this.moveRectToBlock_(t.flyoutRect_,t)}if(this.RTL)for(n=0;t=this.buttons_[n];n++)i=t.getPosition().y,t.moveTo(e/this.workspace_.scale-t.width-this.MARGIN-this.tabWidth_,i);this.targetWorkspace.toolboxPosition!=this.toolboxPosition_||this.toolboxPosition_!=o.TOOLBOX_AT_LEFT||this.targetWorkspace.getToolbox()||this.targetWorkspace.translate(this.targetWorkspace.scrollX+e,this.targetWorkspace.scrollY),this.width_=e,this.position()}},o.registry.register(o.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,o.registry.DEFAULT,o.VerticalFlyout),o.FlyoutButton=function(t,e,i,n){this.workspace_=t,this.targetWorkspace_=e,this.text_=i.text,this.position_=new o.utils.Coordinate(0,0),this.isLabel_=n,this.callbackKey_=i.callbackKey||i.callbackkey,this.cssClass_=i["web-class"]||null,this.onMouseUpWrapper_=null,this.info=i},o.FlyoutButton.MARGIN_X=5,o.FlyoutButton.MARGIN_Y=2,o.FlyoutButton.prototype.width=0,o.FlyoutButton.prototype.height=0,o.FlyoutButton.prototype.createDom=function(){var t=this.isLabel_?"blocklyFlyoutLabel":"blocklyFlyoutButton";if(this.cssClass_&&(t+=" "+this.cssClass_),this.svgGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:t},this.workspace_.getCanvas()),!this.isLabel_)var e=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{class:"blocklyFlyoutButtonShadow",rx:4,ry:4,x:1,y:1},this.svgGroup_);t=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{class:this.isLabel_?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:4,ry:4},this.svgGroup_);var i=o.utils.dom.createSvgElement(o.utils.Svg.TEXT,{class:this.isLabel_?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup_),n=o.utils.replaceMessageReferences(this.text_);this.workspace_.RTL&&(n+=""),i.textContent=n,this.isLabel_&&(this.svgText_=i,this.workspace_.getThemeManager().subscribe(this.svgText_,"flyoutForegroundColour","fill"));var r=o.utils.style.getComputedStyle(i,"fontSize"),s=o.utils.style.getComputedStyle(i,"fontWeight"),a=o.utils.style.getComputedStyle(i,"fontFamily");return this.width=o.utils.dom.getFastTextWidthWithSizeString(i,r,s,a),n=o.utils.dom.measureFontMetrics(n,r,s,a),this.height=n.height,this.isLabel_||(this.width+=2*o.FlyoutButton.MARGIN_X,this.height+=2*o.FlyoutButton.MARGIN_Y,e.setAttribute("width",this.width),e.setAttribute("height",this.height)),t.setAttribute("width",this.width),t.setAttribute("height",this.height),i.setAttribute("x",this.width/2),i.setAttribute("y",this.height/2-n.height/2+n.baseline),this.updateTransform_(),this.onMouseUpWrapper_=o.bindEventWithChecks_(this.svgGroup_,"mouseup",this,this.onMouseUp_),this.svgGroup_},o.FlyoutButton.prototype.show=function(){this.updateTransform_(),this.svgGroup_.setAttribute("display","block")},o.FlyoutButton.prototype.updateTransform_=function(){this.svgGroup_.setAttribute("transform","translate("+this.position_.x+","+this.position_.y+")")},o.FlyoutButton.prototype.moveTo=function(t,e){this.position_.x=t,this.position_.y=e,this.updateTransform_()},o.FlyoutButton.prototype.isLabel=function(){return this.isLabel_},o.FlyoutButton.prototype.getPosition=function(){return this.position_},o.FlyoutButton.prototype.getButtonText=function(){return this.text_},o.FlyoutButton.prototype.getTargetWorkspace=function(){return this.targetWorkspace_},o.FlyoutButton.prototype.dispose=function(){this.onMouseUpWrapper_&&o.unbindEvent_(this.onMouseUpWrapper_),this.svgGroup_&&o.utils.dom.removeNode(this.svgGroup_),this.svgText_&&this.workspace_.getThemeManager().unsubscribe(this.svgText_)},o.FlyoutButton.prototype.onMouseUp_=function(t){(t=this.targetWorkspace_.getGesture(t))&&t.cancel(),this.isLabel_&&this.callbackKey_?console.warn("Labels should not have callbacks. Label text: "+this.text_):this.isLabel_||this.callbackKey_&&this.targetWorkspace_.getButtonCallback(this.callbackKey_)?this.isLabel_||this.targetWorkspace_.getButtonCallback(this.callbackKey_)(this):console.warn("Buttons should have callbacks. Button text: "+this.text_)},o.Css.register(".blocklyFlyoutButton {,fill: #888;,cursor: default;,},.blocklyFlyoutButtonShadow {,fill: #666;,},.blocklyFlyoutButton:hover {,fill: #aaa;,},.blocklyFlyoutLabel {,cursor: default;,},.blocklyFlyoutLabelBackground {,opacity: 0;,}".split(",")),o.Generator=function(t){this.name_=t,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")},o.Generator.NAME_TYPE="generated_function",o.Generator.prototype.INFINITE_LOOP_TRAP=null,o.Generator.prototype.STATEMENT_PREFIX=null,o.Generator.prototype.STATEMENT_SUFFIX=null,o.Generator.prototype.INDENT="  ",o.Generator.prototype.COMMENT_WRAP=60,o.Generator.prototype.ORDER_OVERRIDES=[],o.Generator.prototype.isInitialized=null,o.Generator.prototype.workspaceToCode=function(t){t||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),t=o.getMainWorkspace());var e=[];this.init(t),t=t.getTopBlocks(!0);for(var i,n=0;i=t[n];n++){var r=this.blockToCode(i);Array.isArray(r)&&(r=r[0]),r&&(i.outputConnection&&(r=this.scrubNakedValue(r),this.STATEMENT_PREFIX&&!i.suppressPrefixSuffix&&(r=this.injectId(this.STATEMENT_PREFIX,i)+r),this.STATEMENT_SUFFIX&&!i.suppressPrefixSuffix&&(r+=this.injectId(this.STATEMENT_SUFFIX,i))),e.push(r))}return e=e.join("\n"),(e=(e=(e=this.finish(e)).replace(/^\s+\n/,"")).replace(/\n\s+$/,"\n")).replace(/[ \t]+\n/g,"\n")},o.Generator.prototype.prefixLines=function(t,e){return e+t.replace(/(?!\n$)\n/g,"\n"+e)},o.Generator.prototype.allNestedComments=function(t){var e=[];t=t.getDescendants(!0);for(var o=0;o<t.length;o++){var i=t[o].getCommentText();i&&e.push(i)}return e.length&&e.push(""),e.join("\n")},o.Generator.prototype.blockToCode=function(t,e){if(!1===this.isInitialized&&console.warn("Generator init was not called before blockToCode was called."),!t)return"";if(!t.isEnabled())return e?"":this.blockToCode(t.getNextBlock());if(t.isInsertionMarker())return e?"":this.blockToCode(t.getChildren(!1)[0]);var o=this[t.type];if("function"!=typeof o)throw Error('Language "'+this.name_+'" does not know how to generate  code for block type "'+t.type+'".');if(o=o.call(t,t),Array.isArray(o)){if(!t.outputConnection)throw TypeError("Expecting string from statement block: "+t.type);return[this.scrub_(t,o[0],e),o[1]]}if("string"==typeof o)return this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(o=this.injectId(this.STATEMENT_PREFIX,t)+o),this.STATEMENT_SUFFIX&&!t.suppressPrefixSuffix&&(o+=this.injectId(this.STATEMENT_SUFFIX,t)),this.scrub_(t,o,e);if(null===o)return"";throw SyntaxError("Invalid code generated: "+o)},o.Generator.prototype.valueToCode=function(t,e,o){if(isNaN(o))throw TypeError("Expecting valid order from block: "+t.type);var i=t.getInputTargetBlock(e);if(!i)return"";if(""===(e=this.blockToCode(i)))return"";if(!Array.isArray(e))throw TypeError("Expecting tuple from value block: "+i.type);if(t=e[0],e=e[1],isNaN(e))throw TypeError("Expecting valid order from value block: "+i.type);if(!t)return"";i=!1;var n=Math.floor(o),r=Math.floor(e);if(n<=r&&(n!=r||0!=n&&99!=n))for(i=!0,n=0;n<this.ORDER_OVERRIDES.length;n++)if(this.ORDER_OVERRIDES[n][0]==o&&this.ORDER_OVERRIDES[n][1]==e){i=!1;break}return i&&(t="("+t+")"),t},o.Generator.prototype.statementToCode=function(t,e){if(t=t.getInputTargetBlock(e),"string"!=typeof(e=this.blockToCode(t)))throw TypeError("Expecting code from statement block: "+(t&&t.type));return e&&(e=this.prefixLines(e,this.INDENT)),e},o.Generator.prototype.addLoopTrap=function(t,e){return this.INFINITE_LOOP_TRAP&&(t=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,e),this.INDENT)+t),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(t=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,e),this.INDENT)+t),this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(t+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,e),this.INDENT)),t},o.Generator.prototype.injectId=function(t,e){return e=e.id.replace(/\$/g,"$$$$"),t.replace(/%1/g,"'"+e+"'")},o.Generator.prototype.RESERVED_WORDS_="",o.Generator.prototype.addReservedWords=function(t){this.RESERVED_WORDS_+=t+","},o.Generator.prototype.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",o.Generator.prototype.provideFunction_=function(t,e){if(!this.definitions_[t]){var i,n=this.variableDB_.getDistinctName(t,o.PROCEDURE_CATEGORY_NAME);for(this.functionNames_[t]=n,e=e.join("\n").replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,n);i!=e;)i=e,e=e.replace(/^(( {2})*) {2}/gm,"$1\0");e=e.replace(/\0/g,this.INDENT),this.definitions_[t]=e}return this.functionNames_[t]},o.Generator.prototype.init=function(t){},o.Generator.prototype.scrub_=function(t,e,o){return e},o.Generator.prototype.finish=function(t){return t},o.Generator.prototype.scrubNakedValue=function(t){return t},o.ToolboxItem=function(t,e,i){this.id_=t.toolboxitemid||o.utils.IdGenerator.getNextUniqueId(),this.level_=(this.parent_=i||null)?this.parent_.getLevel()+1:0,this.toolboxItemDef_=t,this.parentToolbox_=e,this.workspace_=this.parentToolbox_.getWorkspace()},o.ToolboxItem.prototype.init=function(){},o.ToolboxItem.prototype.getDiv=function(){return null},o.ToolboxItem.prototype.getId=function(){return this.id_},o.ToolboxItem.prototype.getParent=function(){return null},o.ToolboxItem.prototype.getLevel=function(){return this.level_},o.ToolboxItem.prototype.isSelectable=function(){return!1},o.ToolboxItem.prototype.isCollapsible=function(){return!1},o.ToolboxItem.prototype.dispose=function(){},o.ToolboxCategory=function(t,e,i){o.ToolboxCategory.superClass_.constructor.call(this,t,e,i),this.name_=o.utils.replaceMessageReferences(t.name),this.colour_=this.getColour_(t),this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null,this.cssConfig_=this.makeDefaultCssConfig_(),o.utils.object.mixin(this.cssConfig_,t.cssconfig||t.cssConfig),this.isDisabled_=this.isHidden_=!1,this.flyoutItems_=[],this.parseContents_(t)},o.utils.object.inherits(o.ToolboxCategory,o.ToolboxItem),o.ToolboxCategory.registrationName="category",o.ToolboxCategory.nestedPadding=19,o.ToolboxCategory.borderWidth=8,o.ToolboxCategory.defaultBackgroundColour="#57e",o.ToolboxCategory.prototype.makeDefaultCssConfig_=function(){return{container:"blocklyToolboxCategory",row:"blocklyTreeRow",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyTreeIcon",label:"blocklyTreeLabel",contents:"blocklyToolboxContents",selected:"blocklyTreeSelected",openicon:"blocklyTreeIconOpen",closedicon:"blocklyTreeIconClosed"}},o.ToolboxCategory.prototype.parseContents_=function(t){var e=t.contents;if(t.custom)this.flyoutItems_=t.custom;else if(e){t=0;for(var o;o=e[t];t++)this.flyoutItems_.push(o)}},o.ToolboxCategory.prototype.init=function(){this.createDom_(),"true"==this.toolboxItemDef_.hidden&&this.hide()},o.ToolboxCategory.prototype.createDom_=function(){return this.htmlDiv_=this.createContainer_(),o.utils.aria.setRole(this.htmlDiv_,o.utils.aria.Role.TREEITEM),o.utils.aria.setState(this.htmlDiv_,o.utils.aria.State.SELECTED,!1),o.utils.aria.setState(this.htmlDiv_,o.utils.aria.State.LEVEL,this.level_),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),o.utils.aria.setRole(this.iconDom_,o.utils.aria.Role.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_),o.utils.aria.setState(this.htmlDiv_,o.utils.aria.State.LABELLEDBY,this.labelDom_.getAttribute("id")),this.addColourBorder_(this.colour_),this.htmlDiv_},o.ToolboxCategory.prototype.createContainer_=function(){var t=document.createElement("div");return o.utils.dom.addClass(t,this.cssConfig_.container),t},o.ToolboxCategory.prototype.createRowContainer_=function(){var t=document.createElement("div");o.utils.dom.addClass(t,this.cssConfig_.row);var e=o.ToolboxCategory.nestedPadding*this.getLevel();return e=e.toString()+"px",this.workspace_.RTL?t.style.paddingRight=e:t.style.paddingLeft=e,t},o.ToolboxCategory.prototype.createRowContentsContainer_=function(){var t=document.createElement("div");return o.utils.dom.addClass(t,this.cssConfig_.rowcontentcontainer),t},o.ToolboxCategory.prototype.createIconDom_=function(){var t=document.createElement("span");return this.parentToolbox_.isHorizontal()||o.utils.dom.addClass(t,this.cssConfig_.icon),t.style.display="inline-block",t},o.ToolboxCategory.prototype.createLabelDom_=function(t){var e=document.createElement("span");return e.setAttribute("id",this.getId()+".label"),e.textContent=t,o.utils.dom.addClass(e,this.cssConfig_.label),e},o.ToolboxCategory.prototype.refreshTheme=function(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)},o.ToolboxCategory.prototype.addColourBorder_=function(t){t&&(t=o.ToolboxCategory.borderWidth+"px solid "+(t||"#ddd"),this.workspace_.RTL?this.rowDiv_.style.borderRight=t:this.rowDiv_.style.borderLeft=t)},o.ToolboxCategory.prototype.getColour_=function(t){var e=t.categorystyle||t.categoryStyle;return(t=t.colour)&&e?(console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour'),""):e?this.getColourfromStyle_(e):this.parseColour_(t)},o.ToolboxCategory.prototype.getColourfromStyle_=function(t){var e=this.workspace_.getTheme();if(t&&e){if((e=e.categoryStyles[t])&&e.colour)return this.parseColour_(e.colour);console.warn('Style "'+t+'" must exist and contain a colour value')}return""},o.ToolboxCategory.prototype.getClickTarget=function(){return this.rowDiv_},o.ToolboxCategory.prototype.parseColour_=function(t){if(null==(t=o.utils.replaceMessageReferences(t))||""===t)return"";var e=Number(t);return isNaN(e)?(e=o.utils.colour.parse(t))?e:(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+t),""):o.hueToHex(e)},o.ToolboxCategory.prototype.openIcon_=function(t){t&&(o.utils.dom.removeClasses(t,this.cssConfig_.closedicon),o.utils.dom.addClass(t,this.cssConfig_.openicon))},o.ToolboxCategory.prototype.closeIcon_=function(t){t&&(o.utils.dom.removeClasses(t,this.cssConfig_.openicon),o.utils.dom.addClass(t,this.cssConfig_.closedicon))},o.ToolboxCategory.prototype.setVisible_=function(t){this.htmlDiv_.style.display=t?"block":"none",this.isHidden_=!t,this.parentToolbox_.getSelectedItem()==this&&this.parentToolbox_.clearSelection()},o.ToolboxCategory.prototype.hide=function(){this.setVisible_(!1)},o.ToolboxCategory.prototype.show=function(){this.setVisible_(!0)},o.ToolboxCategory.prototype.isVisible=function(){return!this.isHidden_&&this.allAncestorsExpanded_()},o.ToolboxCategory.prototype.allAncestorsExpanded_=function(){for(var t=this;t.getParent();)if(!(t=t.getParent()).isExpanded())return!1;return!0},o.ToolboxCategory.prototype.isSelectable=function(){return this.isVisible()&&!this.isDisabled_},o.ToolboxCategory.prototype.onClick=function(t){},o.ToolboxCategory.prototype.setSelected=function(t){if(t){var e=this.parseColour_(o.ToolboxCategory.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||e,o.utils.dom.addClass(this.rowDiv_,this.cssConfig_.selected)}else this.rowDiv_.style.backgroundColor="",o.utils.dom.removeClass(this.rowDiv_,this.cssConfig_.selected);o.utils.aria.setState(this.htmlDiv_,o.utils.aria.State.SELECTED,t)},o.ToolboxCategory.prototype.setDisabled=function(t){this.isDisabled_=t,this.getDiv().setAttribute("disabled",t),t?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")},o.ToolboxCategory.prototype.getName=function(){return this.name_},o.ToolboxCategory.prototype.getParent=function(){return this.parent_},o.ToolboxCategory.prototype.getDiv=function(){return this.htmlDiv_},o.ToolboxCategory.prototype.getContents=function(){return this.flyoutItems_},o.ToolboxCategory.prototype.updateFlyoutContents=function(t){this.flyoutItems_=[],"string"==typeof t?this.toolboxItemDef_.custom=t:(delete this.toolboxItemDef_.custom,this.toolboxItemDef_.contents=o.utils.toolbox.convertFlyoutDefToJsonArray(t)),this.parseContents_(this.toolboxItemDef_)},o.ToolboxCategory.prototype.dispose=function(){o.utils.dom.removeNode(this.htmlDiv_)},o.Css.register([".blocklyTreeRow:not(.blocklyTreeSelected):hover {","background-color: rgba(255, 255, 255, 0.2);","}",'.blocklyToolboxDiv[layout="h"] .blocklyToolboxCategory {',"margin: 1px 5px 1px 0;","}",'.blocklyToolboxDiv[dir="RTL"][layout="h"] .blocklyToolboxCategory {',"margin: 1px 0 1px 5px;","}",".blocklyTreeRow {","height: 22px;","line-height: 22px;","margin-bottom: 3px;","padding-right: 8px;","white-space: nowrap;","}",'.blocklyToolboxDiv[dir="RTL"] .blocklyTreeRow {',"margin-left: 8px;","padding-right: 0px","}",".blocklyTreeIcon {","background-image: url(<<<PATH>>>/sprites.png);","height: 16px;","vertical-align: middle;","visibility: hidden;","width: 16px;","}",".blocklyTreeIconClosed {","background-position: -32px -1px;","}",'.blocklyToolboxDiv[dir="RTL"] .blocklyTreeIconClosed {',"background-position: 0 -1px;","}",".blocklyTreeSelected>.blocklyTreeIconClosed {","background-position: -32px -17px;","}",'.blocklyToolboxDiv[dir="RTL"] .blocklyTreeSelected>.blocklyTreeIconClosed {',"background-position: 0 -17px;","}",".blocklyTreeIconOpen {","background-position: -16px -1px;","}",".blocklyTreeSelected>.blocklyTreeIconOpen {","background-position: -16px -17px;","}",".blocklyTreeLabel {","cursor: default;","font: 16px sans-serif;","padding: 0 3px;","vertical-align: middle;","}",".blocklyToolboxDelete .blocklyTreeLabel {",'cursor: url("<<<PATH>>>/handdelete.cur"), auto;',"}",".blocklyTreeSelected .blocklyTreeLabel {","color: #fff;","}"]),o.registry.register(o.registry.Type.TOOLBOX_ITEM,o.ToolboxCategory.registrationName,o.ToolboxCategory),o.ToolboxSeparator=function(t,e){o.ToolboxSeparator.superClass_.constructor.call(this,t,e),this.cssConfig_={container:"blocklyTreeSeparator"},o.utils.object.mixin(this.cssConfig_,t.cssconfig||t.cssConfig)},o.utils.object.inherits(o.ToolboxSeparator,o.ToolboxItem),o.ToolboxSeparator.registrationName="sep",o.ToolboxSeparator.prototype.init=function(){this.createDom_()},o.ToolboxSeparator.prototype.createDom_=function(){var t=document.createElement("div");return o.utils.dom.addClass(t,this.cssConfig_.container),this.htmlDiv_=t},o.ToolboxSeparator.prototype.getDiv=function(){return this.htmlDiv_},o.ToolboxSeparator.prototype.dispose=function(){o.utils.dom.removeNode(this.htmlDiv_)},o.Css.register('.blocklyTreeSeparator {,border-bottom: solid #e5e5e5 1px;,height: 0;,margin: 5px 0;,},.blocklyToolboxDiv[layout="h"] .blocklyTreeSeparator {,border-right: solid #e5e5e5 1px;,border-bottom: none;,height: auto;,margin: 0 5px 0 5px;,padding: 5px 0;,width: 0;,}'.split(",")),o.registry.register(o.registry.Type.TOOLBOX_ITEM,o.ToolboxSeparator.registrationName,o.ToolboxSeparator),o.CollapsibleToolboxCategory=function(t,e,i){this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[],o.CollapsibleToolboxCategory.superClass_.constructor.call(this,t,e,i)},o.utils.object.inherits(o.CollapsibleToolboxCategory,o.ToolboxCategory),o.CollapsibleToolboxCategory.registrationName="collapsibleCategory",o.CollapsibleToolboxCategory.prototype.makeDefaultCssConfig_=function(){var t=o.CollapsibleToolboxCategory.superClass_.makeDefaultCssConfig_.call(this);return t.contents="blocklyToolboxContents",t},o.CollapsibleToolboxCategory.prototype.parseContents_=function(t){var e=t.contents,i=!0;if(t.custom)this.flyoutItems_=t.custom;else if(e){t=0;for(var n;n=e[t];t++)!o.registry.hasItem(o.registry.Type.TOOLBOX_ITEM,n.kind)||n.kind.toLowerCase()==o.ToolboxSeparator.registrationName&&i?(this.flyoutItems_.push(n),i=!0):(this.createToolboxItem_(n),i=!1)}},o.CollapsibleToolboxCategory.prototype.createToolboxItem_=function(t){var e=t.kind;"CATEGORY"==e.toUpperCase()&&o.utils.toolbox.isCategoryCollapsible(t)&&(e=o.CollapsibleToolboxCategory.registrationName),t=new(o.registry.getClass(o.registry.Type.TOOLBOX_ITEM,e))(t,this.parentToolbox_,this),this.toolboxItems_.push(t)},o.CollapsibleToolboxCategory.prototype.init=function(){o.CollapsibleToolboxCategory.superClass_.init.call(this),this.setExpanded("true"==this.toolboxItemDef_.expanded||this.toolboxItemDef_.expanded)},o.CollapsibleToolboxCategory.prototype.createDom_=function(){o.CollapsibleToolboxCategory.superClass_.createDom_.call(this);var t=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(t),o.utils.aria.setRole(this.subcategoriesDiv_,o.utils.aria.Role.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.htmlDiv_},o.CollapsibleToolboxCategory.prototype.createIconDom_=function(){var t=document.createElement("span");return this.parentToolbox_.isHorizontal()||(o.utils.dom.addClass(t,this.cssConfig_.icon),t.style.visibility="visible"),t.style.display="inline-block",t},o.CollapsibleToolboxCategory.prototype.createSubCategoriesDom_=function(t){var e=document.createElement("div");o.utils.dom.addClass(e,this.cssConfig_.contents);for(var i=0;i<t.length;i++){var n=t[i];n.init();var r=n.getDiv();e.appendChild(r),n.getClickTarget&&n.getClickTarget().setAttribute("id",n.getId())}return e},o.CollapsibleToolboxCategory.prototype.setExpanded=function(t){this.expanded_!=t&&((this.expanded_=t)?(this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_)):(this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)),o.utils.aria.setState(this.htmlDiv_,o.utils.aria.State.EXPANDED,t),this.parentToolbox_.handleToolboxItemResize())},o.CollapsibleToolboxCategory.prototype.setVisible_=function(t){this.htmlDiv_.style.display=t?"block":"none";for(var e,o=0;e=this.getChildToolboxItems()[o];o++)e.setVisible_(t);this.isHidden_=!t,this.parentToolbox_.getSelectedItem()==this&&this.parentToolbox_.clearSelection()},o.CollapsibleToolboxCategory.prototype.isExpanded=function(){return this.expanded_},o.CollapsibleToolboxCategory.prototype.isCollapsible=function(){return!0},o.CollapsibleToolboxCategory.prototype.onClick=function(t){this.toggleExpanded()},o.CollapsibleToolboxCategory.prototype.toggleExpanded=function(){this.setExpanded(!this.expanded_)},o.CollapsibleToolboxCategory.prototype.getDiv=function(){return this.htmlDiv_},o.CollapsibleToolboxCategory.prototype.getChildToolboxItems=function(){return this.toolboxItems_},o.registry.register(o.registry.Type.TOOLBOX_ITEM,o.CollapsibleToolboxCategory.registrationName,o.CollapsibleToolboxCategory),o.Events.ToolboxItemSelect=function(t,e,i){o.Events.ToolboxItemSelect.superClass_.constructor.call(this,i),this.oldItem=t,this.newItem=e},o.utils.object.inherits(o.Events.ToolboxItemSelect,o.Events.UiBase),o.Events.ToolboxItemSelect.prototype.type=o.Events.TOOLBOX_ITEM_SELECT,o.Events.ToolboxItemSelect.prototype.toJson=function(){var t=o.Events.ToolboxItemSelect.superClass_.toJson.call(this);return t.oldItem=this.oldItem,t.newItem=this.newItem,t},o.Events.ToolboxItemSelect.prototype.fromJson=function(t){o.Events.ToolboxItemSelect.superClass_.fromJson.call(this,t),this.oldItem=t.oldItem,this.newItem=t.newItem},o.registry.register(o.registry.Type.EVENT,o.Events.TOOLBOX_ITEM_SELECT,o.Events.ToolboxItemSelect),o.Toolbox=function(t){this.workspace_=t,this.toolboxDef_=t.options.languageTree||{contents:[]},this.horizontalLayout_=t.options.horizontalLayout,this.contentsDiv_=this.HtmlDiv=null,this.contents_=[],this.height_=this.width_=0,this.RTL=t.options.RTL,this.flyout_=null,this.contentMap_={},this.toolboxPosition=t.options.toolboxPosition,this.previouslySelectedItem_=this.selectedItem_=null,this.boundEvents_=[]},o.Toolbox.prototype.init=function(){var t=this.workspace_,e=t.getParentSvg();this.flyout_=this.createFlyout_(),this.HtmlDiv=this.createDom_(this.workspace_),o.utils.dom.insertAfter(this.flyout_.createDom("svg"),e),this.flyout_.init(t),this.render(this.toolboxDef_),(t=t.getThemeManager()).subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color"),t.subscribe(this.HtmlDiv,"toolboxForegroundColour","color")},o.Toolbox.prototype.createDom_=function(t){t=t.getParentSvg();var e=this.createContainer_();return this.contentsDiv_=this.createContentsContainer_(),this.contentsDiv_.tabIndex=0,o.utils.aria.setRole(this.contentsDiv_,o.utils.aria.Role.TREE),e.appendChild(this.contentsDiv_),t.parentNode.insertBefore(e,t),this.attachEvents_(e,this.contentsDiv_),e},o.Toolbox.prototype.createContainer_=function(){var t=document.createElement("div");return t.setAttribute("layout",this.isHorizontal()?"h":"v"),o.utils.dom.addClass(t,"blocklyToolboxDiv"),o.utils.dom.addClass(t,"blocklyNonSelectable"),t.setAttribute("dir",this.RTL?"RTL":"LTR"),t},o.Toolbox.prototype.createContentsContainer_=function(){var t=document.createElement("div");return o.utils.dom.addClass(t,"blocklyToolboxContents"),this.isHorizontal()&&(t.style.flexDirection="row"),t},o.Toolbox.prototype.attachEvents_=function(t,e){t=o.bindEventWithChecks_(t,"click",this,this.onClick_,!1,!0),this.boundEvents_.push(t),e=o.bindEventWithChecks_(e,"keydown",this,this.onKeyDown_,!1,!0),this.boundEvents_.push(e)},o.Toolbox.prototype.onClick_=function(t){if(o.utils.isRightButton(t)||t.target==this.HtmlDiv)o.hideChaff(!1);else{var e=t.target.getAttribute("id");e&&(e=this.getToolboxItemById(e)).isSelectable()&&(this.setSelectedItem(e),e.onClick(t)),o.hideChaff(!0)}o.Touch.clearTouchIdentifier()},o.Toolbox.prototype.onKeyDown_=function(t){var e=!1;switch(t.keyCode){case o.utils.KeyCodes.DOWN:e=this.selectNext_();break;case o.utils.KeyCodes.UP:e=this.selectPrevious_();break;case o.utils.KeyCodes.LEFT:e=this.selectParent_();break;case o.utils.KeyCodes.RIGHT:e=this.selectChild_();break;case o.utils.KeyCodes.ENTER:case o.utils.KeyCodes.SPACE:this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),e=!0);break;default:e=!1}!e&&this.selectedItem_&&this.selectedItem_.onKeyDown&&(e=this.selectedItem_.onKeyDown(t)),e&&t.preventDefault()},o.Toolbox.prototype.createFlyout_=function(){var t=this.workspace_,e=new o.Options({parentWorkspace:t,rtl:t.RTL,oneBasedIndex:t.options.oneBasedIndex,horizontalLayout:t.horizontalLayout,renderer:t.options.renderer,rendererOverrides:t.options.rendererOverrides});if(e.toolboxPosition=t.options.toolboxPosition,!(t=t.horizontalLayout?o.registry.getClassFromOptions(o.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,t.options):o.registry.getClassFromOptions(o.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,t.options)))throw Error("Blockly.VerticalFlyout, Blockly.HorizontalFlyout or your own custom flyout must be required.");return new t(e)},o.Toolbox.prototype.render=function(t){this.toolboxDef_=t;for(var e=0;e<this.contents_.length;e++){var o=this.contents_[e];o&&o.dispose()}this.contents_=[],this.contentMap_={},this.renderContents_(t.contents),this.position()},o.Toolbox.prototype.renderContents_=function(t){for(var e,o=document.createDocumentFragment(),i=0;e=t[i];i++)this.createToolboxItem_(e,o);this.contentsDiv_.appendChild(o)},o.Toolbox.prototype.createToolboxItem_=function(t,e){var i=t.kind;"CATEGORY"==i.toUpperCase()&&o.utils.toolbox.isCategoryCollapsible(t)&&(i=o.CollapsibleToolboxCategory.registrationName),(i=o.registry.getClass(o.registry.Type.TOOLBOX_ITEM,i.toLowerCase()))&&(t=new i(t,this),this.addToolboxItem_(t),t.init(),(i=t.getDiv())&&e.appendChild(i),t.getClickTarget&&t.getClickTarget().setAttribute("id",t.getId()))},o.Toolbox.prototype.addToolboxItem_=function(t){if(this.contents_.push(t),this.contentMap_[t.getId()]=t,t.isCollapsible())for(var e,o=0;e=t.getChildToolboxItems()[o];o++)this.addToolboxItem_(e)},o.Toolbox.prototype.getToolboxItems=function(){return this.contents_},o.Toolbox.prototype.addStyle=function(t){o.utils.dom.addClass(this.HtmlDiv,t)},o.Toolbox.prototype.removeStyle=function(t){o.utils.dom.removeClass(this.HtmlDiv,t)},o.Toolbox.prototype.getClientRect=function(){if(!this.HtmlDiv)return null;var t=this.HtmlDiv.getBoundingClientRect(),e=t.top,i=e+t.height,n=t.left;return t=n+t.width,this.toolboxPosition==o.utils.toolbox.Position.TOP?new o.utils.Rect(-1e7,i,-1e7,1e7):this.toolboxPosition==o.utils.toolbox.Position.BOTTOM?new o.utils.Rect(e,1e7,-1e7,1e7):this.toolboxPosition==o.utils.toolbox.Position.LEFT?new o.utils.Rect(-1e7,1e7,-1e7,t):new o.utils.Rect(-1e7,1e7,n,1e7)},o.Toolbox.prototype.getToolboxItemById=function(t){return this.contentMap_[t]},o.Toolbox.prototype.getWidth=function(){return this.width_},o.Toolbox.prototype.getHeight=function(){return this.height_},o.Toolbox.prototype.getFlyout=function(){return this.flyout_},o.Toolbox.prototype.getWorkspace=function(){return this.workspace_},o.Toolbox.prototype.getSelectedItem=function(){return this.selectedItem_},o.Toolbox.prototype.getPreviouslySelectedItem=function(){return this.previouslySelectedItem_},o.Toolbox.prototype.isHorizontal=function(){return this.horizontalLayout_},o.Toolbox.prototype.position=function(){var t=this.HtmlDiv;t&&(this.horizontalLayout_?(t.style.left="0",t.style.height="auto",t.style.width="100%",this.height_=t.offsetHeight,this.toolboxPosition==o.TOOLBOX_AT_TOP?t.style.top="0":t.style.bottom="0"):(this.toolboxPosition==o.TOOLBOX_AT_RIGHT?t.style.right="0":t.style.left="0",t.style.height="100%",this.width_=t.offsetWidth),this.flyout_.position())},o.Toolbox.prototype.handleToolboxItemResize=function(){var t=this.workspace_,e=this.HtmlDiv.getBoundingClientRect();t.translate(this.toolboxPosition==o.TOOLBOX_AT_LEFT?t.scrollX+e.width:t.scrollX,this.toolboxPosition==o.TOOLBOX_AT_TOP?t.scrollY+e.height:t.scrollY),o.svgResize(t)},o.Toolbox.prototype.clearSelection=function(){this.setSelectedItem(null)},o.Toolbox.prototype.refreshTheme=function(){for(var t=0;t<this.contents_.length;t++){var e=this.contents_[t];e.refreshTheme&&e.refreshTheme()}},o.Toolbox.prototype.refreshSelection=function(){this.selectedItem_&&this.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout_.show(this.selectedItem_.getContents())},o.Toolbox.prototype.setVisible=function(t){this.HtmlDiv.style.display=t?"block":"none"},o.Toolbox.prototype.setSelectedItem=function(t){var e=this.selectedItem_;!t&&!e||t&&!t.isSelectable()||(this.shouldDeselectItem_(e,t)&&null!=e&&this.deselectItem_(e),this.shouldSelectItem_(e,t)&&null!=t&&this.selectItem_(e,t),this.updateFlyout_(e,t),this.fireSelectEvent_(e,t))},o.Toolbox.prototype.shouldDeselectItem_=function(t,e){return null!=t&&(!t.isCollapsible()||t!=e)},o.Toolbox.prototype.shouldSelectItem_=function(t,e){return null!=e&&e!=t},o.Toolbox.prototype.deselectItem_=function(t){this.selectedItem_=null,this.previouslySelectedItem_=t,t.setSelected(!1),o.utils.aria.setState(this.contentsDiv_,o.utils.aria.State.ACTIVEDESCENDANT,"")},o.Toolbox.prototype.selectItem_=function(t,e){this.selectedItem_=e,this.previouslySelectedItem_=t,e.setSelected(!0),o.utils.aria.setState(this.contentsDiv_,o.utils.aria.State.ACTIVEDESCENDANT,e.getId())},o.Toolbox.prototype.selectItemByPosition=function(t){-1<t&&t<this.contents_.length&&(t=this.contents_[t]).isSelectable()&&this.setSelectedItem(t)},o.Toolbox.prototype.updateFlyout_=function(t,e){(t!=e||e.isCollapsible())&&e&&e.getContents().length?(this.flyout_.show(e.getContents()),this.flyout_.scrollToStart()):this.flyout_.hide()},o.Toolbox.prototype.fireSelectEvent_=function(t,e){var i=t&&t.getName(),n=e&&e.getName();t==e&&(n=null),t=new o.Events.ToolboxItemSelect(i,n,this.workspace_.id),o.Events.fire(t)},o.Toolbox.prototype.onBlocklyAction=function(t){if(!this.selectedItem_)return!1;switch(t.name){case o.navigation.actionNames.PREVIOUS:return this.selectPrevious_();case o.navigation.actionNames.OUT:return this.selectParent_();case o.navigation.actionNames.NEXT:return this.selectNext_();case o.navigation.actionNames.IN:return this.selectChild_();default:return!1}},o.Toolbox.prototype.selectParent_=function(){return!(!this.selectedItem_||(this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.setExpanded(!1),0):!this.selectedItem_.getParent()||!this.selectedItem_.getParent().isSelectable()||(this.setSelectedItem(this.selectedItem_.getParent()),0)))},o.Toolbox.prototype.selectChild_=function(){if(!this.selectedItem_||!this.selectedItem_.isCollapsible())return!1;var t=this.selectedItem_;return t.isExpanded()?this.selectNext_():t.setExpanded(!0),!0},o.Toolbox.prototype.selectNext_=function(){if(!this.selectedItem_)return!1;var t=this.contents_.indexOf(this.selectedItem_)+1;if(-1<t&&t<this.contents_.length){for(var e=this.contents_[t];e&&!e.isSelectable();)e=this.contents_[++t];if(e&&e.isSelectable())return this.setSelectedItem(e),!0}return!1},o.Toolbox.prototype.selectPrevious_=function(){if(!this.selectedItem_)return!1;var t=this.contents_.indexOf(this.selectedItem_)-1;if(-1<t&&t<this.contents_.length){for(var e=this.contents_[t];e&&!e.isSelectable();)e=this.contents_[--t];if(e&&e.isSelectable())return this.setSelectedItem(e),!0}return!1},o.Toolbox.prototype.dispose=function(){this.flyout_.dispose();for(var t=0;t<this.contents_.length;t++)this.contents_[t].dispose();for(t=0;t<this.boundEvents_.length;t++)o.unbindEvent_(this.boundEvents_[t]);this.boundEvents_=[],this.contents_=[],this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv),o.utils.dom.removeNode(this.HtmlDiv)},o.Css.register([".blocklyToolboxDelete {",'cursor: url("<<<PATH>>>/handdelete.cur"), auto;',"}",".blocklyToolboxGrab {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyToolboxDiv {","background-color: #ddd;","overflow-x: visible;","overflow-y: auto;","padding: 4px 0 4px 0;","position: absolute;","z-index: 70;","-webkit-tap-highlight-color: transparent;","}",".blocklyToolboxContents {","display: flex;","flex-wrap: wrap;","flex-direction: column;","}",".blocklyToolboxContents:focus {","outline: none;","}"]),o.registry.register(o.registry.Type.TOOLBOX,o.registry.DEFAULT,o.Toolbox),o.Events.TrashcanOpen=function(t,e){o.Events.TrashcanOpen.superClass_.constructor.call(this,e),this.isOpen=t},o.utils.object.inherits(o.Events.TrashcanOpen,o.Events.UiBase),o.Events.TrashcanOpen.prototype.type=o.Events.TRASHCAN_OPEN,o.Events.TrashcanOpen.prototype.toJson=function(){var t=o.Events.TrashcanOpen.superClass_.toJson.call(this);return t.isOpen=this.isOpen,t},o.Events.TrashcanOpen.prototype.fromJson=function(t){o.Events.TrashcanOpen.superClass_.fromJson.call(this,t),this.isOpen=t.isOpen},o.registry.register(o.registry.Type.EVENT,o.Events.TRASHCAN_OPEN,o.Events.TrashcanOpen),o.Trashcan=function(t){if(this.workspace_=t,this.contents_=[],this.flyout=null,!(0>=this.workspace_.options.maxTrashcanContents)){if(t=new o.Options({scrollbars:!0,parentWorkspace:this.workspace_,rtl:this.workspace_.RTL,oneBasedIndex:this.workspace_.options.oneBasedIndex,renderer:this.workspace_.options.renderer,rendererOverrides:this.workspace_.options.rendererOverrides}),this.workspace_.horizontalLayout){if(t.toolboxPosition=this.workspace_.toolboxPosition==o.utils.toolbox.Position.TOP?o.utils.toolbox.Position.BOTTOM:o.utils.toolbox.Position.TOP,!o.HorizontalFlyout)throw Error("Missing require for Blockly.HorizontalFlyout");this.flyout=new o.HorizontalFlyout(t)}else{if(t.toolboxPosition=this.workspace_.toolboxPosition==o.utils.toolbox.Position.RIGHT?o.utils.toolbox.Position.LEFT:o.utils.toolbox.Position.RIGHT,!o.VerticalFlyout)throw Error("Missing require for Blockly.VerticalFlyout");this.flyout=new o.VerticalFlyout(t)}this.workspace_.addChangeListener(this.onDelete_.bind(this))}},o.Trashcan.prototype.WIDTH_=47,o.Trashcan.prototype.BODY_HEIGHT_=44,o.Trashcan.prototype.LID_HEIGHT_=16,o.Trashcan.prototype.MARGIN_BOTTOM_=20,o.Trashcan.prototype.MARGIN_SIDE_=20,o.Trashcan.prototype.MARGIN_HOTSPOT_=10,o.Trashcan.prototype.SPRITE_LEFT_=0,o.Trashcan.prototype.SPRITE_TOP_=32,o.Trashcan.prototype.HAS_BLOCKS_LID_ANGLE_=.1,o.Trashcan.ANIMATION_LENGTH_=80,o.Trashcan.ANIMATION_FRAMES_=4,o.Trashcan.OPACITY_MIN_=.4,o.Trashcan.OPACITY_MAX_=.8,o.Trashcan.MAX_LID_ANGLE_=45,o.Trashcan.prototype.isLidOpen=!1,o.Trashcan.prototype.minOpenness_=0,o.Trashcan.prototype.svgGroup_=null,o.Trashcan.prototype.svgLid_=null,o.Trashcan.prototype.lidTask_=0,o.Trashcan.prototype.lidOpen_=0,o.Trashcan.prototype.left_=0,o.Trashcan.prototype.top_=0,o.Trashcan.prototype.createDom=function(){this.svgGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:"blocklyTrash"},null);var t=String(Math.random()).substring(2),e=o.utils.dom.createSvgElement(o.utils.Svg.CLIPPATH,{id:"blocklyTrashBodyClipPath"+t},this.svgGroup_);o.utils.dom.createSvgElement(o.utils.Svg.RECT,{width:this.WIDTH_,height:this.BODY_HEIGHT_,y:this.LID_HEIGHT_},e);var i=o.utils.dom.createSvgElement(o.utils.Svg.IMAGE,{width:o.SPRITE.width,x:-this.SPRITE_LEFT_,height:o.SPRITE.height,y:-this.SPRITE_TOP_,"clip-path":"url(#blocklyTrashBodyClipPath"+t+")"},this.svgGroup_);return i.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+o.SPRITE.url),e=o.utils.dom.createSvgElement(o.utils.Svg.CLIPPATH,{id:"blocklyTrashLidClipPath"+t},this.svgGroup_),o.utils.dom.createSvgElement(o.utils.Svg.RECT,{width:this.WIDTH_,height:this.LID_HEIGHT_},e),this.svgLid_=o.utils.dom.createSvgElement(o.utils.Svg.IMAGE,{width:o.SPRITE.width,x:-this.SPRITE_LEFT_,height:o.SPRITE.height,y:-this.SPRITE_TOP_,"clip-path":"url(#blocklyTrashLidClipPath"+t+")"},this.svgGroup_),this.svgLid_.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+o.SPRITE.url),o.bindEvent_(this.svgGroup_,"mousedown",this,this.blockMouseDownWhenOpenable_),o.bindEvent_(this.svgGroup_,"mouseup",this,this.click),o.bindEvent_(i,"mouseover",this,this.mouseOver_),o.bindEvent_(i,"mouseout",this,this.mouseOut_),this.animateLid_(),this.svgGroup_},o.Trashcan.prototype.init=function(t){return 0<this.workspace_.options.maxTrashcanContents&&(o.utils.dom.insertAfter(this.flyout.createDom(o.utils.Svg.SVG),this.workspace_.getParentSvg()),this.flyout.init(this.workspace_)),this.verticalSpacing_=this.MARGIN_BOTTOM_+t,this.setLidOpen(!1),this.verticalSpacing_+this.BODY_HEIGHT_+this.LID_HEIGHT_},o.Trashcan.prototype.dispose=function(){this.svgGroup_&&(o.utils.dom.removeNode(this.svgGroup_),this.svgGroup_=null),this.workspace_=this.svgLid_=null,clearTimeout(this.lidTask_)},o.Trashcan.prototype.hasContents_=function(){return!!this.contents_.length},o.Trashcan.prototype.contentsIsOpen=function(){return this.flyout.isVisible()},o.Trashcan.prototype.openFlyout=function(){if(!this.contentsIsOpen()){for(var t,e=[],i=0;t=this.contents_[i];i++)e[i]=o.Xml.textToDom(t);this.flyout.show(e),this.fireUiEvent_(!0)}},o.Trashcan.prototype.closeFlyout=function(){this.contentsIsOpen()&&(this.flyout.hide(),this.fireUiEvent_(!1))},o.Trashcan.prototype.emptyContents=function(){this.hasContents_()&&(this.contents_.length=0,this.setMinOpenness_(0),this.closeFlyout())},o.Trashcan.prototype.position=function(){if(this.verticalSpacing_){var t=this.workspace_.getMetrics();t&&(this.left_=t.toolboxPosition==o.TOOLBOX_AT_LEFT||this.workspace_.horizontalLayout&&!this.workspace_.RTL?t.viewWidth+t.absoluteLeft-this.WIDTH_-this.MARGIN_SIDE_-o.Scrollbar.scrollbarThickness:this.MARGIN_SIDE_+o.Scrollbar.scrollbarThickness,this.top_=t.toolboxPosition==o.TOOLBOX_AT_BOTTOM?this.verticalSpacing_:t.viewHeight+t.absoluteTop-(this.BODY_HEIGHT_+this.LID_HEIGHT_)-this.verticalSpacing_,this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")"))}},o.Trashcan.prototype.getClientRect=function(){if(!this.svgGroup_)return null;var t=this.svgGroup_.getBoundingClientRect(),e=t.top+this.SPRITE_TOP_-this.MARGIN_HOTSPOT_;return t=t.left+this.SPRITE_LEFT_-this.MARGIN_HOTSPOT_,new o.utils.Rect(e,e+this.LID_HEIGHT_+this.BODY_HEIGHT_+2*this.MARGIN_HOTSPOT_,t,t+this.WIDTH_+2*this.MARGIN_HOTSPOT_)},o.Trashcan.prototype.setLidOpen=function(t){this.isLidOpen!=t&&(clearTimeout(this.lidTask_),this.isLidOpen=t,this.animateLid_())},o.Trashcan.prototype.animateLid_=function(){var t=o.Trashcan.ANIMATION_FRAMES_,e=1/(t+1);this.lidOpen_+=this.isLidOpen?e:-e,this.lidOpen_=Math.min(Math.max(this.lidOpen_,this.minOpenness_),1),this.setLidAngle_(this.lidOpen_*o.Trashcan.MAX_LID_ANGLE_),e=o.Trashcan.OPACITY_MIN_,this.svgGroup_.style.opacity=e+this.lidOpen_*(o.Trashcan.OPACITY_MAX_-e),this.lidOpen_>this.minOpenness_&&1>this.lidOpen_&&(this.lidTask_=setTimeout(this.animateLid_.bind(this),o.Trashcan.ANIMATION_LENGTH_/t))},o.Trashcan.prototype.setLidAngle_=function(t){var e=this.workspace_.toolboxPosition==o.TOOLBOX_AT_RIGHT||this.workspace_.horizontalLayout&&this.workspace_.RTL;this.svgLid_.setAttribute("transform","rotate("+(e?-t:t)+","+(e?4:this.WIDTH_-4)+","+(this.LID_HEIGHT_-2)+")")},o.Trashcan.prototype.setMinOpenness_=function(t){this.minOpenness_=t,this.isLidOpen||this.setLidAngle_(t*o.Trashcan.MAX_LID_ANGLE_)},o.Trashcan.prototype.closeLid=function(){this.setLidOpen(!1)},o.Trashcan.prototype.click=function(){this.hasContents_()&&this.openFlyout()},o.Trashcan.prototype.fireUiEvent_=function(t){t=new o.Events.TrashcanOpen(t,this.workspace_.id),o.Events.fire(t)},o.Trashcan.prototype.blockMouseDownWhenOpenable_=function(t){!this.contentsIsOpen()&&this.hasContents_()&&t.stopPropagation()},o.Trashcan.prototype.mouseOver_=function(){this.hasContents_()&&this.setLidOpen(!0)},o.Trashcan.prototype.mouseOut_=function(){this.setLidOpen(!1)},o.Trashcan.prototype.onDelete_=function(t){if(!(0>=this.workspace_.options.maxTrashcanContents)&&t.type==o.Events.BLOCK_DELETE&&t.oldXml.tagName&&"shadow"!=t.oldXml.tagName.toLowerCase()&&(t=this.cleanBlockXML_(t.oldXml),-1==this.contents_.indexOf(t))){for(this.contents_.unshift(t);this.contents_.length>this.workspace_.options.maxTrashcanContents;)this.contents_.pop();this.setMinOpenness_(this.HAS_BLOCKS_LID_ANGLE_)}},o.Trashcan.prototype.cleanBlockXML_=function(t){for(var e=t=t.cloneNode(!0);e;){e.removeAttribute&&(e.removeAttribute("x"),e.removeAttribute("y"),e.removeAttribute("id"),e.removeAttribute("disabled"),"comment"==e.nodeName&&(e.removeAttribute("h"),e.removeAttribute("w"),e.removeAttribute("pinned")));var i=e.firstChild||e.nextSibling;if(!i)for(i=e.parentNode;i;){if(i.nextSibling){i=i.nextSibling;break}i=i.parentNode}e=i}return o.Xml.domToText(t)},o.VariablesDynamic={},o.VariablesDynamic.onCreateVariableButtonClick_String=function(t){o.Variables.createVariableButtonHandler(t.getTargetWorkspace(),void 0,"String")},o.VariablesDynamic.onCreateVariableButtonClick_Number=function(t){o.Variables.createVariableButtonHandler(t.getTargetWorkspace(),void 0,"Number")},o.VariablesDynamic.onCreateVariableButtonClick_Colour=function(t){o.Variables.createVariableButtonHandler(t.getTargetWorkspace(),void 0,"Colour")},o.VariablesDynamic.flyoutCategory=function(t){var e=[],i=document.createElement("button");return i.setAttribute("text",o.Msg.NEW_STRING_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_STRING"),e.push(i),(i=document.createElement("button")).setAttribute("text",o.Msg.NEW_NUMBER_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER"),e.push(i),(i=document.createElement("button")).setAttribute("text",o.Msg.NEW_COLOUR_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR"),e.push(i),t.registerButtonCallback("CREATE_VARIABLE_STRING",o.VariablesDynamic.onCreateVariableButtonClick_String),t.registerButtonCallback("CREATE_VARIABLE_NUMBER",o.VariablesDynamic.onCreateVariableButtonClick_Number),t.registerButtonCallback("CREATE_VARIABLE_COLOUR",o.VariablesDynamic.onCreateVariableButtonClick_Colour),t=o.VariablesDynamic.flyoutCategoryBlocks(t),e.concat(t)},o.VariablesDynamic.flyoutCategoryBlocks=function(t){var e=[];if(0<(t=t.getAllVariables()).length){if(o.Blocks.variables_set_dynamic){var i=t[t.length-1],n=o.utils.xml.createElement("block");n.setAttribute("type","variables_set_dynamic"),n.setAttribute("gap",24),n.appendChild(o.Variables.generateVariableFieldDom(i)),e.push(n)}if(o.Blocks.variables_get_dynamic){t.sort(o.VariableModel.compareByName),i=0;for(var r;r=t[i];i++)(n=o.utils.xml.createElement("block")).setAttribute("type","variables_get_dynamic"),n.setAttribute("gap",8),n.appendChild(o.Variables.generateVariableFieldDom(r)),e.push(n)}}return e},o.ZoomControls=function(t){this.workspace_=t,this.zoomResetGroup_=this.zoomOutGroup_=this.zoomInGroup_=this.verticalSpacing_=this.onZoomOutWrapper_=this.onZoomInWrapper_=this.onZoomResetWrapper_=null},o.ZoomControls.prototype.WIDTH_=32,o.ZoomControls.prototype.HEIGHT_=110,o.ZoomControls.prototype.MARGIN_BOTTOM_=20,o.ZoomControls.prototype.MARGIN_SIDE_=20,o.ZoomControls.prototype.svgGroup_=null,o.ZoomControls.prototype.left_=0,o.ZoomControls.prototype.top_=0,o.ZoomControls.prototype.createDom=function(){this.svgGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{},null);var t=String(Math.random()).substring(2);return this.createZoomOutSvg_(t),this.createZoomInSvg_(t),this.workspace_.isMovable()&&this.createZoomResetSvg_(t),this.svgGroup_},o.ZoomControls.prototype.init=function(t){return this.verticalSpacing_=this.MARGIN_BOTTOM_+t,this.verticalSpacing_+this.HEIGHT_},o.ZoomControls.prototype.dispose=function(){this.svgGroup_&&o.utils.dom.removeNode(this.svgGroup_),this.onZoomResetWrapper_&&o.unbindEvent_(this.onZoomResetWrapper_),this.onZoomInWrapper_&&o.unbindEvent_(this.onZoomInWrapper_),this.onZoomOutWrapper_&&o.unbindEvent_(this.onZoomOutWrapper_)},o.ZoomControls.prototype.position=function(){if(this.verticalSpacing_){var t=this.workspace_.getMetrics();t&&(this.left_=t.toolboxPosition==o.TOOLBOX_AT_LEFT||this.workspace_.horizontalLayout&&!this.workspace_.RTL?t.viewWidth+t.absoluteLeft-this.WIDTH_-this.MARGIN_SIDE_-o.Scrollbar.scrollbarThickness:this.MARGIN_SIDE_+o.Scrollbar.scrollbarThickness,t.toolboxPosition==o.TOOLBOX_AT_BOTTOM?(this.top_=this.verticalSpacing_,this.zoomInGroup_.setAttribute("transform","translate(0, 34)"),this.zoomResetGroup_&&this.zoomResetGroup_.setAttribute("transform","translate(0, 77)")):(this.top_=t.viewHeight+t.absoluteTop-this.HEIGHT_-this.verticalSpacing_,this.zoomInGroup_.setAttribute("transform","translate(0, 43)"),this.zoomOutGroup_.setAttribute("transform","translate(0, 77)")),this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")"))}},o.ZoomControls.prototype.createZoomOutSvg_=function(t){this.zoomOutGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:"blocklyZoom"},this.svgGroup_);var e=o.utils.dom.createSvgElement(o.utils.Svg.CLIPPATH,{id:"blocklyZoomoutClipPath"+t},this.zoomOutGroup_);o.utils.dom.createSvgElement(o.utils.Svg.RECT,{width:32,height:32},e),o.utils.dom.createSvgElement(o.utils.Svg.IMAGE,{width:o.SPRITE.width,height:o.SPRITE.height,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+t+")"},this.zoomOutGroup_).setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+o.SPRITE.url),this.onZoomOutWrapper_=o.bindEventWithChecks_(this.zoomOutGroup_,"mousedown",null,this.zoom_.bind(this,-1))},o.ZoomControls.prototype.createZoomInSvg_=function(t){this.zoomInGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:"blocklyZoom"},this.svgGroup_);var e=o.utils.dom.createSvgElement(o.utils.Svg.CLIPPATH,{id:"blocklyZoominClipPath"+t},this.zoomInGroup_);o.utils.dom.createSvgElement(o.utils.Svg.RECT,{width:32,height:32},e),o.utils.dom.createSvgElement(o.utils.Svg.IMAGE,{width:o.SPRITE.width,height:o.SPRITE.height,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+t+")"},this.zoomInGroup_).setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+o.SPRITE.url),this.onZoomInWrapper_=o.bindEventWithChecks_(this.zoomInGroup_,"mousedown",null,this.zoom_.bind(this,1))},o.ZoomControls.prototype.zoom_=function(t,e){this.workspace_.markFocused(),this.workspace_.zoomCenter(t),this.fireZoomEvent_(),o.Touch.clearTouchIdentifier(),e.stopPropagation(),e.preventDefault()},o.ZoomControls.prototype.createZoomResetSvg_=function(t){this.zoomResetGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:"blocklyZoom"},this.svgGroup_);var e=o.utils.dom.createSvgElement(o.utils.Svg.CLIPPATH,{id:"blocklyZoomresetClipPath"+t},this.zoomResetGroup_);o.utils.dom.createSvgElement(o.utils.Svg.RECT,{width:32,height:32},e),o.utils.dom.createSvgElement(o.utils.Svg.IMAGE,{width:o.SPRITE.width,height:o.SPRITE.height,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+t+")"},this.zoomResetGroup_).setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+o.SPRITE.url),this.onZoomResetWrapper_=o.bindEventWithChecks_(this.zoomResetGroup_,"mousedown",null,this.resetZoom_.bind(this))},o.ZoomControls.prototype.resetZoom_=function(t){this.workspace_.markFocused(),this.workspace_.setScale(this.workspace_.options.zoomOptions.startScale),this.workspace_.beginCanvasTransition(),this.workspace_.scrollCenter(),setTimeout(this.workspace_.endCanvasTransition.bind(this.workspace_),500),this.fireZoomEvent_(),o.Touch.clearTouchIdentifier(),t.stopPropagation(),t.preventDefault()},o.ZoomControls.prototype.fireZoomEvent_=function(){var t=new o.Events.Click(null,this.workspace_.id,"zoom_controls");o.Events.fire(t)},o.Css.register([".blocklyZoom>image, .blocklyZoom>svg>image {","opacity: .4;","}",".blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {","opacity: .6;","}",".blocklyZoom>image:active, .blocklyZoom>svg>image:active {","opacity: .8;","}"]),o.Mutator=function(t){o.Mutator.superClass_.constructor.call(this,null),this.quarkNames_=t},o.utils.object.inherits(o.Mutator,o.Icon),o.Mutator.prototype.workspaceWidth_=0,o.Mutator.prototype.workspaceHeight_=0,o.Mutator.prototype.setBlock=function(t){this.block_=t},o.Mutator.prototype.getWorkspace=function(){return this.workspace_},o.Mutator.prototype.drawIcon_=function(t){o.utils.dom.createSvgElement(o.utils.Svg.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},t),o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},t),o.utils.dom.createSvgElement(o.utils.Svg.CIRCLE,{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},t)},o.Mutator.prototype.iconClick_=function(t){this.block_.isEditable()&&o.Icon.prototype.iconClick_.call(this,t)},o.Mutator.prototype.createEditor_=function(){if(this.svgDialog_=o.utils.dom.createSvgElement(o.utils.Svg.SVG,{x:o.Bubble.BORDER_WIDTH,y:o.Bubble.BORDER_WIDTH},null),this.quarkNames_.length)for(var t,e=o.utils.xml.createElement("xml"),i=0;t=this.quarkNames_[i];i++){var n=o.utils.xml.createElement("block");n.setAttribute("type",t),e.appendChild(n)}else e=null;return(i=new o.Options({disable:!1,parentWorkspace:this.block_.workspace,media:this.block_.workspace.options.pathToMedia,rtl:this.block_.RTL,horizontalLayout:!1,renderer:this.block_.workspace.options.renderer,rendererOverrides:this.block_.workspace.options.rendererOverrides})).toolboxPosition=this.block_.RTL?o.utils.toolbox.Position.RIGHT:o.utils.toolbox.Position.LEFT,(t=!!e)&&(i.languageTree=o.utils.toolbox.convertToolboxDefToJson(e),i.getMetrics=this.getFlyoutMetrics_.bind(this)),this.workspace_=new o.WorkspaceSvg(i),this.workspace_.isMutator=!0,this.workspace_.addChangeListener(o.Events.disableOrphans),e=t?this.workspace_.addFlyout(o.utils.Svg.G):null,i=this.workspace_.createDom("blocklyMutatorBackground"),e&&i.insertBefore(e,this.workspace_.svgBlockCanvas_),this.svgDialog_.appendChild(i),this.svgDialog_},o.Mutator.prototype.updateEditable=function(){o.Mutator.superClass_.updateEditable.call(this),this.block_.isInFlyout||(this.block_.isEditable()?this.iconGroup_&&o.utils.dom.removeClass(this.iconGroup_,"blocklyIconGroupReadonly"):(this.setVisible(!1),this.iconGroup_&&o.utils.dom.addClass(this.iconGroup_,"blocklyIconGroupReadonly")))},o.Mutator.prototype.resizeBubble_=function(){var t=2*o.Bubble.BORDER_WIDTH,e=this.workspace_.getCanvas().getBBox(),i=e.width+e.x,n=e.height+3*t,r=this.workspace_.getFlyout();if(r){var s=r.getMetrics_();n=Math.max(n,s.contentHeight+20),i+=r.getWidth()}this.block_.RTL&&(i=-e.x),i+=3*t,(Math.abs(this.workspaceWidth_-i)>t||Math.abs(this.workspaceHeight_-n)>t)&&(this.workspaceWidth_=i,this.workspaceHeight_=n,this.bubble_.setBubbleSize(i+t,n+t),this.svgDialog_.setAttribute("width",this.workspaceWidth_),this.svgDialog_.setAttribute("height",this.workspaceHeight_)),this.block_.RTL&&(t="translate("+this.workspaceWidth_+",0)",this.workspace_.getCanvas().setAttribute("transform",t)),this.workspace_.resize()},o.Mutator.prototype.onBubbleMove_=function(){this.workspace_&&this.workspace_.recordDeleteAreas()},o.Mutator.prototype.setVisible=function(t){if(t!=this.isVisible())if(o.Events.fire(new o.Events.BubbleOpen(this.block_,t,"mutator")),t){this.bubble_=new o.Bubble(this.block_.workspace,this.createEditor_(),this.block_.pathObject.svgPath,this.iconXY_,null,null),this.bubble_.setSvgId(this.block_.id),this.bubble_.registerMoveEvent(this.onBubbleMove_.bind(this));var e=this.workspace_.options.languageTree;t=this.workspace_.getFlyout(),e&&(t.init(this.workspace_),t.show(e)),this.rootBlock_=this.block_.decompose(this.workspace_),e=this.rootBlock_.getDescendants(!1);for(var i,n=0;i=e[n];n++)i.render();if(this.rootBlock_.setMovable(!1),this.rootBlock_.setDeletable(!1),t?(e=2*t.CORNER_RADIUS,t=this.rootBlock_.RTL?t.getWidth()+e:e):t=e=16,this.block_.RTL&&(t=-t),this.rootBlock_.moveBy(t,e),this.block_.saveConnections){var r=this,s=this.block_;s.saveConnections(this.rootBlock_),this.sourceListener_=function(){s.saveConnections(r.rootBlock_)},this.block_.workspace.addChangeListener(this.sourceListener_)}this.resizeBubble_(),this.workspace_.addChangeListener(this.workspaceChanged_.bind(this)),this.applyColour()}else this.svgDialog_=null,this.workspace_.dispose(),this.rootBlock_=this.workspace_=null,this.bubble_.dispose(),this.bubble_=null,this.workspaceHeight_=this.workspaceWidth_=0,this.sourceListener_&&(this.block_.workspace.removeChangeListener(this.sourceListener_),this.sourceListener_=null)},o.Mutator.prototype.workspaceChanged_=function(t){if(!(t.isUiEvent||t.type==o.Events.CHANGE&&"disabled"==t.element)){if(!this.workspace_.isDragging()){t=this.workspace_.getTopBlocks(!1);for(var e,i=0;e=t[i];i++){var n=e.getRelativeToSurfaceXY();if(20>n.y&&e.moveBy(0,20-n.y),e.RTL){var r=-20,s=this.workspace_.getFlyout();s&&(r-=s.getWidth()),n.x>r&&e.moveBy(r-n.x,0)}else 20>n.x&&e.moveBy(20-n.x,0)}}if(this.rootBlock_.workspace==this.workspace_){if(o.Events.setGroup(!0),t=(t=(e=this.block_).mutationToDom())&&o.Xml.domToText(t),i=e.rendered,e.rendered=!1,e.compose(this.rootBlock_),e.rendered=i,e.initSvg(),o.getMainWorkspace().keyboardAccessibilityMode&&o.navigation.moveCursorOnBlockMutation(e),e.rendered&&e.render(),t!=(i=(i=e.mutationToDom())&&o.Xml.domToText(i))){o.Events.fire(new o.Events.BlockChange(e,"mutation",null,t,i));var a=o.Events.getGroup();setTimeout((function(){o.Events.setGroup(a),e.bumpNeighbours(),o.Events.setGroup(!1)}),o.BUMP_DELAY)}this.workspace_.isDragging()||this.resizeBubble_(),o.Events.setGroup(!1)}}},o.Mutator.prototype.getFlyoutMetrics_=function(){var t=this.workspace_.getFlyout();return t=t?t.getWidth():0,{contentHeight:0,contentWidth:0,contentTop:0,contentLeft:0,viewHeight:this.workspaceHeight_,viewWidth:this.workspaceWidth_-t,viewTop:0,viewLeft:0,absoluteTop:0,absoluteLeft:this.workspace_.RTL?0:t}},o.Mutator.prototype.dispose=function(){this.block_.mutator=null,o.Icon.prototype.dispose.call(this)},o.Mutator.prototype.updateBlockStyle=function(){var t=this.workspace_;if(t&&t.getAllBlocks(!1)){for(var e=t.getAllBlocks(!1),o=0;o<e.length;o++){var i=e[o];i.setStyle(i.getStyleName())}if(o=t.getFlyout())for(t=o.workspace_.getAllBlocks(!1),o=0;o<t.length;o++)(i=t[o]).setStyle(i.getStyleName())}},o.Mutator.reconnect=function(t,e,o){if(!t||!t.getSourceBlock().workspace)return!1;o=e.getInput(o).connection;var i=t.targetBlock();return!(i&&i!=e||o.targetConnection==t||(o.isConnected()&&o.disconnect(),o.connect(t),0))},o.Mutator.findParentWs=function(t){var e=null;if(t&&t.options){var o=t.options.parentWorkspace;t.isFlyout?o&&o.options&&(e=o.options.parentWorkspace):o&&(e=o)}return e},o.FieldTextInput=function(t,e,i){this.spellcheck_=!0,o.FieldTextInput.superClass_.constructor.call(this,t,e,i),this.onKeyInputWrapper_=this.onKeyDownWrapper_=this.htmlInput_=null,this.fullBlockClickTarget_=!1,this.workspace_=null},o.utils.object.inherits(o.FieldTextInput,o.Field),o.FieldTextInput.prototype.DEFAULT_VALUE="",o.FieldTextInput.fromJson=function(t){var e=o.utils.replaceMessageReferences(t.text);return new o.FieldTextInput(e,void 0,t)},o.FieldTextInput.prototype.SERIALIZABLE=!0,o.FieldTextInput.BORDERRADIUS=4,o.FieldTextInput.prototype.CURSOR="text",o.FieldTextInput.prototype.configure_=function(t){o.FieldTextInput.superClass_.configure_.call(this,t),"boolean"==typeof t.spellcheck&&(this.spellcheck_=t.spellcheck)},o.FieldTextInput.prototype.initView=function(){if(this.getConstants().FULL_BLOCK_FIELDS){for(var t,e=0,o=0,i=0;t=this.sourceBlock_.inputList[i];i++){for(var n=0;t.fieldRow[n];n++)e++;t.connection&&o++}this.fullBlockClickTarget_=1>=e&&this.sourceBlock_.outputConnection&&!o}else this.fullBlockClickTarget_=!1;this.fullBlockClickTarget_?this.clickTarget_=this.sourceBlock_.getSvgRoot():this.createBorderRect_(),this.createTextElement_()},o.FieldTextInput.prototype.doClassValidation_=function(t){return null==t?null:String(t)},o.FieldTextInput.prototype.doValueInvalid_=function(t){this.isBeingEdited_&&(this.isTextValid_=!1,t=this.value_,this.value_=this.htmlInput_.untypedDefaultValue_,this.sourceBlock_&&o.Events.isEnabled()&&o.Events.fire(new o.Events.BlockChange(this.sourceBlock_,"field",this.name||null,t,this.value_)))},o.FieldTextInput.prototype.doValueUpdate_=function(t){this.isTextValid_=!0,this.value_=t,this.isBeingEdited_||(this.isDirty_=!0)},o.FieldTextInput.prototype.applyColour=function(){this.sourceBlock_&&this.getConstants().FULL_BLOCK_FIELDS&&(this.borderRect_?this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourTertiary):this.sourceBlock_.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR))},o.FieldTextInput.prototype.render_=function(){if(o.FieldTextInput.superClass_.render_.call(this),this.isBeingEdited_){this.resizeEditor_();var t=this.htmlInput_;this.isTextValid_?(o.utils.dom.removeClass(t,"blocklyInvalidInput"),o.utils.aria.setState(t,o.utils.aria.State.INVALID,!1)):(o.utils.dom.addClass(t,"blocklyInvalidInput"),o.utils.aria.setState(t,o.utils.aria.State.INVALID,!0))}},o.FieldTextInput.prototype.setSpellcheck=function(t){t!=this.spellcheck_&&(this.spellcheck_=t,this.htmlInput_&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_))},o.FieldTextInput.prototype.showEditor_=function(t,e){this.workspace_=this.sourceBlock_.workspace,!(t=e||!1)&&(o.utils.userAgent.MOBILE||o.utils.userAgent.ANDROID||o.utils.userAgent.IPAD)?this.showPromptEditor_():this.showInlineEditor_(t)},o.FieldTextInput.prototype.showPromptEditor_=function(){o.prompt(o.Msg.CHANGE_VALUE_TITLE,this.getText(),function(t){this.setValue(this.getValueFromEditorText_(t))}.bind(this))},o.FieldTextInput.prototype.showInlineEditor_=function(t){o.WidgetDiv.show(this,this.sourceBlock_.RTL,this.widgetDispose_.bind(this)),this.htmlInput_=this.widgetCreate_(),this.isBeingEdited_=!0,t||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())},o.FieldTextInput.prototype.widgetCreate_=function(){var t=o.WidgetDiv.DIV;o.utils.dom.addClass(this.getClickTarget_(),"editing");var e=document.createElement("input");e.className="blocklyHtmlInput",e.setAttribute("spellcheck",this.spellcheck_);var i=this.workspace_.getScale(),n=this.getConstants().FIELD_TEXT_FONTSIZE*i+"pt";if(t.style.fontSize=n,e.style.fontSize=n,n=o.FieldTextInput.BORDERRADIUS*i+"px",this.fullBlockClickTarget_){n=((n=this.getScaledBBox()).bottom-n.top)/2+"px";var r=this.sourceBlock_.getParent()?this.sourceBlock_.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary;e.style.border=1*i+"px solid "+r,t.style.borderRadius=n,t.style.transition="box-shadow 0.25s ease 0s",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW&&(t.style.boxShadow="rgba(255, 255, 255, 0.3) 0px 0px 0px "+4*i+"px")}return e.style.borderRadius=n,t.appendChild(e),e.value=e.defaultValue=this.getEditorText_(this.value_),e.untypedDefaultValue_=this.value_,e.oldValue_=null,this.resizeEditor_(),this.bindInputEvents_(e),e},o.FieldTextInput.prototype.widgetDispose_=function(){this.isBeingEdited_=!1,this.isTextValid_=!0,this.forceRerender(),this.onFinishEditing_&&this.onFinishEditing_(this.value_),this.unbindInputEvents_();var t=o.WidgetDiv.DIV.style;t.width="auto",t.height="auto",t.fontSize="",t.transition="",t.boxShadow="",this.htmlInput_=null,o.utils.dom.removeClass(this.getClickTarget_(),"editing")},o.FieldTextInput.prototype.bindInputEvents_=function(t){this.onKeyDownWrapper_=o.bindEventWithChecks_(t,"keydown",this,this.onHtmlInputKeyDown_),this.onKeyInputWrapper_=o.bindEventWithChecks_(t,"input",this,this.onHtmlInputChange_)},o.FieldTextInput.prototype.unbindInputEvents_=function(){this.onKeyDownWrapper_&&(o.unbindEvent_(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null),this.onKeyInputWrapper_&&(o.unbindEvent_(this.onKeyInputWrapper_),this.onKeyInputWrapper_=null)},o.FieldTextInput.prototype.onHtmlInputKeyDown_=function(t){t.keyCode==o.utils.KeyCodes.ENTER?(o.WidgetDiv.hide(),o.DropDownDiv.hideWithoutAnimation()):t.keyCode==o.utils.KeyCodes.ESC?(this.htmlInput_.value=this.htmlInput_.defaultValue,o.WidgetDiv.hide(),o.DropDownDiv.hideWithoutAnimation()):t.keyCode==o.utils.KeyCodes.TAB&&(o.WidgetDiv.hide(),o.DropDownDiv.hideWithoutAnimation(),this.sourceBlock_.tab(this,!t.shiftKey),t.preventDefault())},o.FieldTextInput.prototype.onHtmlInputChange_=function(t){(t=this.htmlInput_.value)!==this.htmlInput_.oldValue_&&(this.htmlInput_.oldValue_=t,o.Events.setGroup(!0),t=this.getValueFromEditorText_(t),this.setValue(t),this.forceRerender(),this.resizeEditor_(),o.Events.setGroup(!1))},o.FieldTextInput.prototype.setEditorValue_=function(t){this.isDirty_=!0,this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(t)),this.setValue(t)},o.FieldTextInput.prototype.resizeEditor_=function(){var t=o.WidgetDiv.DIV,e=this.getScaledBBox();t.style.width=e.right-e.left+"px",t.style.height=e.bottom-e.top+"px",e=new o.utils.Coordinate(this.sourceBlock_.RTL?e.right-t.offsetWidth:e.left,e.top),t.style.left=e.x+"px",t.style.top=e.y+"px"},o.FieldTextInput.prototype.isTabNavigable=function(){return!0},o.FieldTextInput.prototype.getText_=function(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null},o.FieldTextInput.prototype.getEditorText_=function(t){return String(t)},o.FieldTextInput.prototype.getValueFromEditorText_=function(t){return t},o.fieldRegistry.register("field_input",o.FieldTextInput),o.FieldAngle=function(t,e,i){this.clockwise_=o.FieldAngle.CLOCKWISE,this.offset_=o.FieldAngle.OFFSET,this.wrap_=o.FieldAngle.WRAP,this.round_=o.FieldAngle.ROUND,o.FieldAngle.superClass_.constructor.call(this,t,e,i),this.moveSurfaceWrapper_=this.clickSurfaceWrapper_=this.clickWrapper_=this.line_=this.gauge_=null},o.utils.object.inherits(o.FieldAngle,o.FieldTextInput),o.FieldAngle.prototype.DEFAULT_VALUE=0,o.FieldAngle.fromJson=function(t){return new o.FieldAngle(t.angle,void 0,t)},o.FieldAngle.prototype.SERIALIZABLE=!0,o.FieldAngle.ROUND=15,o.FieldAngle.HALF=50,o.FieldAngle.CLOCKWISE=!1,o.FieldAngle.OFFSET=0,o.FieldAngle.WRAP=360,o.FieldAngle.RADIUS=o.FieldAngle.HALF-1,o.FieldAngle.prototype.configure_=function(t){switch(o.FieldAngle.superClass_.configure_.call(this,t),t.mode){case"compass":this.clockwise_=!0,this.offset_=90;break;case"protractor":this.clockwise_=!1,this.offset_=0}var e=t.clockwise;"boolean"==typeof e&&(this.clockwise_=e),null!=(e=t.offset)&&(e=Number(e),isNaN(e)||(this.offset_=e)),null!=(e=t.wrap)&&(e=Number(e),isNaN(e)||(this.wrap_=e)),null!=(t=t.round)&&(t=Number(t),isNaN(t)||(this.round_=t))},o.FieldAngle.prototype.initView=function(){o.FieldAngle.superClass_.initView.call(this),this.symbol_=o.utils.dom.createSvgElement(o.utils.Svg.TSPAN,{},null),this.symbol_.appendChild(document.createTextNode("")),this.textElement_.appendChild(this.symbol_)},o.FieldAngle.prototype.render_=function(){o.FieldAngle.superClass_.render_.call(this),this.updateGraph_()},o.FieldAngle.prototype.showEditor_=function(t){o.FieldAngle.superClass_.showEditor_.call(this,t,o.utils.userAgent.MOBILE||o.utils.userAgent.ANDROID||o.utils.userAgent.IPAD),t=this.dropdownCreate_(),o.DropDownDiv.getContentDiv().appendChild(t),o.DropDownDiv.setColour(this.sourceBlock_.style.colourPrimary,this.sourceBlock_.style.colourTertiary),o.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.updateGraph_()},o.FieldAngle.prototype.dropdownCreate_=function(){var t=o.utils.dom.createSvgElement(o.utils.Svg.SVG,{xmlns:o.utils.dom.SVG_NS,"xmlns:html":o.utils.dom.HTML_NS,"xmlns:xlink":o.utils.dom.XLINK_NS,version:"1.1",height:2*o.FieldAngle.HALF+"px",width:2*o.FieldAngle.HALF+"px",style:"touch-action: none"},null),e=o.utils.dom.createSvgElement(o.utils.Svg.CIRCLE,{cx:o.FieldAngle.HALF,cy:o.FieldAngle.HALF,r:o.FieldAngle.RADIUS,class:"blocklyAngleCircle"},t);this.gauge_=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyAngleGauge"},t),this.line_=o.utils.dom.createSvgElement(o.utils.Svg.LINE,{x1:o.FieldAngle.HALF,y1:o.FieldAngle.HALF,class:"blocklyAngleLine"},t);for(var i=0;360>i;i+=15)o.utils.dom.createSvgElement(o.utils.Svg.LINE,{x1:o.FieldAngle.HALF+o.FieldAngle.RADIUS,y1:o.FieldAngle.HALF,x2:o.FieldAngle.HALF+o.FieldAngle.RADIUS-(0==i%45?10:5),y2:o.FieldAngle.HALF,class:"blocklyAngleMarks",transform:"rotate("+i+","+o.FieldAngle.HALF+","+o.FieldAngle.HALF+")"},t);return this.clickWrapper_=o.bindEventWithChecks_(t,"click",this,this.hide_),this.clickSurfaceWrapper_=o.bindEventWithChecks_(e,"click",this,this.onMouseMove_,!0,!0),this.moveSurfaceWrapper_=o.bindEventWithChecks_(e,"mousemove",this,this.onMouseMove_,!0,!0),t},o.FieldAngle.prototype.dropdownDispose_=function(){this.clickWrapper_&&(o.unbindEvent_(this.clickWrapper_),this.clickWrapper_=null),this.clickSurfaceWrapper_&&(o.unbindEvent_(this.clickSurfaceWrapper_),this.clickSurfaceWrapper_=null),this.moveSurfaceWrapper_&&(o.unbindEvent_(this.moveSurfaceWrapper_),this.moveSurfaceWrapper_=null),this.line_=this.gauge_=null},o.FieldAngle.prototype.hide_=function(){o.DropDownDiv.hideIfOwner(this),o.WidgetDiv.hide()},o.FieldAngle.prototype.onMouseMove_=function(t){var e=this.gauge_.ownerSVGElement.getBoundingClientRect(),i=t.clientX-e.left-o.FieldAngle.HALF;t=t.clientY-e.top-o.FieldAngle.HALF,e=Math.atan(-t/i),isNaN(e)||(e=o.utils.math.toDegrees(e),0>i?e+=180:0<t&&(e+=360),e=this.clockwise_?this.offset_+360-e:360-(this.offset_-e),this.displayMouseOrKeyboardValue_(e))},o.FieldAngle.prototype.displayMouseOrKeyboardValue_=function(t){this.round_&&(t=Math.round(t/this.round_)*this.round_),(t=this.wrapValue_(t))!=this.value_&&this.setEditorValue_(t)},o.FieldAngle.prototype.updateGraph_=function(){if(this.gauge_){var t=Number(this.getText())+this.offset_,e=o.utils.math.toRadians(t%360);t=["M ",o.FieldAngle.HALF,",",o.FieldAngle.HALF];var i=o.FieldAngle.HALF,n=o.FieldAngle.HALF;if(!isNaN(e)){var r=Number(this.clockwise_),s=o.utils.math.toRadians(this.offset_),a=Math.cos(s)*o.FieldAngle.RADIUS,l=Math.sin(s)*-o.FieldAngle.RADIUS;r&&(e=2*s-e),i+=Math.cos(e)*o.FieldAngle.RADIUS,n-=Math.sin(e)*o.FieldAngle.RADIUS,e=Math.abs(Math.floor((e-s)/Math.PI)%2),r&&(e=1-e),t.push(" l ",a,",",l," A ",o.FieldAngle.RADIUS,",",o.FieldAngle.RADIUS," 0 ",e," ",r," ",i,",",n," z")}this.gauge_.setAttribute("d",t.join("")),this.line_.setAttribute("x2",i),this.line_.setAttribute("y2",n)}},o.FieldAngle.prototype.onHtmlInputKeyDown_=function(t){var e;if(o.FieldAngle.superClass_.onHtmlInputKeyDown_.call(this,t),t.keyCode===o.utils.KeyCodes.LEFT?e=this.sourceBlock_.RTL?1:-1:t.keyCode===o.utils.KeyCodes.RIGHT?e=this.sourceBlock_.RTL?-1:1:t.keyCode===o.utils.KeyCodes.DOWN?e=-1:t.keyCode===o.utils.KeyCodes.UP&&(e=1),e){var i=this.getValue();this.displayMouseOrKeyboardValue_(i+e*this.round_),t.preventDefault(),t.stopPropagation()}},o.FieldAngle.prototype.doClassValidation_=function(t){return t=Number(t),isNaN(t)||!isFinite(t)?null:this.wrapValue_(t)},o.FieldAngle.prototype.wrapValue_=function(t){return 0>(t%=360)&&(t+=360),t>this.wrap_&&(t-=360),t},o.Css.register(".blocklyAngleCircle {,stroke: #444;,stroke-width: 1;,fill: #ddd;,fill-opacity: .8;,},.blocklyAngleMarks {,stroke: #444;,stroke-width: 1;,},.blocklyAngleGauge {,fill: #f88;,fill-opacity: .8;,pointer-events: none;,},.blocklyAngleLine {,stroke: #f00;,stroke-width: 2;,stroke-linecap: round;,pointer-events: none;,}".split(",")),o.fieldRegistry.register("field_angle",o.FieldAngle),o.FieldCheckbox=function(t,e,i){this.checkChar_=null,o.FieldCheckbox.superClass_.constructor.call(this,t,e,i)},o.utils.object.inherits(o.FieldCheckbox,o.Field),o.FieldCheckbox.prototype.DEFAULT_VALUE=!1,o.FieldCheckbox.fromJson=function(t){return new o.FieldCheckbox(t.checked,void 0,t)},o.FieldCheckbox.CHECK_CHAR="",o.FieldCheckbox.prototype.SERIALIZABLE=!0,o.FieldCheckbox.prototype.CURSOR="default",o.FieldCheckbox.prototype.configure_=function(t){o.FieldCheckbox.superClass_.configure_.call(this,t),t.checkCharacter&&(this.checkChar_=t.checkCharacter)},o.FieldCheckbox.prototype.initView=function(){o.FieldCheckbox.superClass_.initView.call(this),o.utils.dom.addClass(this.textElement_,"blocklyCheckbox"),this.textElement_.style.display=this.value_?"block":"none"},o.FieldCheckbox.prototype.render_=function(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)},o.FieldCheckbox.prototype.getDisplayText_=function(){return this.checkChar_||o.FieldCheckbox.CHECK_CHAR},o.FieldCheckbox.prototype.setCheckCharacter=function(t){this.checkChar_=t,this.forceRerender()},o.FieldCheckbox.prototype.showEditor_=function(){this.setValue(!this.value_)},o.FieldCheckbox.prototype.doClassValidation_=function(t){return!0===t||"TRUE"===t?"TRUE":!1===t||"FALSE"===t?"FALSE":null},o.FieldCheckbox.prototype.doValueUpdate_=function(t){this.value_=this.convertValueToBool_(t),this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")},o.FieldCheckbox.prototype.getValue=function(){return this.value_?"TRUE":"FALSE"},o.FieldCheckbox.prototype.getValueBoolean=function(){return this.value_},o.FieldCheckbox.prototype.getText=function(){return String(this.convertValueToBool_(this.value_))},o.FieldCheckbox.prototype.convertValueToBool_=function(t){return"string"==typeof t?"TRUE"==t:!!t},o.fieldRegistry.register("field_checkbox",o.FieldCheckbox),o.FieldColour=function(t,e,i){o.FieldColour.superClass_.constructor.call(this,t,e,i),this.onKeyDownWrapper_=this.onMouseLeaveWrapper_=this.onMouseEnterWrapper_=this.onMouseMoveWrapper_=this.onClickWrapper_=this.highlightedIndex_=this.picker_=null},o.utils.object.inherits(o.FieldColour,o.Field),o.FieldColour.fromJson=function(t){return new o.FieldColour(t.colour,void 0,t)},o.FieldColour.prototype.SERIALIZABLE=!0,o.FieldColour.prototype.CURSOR="default",o.FieldColour.prototype.isDirty_=!1,o.FieldColour.prototype.colours_=null,o.FieldColour.prototype.titles_=null,o.FieldColour.prototype.columns_=0,o.FieldColour.prototype.configure_=function(t){o.FieldColour.superClass_.configure_.call(this,t),t.colourOptions&&(this.colours_=t.colourOptions,this.titles_=t.colourTitles),t.columns&&(this.columns_=t.columns)},o.FieldColour.prototype.initView=function(){this.size_=new o.utils.Size(this.getConstants().FIELD_COLOUR_DEFAULT_WIDTH,this.getConstants().FIELD_COLOUR_DEFAULT_HEIGHT),this.getConstants().FIELD_COLOUR_FULL_BLOCK?this.clickTarget_=this.sourceBlock_.getSvgRoot():(this.createBorderRect_(),this.borderRect_.style.fillOpacity="1")},o.FieldColour.prototype.applyColour=function(){this.getConstants().FIELD_COLOUR_FULL_BLOCK?(this.sourceBlock_.pathObject.svgPath.setAttribute("fill",this.getValue()),this.sourceBlock_.pathObject.svgPath.setAttribute("stroke","#fff")):this.borderRect_&&(this.borderRect_.style.fill=this.getValue())},o.FieldColour.prototype.doClassValidation_=function(t){return"string"!=typeof t?null:o.utils.colour.parse(t)},o.FieldColour.prototype.doValueUpdate_=function(t){this.value_=t,this.borderRect_?this.borderRect_.style.fill=t:this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.pathObject.svgPath.setAttribute("fill",t),this.sourceBlock_.pathObject.svgPath.setAttribute("stroke","#fff"))},o.FieldColour.prototype.getText=function(){var t=this.value_;return/^#(.)\1(.)\2(.)\3$/.test(t)&&(t="#"+t[1]+t[3]+t[5]),t},o.FieldColour.COLOURS="#ffffff #cccccc #c0c0c0 #999999 #666666 #333333 #000000 #ffcccc #ff6666 #ff0000 #cc0000 #990000 #660000 #330000 #ffcc99 #ff9966 #ff9900 #ff6600 #cc6600 #993300 #663300 #ffff99 #ffff66 #ffcc66 #ffcc33 #cc9933 #996633 #663333 #ffffcc #ffff33 #ffff00 #ffcc00 #999900 #666600 #333300 #99ff99 #66ff99 #33ff33 #33cc00 #009900 #006600 #003300 #99ffff #33ffff #66cccc #00cccc #339999 #336666 #003333 #ccffff #66ffff #33ccff #3366ff #3333ff #000099 #000066 #ccccff #9999ff #6666cc #6633ff #6600cc #333399 #330099 #ffccff #ff99ff #cc66cc #cc33cc #993399 #663366 #330033".split(" "),o.FieldColour.prototype.DEFAULT_VALUE=o.FieldColour.COLOURS[0],o.FieldColour.TITLES=[],o.FieldColour.COLUMNS=7,o.FieldColour.prototype.setColours=function(t,e){return this.colours_=t,e&&(this.titles_=e),this},o.FieldColour.prototype.setColumns=function(t){return this.columns_=t,this},o.FieldColour.prototype.showEditor_=function(){this.picker_=this.dropdownCreate_(),o.DropDownDiv.getContentDiv().appendChild(this.picker_),o.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.picker_.focus({preventScroll:!0})},o.FieldColour.prototype.onClick_=function(t){null!==(t=(t=t.target)&&t.label)&&(this.setValue(t),o.DropDownDiv.hideIfOwner(this))},o.FieldColour.prototype.onKeyDown_=function(t){var e=!1;t.keyCode===o.utils.KeyCodes.UP?(this.moveHighlightBy_(0,-1),e=!0):t.keyCode===o.utils.KeyCodes.DOWN?(this.moveHighlightBy_(0,1),e=!0):t.keyCode===o.utils.KeyCodes.LEFT?(this.moveHighlightBy_(-1,0),e=!0):t.keyCode===o.utils.KeyCodes.RIGHT?(this.moveHighlightBy_(1,0),e=!0):t.keyCode===o.utils.KeyCodes.ENTER&&((e=this.getHighlighted_())&&null!==(e=e&&e.label)&&this.setValue(e),o.DropDownDiv.hideWithoutAnimation(),e=!0),e&&t.stopPropagation()},o.FieldColour.prototype.onBlocklyAction=function(t){if(this.picker_)switch(t.name){case o.navigation.actionNames.PREVIOUS:return this.moveHighlightBy_(0,-1),!0;case o.navigation.actionNames.NEXT:return this.moveHighlightBy_(0,1),!0;case o.navigation.actionNames.OUT:return this.moveHighlightBy_(-1,0),!0;case o.navigation.actionNames.IN:return this.moveHighlightBy_(1,0),!0;default:return!1}return o.FieldColour.superClass_.onBlocklyAction.call(this,t)},o.FieldColour.prototype.moveHighlightBy_=function(t,e){var i=this.colours_||o.FieldColour.COLOURS,n=this.columns_||o.FieldColour.COLUMNS,r=this.highlightedIndex_%n,s=Math.floor(this.highlightedIndex_/n);r+=t,s+=e,0>t?0>r&&0<s?(r=n-1,s--):0>r&&(r=0):0<t?r>n-1&&s<Math.floor(i.length/n)-1?(r=0,s++):r>n-1&&r--:0>e?0>s&&(s=0):0<e&&s>Math.floor(i.length/n)-1&&(s=Math.floor(i.length/n)-1),this.setHighlightedCell_(this.picker_.childNodes[s].childNodes[r],s*n+r)},o.FieldColour.prototype.onMouseMove_=function(t){var e=(t=t.target)&&Number(t.getAttribute("data-index"));null!==e&&e!==this.highlightedIndex_&&this.setHighlightedCell_(t,e)},o.FieldColour.prototype.onMouseEnter_=function(){this.picker_.focus({preventScroll:!0})},o.FieldColour.prototype.onMouseLeave_=function(){this.picker_.blur();var t=this.getHighlighted_();t&&o.utils.dom.removeClass(t,"blocklyColourHighlighted")},o.FieldColour.prototype.getHighlighted_=function(){var t=this.columns_||o.FieldColour.COLUMNS,e=this.picker_.childNodes[Math.floor(this.highlightedIndex_/t)];return e?e.childNodes[this.highlightedIndex_%t]:null},o.FieldColour.prototype.setHighlightedCell_=function(t,e){var i=this.getHighlighted_();i&&o.utils.dom.removeClass(i,"blocklyColourHighlighted"),o.utils.dom.addClass(t,"blocklyColourHighlighted"),this.highlightedIndex_=e,o.utils.aria.setState(this.picker_,o.utils.aria.State.ACTIVEDESCENDANT,t.getAttribute("id"))},o.FieldColour.prototype.dropdownCreate_=function(){var t=this.columns_||o.FieldColour.COLUMNS,e=this.colours_||o.FieldColour.COLOURS,i=this.titles_||o.FieldColour.TITLES,n=this.getValue(),r=document.createElement("table");r.className="blocklyColourTable",r.tabIndex=0,r.dir="ltr",o.utils.aria.setRole(r,o.utils.aria.Role.GRID),o.utils.aria.setState(r,o.utils.aria.State.EXPANDED,!0),o.utils.aria.setState(r,o.utils.aria.State.ROWCOUNT,Math.floor(e.length/t)),o.utils.aria.setState(r,o.utils.aria.State.COLCOUNT,t);for(var s,a=0;a<e.length;a++){0==a%t&&(s=document.createElement("tr"),o.utils.aria.setRole(s,o.utils.aria.Role.ROW),r.appendChild(s));var l=document.createElement("td");s.appendChild(l),l.label=e[a],l.title=i[a]||e[a],l.id=o.utils.IdGenerator.getNextUniqueId(),l.setAttribute("data-index",a),o.utils.aria.setRole(l,o.utils.aria.Role.GRIDCELL),o.utils.aria.setState(l,o.utils.aria.State.LABEL,e[a]),o.utils.aria.setState(l,o.utils.aria.State.SELECTED,e[a]==n),l.style.backgroundColor=e[a],e[a]==n&&(l.className="blocklyColourSelected",this.highlightedIndex_=a)}return this.onClickWrapper_=o.bindEventWithChecks_(r,"click",this,this.onClick_,!0),this.onMouseMoveWrapper_=o.bindEventWithChecks_(r,"mousemove",this,this.onMouseMove_,!0),this.onMouseEnterWrapper_=o.bindEventWithChecks_(r,"mouseenter",this,this.onMouseEnter_,!0),this.onMouseLeaveWrapper_=o.bindEventWithChecks_(r,"mouseleave",this,this.onMouseLeave_,!0),this.onKeyDownWrapper_=o.bindEventWithChecks_(r,"keydown",this,this.onKeyDown_),r},o.FieldColour.prototype.dropdownDispose_=function(){this.onClickWrapper_&&(o.unbindEvent_(this.onClickWrapper_),this.onClickWrapper_=null),this.onMouseMoveWrapper_&&(o.unbindEvent_(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null),this.onMouseEnterWrapper_&&(o.unbindEvent_(this.onMouseEnterWrapper_),this.onMouseEnterWrapper_=null),this.onMouseLeaveWrapper_&&(o.unbindEvent_(this.onMouseLeaveWrapper_),this.onMouseLeaveWrapper_=null),this.onKeyDownWrapper_&&(o.unbindEvent_(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null),this.highlightedIndex_=this.picker_=null},o.Css.register([".blocklyColourTable {","border-collapse: collapse;","display: block;","outline: none;","padding: 1px;","}",".blocklyColourTable>tr>td {","border: .5px solid #888;","box-sizing: border-box;","cursor: pointer;","display: inline-block;","height: 20px;","padding: 0;","width: 20px;","}",".blocklyColourTable>tr>td.blocklyColourHighlighted {","border-color: #eee;","box-shadow: 2px 2px 7px 2px rgba(0,0,0,.3);","position: relative;","}",".blocklyColourSelected, .blocklyColourSelected:hover {","border-color: #eee !important;","outline: 1px solid #333;","position: relative;","}"]),o.fieldRegistry.register("field_colour",o.FieldColour),o.FieldDropdown=function(t,e,i){"function"!=typeof t&&o.FieldDropdown.validateOptions_(t),this.menuGenerator_=t,this.suffixField=this.prefixField=this.generatedOptions_=null,this.trimOptions_(),this.selectedOption_=this.getOptions(!1)[0],o.FieldDropdown.superClass_.constructor.call(this,this.selectedOption_[1],e,i),this.svgArrow_=this.arrow_=this.imageElement_=this.menu_=this.selectedMenuItem_=null},o.utils.object.inherits(o.FieldDropdown,o.Field),o.FieldDropdown.fromJson=function(t){return new o.FieldDropdown(t.options,void 0,t)},o.FieldDropdown.prototype.SERIALIZABLE=!0,o.FieldDropdown.CHECKMARK_OVERHANG=25,o.FieldDropdown.MAX_MENU_HEIGHT_VH=.45,o.FieldDropdown.IMAGE_Y_OFFSET=5,o.FieldDropdown.IMAGE_Y_PADDING=2*o.FieldDropdown.IMAGE_Y_OFFSET,o.FieldDropdown.ARROW_CHAR=o.utils.userAgent.ANDROID?"":"",o.FieldDropdown.prototype.CURSOR="default",o.FieldDropdown.prototype.initView=function(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot(),this.createTextElement_(),this.imageElement_=o.utils.dom.createSvgElement(o.utils.Svg.IMAGE,{},this.fieldGroup_),this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_(),this.borderRect_&&o.utils.dom.addClass(this.borderRect_,"blocklyDropdownRect")},o.FieldDropdown.prototype.shouldAddBorderRect_=function(){return!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!this.sourceBlock_.isShadow()},o.FieldDropdown.prototype.createTextArrow_=function(){this.arrow_=o.utils.dom.createSvgElement(o.utils.Svg.TSPAN,{},this.textElement_),this.arrow_.appendChild(document.createTextNode(this.sourceBlock_.RTL?o.FieldDropdown.ARROW_CHAR+" ":" "+o.FieldDropdown.ARROW_CHAR)),this.sourceBlock_.RTL?this.textElement_.insertBefore(this.arrow_,this.textContent_):this.textElement_.appendChild(this.arrow_)},o.FieldDropdown.prototype.createSVGArrow_=function(){this.svgArrow_=o.utils.dom.createSvgElement(o.utils.Svg.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow_.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)},o.FieldDropdown.prototype.showEditor_=function(t){if(this.menu_=this.dropdownCreate_(),this.menu_.openingCoords=t&&"number"==typeof t.clientX?new o.utils.Coordinate(t.clientX,t.clientY):null,this.menu_.render(o.DropDownDiv.getContentDiv()),t=this.menu_.getElement(),o.utils.dom.addClass(t,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV){t=this.sourceBlock_.isShadow()?this.sourceBlock_.getParent().getColour():this.sourceBlock_.getColour();var e=this.sourceBlock_.isShadow()?this.sourceBlock_.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary;o.DropDownDiv.setColour(t,e)}o.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),this.selectedMenuItem_&&this.menu_.setHighlighted(this.selectedMenuItem_),this.applyColour()},o.FieldDropdown.prototype.dropdownCreate_=function(){var t=new o.Menu;t.setRole(o.utils.aria.Role.LISTBOX);var e=this.getOptions(!1);this.selectedMenuItem_=null;for(var i=0;i<e.length;i++){var n=e[i][0],r=e[i][1];if("object"==typeof n){var s=new Image(n.width,n.height);s.src=n.src,s.alt=n.alt||"",n=s}(n=new o.MenuItem(n,r)).setRole(o.utils.aria.Role.OPTION),n.setRightToLeft(this.sourceBlock_.RTL),n.setCheckable(!0),t.addChild(n),n.setChecked(r==this.value_),r==this.value_&&(this.selectedMenuItem_=n),n.onAction(this.handleMenuActionEvent_,this)}return t},o.FieldDropdown.prototype.dropdownDispose_=function(){this.menu_&&this.menu_.dispose(),this.selectedMenuItem_=this.menu_=null,this.applyColour()},o.FieldDropdown.prototype.handleMenuActionEvent_=function(t){o.DropDownDiv.hideIfOwner(this,!0),this.onItemSelected_(this.menu_,t)},o.FieldDropdown.prototype.onItemSelected_=function(t,e){this.setValue(e.getValue())},o.FieldDropdown.prototype.trimOptions_=function(){var t=this.menuGenerator_;if(Array.isArray(t)){for(var e=!1,i=0;i<t.length;i++){var n=t[i][0];"string"==typeof n?t[i][0]=o.utils.replaceMessageReferences(n):(null!=n.alt&&(t[i][0].alt=o.utils.replaceMessageReferences(n.alt)),e=!0)}if(!(e||2>t.length)){for(e=[],i=0;i<t.length;i++)e.push(t[i][0]);i=o.utils.string.shortestStringLength(e),n=o.utils.string.commonWordPrefix(e,i);var r=o.utils.string.commonWordSuffix(e,i);!n&&!r||i<=n+r||(n&&(this.prefixField=e[0].substring(0,n-1)),r&&(this.suffixField=e[0].substr(1-r)),this.menuGenerator_=o.FieldDropdown.applyTrim_(t,n,r))}}},o.FieldDropdown.applyTrim_=function(t,e,o){for(var i=[],n=0;n<t.length;n++){var r=t[n][0],s=t[n][1];r=r.substring(e,r.length-o),i[n]=[r,s]}return i},o.FieldDropdown.prototype.isOptionListDynamic=function(){return"function"==typeof this.menuGenerator_},o.FieldDropdown.prototype.getOptions=function(t){return this.isOptionListDynamic()?(this.generatedOptions_&&t||(this.generatedOptions_=this.menuGenerator_.call(this),o.FieldDropdown.validateOptions_(this.generatedOptions_)),this.generatedOptions_):this.menuGenerator_},o.FieldDropdown.prototype.doClassValidation_=function(t){for(var e,o=!1,i=this.getOptions(!0),n=0;e=i[n];n++)if(e[1]==t){o=!0;break}return o?t:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+t),null)},o.FieldDropdown.prototype.doValueUpdate_=function(t){o.FieldDropdown.superClass_.doValueUpdate_.call(this,t),t=this.getOptions(!0);for(var e,i=0;e=t[i];i++)e[1]==this.value_&&(this.selectedOption_=e)},o.FieldDropdown.prototype.applyColour=function(){this.borderRect_&&(this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourTertiary),this.menu_?this.borderRect_.setAttribute("fill",this.sourceBlock_.style.colourTertiary):this.borderRect_.setAttribute("fill","transparent")),this.sourceBlock_&&this.arrow_&&(this.sourceBlock_.isShadow()?this.arrow_.style.fill=this.sourceBlock_.style.colourSecondary:this.arrow_.style.fill=this.sourceBlock_.style.colourPrimary)},o.FieldDropdown.prototype.render_=function(){this.textContent_.nodeValue="",this.imageElement_.style.display="none";var t=this.selectedOption_&&this.selectedOption_[0];t&&"object"==typeof t?this.renderSelectedImage_(t):this.renderSelectedText_(),this.positionBorderRect_()},o.FieldDropdown.prototype.renderSelectedImage_=function(t){this.imageElement_.style.display="",this.imageElement_.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",t.src),this.imageElement_.setAttribute("height",t.height),this.imageElement_.setAttribute("width",t.width);var e=Number(t.height);t=Number(t.width);var i=!!this.borderRect_,n=Math.max(i?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,e+o.FieldDropdown.IMAGE_Y_PADDING);i=i?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;var r=this.svgArrow_?this.positionSVGArrow_(t+i,n/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):o.utils.dom.getFastTextWidth(this.arrow_,this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);this.size_.width=t+r+2*i,this.size_.height=n;var s=0;this.sourceBlock_.RTL?this.imageElement_.setAttribute("x",i+r):(s=t+r,this.textElement_.setAttribute("text-anchor","end"),this.imageElement_.setAttribute("x",i)),this.imageElement_.setAttribute("y",n/2-e/2),this.positionTextElement_(s+i,t+r)},o.FieldDropdown.prototype.renderSelectedText_=function(){this.textContent_.nodeValue=this.getDisplayText_(),o.utils.dom.addClass(this.textElement_,"blocklyDropdownText"),this.textElement_.setAttribute("text-anchor","start");var t=!!this.borderRect_,e=Math.max(t?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT),i=o.utils.dom.getFastTextWidth(this.textElement_,this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);t=t?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;var n=0;this.svgArrow_&&(n=this.positionSVGArrow_(i+t,e/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2)),this.size_.width=i+n+2*t,this.size_.height=e,this.positionTextElement_(t,i)},o.FieldDropdown.prototype.positionSVGArrow_=function(t,e){if(!this.svgArrow_)return 0;var o=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,i=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,n=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE;return this.svgArrow_.setAttribute("transform","translate("+(this.sourceBlock_.RTL?o:t+i)+","+e+")"),n+i},o.FieldDropdown.prototype.getText_=function(){if(!this.selectedOption_)return null;var t=this.selectedOption_[0];return"object"==typeof t?t.alt:t},o.FieldDropdown.validateOptions_=function(t){if(!Array.isArray(t))throw TypeError("FieldDropdown options must be an array.");if(!t.length)throw TypeError("FieldDropdown options must not be an empty array.");for(var e=!1,o=0;o<t.length;++o){var i=t[o];Array.isArray(i)?"string"!=typeof i[1]?(e=!0,console.error("Invalid option["+o+"]: Each FieldDropdown option id must be a string. Found "+i[1]+" in: ",i)):i[0]&&"string"!=typeof i[0]&&"string"!=typeof i[0].src&&(e=!0,console.error("Invalid option["+o+"]: Each FieldDropdown option must have a string label or image description. Found"+i[0]+" in: ",i)):(e=!0,console.error("Invalid option["+o+"]: Each FieldDropdown option must be an array. Found: ",i))}if(e)throw TypeError("Found invalid FieldDropdown options.")},o.FieldDropdown.prototype.onBlocklyAction=function(t){if(this.menu_)switch(t.name){case o.navigation.actionNames.PREVIOUS:return this.menu_.highlightPrevious(),!0;case o.navigation.actionNames.NEXT:return this.menu_.highlightNext(),!0;default:return!1}return o.FieldDropdown.superClass_.onBlocklyAction.call(this,t)},o.fieldRegistry.register("field_dropdown",o.FieldDropdown),o.FieldLabelSerializable=function(t,e,i){o.FieldLabelSerializable.superClass_.constructor.call(this,t,e,i)},o.utils.object.inherits(o.FieldLabelSerializable,o.FieldLabel),o.FieldLabelSerializable.fromJson=function(t){var e=o.utils.replaceMessageReferences(t.text);return new o.FieldLabelSerializable(e,void 0,t)},o.FieldLabelSerializable.prototype.EDITABLE=!1,o.FieldLabelSerializable.prototype.SERIALIZABLE=!0,o.fieldRegistry.register("field_label_serializable",o.FieldLabelSerializable),o.FieldImage=function(t,e,i,n,r,s,a){if(!t)throw Error("Src value of an image field is required");if(t=o.utils.replaceMessageReferences(t),i=Number(o.utils.replaceMessageReferences(i)),e=Number(o.utils.replaceMessageReferences(e)),isNaN(i)||isNaN(e))throw Error("Height and width values of an image field must cast to numbers.");if(0>=i||0>=e)throw Error("Height and width values of an image field must be greater than 0.");this.flipRtl_=!1,this.altText_="",o.FieldImage.superClass_.constructor.call(this,t,null,a),a||(this.flipRtl_=!!s,this.altText_=o.utils.replaceMessageReferences(n)||""),this.size_=new o.utils.Size(e,i+o.FieldImage.Y_PADDING),this.imageHeight_=i,this.clickHandler_=null,"function"==typeof r&&(this.clickHandler_=r),this.imageElement_=null},o.utils.object.inherits(o.FieldImage,o.Field),o.FieldImage.prototype.DEFAULT_VALUE="",o.FieldImage.fromJson=function(t){return new o.FieldImage(t.src,t.width,t.height,void 0,void 0,void 0,t)},o.FieldImage.Y_PADDING=1,o.FieldImage.prototype.EDITABLE=!1,o.FieldImage.prototype.isDirty_=!1,o.FieldImage.prototype.configure_=function(t){o.FieldImage.superClass_.configure_.call(this,t),this.flipRtl_=!!t.flipRtl,this.altText_=o.utils.replaceMessageReferences(t.alt)||""},o.FieldImage.prototype.initView=function(){this.imageElement_=o.utils.dom.createSvgElement(o.utils.Svg.IMAGE,{height:this.imageHeight_+"px",width:this.size_.width+"px",alt:this.altText_},this.fieldGroup_),this.imageElement_.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",this.value_),this.clickHandler_&&(this.imageElement_.style.cursor="pointer")},o.FieldImage.prototype.updateSize_=function(){},o.FieldImage.prototype.doClassValidation_=function(t){return"string"!=typeof t?null:t},o.FieldImage.prototype.doValueUpdate_=function(t){this.value_=t,this.imageElement_&&this.imageElement_.setAttributeNS(o.utils.dom.XLINK_NS,"xlink:href",String(this.value_))},o.FieldImage.prototype.getFlipRtl=function(){return this.flipRtl_},o.FieldImage.prototype.setAlt=function(t){t!=this.altText_&&(this.altText_=t||"",this.imageElement_&&this.imageElement_.setAttribute("alt",this.altText_))},o.FieldImage.prototype.showEditor_=function(){this.clickHandler_&&this.clickHandler_(this)},o.FieldImage.prototype.setOnClickHandler=function(t){this.clickHandler_=t},o.FieldImage.prototype.getText_=function(){return this.altText_},o.fieldRegistry.register("field_image",o.FieldImage),o.FieldMultilineInput=function(t,e,i){o.FieldMultilineInput.superClass_.constructor.call(this,t,e,i),this.textGroup_=null},o.utils.object.inherits(o.FieldMultilineInput,o.FieldTextInput),o.FieldMultilineInput.fromJson=function(t){var e=o.utils.replaceMessageReferences(t.text);return new o.FieldMultilineInput(e,void 0,t)},o.FieldMultilineInput.prototype.toXml=function(t){return t.textContent=this.getValue().replace(/\n/g,"&#10;"),t},o.FieldMultilineInput.prototype.fromXml=function(t){this.setValue(t.textContent.replace(/&#10;/g,"\n"))},o.FieldMultilineInput.prototype.initView=function(){this.createBorderRect_(),this.textGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:"blocklyEditableText"},this.fieldGroup_)},o.FieldMultilineInput.prototype.getDisplayText_=function(){var t=this.getText();if(!t)return o.Field.NBSP;var e=t.split("\n");t="";for(var i=0;i<e.length;i++){var n=e[i];n.length>this.maxDisplayLength&&(n=n.substring(0,this.maxDisplayLength-4)+"..."),t+=n=n.replace(/\s/g,o.Field.NBSP),i!==e.length-1&&(t+="\n")}return this.sourceBlock_.RTL&&(t+=""),t},o.FieldMultilineInput.prototype.render_=function(){for(var t;t=this.textGroup_.firstChild;)this.textGroup_.removeChild(t);t=this.getDisplayText_().split("\n");for(var e=0,i=0;i<t.length;i++){var n=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING;o.utils.dom.createSvgElement(o.utils.Svg.TEXT,{class:"blocklyText blocklyMultilineText",x:this.getConstants().FIELD_BORDER_RECT_X_PADDING,y:e+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,dy:this.getConstants().FIELD_TEXT_BASELINE},this.textGroup_).appendChild(document.createTextNode(t[i])),e+=n}this.updateSize_(),this.isBeingEdited_&&(this.sourceBlock_.RTL?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),t=this.htmlInput_,this.isTextValid_?(o.utils.dom.removeClass(t,"blocklyInvalidInput"),o.utils.aria.setState(t,o.utils.aria.State.INVALID,!1)):(o.utils.dom.addClass(t,"blocklyInvalidInput"),o.utils.aria.setState(t,o.utils.aria.State.INVALID,!0)))},o.FieldMultilineInput.prototype.updateSize_=function(){for(var t=this.textGroup_.childNodes,e=0,i=0,n=0;n<t.length;n++){var r=o.utils.dom.getTextWidth(t[n]);r>e&&(e=r),i+=this.getConstants().FIELD_TEXT_HEIGHT+(0<n?this.getConstants().FIELD_BORDER_RECT_Y_PADDING:0)}this.borderRect_&&(i+=2*this.getConstants().FIELD_BORDER_RECT_Y_PADDING,e+=2*this.getConstants().FIELD_BORDER_RECT_X_PADDING,this.borderRect_.setAttribute("width",e),this.borderRect_.setAttribute("height",i)),this.size_.width=e,this.size_.height=i,this.positionBorderRect_()},o.FieldMultilineInput.prototype.widgetCreate_=function(){var t=o.WidgetDiv.DIV,e=this.workspace_.getScale(),i=document.createElement("textarea");i.className="blocklyHtmlInput blocklyHtmlTextAreaInput",i.setAttribute("spellcheck",this.spellcheck_);var n=this.getConstants().FIELD_TEXT_FONTSIZE*e+"pt";t.style.fontSize=n,i.style.fontSize=n,i.style.borderRadius=o.FieldTextInput.BORDERRADIUS*e+"px",n=this.getConstants().FIELD_BORDER_RECT_X_PADDING*e;var r=this.getConstants().FIELD_BORDER_RECT_Y_PADDING*e/2;return i.style.padding=r+"px "+n+"px "+r+"px "+n+"px",n=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,i.style.lineHeight=n*e+"px",t.appendChild(i),i.value=i.defaultValue=this.getEditorText_(this.value_),i.untypedDefaultValue_=this.value_,i.oldValue_=null,o.utils.userAgent.GECKO?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),this.bindInputEvents_(i),i},o.FieldMultilineInput.prototype.onHtmlInputKeyDown_=function(t){t.keyCode!==o.utils.KeyCodes.ENTER&&o.FieldMultilineInput.superClass_.onHtmlInputKeyDown_.call(this,t)},o.Css.register(".blocklyHtmlTextAreaInput {,font-family: monospace;,resize: none;,overflow: hidden;,height: 100%;,text-align: left;,}".split(",")),o.fieldRegistry.register("field_multilinetext",o.FieldMultilineInput),o.FieldNumber=function(t,e,i,n,r,s){this.min_=-1/0,this.max_=1/0,this.precision_=0,this.decimalPlaces_=null,o.FieldNumber.superClass_.constructor.call(this,t,r,s),s||this.setConstraints(e,i,n)},o.utils.object.inherits(o.FieldNumber,o.FieldTextInput),o.FieldNumber.prototype.DEFAULT_VALUE=0,o.FieldNumber.fromJson=function(t){return new o.FieldNumber(t.value,void 0,void 0,void 0,void 0,t)},o.FieldNumber.prototype.SERIALIZABLE=!0,o.FieldNumber.prototype.configure_=function(t){o.FieldNumber.superClass_.configure_.call(this,t),this.setMinInternal_(t.min),this.setMaxInternal_(t.max),this.setPrecisionInternal_(t.precision)},o.FieldNumber.prototype.setConstraints=function(t,e,o){this.setMinInternal_(t),this.setMaxInternal_(e),this.setPrecisionInternal_(o),this.setValue(this.getValue())},o.FieldNumber.prototype.setMin=function(t){this.setMinInternal_(t),this.setValue(this.getValue())},o.FieldNumber.prototype.setMinInternal_=function(t){null==t?this.min_=-1/0:(t=Number(t),isNaN(t)||(this.min_=t))},o.FieldNumber.prototype.getMin=function(){return this.min_},o.FieldNumber.prototype.setMax=function(t){this.setMaxInternal_(t),this.setValue(this.getValue())},o.FieldNumber.prototype.setMaxInternal_=function(t){null==t?this.max_=1/0:(t=Number(t),isNaN(t)||(this.max_=t))},o.FieldNumber.prototype.getMax=function(){return this.max_},o.FieldNumber.prototype.setPrecision=function(t){this.setPrecisionInternal_(t),this.setValue(this.getValue())},o.FieldNumber.prototype.setPrecisionInternal_=function(t){null==t?this.precision_=0:(t=Number(t),isNaN(t)||(this.precision_=t));var e=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}),o=e.indexOf(".");this.decimalPlaces_=-1==o?t?0:null:e.length-o-1},o.FieldNumber.prototype.getPrecision=function(){return this.precision_},o.FieldNumber.prototype.doClassValidation_=function(t){return null===t?null:(t=(t=(t=(t=String(t)).replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity"),t=Number(t||0),isNaN(t)?null:(t=Math.min(Math.max(t,this.min_),this.max_),this.precision_&&isFinite(t)&&(t=Math.round(t/this.precision_)*this.precision_),null!=this.decimalPlaces_&&(t=Number(t.toFixed(this.decimalPlaces_))),t))},o.FieldNumber.prototype.widgetCreate_=function(){var t=o.FieldNumber.superClass_.widgetCreate_.call(this);return-1/0<this.min_&&o.utils.aria.setState(t,o.utils.aria.State.VALUEMIN,this.min_),1/0>this.max_&&o.utils.aria.setState(t,o.utils.aria.State.VALUEMAX,this.max_),t},o.fieldRegistry.register("field_number",o.FieldNumber),o.FieldVariable=function(t,e,i,n,r){this.menuGenerator_=o.FieldVariable.dropdownCreate,this.defaultVariableName="string"==typeof t?t:"",this.size_=new o.utils.Size(0,0),r&&this.configure_(r),e&&this.setValidator(e),r||this.setTypes_(i,n)},o.utils.object.inherits(o.FieldVariable,o.FieldDropdown),o.FieldVariable.fromJson=function(t){var e=o.utils.replaceMessageReferences(t.variable);return new o.FieldVariable(e,void 0,void 0,void 0,t)},o.FieldVariable.prototype.SERIALIZABLE=!0,o.FieldVariable.prototype.configure_=function(t){o.FieldVariable.superClass_.configure_.call(this,t),this.setTypes_(t.variableTypes,t.defaultType)},o.FieldVariable.prototype.initModel=function(){if(!this.variable_){var t=o.Variables.getOrCreateVariablePackage(this.sourceBlock_.workspace,null,this.defaultVariableName,this.defaultType_);this.doValueUpdate_(t.getId())}},o.FieldVariable.prototype.shouldAddBorderRect_=function(){return o.FieldVariable.superClass_.shouldAddBorderRect_.call(this)&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||"variables_get"!=this.sourceBlock_.type)},o.FieldVariable.prototype.fromXml=function(t){var e=t.getAttribute("id"),i=t.textContent,n=t.getAttribute("variabletype")||t.getAttribute("variableType")||"";if(e=o.Variables.getOrCreateVariablePackage(this.sourceBlock_.workspace,e,i,n),null!=n&&n!==e.type)throw Error("Serialized variable type with id '"+e.getId()+"' had type "+e.type+", and does not match variable field that references it: "+o.Xml.domToText(t)+".");this.setValue(e.getId())},o.FieldVariable.prototype.toXml=function(t){return this.initModel(),t.id=this.variable_.getId(),t.textContent=this.variable_.name,this.variable_.type&&t.setAttribute("variabletype",this.variable_.type),t},o.FieldVariable.prototype.setSourceBlock=function(t){if(t.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");o.FieldVariable.superClass_.setSourceBlock.call(this,t)},o.FieldVariable.prototype.getValue=function(){return this.variable_?this.variable_.getId():null},o.FieldVariable.prototype.getText=function(){return this.variable_?this.variable_.name:""},o.FieldVariable.prototype.getVariable=function(){return this.variable_},o.FieldVariable.prototype.getValidator=function(){return this.variable_?this.validator_:null},o.FieldVariable.prototype.doClassValidation_=function(t){if(null===t)return null;var e=o.Variables.getVariable(this.sourceBlock_.workspace,t);return e?(e=e.type,this.typeIsAllowed_(e)?t:(console.warn("Variable type doesn't match this field!  Type was "+e),null)):(console.warn("Variable id doesn't point to a real variable! ID was "+t),null)},o.FieldVariable.prototype.doValueUpdate_=function(t){this.variable_=o.Variables.getVariable(this.sourceBlock_.workspace,t),o.FieldVariable.superClass_.doValueUpdate_.call(this,t)},o.FieldVariable.prototype.typeIsAllowed_=function(t){var e=this.getVariableTypes_();if(!e)return!0;for(var o=0;o<e.length;o++)if(t==e[o])return!0;return!1},o.FieldVariable.prototype.getVariableTypes_=function(){var t=this.variableTypes;if(null===t&&this.sourceBlock_&&this.sourceBlock_.workspace)return this.sourceBlock_.workspace.getVariableTypes();if(0==(t=t||[""]).length)throw t=this.getText(),Error("'variableTypes' of field variable "+t+" was an empty list");return t},o.FieldVariable.prototype.setTypes_=function(t,e){if(e=e||"",null==t||null==t)t=null;else{if(!Array.isArray(t))throw Error("'variableTypes' was not an array in the definition of a FieldVariable");for(var o=!1,i=0;i<t.length;i++)t[i]==e&&(o=!0);if(!o)throw Error("Invalid default type '"+e+"' in the definition of a FieldVariable")}this.defaultType_=e,this.variableTypes=t},o.FieldVariable.prototype.refreshVariableName=function(){this.forceRerender()},o.FieldVariable.dropdownCreate=function(){if(!this.variable_)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");var t=this.getText(),e=[];if(this.sourceBlock_&&this.sourceBlock_.workspace)for(var i=this.getVariableTypes_(),n=0;n<i.length;n++){var r=this.sourceBlock_.workspace.getVariablesOfType(i[n]);e=e.concat(r)}for(e.sort(o.VariableModel.compareByName),i=[],n=0;n<e.length;n++)i[n]=[e[n].name,e[n].getId()];return i.push([o.Msg.RENAME_VARIABLE,o.RENAME_VARIABLE_ID]),o.Msg.DELETE_VARIABLE&&i.push([o.Msg.DELETE_VARIABLE.replace("%1",t),o.DELETE_VARIABLE_ID]),i},o.FieldVariable.prototype.onItemSelected_=function(t,e){if(t=e.getValue(),this.sourceBlock_&&this.sourceBlock_.workspace){if(t==o.RENAME_VARIABLE_ID)return void o.Variables.renameVariable(this.sourceBlock_.workspace,this.variable_);if(t==o.DELETE_VARIABLE_ID)return void this.sourceBlock_.workspace.deleteVariableById(this.variable_.getId())}this.setValue(t)},o.FieldVariable.prototype.referencesVariables=function(){return!0},o.fieldRegistry.register("field_variable",o.FieldVariable),o.utils.svgPaths={},o.utils.svgPaths.point=function(t,e){return" "+t+","+e+" "},o.utils.svgPaths.curve=function(t,e){return" "+t+e.join("")},o.utils.svgPaths.moveTo=function(t,e){return" M "+t+","+e+" "},o.utils.svgPaths.moveBy=function(t,e){return" m "+t+","+e+" "},o.utils.svgPaths.lineTo=function(t,e){return" l "+t+","+e+" "},o.utils.svgPaths.line=function(t){return" l"+t.join("")},o.utils.svgPaths.lineOnAxis=function(t,e){return" "+t+" "+e+" "},o.utils.svgPaths.arc=function(t,e,o,i){return t+" "+o+" "+o+" "+e+i},o.blockRendering.ConstantProvider=function(){this.NO_PADDING=0,this.SMALL_PADDING=3,this.MEDIUM_PADDING=5,this.MEDIUM_LARGE_PADDING=8,this.LARGE_PADDING=10,this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING,this.TAB_HEIGHT=15,this.TAB_OFFSET_FROM_TOP=5,this.TAB_VERTICAL_OVERLAP=2.5,this.TAB_WIDTH=8,this.NOTCH_WIDTH=15,this.NOTCH_HEIGHT=4,this.MIN_BLOCK_WIDTH=12,this.EMPTY_BLOCK_SPACER_HEIGHT=16,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT,this.CORNER_RADIUS=8,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=15,this.STATEMENT_BOTTOM_SPACER=0,this.STATEMENT_INPUT_PADDING_LEFT=20,this.BETWEEN_STATEMENT_PADDING_Y=4,this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.ADD_START_HATS=!1,this.START_HAT_HEIGHT=15,this.START_HAT_WIDTH=100,this.SPACER_DEFAULT_HEIGHT=15,this.MIN_BLOCK_HEIGHT=24,this.EMPTY_INLINE_INPUT_PADDING=14.5,this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11,this.EXTERNAL_VALUE_INPUT_PADDING=2,this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT,this.START_POINT=o.utils.svgPaths.moveBy(0,0),this.JAGGED_TEETH_HEIGHT=12,this.JAGGED_TEETH_WIDTH=6,this.FIELD_TEXT_FONTSIZE=11,this.FIELD_TEXT_FONTWEIGHT="normal",this.FIELD_TEXT_FONTFAMILY="sans-serif",this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1,this.FIELD_BORDER_RECT_RADIUS=4,this.FIELD_BORDER_RECT_HEIGHT=16,this.FIELD_BORDER_RECT_X_PADDING=5,this.FIELD_BORDER_RECT_Y_PADDING=3,this.FIELD_BORDER_RECT_COLOUR="#fff",this.FIELD_TEXT_BASELINE_CENTER=!o.utils.userAgent.IE&&!o.utils.userAgent.EDGE,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12,this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1,this.FIELD_COLOUR_DEFAULT_WIDTH=26,this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3,this.randomIdentifier=String(Math.random()).substring(2),this.embossFilterId="",this.embossFilter_=null,this.disabledPatternId="",this.disabledPattern_=null,this.debugFilterId="",this.cssNode_=this.debugFilter_=null,this.CURSOR_COLOUR="#cc0a0a",this.MARKER_COLOUR="#4286f4",this.CURSOR_WS_WIDTH=100,this.WS_CURSOR_HEIGHT=5,this.CURSOR_STACK_PADDING=10,this.CURSOR_BLOCK_PADDING=2,this.CURSOR_STROKE_WIDTH=4,this.FULL_BLOCK_FIELDS=!1,this.INSERTION_MARKER_COLOUR="#000000",this.INSERTION_MARKER_OPACITY=.2,this.SHAPES={PUZZLE:1,NOTCH:2}},o.blockRendering.ConstantProvider.prototype.init=function(){this.JAGGED_TEETH=this.makeJaggedTeeth(),this.NOTCH=this.makeNotch(),this.START_HAT=this.makeStartHat(),this.PUZZLE_TAB=this.makePuzzleTab(),this.INSIDE_CORNERS=this.makeInsideCorners(),this.OUTSIDE_CORNERS=this.makeOutsideCorners()},o.blockRendering.ConstantProvider.prototype.setTheme=function(t){this.blockStyles={};var e,o=t.blockStyles;for(e in o)this.blockStyles[e]=this.validatedBlockStyle_(o[e]);this.setDynamicProperties_(t)},o.blockRendering.ConstantProvider.prototype.setDynamicProperties_=function(t){this.setFontConstants_(t),this.setComponentConstants_(t),this.ADD_START_HATS=null!=t.startHats?t.startHats:this.ADD_START_HATS},o.blockRendering.ConstantProvider.prototype.setFontConstants_=function(t){this.FIELD_TEXT_FONTFAMILY=t.fontStyle&&null!=t.fontStyle.family?t.fontStyle.family:this.FIELD_TEXT_FONTFAMILY,this.FIELD_TEXT_FONTWEIGHT=t.fontStyle&&null!=t.fontStyle.weight?t.fontStyle.weight:this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTSIZE=t.fontStyle&&null!=t.fontStyle.size?t.fontStyle.size:this.FIELD_TEXT_FONTSIZE,t=o.utils.dom.measureFontMetrics("Hg",this.FIELD_TEXT_FONTSIZE+"pt",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY),this.FIELD_TEXT_HEIGHT=t.height,this.FIELD_TEXT_BASELINE=t.baseline},o.blockRendering.ConstantProvider.prototype.setComponentConstants_=function(t){this.CURSOR_COLOUR=t.getComponentStyle("cursorColour")||this.CURSOR_COLOUR,this.MARKER_COLOUR=t.getComponentStyle("markerColour")||this.MARKER_COLOUR,this.INSERTION_MARKER_COLOUR=t.getComponentStyle("insertionMarkerColour")||this.INSERTION_MARKER_COLOUR,this.INSERTION_MARKER_OPACITY=Number(t.getComponentStyle("insertionMarkerOpacity"))||this.INSERTION_MARKER_OPACITY},o.blockRendering.ConstantProvider.prototype.getBlockStyleForColour=function(t){var e="auto_"+t;return this.blockStyles[e]||(this.blockStyles[e]=this.createBlockStyle_(t)),{style:this.blockStyles[e],name:e}},o.blockRendering.ConstantProvider.prototype.getBlockStyle=function(t){return this.blockStyles[t||""]||(t&&0==t.indexOf("auto_")?this.getBlockStyleForColour(t.substring(5)).style:this.createBlockStyle_("#000000"))},o.blockRendering.ConstantProvider.prototype.createBlockStyle_=function(t){return this.validatedBlockStyle_({colourPrimary:t})},o.blockRendering.ConstantProvider.prototype.validatedBlockStyle_=function(t){var e={};return t&&o.utils.object.mixin(e,t),t=o.utils.parseBlockColour(e.colourPrimary||"#000"),e.colourPrimary=t.hex,e.colourSecondary=e.colourSecondary?o.utils.parseBlockColour(e.colourSecondary).hex:this.generateSecondaryColour_(e.colourPrimary),e.colourTertiary=e.colourTertiary?o.utils.parseBlockColour(e.colourTertiary).hex:this.generateTertiaryColour_(e.colourPrimary),e.hat=e.hat||"",e},o.blockRendering.ConstantProvider.prototype.generateSecondaryColour_=function(t){return o.utils.colour.blend("#fff",t,.6)||t},o.blockRendering.ConstantProvider.prototype.generateTertiaryColour_=function(t){return o.utils.colour.blend("#fff",t,.3)||t},o.blockRendering.ConstantProvider.prototype.dispose=function(){this.embossFilter_&&o.utils.dom.removeNode(this.embossFilter_),this.disabledPattern_&&o.utils.dom.removeNode(this.disabledPattern_),this.debugFilter_&&o.utils.dom.removeNode(this.debugFilter_),this.cssNode_=null},o.blockRendering.ConstantProvider.prototype.makeJaggedTeeth=function(){var t=this.JAGGED_TEETH_HEIGHT,e=this.JAGGED_TEETH_WIDTH;return{height:t,width:e,path:o.utils.svgPaths.line([o.utils.svgPaths.point(e,t/4),o.utils.svgPaths.point(2*-e,t/2),o.utils.svgPaths.point(e,t/4)])}},o.blockRendering.ConstantProvider.prototype.makeStartHat=function(){var t=this.START_HAT_HEIGHT,e=this.START_HAT_WIDTH;return{height:t,width:e,path:o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(30,-t),o.utils.svgPaths.point(70,-t),o.utils.svgPaths.point(e,0)])}},o.blockRendering.ConstantProvider.prototype.makePuzzleTab=function(){function t(t){var n=-(t=t?-1:1),r=i/2,s=r+2.5,a=r+.5,l=o.utils.svgPaths.point(-e,t*r);return r=o.utils.svgPaths.point(e,t*r),o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(0,t*s),o.utils.svgPaths.point(-e,n*a),l])+o.utils.svgPaths.curve("s",[o.utils.svgPaths.point(e,2.5*n),r])}var e=this.TAB_WIDTH,i=this.TAB_HEIGHT,n=t(!0),r=t(!1);return{type:this.SHAPES.PUZZLE,width:e,height:i,pathDown:r,pathUp:n}},o.blockRendering.ConstantProvider.prototype.makeNotch=function(){function t(t){return o.utils.svgPaths.line([o.utils.svgPaths.point(t*n,i),o.utils.svgPaths.point(3*t,0),o.utils.svgPaths.point(t*n,-i)])}var e=this.NOTCH_WIDTH,i=this.NOTCH_HEIGHT,n=(e-3)/2,r=t(1),s=t(-1);return{type:this.SHAPES.NOTCH,width:e,height:i,pathLeft:r,pathRight:s}},o.blockRendering.ConstantProvider.prototype.makeInsideCorners=function(){var t=this.CORNER_RADIUS;return{width:t,height:t,pathTop:o.utils.svgPaths.arc("a","0 0,0",t,o.utils.svgPaths.point(-t,t)),pathBottom:o.utils.svgPaths.arc("a","0 0,0",t,o.utils.svgPaths.point(t,t))}},o.blockRendering.ConstantProvider.prototype.makeOutsideCorners=function(){var t=this.CORNER_RADIUS,e=o.utils.svgPaths.moveBy(0,t)+o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(t,-t)),i=o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(t,t)),n=o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(-t,-t));return{topLeft:e,topRight:i,bottomRight:o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(-t,t)),bottomLeft:n,rightHeight:t}},o.blockRendering.ConstantProvider.prototype.shapeFor=function(t){switch(t.type){case o.INPUT_VALUE:case o.OUTPUT_VALUE:return this.PUZZLE_TAB;case o.PREVIOUS_STATEMENT:case o.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type")}},o.blockRendering.ConstantProvider.prototype.createDom=function(t,e,i){this.injectCSS_(e,i),t=o.utils.dom.createSvgElement(o.utils.Svg.DEFS,{},t),e=o.utils.dom.createSvgElement(o.utils.Svg.FILTER,{id:"blocklyEmbossFilter"+this.randomIdentifier},t),o.utils.dom.createSvgElement(o.utils.Svg.FEGAUSSIANBLUR,{in:"SourceAlpha",stdDeviation:1,result:"blur"},e),i=o.utils.dom.createSvgElement(o.utils.Svg.FESPECULARLIGHTING,{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},e),o.utils.dom.createSvgElement(o.utils.Svg.FEPOINTLIGHT,{x:-5e3,y:-1e4,z:2e4},i),o.utils.dom.createSvgElement(o.utils.Svg.FECOMPOSITE,{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},e),o.utils.dom.createSvgElement(o.utils.Svg.FECOMPOSITE,{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},e),this.embossFilterId=e.id,this.embossFilter_=e,e=o.utils.dom.createSvgElement(o.utils.Svg.PATTERN,{id:"blocklyDisabledPattern"+this.randomIdentifier,patternUnits:"userSpaceOnUse",width:10,height:10},t),o.utils.dom.createSvgElement(o.utils.Svg.RECT,{width:10,height:10,fill:"#aaa"},e),o.utils.dom.createSvgElement(o.utils.Svg.PATH,{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},e),this.disabledPatternId=e.id,this.disabledPattern_=e,o.blockRendering.Debug&&(t=o.utils.dom.createSvgElement(o.utils.Svg.FILTER,{id:"blocklyDebugFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},t),e=o.utils.dom.createSvgElement(o.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},t),o.utils.dom.createSvgElement(o.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},e),o.utils.dom.createSvgElement(o.utils.Svg.FEFLOOD,{"flood-color":"#ff0000","flood-opacity":.5,result:"outColor"},t),o.utils.dom.createSvgElement(o.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),this.debugFilterId=t.id,this.debugFilter_=t)},o.blockRendering.ConstantProvider.prototype.injectCSS_=function(t,e){e=this.getCSS_(e),t="blockly-renderer-style-"+t,this.cssNode_=document.getElementById(t);var o=e.join("\n");this.cssNode_?this.cssNode_.firstChild.textContent=o:((e=document.createElement("style")).id=t,t=document.createTextNode(o),e.appendChild(t),document.head.insertBefore(e,document.head.firstChild),this.cssNode_=e)},o.blockRendering.ConstantProvider.prototype.getCSS_=function(t){return[t+" .blocklyText, ",t+" .blocklyFlyoutLabelText {","font: "+this.FIELD_TEXT_FONTWEIGHT+" "+this.FIELD_TEXT_FONTSIZE+"pt "+this.FIELD_TEXT_FONTFAMILY+";","}",t+" .blocklyText {","fill: #fff;","}",t+" .blocklyNonEditableText>rect,",t+" .blocklyEditableText>rect {","fill: "+this.FIELD_BORDER_RECT_COLOUR+";","fill-opacity: .6;","stroke: none;","}",t+" .blocklyNonEditableText>text,",t+" .blocklyEditableText>text {","fill: #000;","}",t+" .blocklyFlyoutLabelText {","fill: #000;","}",t+" .blocklyText.blocklyBubbleText {","fill: #000;","}",t+" .blocklyEditableText:not(.editing):hover>rect {","stroke: #fff;","stroke-width: 2;","}",t+" .blocklyHtmlInput {","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","font-weight: "+this.FIELD_TEXT_FONTWEIGHT+";","}",t+" .blocklySelected>.blocklyPath {","stroke: #fc3;","stroke-width: 3px;","}",t+" .blocklyHighlightedConnectionPath {","stroke: #fc3;","}",t+" .blocklyReplaceable .blocklyPath {","fill-opacity: .5;","}",t+" .blocklyReplaceable .blocklyPathLight,",t+" .blocklyReplaceable .blocklyPathDark {","display: none;","}",t+" .blocklyInsertionMarker>.blocklyPath {","fill-opacity: "+this.INSERTION_MARKER_OPACITY+";","stroke: none;","}"]},o.Events.MarkerMove=function(t,e,i,n){var r=t?t.workspace.id:void 0;n&&n.getType()==o.ASTNode.types.WORKSPACE&&(r=n.getLocation().id),o.Events.MarkerMove.superClass_.constructor.call(this,r),this.blockId=t?t.id:null,this.oldNode=i,this.newNode=n,this.isCursor=e},o.utils.object.inherits(o.Events.MarkerMove,o.Events.UiBase),o.Events.MarkerMove.prototype.type=o.Events.MARKER_MOVE,o.Events.MarkerMove.prototype.toJson=function(){var t=o.Events.MarkerMove.superClass_.toJson.call(this);return t.isCursor=this.isCursor,t.blockId=this.blockId,t.oldNode=this.oldNode,t.newNode=this.newNode,t},o.Events.MarkerMove.prototype.fromJson=function(t){o.Events.MarkerMove.superClass_.fromJson.call(this,t),this.isCursor=t.isCursor,this.blockId=t.blockId,this.oldNode=t.oldNode,this.newNode=t.newNode},o.registry.register(o.registry.Type.EVENT,o.Events.MARKER_MOVE,o.Events.MarkerMove),o.blockRendering.MarkerSvg=function(t,e,o){this.workspace_=t,this.marker_=o,this.parent_=null,this.constants_=e,this.currentMarkerSvg=null,t=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR,this.colour_=o.colour||t},o.blockRendering.MarkerSvg.CURSOR_CLASS="blocklyCursor",o.blockRendering.MarkerSvg.MARKER_CLASS="blocklyMarker",o.blockRendering.MarkerSvg.HEIGHT_MULTIPLIER=.75,o.blockRendering.MarkerSvg.prototype.getSvgRoot=function(){return this.svgGroup_},o.blockRendering.MarkerSvg.prototype.getMarker=function(){return this.marker_},o.blockRendering.MarkerSvg.prototype.isCursor=function(){return"cursor"==this.marker_.type},o.blockRendering.MarkerSvg.prototype.createDom=function(){var t=this.isCursor()?o.blockRendering.MarkerSvg.CURSOR_CLASS:o.blockRendering.MarkerSvg.MARKER_CLASS;return this.svgGroup_=o.utils.dom.createSvgElement(o.utils.Svg.G,{class:t},null),this.createDomInternal_(),this.svgGroup_},o.blockRendering.MarkerSvg.prototype.setParent_=function(t){this.isCursor()?(this.parent_&&this.parent_.setCursorSvg(null),t.setCursorSvg(this.getSvgRoot())):(this.parent_&&this.parent_.setMarkerSvg(null),t.setMarkerSvg(this.getSvgRoot())),this.parent_=t},o.blockRendering.MarkerSvg.prototype.draw=function(t,e){if(e){this.constants_=this.workspace_.getRenderer().getConstants();var o=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=this.marker_.colour||o,this.applyColour_(e),this.showAtLocation_(e),this.fireMarkerEvent_(t,e),void 0!==(t=this.currentMarkerSvg.childNodes[0])&&t.beginElement&&t.beginElement()}else this.hide()},o.blockRendering.MarkerSvg.prototype.showAtLocation_=function(t){var e=t.getLocation();t.getType()==o.ASTNode.types.BLOCK?this.showWithBlock_(t):t.getType()==o.ASTNode.types.OUTPUT?this.showWithOutput_(t):e.type==o.INPUT_VALUE?this.showWithInput_(t):e.type==o.NEXT_STATEMENT?this.showWithNext_(t):t.getType()==o.ASTNode.types.PREVIOUS?this.showWithPrevious_(t):t.getType()==o.ASTNode.types.FIELD?this.showWithField_(t):t.getType()==o.ASTNode.types.WORKSPACE?this.showWithCoordinates_(t):t.getType()==o.ASTNode.types.STACK&&this.showWithStack_(t)},o.blockRendering.MarkerSvg.prototype.showWithBlockPrevOutput_=function(t){var e=(t=t.getSourceBlock()).width,i=t.height,n=i*o.blockRendering.MarkerSvg.HEIGHT_MULTIPLIER,r=this.constants_.CURSOR_BLOCK_PADDING;if(t.previousConnection){var s=this.constants_.shapeFor(t.previousConnection);this.positionPrevious_(e,r,n,s)}else t.outputConnection?(s=this.constants_.shapeFor(t.outputConnection),this.positionOutput_(e,i,s)):this.positionBlock_(e,r,n);this.setParent_(t),this.showCurrent_()},o.blockRendering.MarkerSvg.prototype.showWithBlock_=function(t){this.showWithBlockPrevOutput_(t)},o.blockRendering.MarkerSvg.prototype.showWithPrevious_=function(t){this.showWithBlockPrevOutput_(t)},o.blockRendering.MarkerSvg.prototype.showWithOutput_=function(t){this.showWithBlockPrevOutput_(t)},o.blockRendering.MarkerSvg.prototype.showWithCoordinates_=function(t){var e=t.getWsCoordinate();t=e.x,e=e.y,this.workspace_.RTL&&(t-=this.constants_.CURSOR_WS_WIDTH),this.positionLine_(t,e,this.constants_.CURSOR_WS_WIDTH),this.setParent_(this.workspace_),this.showCurrent_()},o.blockRendering.MarkerSvg.prototype.showWithField_=function(t){var e=(t=t.getLocation()).getSize().width,o=t.getSize().height;this.positionRect_(0,0,e,o),this.setParent_(t),this.showCurrent_()},o.blockRendering.MarkerSvg.prototype.showWithInput_=function(t){var e=(t=t.getLocation()).getSourceBlock();this.positionInput_(t),this.setParent_(e),this.showCurrent_()},o.blockRendering.MarkerSvg.prototype.showWithNext_=function(t){var e=t.getLocation();t=e.getSourceBlock();var o=0;e=e.getOffsetInBlock().y;var i=t.getHeightWidth().width;this.workspace_.RTL&&(o=-i),this.positionLine_(o,e,i),this.setParent_(t),this.showCurrent_()},o.blockRendering.MarkerSvg.prototype.showWithStack_=function(t){var e=(t=t.getLocation()).getHeightWidth(),o=e.width+this.constants_.CURSOR_STACK_PADDING;e=e.height+this.constants_.CURSOR_STACK_PADDING;var i=-this.constants_.CURSOR_STACK_PADDING/2,n=-this.constants_.CURSOR_STACK_PADDING/2,r=i;this.workspace_.RTL&&(r=-(o+i)),this.positionRect_(r,n,o,e),this.setParent_(t),this.showCurrent_()},o.blockRendering.MarkerSvg.prototype.showCurrent_=function(){this.hide(),this.currentMarkerSvg.style.display=""},o.blockRendering.MarkerSvg.prototype.positionBlock_=function(t,e,i){t=o.utils.svgPaths.moveBy(-e,i)+o.utils.svgPaths.lineOnAxis("V",-e)+o.utils.svgPaths.lineOnAxis("H",t+2*e)+o.utils.svgPaths.lineOnAxis("V",i),this.markerBlock_.setAttribute("d",t),this.workspace_.RTL&&this.flipRtl_(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_},o.blockRendering.MarkerSvg.prototype.positionInput_=function(t){var e=t.getOffsetInBlock().x,i=t.getOffsetInBlock().y;t=o.utils.svgPaths.moveTo(0,0)+this.constants_.shapeFor(t).pathDown,this.markerInput_.setAttribute("d",t),this.markerInput_.setAttribute("transform","translate("+e+","+i+")"+(this.workspace_.RTL?" scale(-1 1)":"")),this.currentMarkerSvg=this.markerInput_},o.blockRendering.MarkerSvg.prototype.positionLine_=function(t,e,o){this.markerSvgLine_.setAttribute("x",t),this.markerSvgLine_.setAttribute("y",e),this.markerSvgLine_.setAttribute("width",o),this.currentMarkerSvg=this.markerSvgLine_},o.blockRendering.MarkerSvg.prototype.positionOutput_=function(t,e,i){t=o.utils.svgPaths.moveBy(t,0)+o.utils.svgPaths.lineOnAxis("h",-(t-i.width))+o.utils.svgPaths.lineOnAxis("v",this.constants_.TAB_OFFSET_FROM_TOP)+i.pathDown+o.utils.svgPaths.lineOnAxis("V",e)+o.utils.svgPaths.lineOnAxis("H",t),this.markerBlock_.setAttribute("d",t),this.workspace_.RTL&&this.flipRtl_(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_},o.blockRendering.MarkerSvg.prototype.positionPrevious_=function(t,e,i,n){t=o.utils.svgPaths.moveBy(-e,i)+o.utils.svgPaths.lineOnAxis("V",-e)+o.utils.svgPaths.lineOnAxis("H",this.constants_.NOTCH_OFFSET_LEFT)+n.pathLeft+o.utils.svgPaths.lineOnAxis("H",t+2*e)+o.utils.svgPaths.lineOnAxis("V",i),this.markerBlock_.setAttribute("d",t),this.workspace_.RTL&&this.flipRtl_(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_},o.blockRendering.MarkerSvg.prototype.positionRect_=function(t,e,o,i){this.markerSvgRect_.setAttribute("x",t),this.markerSvgRect_.setAttribute("y",e),this.markerSvgRect_.setAttribute("width",o),this.markerSvgRect_.setAttribute("height",i),this.currentMarkerSvg=this.markerSvgRect_},o.blockRendering.MarkerSvg.prototype.flipRtl_=function(t){t.setAttribute("transform","scale(-1 1)")},o.blockRendering.MarkerSvg.prototype.hide=function(){this.markerSvgLine_.style.display="none",this.markerSvgRect_.style.display="none",this.markerInput_.style.display="none",this.markerBlock_.style.display="none"},o.blockRendering.MarkerSvg.prototype.fireMarkerEvent_=function(t,e){var i=e.getSourceBlock();t=new o.Events.MarkerMove(i,this.isCursor(),t,e),o.Events.fire(t)},o.blockRendering.MarkerSvg.prototype.getBlinkProperties_=function(){return{attributeType:"XML",attributeName:"fill",dur:"1s",values:this.colour_+";transparent;transparent;",repeatCount:"indefinite"}},o.blockRendering.MarkerSvg.prototype.createDomInternal_=function(){if(this.markerSvg_=o.utils.dom.createSvgElement(o.utils.Svg.G,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_),this.markerSvgLine_=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT,style:"display: none"},this.markerSvg_),this.markerSvgRect_=o.utils.dom.createSvgElement(o.utils.Svg.RECT,{class:"blocklyVerticalMarker",rx:10,ry:10,style:"display: none"},this.markerSvg_),this.markerInput_=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{transform:"",style:"display: none"},this.markerSvg_),this.markerBlock_=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{transform:"",style:"display: none",fill:"none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.isCursor()){var t=this.getBlinkProperties_();o.utils.dom.createSvgElement(o.utils.Svg.ANIMATE,t,this.markerSvgLine_),o.utils.dom.createSvgElement(o.utils.Svg.ANIMATE,t,this.markerInput_),t.attributeName="stroke",o.utils.dom.createSvgElement(o.utils.Svg.ANIMATE,t,this.markerBlock_)}return this.markerSvg_},o.blockRendering.MarkerSvg.prototype.applyColour_=function(t){this.markerSvgLine_.setAttribute("fill",this.colour_),this.markerSvgRect_.setAttribute("stroke",this.colour_),this.markerInput_.setAttribute("fill",this.colour_),this.markerBlock_.setAttribute("stroke",this.colour_),this.isCursor()&&(t=this.colour_+";transparent;transparent;",this.markerSvgLine_.firstChild.setAttribute("values",t),this.markerInput_.firstChild.setAttribute("values",t),this.markerBlock_.firstChild.setAttribute("values",t))},o.blockRendering.MarkerSvg.prototype.dispose=function(){this.svgGroup_&&o.utils.dom.removeNode(this.svgGroup_)},o.blockRendering.Types={NONE:0,FIELD:1,HAT:2,ICON:4,SPACER:8,BETWEEN_ROW_SPACER:16,IN_ROW_SPACER:32,EXTERNAL_VALUE_INPUT:64,INPUT:128,INLINE_INPUT:256,STATEMENT_INPUT:512,CONNECTION:1024,PREVIOUS_CONNECTION:2048,NEXT_CONNECTION:4096,OUTPUT_CONNECTION:8192,CORNER:16384,LEFT_SQUARE_CORNER:32768,LEFT_ROUND_CORNER:65536,RIGHT_SQUARE_CORNER:131072,RIGHT_ROUND_CORNER:262144,JAGGED_EDGE:524288,ROW:1048576,TOP_ROW:2097152,BOTTOM_ROW:4194304,INPUT_ROW:8388608},o.blockRendering.Types.LEFT_CORNER=o.blockRendering.Types.LEFT_SQUARE_CORNER|o.blockRendering.Types.LEFT_ROUND_CORNER,o.blockRendering.Types.RIGHT_CORNER=o.blockRendering.Types.RIGHT_SQUARE_CORNER|o.blockRendering.Types.RIGHT_ROUND_CORNER,o.blockRendering.Types.nextTypeValue_=16777216,o.blockRendering.Types.getType=function(t){return Object.prototype.hasOwnProperty.call(o.blockRendering.Types,t)||(o.blockRendering.Types[t]=o.blockRendering.Types.nextTypeValue_,o.blockRendering.Types.nextTypeValue_<<=1),o.blockRendering.Types[t]},o.blockRendering.Types.isField=function(t){return t.type&o.blockRendering.Types.FIELD},o.blockRendering.Types.isHat=function(t){return t.type&o.blockRendering.Types.HAT},o.blockRendering.Types.isIcon=function(t){return t.type&o.blockRendering.Types.ICON},o.blockRendering.Types.isSpacer=function(t){return t.type&o.blockRendering.Types.SPACER},o.blockRendering.Types.isInRowSpacer=function(t){return t.type&o.blockRendering.Types.IN_ROW_SPACER},o.blockRendering.Types.isInput=function(t){return t.type&o.blockRendering.Types.INPUT},o.blockRendering.Types.isExternalInput=function(t){return t.type&o.blockRendering.Types.EXTERNAL_VALUE_INPUT},o.blockRendering.Types.isInlineInput=function(t){return t.type&o.blockRendering.Types.INLINE_INPUT},o.blockRendering.Types.isStatementInput=function(t){return t.type&o.blockRendering.Types.STATEMENT_INPUT},o.blockRendering.Types.isPreviousConnection=function(t){return t.type&o.blockRendering.Types.PREVIOUS_CONNECTION},o.blockRendering.Types.isNextConnection=function(t){return t.type&o.blockRendering.Types.NEXT_CONNECTION},o.blockRendering.Types.isPreviousOrNextConnection=function(t){return t.type&(o.blockRendering.Types.PREVIOUS_CONNECTION|o.blockRendering.Types.NEXT_CONNECTION)},o.blockRendering.Types.isLeftRoundedCorner=function(t){return t.type&o.blockRendering.Types.LEFT_ROUND_CORNER},o.blockRendering.Types.isRightRoundedCorner=function(t){return t.type&o.blockRendering.Types.RIGHT_ROUND_CORNER},o.blockRendering.Types.isLeftSquareCorner=function(t){return t.type&o.blockRendering.Types.LEFT_SQUARE_CORNER},o.blockRendering.Types.isRightSquareCorner=function(t){return t.type&o.blockRendering.Types.RIGHT_SQUARE_CORNER},o.blockRendering.Types.isCorner=function(t){return t.type&o.blockRendering.Types.CORNER},o.blockRendering.Types.isJaggedEdge=function(t){return t.type&o.blockRendering.Types.JAGGED_EDGE},o.blockRendering.Types.isRow=function(t){return t.type&o.blockRendering.Types.ROW},o.blockRendering.Types.isBetweenRowSpacer=function(t){return t.type&o.blockRendering.Types.BETWEEN_ROW_SPACER},o.blockRendering.Types.isTopRow=function(t){return t.type&o.blockRendering.Types.TOP_ROW},o.blockRendering.Types.isBottomRow=function(t){return t.type&o.blockRendering.Types.BOTTOM_ROW},o.blockRendering.Types.isTopOrBottomRow=function(t){return t.type&(o.blockRendering.Types.TOP_ROW|o.blockRendering.Types.BOTTOM_ROW)},o.blockRendering.Types.isInputRow=function(t){return t.type&o.blockRendering.Types.INPUT_ROW},o.blockRendering.Measurable=function(t){this.height=this.width=0,this.type=o.blockRendering.Types.NONE,this.centerline=this.xPos=0,this.constants_=t,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT},o.blockRendering.Connection=function(t,e){o.blockRendering.Connection.superClass_.constructor.call(this,t),this.connectionModel=e,this.shape=this.constants_.shapeFor(e),this.isDynamicShape=!!this.shape.isDynamic,this.type|=o.blockRendering.Types.CONNECTION},o.utils.object.inherits(o.blockRendering.Connection,o.blockRendering.Measurable),o.blockRendering.OutputConnection=function(t,e){o.blockRendering.OutputConnection.superClass_.constructor.call(this,t,e),this.type|=o.blockRendering.Types.OUTPUT_CONNECTION,this.height=this.isDynamicShape?0:this.shape.height,this.startX=this.width=this.isDynamicShape?0:this.shape.width,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX=0},o.utils.object.inherits(o.blockRendering.OutputConnection,o.blockRendering.Connection),o.blockRendering.PreviousConnection=function(t,e){o.blockRendering.PreviousConnection.superClass_.constructor.call(this,t,e),this.type|=o.blockRendering.Types.PREVIOUS_CONNECTION,this.height=this.shape.height,this.width=this.shape.width},o.utils.object.inherits(o.blockRendering.PreviousConnection,o.blockRendering.Connection),o.blockRendering.NextConnection=function(t,e){o.blockRendering.NextConnection.superClass_.constructor.call(this,t,e),this.type|=o.blockRendering.Types.NEXT_CONNECTION,this.height=this.shape.height,this.width=this.shape.width},o.utils.object.inherits(o.blockRendering.NextConnection,o.blockRendering.Connection),o.blockRendering.InputConnection=function(t,e){o.blockRendering.InputConnection.superClass_.constructor.call(this,t,e.connection),this.type|=o.blockRendering.Types.INPUT,this.input=e,this.align=e.align,(this.connectedBlock=e.connection&&e.connection.targetBlock()?e.connection.targetBlock():null)?(t=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=t.width,this.connectedBlockHeight=t.height):this.connectedBlockHeight=this.connectedBlockWidth=0,this.connectionOffsetY=this.connectionOffsetX=0},o.utils.object.inherits(o.blockRendering.InputConnection,o.blockRendering.Connection),o.blockRendering.InlineInput=function(t,e){o.blockRendering.InlineInput.superClass_.constructor.call(this,t,e),this.type|=o.blockRendering.Types.INLINE_INPUT,this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING),this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height,this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width,this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1)),this.connectionOffsetY=this.isDynamicShape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX=this.isDynamicShape?this.shape.connectionOffsetX(this.connectionWidth):0},o.utils.object.inherits(o.blockRendering.InlineInput,o.blockRendering.InputConnection),o.blockRendering.StatementInput=function(t,e){o.blockRendering.StatementInput.superClass_.constructor.call(this,t,e),this.type|=o.blockRendering.Types.STATEMENT_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT,this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width},o.utils.object.inherits(o.blockRendering.StatementInput,o.blockRendering.InputConnection),o.blockRendering.ExternalValueInput=function(t,e){o.blockRendering.ExternalValueInput.superClass_.constructor.call(this,t,e),this.type|=o.blockRendering.Types.EXTERNAL_VALUE_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height,this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionHeight=this.shape.height,this.connectionWidth=this.shape.width},o.utils.object.inherits(o.blockRendering.ExternalValueInput,o.blockRendering.InputConnection),o.blockRendering.Icon=function(t,e){o.blockRendering.Icon.superClass_.constructor.call(this,t),this.icon=e,this.isVisible=e.isVisible(),this.type|=o.blockRendering.Types.ICON,t=e.getCorrectedSize(),this.height=t.height,this.width=t.width},o.utils.object.inherits(o.blockRendering.Icon,o.blockRendering.Measurable),o.blockRendering.JaggedEdge=function(t){o.blockRendering.JaggedEdge.superClass_.constructor.call(this,t),this.type|=o.blockRendering.Types.JAGGED_EDGE,this.height=this.constants_.JAGGED_TEETH.height,this.width=this.constants_.JAGGED_TEETH.width},o.utils.object.inherits(o.blockRendering.JaggedEdge,o.blockRendering.Measurable),o.blockRendering.Field=function(t,e,i){o.blockRendering.Field.superClass_.constructor.call(this,t),this.field=e,this.isEditable=e.EDITABLE,this.flipRtl=e.getFlipRtl(),this.type|=o.blockRendering.Types.FIELD,t=this.field.getSize(),this.height=t.height,this.width=t.width,this.parentInput=i},o.utils.object.inherits(o.blockRendering.Field,o.blockRendering.Measurable),o.blockRendering.Hat=function(t){o.blockRendering.Hat.superClass_.constructor.call(this,t),this.type|=o.blockRendering.Types.HAT,this.height=this.constants_.START_HAT.height,this.width=this.constants_.START_HAT.width,this.ascenderHeight=this.height},o.utils.object.inherits(o.blockRendering.Hat,o.blockRendering.Measurable),o.blockRendering.SquareCorner=function(t,e){o.blockRendering.SquareCorner.superClass_.constructor.call(this,t),this.type=(e&&"left"!=e?o.blockRendering.Types.RIGHT_SQUARE_CORNER:o.blockRendering.Types.LEFT_SQUARE_CORNER)|o.blockRendering.Types.CORNER,this.width=this.height=this.constants_.NO_PADDING},o.utils.object.inherits(o.blockRendering.SquareCorner,o.blockRendering.Measurable),o.blockRendering.RoundCorner=function(t,e){o.blockRendering.RoundCorner.superClass_.constructor.call(this,t),this.type=(e&&"left"!=e?o.blockRendering.Types.RIGHT_ROUND_CORNER:o.blockRendering.Types.LEFT_ROUND_CORNER)|o.blockRendering.Types.CORNER,this.width=this.constants_.CORNER_RADIUS,this.height=this.constants_.CORNER_RADIUS/2},o.utils.object.inherits(o.blockRendering.RoundCorner,o.blockRendering.Measurable),o.blockRendering.InRowSpacer=function(t,e){o.blockRendering.InRowSpacer.superClass_.constructor.call(this,t),this.type=this.type|o.blockRendering.Types.SPACER|o.blockRendering.Types.IN_ROW_SPACER,this.width=e,this.height=this.constants_.SPACER_DEFAULT_HEIGHT},o.utils.object.inherits(o.blockRendering.InRowSpacer,o.blockRendering.Measurable),o.blockRendering.Row=function(t){this.type=o.blockRendering.Types.ROW,this.elements=[],this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0,this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=this.hasStatement=this.hasExternalInput=!1,this.constants_=t,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT,this.align=null},o.blockRendering.Row.prototype.measure=function(){throw Error("Unexpected attempt to measure a base Row.")},o.blockRendering.Row.prototype.getLastInput=function(){for(var t,e=this.elements.length-1;t=this.elements[e];e--)if(o.blockRendering.Types.isInput(t))return t;return null},o.blockRendering.Row.prototype.startsWithElemSpacer=function(){return!0},o.blockRendering.Row.prototype.endsWithElemSpacer=function(){return!0},o.blockRendering.Row.prototype.getFirstSpacer=function(){for(var t,e=0;t=this.elements[e];e++)if(o.blockRendering.Types.isSpacer(t))return t;return null},o.blockRendering.Row.prototype.getLastSpacer=function(){for(var t,e=this.elements.length-1;t=this.elements[e];e--)if(o.blockRendering.Types.isSpacer(t))return t;return null},o.blockRendering.TopRow=function(t){o.blockRendering.TopRow.superClass_.constructor.call(this,t),this.type|=o.blockRendering.Types.TOP_ROW,this.ascenderHeight=this.capline=0,this.hasPreviousConnection=!1,this.connection=null},o.utils.object.inherits(o.blockRendering.TopRow,o.blockRendering.Row),o.blockRendering.TopRow.prototype.hasLeftSquareCorner=function(t){var e=(t.hat?"cap"===t.hat:this.constants_.ADD_START_HATS)&&!t.outputConnection&&!t.previousConnection,o=t.getPreviousBlock();return!!t.outputConnection||e||!!o&&o.getNextBlock()==t},o.blockRendering.TopRow.prototype.hasRightSquareCorner=function(t){return!0},o.blockRendering.TopRow.prototype.measure=function(){for(var t,e=0,i=0,n=0,r=0;t=this.elements[r];r++)i+=t.width,o.blockRendering.Types.isSpacer(t)||(o.blockRendering.Types.isHat(t)?n=Math.max(n,t.ascenderHeight):e=Math.max(e,t.height));this.width=Math.max(this.minWidth,i),this.height=Math.max(this.minHeight,e)+n,this.capline=this.ascenderHeight=n,this.widthWithConnectedBlocks=this.width},o.blockRendering.TopRow.prototype.startsWithElemSpacer=function(){return!1},o.blockRendering.TopRow.prototype.endsWithElemSpacer=function(){return!1},o.blockRendering.BottomRow=function(t){o.blockRendering.BottomRow.superClass_.constructor.call(this,t),this.type|=o.blockRendering.Types.BOTTOM_ROW,this.hasNextConnection=!1,this.connection=null,this.baseline=this.descenderHeight=0},o.utils.object.inherits(o.blockRendering.BottomRow,o.blockRendering.Row),o.blockRendering.BottomRow.prototype.hasLeftSquareCorner=function(t){return!!t.outputConnection||!!t.getNextBlock()},o.blockRendering.BottomRow.prototype.hasRightSquareCorner=function(t){return!0},o.blockRendering.BottomRow.prototype.measure=function(){for(var t,e=0,i=0,n=0,r=0;t=this.elements[r];r++)i+=t.width,o.blockRendering.Types.isSpacer(t)||(o.blockRendering.Types.isNextConnection(t)?n=Math.max(n,t.height):e=Math.max(e,t.height));this.width=Math.max(this.minWidth,i),this.height=Math.max(this.minHeight,e)+n,this.descenderHeight=n,this.widthWithConnectedBlocks=this.width},o.blockRendering.BottomRow.prototype.startsWithElemSpacer=function(){return!1},o.blockRendering.BottomRow.prototype.endsWithElemSpacer=function(){return!1},o.blockRendering.SpacerRow=function(t,e,i){o.blockRendering.SpacerRow.superClass_.constructor.call(this,t),this.type=this.type|o.blockRendering.Types.SPACER|o.blockRendering.Types.BETWEEN_ROW_SPACER,this.width=i,this.height=e,this.followsStatement=!1,this.widthWithConnectedBlocks=0,this.elements=[new o.blockRendering.InRowSpacer(this.constants_,i)]},o.utils.object.inherits(o.blockRendering.SpacerRow,o.blockRendering.Row),o.blockRendering.SpacerRow.prototype.measure=function(){},o.blockRendering.InputRow=function(t){o.blockRendering.InputRow.superClass_.constructor.call(this,t),this.type|=o.blockRendering.Types.INPUT_ROW,this.connectedBlockWidths=0},o.utils.object.inherits(o.blockRendering.InputRow,o.blockRendering.Row),o.blockRendering.InputRow.prototype.measure=function(){this.width=this.minWidth,this.height=this.minHeight;for(var t,e=0,i=0;t=this.elements[i];i++)this.width+=t.width,o.blockRendering.Types.isInput(t)&&(o.blockRendering.Types.isStatementInput(t)?e+=t.connectedBlockWidth:o.blockRendering.Types.isExternalInput(t)&&0!=t.connectedBlockWidth&&(e+=t.connectedBlockWidth-t.connectionWidth)),o.blockRendering.Types.isSpacer(t)||(this.height=Math.max(this.height,t.height));this.connectedBlockWidths=e,this.widthWithConnectedBlocks=this.width+e},o.blockRendering.InputRow.prototype.endsWithElemSpacer=function(){return!this.hasExternalInput&&!this.hasStatement},o.blockRendering.RenderInfo=function(t,e){this.block_=e,this.renderer_=t,this.constants_=this.renderer_.getConstants(),this.outputConnection=e.outputConnection?new o.blockRendering.OutputConnection(this.constants_,e.outputConnection):null,this.isInline=e.getInputsInline()&&!e.isCollapsed(),this.isCollapsed=e.isCollapsed(),this.isInsertionMarker=e.isInsertionMarker(),this.RTL=e.RTL,this.statementEdge=this.width=this.widthWithChildren=this.height=0,this.rows=[],this.inputRows=[],this.hiddenIcons=[],this.topRow=new o.blockRendering.TopRow(this.constants_),this.bottomRow=new o.blockRendering.BottomRow(this.constants_),this.startY=this.startX=0},o.blockRendering.RenderInfo.prototype.getRenderer=function(){return this.renderer_},o.blockRendering.RenderInfo.prototype.measure=function(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()},o.blockRendering.RenderInfo.prototype.createRows_=function(){this.populateTopRow_(),this.rows.push(this.topRow);var t=new o.blockRendering.InputRow(this.constants_);this.inputRows.push(t);var e=this.block_.getIcons();if(e.length)for(var i,n=0;i=e[n];n++){var r=new o.blockRendering.Icon(this.constants_,i);this.isCollapsed&&i.collapseHidden?this.hiddenIcons.push(r):t.elements.push(r)}for(i=null,n=0;e=this.block_.inputList[n];n++)if(e.isVisible()){for(this.shouldStartNewRow_(e,i)&&(this.rows.push(t),t=new o.blockRendering.InputRow(this.constants_),this.inputRows.push(t)),i=0;r=e.fieldRow[i];i++)t.elements.push(new o.blockRendering.Field(this.constants_,r,e));this.addInput_(e,t),i=e}this.isCollapsed&&(t.hasJaggedEdge=!0,t.elements.push(new o.blockRendering.JaggedEdge(this.constants_))),(t.elements.length||t.hasDummyInput)&&this.rows.push(t),this.populateBottomRow_(),this.rows.push(this.bottomRow)},o.blockRendering.RenderInfo.prototype.populateTopRow_=function(){var t=!!this.block_.previousConnection,e=(this.block_.hat?"cap"===this.block_.hat:this.constants_.ADD_START_HATS)&&!this.outputConnection&&!t;this.topRow.hasLeftSquareCorner(this.block_)?this.topRow.elements.push(new o.blockRendering.SquareCorner(this.constants_)):this.topRow.elements.push(new o.blockRendering.RoundCorner(this.constants_)),e?(t=new o.blockRendering.Hat(this.constants_),this.topRow.elements.push(t),this.topRow.capline=t.ascenderHeight):t&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new o.blockRendering.PreviousConnection(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection)),this.block_.inputList.length&&this.block_.inputList[0].type==o.NEXT_STATEMENT&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT,this.topRow.hasRightSquareCorner(this.block_)?this.topRow.elements.push(new o.blockRendering.SquareCorner(this.constants_,"right")):this.topRow.elements.push(new o.blockRendering.RoundCorner(this.constants_,"right"))},o.blockRendering.RenderInfo.prototype.populateBottomRow_=function(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection,this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1].type==o.NEXT_STATEMENT?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new o.blockRendering.SquareCorner(this.constants_)):this.bottomRow.elements.push(new o.blockRendering.RoundCorner(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new o.blockRendering.NextConnection(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new o.blockRendering.SquareCorner(this.constants_,"right")):this.bottomRow.elements.push(new o.blockRendering.RoundCorner(this.constants_,"right"))},o.blockRendering.RenderInfo.prototype.addInput_=function(t,e){this.isInline&&t.type==o.INPUT_VALUE?(e.elements.push(new o.blockRendering.InlineInput(this.constants_,t)),e.hasInlineInput=!0):t.type==o.NEXT_STATEMENT?(e.elements.push(new o.blockRendering.StatementInput(this.constants_,t)),e.hasStatement=!0):t.type==o.INPUT_VALUE?(e.elements.push(new o.blockRendering.ExternalValueInput(this.constants_,t)),e.hasExternalInput=!0):t.type==o.DUMMY_INPUT&&(e.minHeight=Math.max(e.minHeight,t.getSourceBlock()&&t.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),e.hasDummyInput=!0),null==e.align&&(e.align=t.align)},o.blockRendering.RenderInfo.prototype.shouldStartNewRow_=function(t,e){return!(!e||t.type!=o.NEXT_STATEMENT&&e.type!=o.NEXT_STATEMENT&&(t.type!=o.INPUT_VALUE&&t.type!=o.DUMMY_INPUT||this.isInline))},o.blockRendering.RenderInfo.prototype.addElemSpacing_=function(){for(var t,e=0;t=this.rows[e];e++){var i=t.elements;if(t.elements=[],t.startsWithElemSpacer()&&t.elements.push(new o.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,i[0]))),i.length){for(var n=0;n<i.length-1;n++){t.elements.push(i[n]);var r=this.getInRowSpacing_(i[n],i[n+1]);t.elements.push(new o.blockRendering.InRowSpacer(this.constants_,r))}t.elements.push(i[i.length-1]),t.endsWithElemSpacer()&&t.elements.push(new o.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(i[i.length-1],null)))}}},o.blockRendering.RenderInfo.prototype.getInRowSpacing_=function(t,e){if(!t&&e&&o.blockRendering.Types.isStatementInput(e))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(t&&o.blockRendering.Types.isInput(t)&&!e){if(o.blockRendering.Types.isExternalInput(t))return this.constants_.NO_PADDING;if(o.blockRendering.Types.isInlineInput(t))return this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isStatementInput(t))return this.constants_.NO_PADDING}return t&&o.blockRendering.Types.isLeftSquareCorner(t)&&e&&(o.blockRendering.Types.isPreviousConnection(e)||o.blockRendering.Types.isNextConnection(e))?e.notchOffset:t&&o.blockRendering.Types.isLeftRoundedCorner(t)&&e&&(o.blockRendering.Types.isPreviousConnection(e)||o.blockRendering.Types.isNextConnection(e))?e.notchOffset-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING},o.blockRendering.RenderInfo.prototype.computeBounds_=function(){for(var t,e=0,o=0,i=0,n=0;t=this.rows[n];n++){if(t.measure(),o=Math.max(o,t.width),t.hasStatement){var r=t.getLastInput();e=Math.max(e,t.width-r.width)}i=Math.max(i,t.widthWithConnectedBlocks)}for(this.statementEdge=e,this.width=o,n=0;t=this.rows[n];n++)t.hasStatement&&(t.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(o,i),this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)},o.blockRendering.RenderInfo.prototype.alignRowElements_=function(){for(var t,e=0;t=this.rows[e];e++)if(t.hasStatement)this.alignStatementRow_(t);else{var i=t.width;0<(i=this.getDesiredRowWidth_(t)-i)&&this.addAlignmentPadding_(t,i),o.blockRendering.Types.isTopOrBottomRow(t)&&(t.widthWithConnectedBlocks=t.width)}},o.blockRendering.RenderInfo.prototype.getDesiredRowWidth_=function(t){return this.width-this.startX},o.blockRendering.RenderInfo.prototype.addAlignmentPadding_=function(t,e){var i=t.getFirstSpacer(),n=t.getLastSpacer();(t.hasExternalInput||t.hasStatement)&&(t.widthWithConnectedBlocks+=e),t.align==o.ALIGN_LEFT?n.width+=e:t.align==o.ALIGN_CENTRE?(i.width+=e/2,n.width+=e/2):t.align==o.ALIGN_RIGHT?i.width+=e:n.width+=e,t.width+=e},o.blockRendering.RenderInfo.prototype.alignStatementRow_=function(t){var e=t.getLastInput(),o=t.width-e.width,i=this.statementEdge;0<(o=i-o)&&this.addAlignmentPadding_(t,o),o=t.width,i=this.getDesiredRowWidth_(t),e.width+=i-o,e.height=Math.max(e.height,t.height),t.width+=i-o,t.widthWithConnectedBlocks=Math.max(t.width,this.statementEdge+t.connectedBlockWidths)},o.blockRendering.RenderInfo.prototype.addRowSpacing_=function(){var t=this.rows;this.rows=[];for(var e=0;e<t.length;e++)this.rows.push(t[e]),e!=t.length-1&&this.rows.push(this.makeSpacerRow_(t[e],t[e+1]))},o.blockRendering.RenderInfo.prototype.makeSpacerRow_=function(t,e){var i=this.getSpacerRowHeight_(t,e),n=this.getSpacerRowWidth_(t,e);return i=new o.blockRendering.SpacerRow(this.constants_,i,n),t.hasStatement&&(i.followsStatement=!0),e.hasStatement&&(i.precedesStatement=!0),i},o.blockRendering.RenderInfo.prototype.getSpacerRowWidth_=function(t,e){return this.width-this.startX},o.blockRendering.RenderInfo.prototype.getSpacerRowHeight_=function(t,e){return this.constants_.MEDIUM_PADDING},o.blockRendering.RenderInfo.prototype.getElemCenterline_=function(t,e){return o.blockRendering.Types.isSpacer(e)?t.yPos+e.height/2:o.blockRendering.Types.isBottomRow(t)?(t=t.yPos+t.height-t.descenderHeight,o.blockRendering.Types.isNextConnection(e)?t+e.height/2:t-e.height/2):o.blockRendering.Types.isTopRow(t)?o.blockRendering.Types.isHat(e)?t.capline-e.height/2:t.capline+e.height/2:t.yPos+t.height/2},o.blockRendering.RenderInfo.prototype.recordElemPositions_=function(t){for(var e,i=t.xPos,n=0;e=t.elements[n];n++)o.blockRendering.Types.isSpacer(e)&&(e.height=t.height),e.xPos=i,e.centerline=this.getElemCenterline_(t,e),i+=e.width},o.blockRendering.RenderInfo.prototype.finalize_=function(){for(var t,e=0,o=0,i=0;t=this.rows[i];i++)t.yPos=o,t.xPos=this.startX,o+=t.height,e=Math.max(e,t.widthWithConnectedBlocks),this.recordElemPositions_(t);this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(e=Math.max(e,this.block_.nextConnection.targetBlock().getHeightWidth().width)),this.widthWithChildren=e+this.startX,this.height=o,this.startY=this.topRow.capline,this.bottomRow.baseline=o-this.bottomRow.descenderHeight},o.blockRendering.Drawer=function(t,e){this.block_=t,this.info_=e,this.topLeft_=t.getRelativeToSurfaceXY(),this.inlinePath_=this.outlinePath_="",this.constants_=e.getRenderer().getConstants()},o.blockRendering.Drawer.prototype.draw=function(){this.hideHiddenIcons_(),this.drawOutline_(),this.drawInternals_(),this.block_.pathObject.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&this.block_.pathObject.flipRTL(),o.blockRendering.useDebugger&&this.block_.renderingDebugger.drawDebug(this.block_,this.info_),this.recordSizeOnBlock_()},o.blockRendering.Drawer.prototype.recordSizeOnBlock_=function(){this.block_.height=this.info_.height,this.block_.width=this.info_.widthWithChildren},o.blockRendering.Drawer.prototype.hideHiddenIcons_=function(){for(var t,e=0;t=this.info_.hiddenIcons[e];e++)t.icon.iconGroup_.setAttribute("display","none")},o.blockRendering.Drawer.prototype.drawOutline_=function(){this.drawTop_();for(var t=1;t<this.info_.rows.length-1;t++){var e=this.info_.rows[t];e.hasJaggedEdge?this.drawJaggedEdge_(e):e.hasStatement?this.drawStatementInput_(e):e.hasExternalInput?this.drawValueInput_(e):this.drawRightSideRow_(e)}this.drawBottom_(),this.drawLeft_()},o.blockRendering.Drawer.prototype.drawTop_=function(){var t=this.info_.topRow,e=t.elements;this.positionPreviousConnection_(),this.outlinePath_+=o.utils.svgPaths.moveBy(t.xPos,this.info_.startY);for(var i,n=0;i=e[n];n++)o.blockRendering.Types.isLeftRoundedCorner(i)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:o.blockRendering.Types.isRightRoundedCorner(i)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:o.blockRendering.Types.isPreviousConnection(i)?this.outlinePath_+=i.shape.pathLeft:o.blockRendering.Types.isHat(i)?this.outlinePath_+=this.constants_.START_HAT.path:o.blockRendering.Types.isSpacer(i)&&(this.outlinePath_+=o.utils.svgPaths.lineOnAxis("h",i.width));this.outlinePath_+=o.utils.svgPaths.lineOnAxis("v",t.height)},o.blockRendering.Drawer.prototype.drawJaggedEdge_=function(t){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+o.utils.svgPaths.lineOnAxis("v",t.height-this.constants_.JAGGED_TEETH.height)},o.blockRendering.Drawer.prototype.drawValueInput_=function(t){var e=t.getLastInput();this.positionExternalValueConnection_(t);var i="function"==typeof e.shape.pathDown?e.shape.pathDown(e.height):e.shape.pathDown;this.outlinePath_+=o.utils.svgPaths.lineOnAxis("H",e.xPos+e.width)+i+o.utils.svgPaths.lineOnAxis("v",t.height-e.connectionHeight)},o.blockRendering.Drawer.prototype.drawStatementInput_=function(t){var e=t.getLastInput(),i=e.xPos+e.notchOffset+e.shape.width;e=e.shape.pathRight+o.utils.svgPaths.lineOnAxis("h",-(e.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var n=t.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=o.utils.svgPaths.lineOnAxis("H",i)+e+o.utils.svgPaths.lineOnAxis("v",n)+this.constants_.INSIDE_CORNERS.pathBottom+o.utils.svgPaths.lineOnAxis("H",t.xPos+t.width),this.positionStatementInputConnection_(t)},o.blockRendering.Drawer.prototype.drawRightSideRow_=function(t){this.outlinePath_+=o.utils.svgPaths.lineOnAxis("V",t.yPos+t.height)},o.blockRendering.Drawer.prototype.drawBottom_=function(){var t=this.info_.bottomRow,e=t.elements;this.positionNextConnection_();for(var i,n=0,r="",s=e.length-1;i=e[s];s--)o.blockRendering.Types.isNextConnection(i)?r+=i.shape.pathRight:o.blockRendering.Types.isLeftSquareCorner(i)?r+=o.utils.svgPaths.lineOnAxis("H",t.xPos):o.blockRendering.Types.isLeftRoundedCorner(i)?r+=this.constants_.OUTSIDE_CORNERS.bottomLeft:o.blockRendering.Types.isRightRoundedCorner(i)?(r+=this.constants_.OUTSIDE_CORNERS.bottomRight,n=this.constants_.OUTSIDE_CORNERS.rightHeight):o.blockRendering.Types.isSpacer(i)&&(r+=o.utils.svgPaths.lineOnAxis("h",-1*i.width));this.outlinePath_+=o.utils.svgPaths.lineOnAxis("V",t.baseline-n),this.outlinePath_+=r},o.blockRendering.Drawer.prototype.drawLeft_=function(){var t=this.info_.outputConnection;if(this.positionOutputConnection_(),t){var e=t.connectionOffsetY+t.height;t="function"==typeof t.shape.pathUp?t.shape.pathUp(t.height):t.shape.pathUp,this.outlinePath_+=o.utils.svgPaths.lineOnAxis("V",e)+t}this.outlinePath_+="z"},o.blockRendering.Drawer.prototype.drawInternals_=function(){for(var t,e=0;t=this.info_.rows[e];e++)for(var i,n=0;i=t.elements[n];n++)o.blockRendering.Types.isInlineInput(i)?this.drawInlineInput_(i):(o.blockRendering.Types.isIcon(i)||o.blockRendering.Types.isField(i))&&this.layoutField_(i)},o.blockRendering.Drawer.prototype.layoutField_=function(t){if(o.blockRendering.Types.isField(t))var e=t.field.getSvgRoot();else o.blockRendering.Types.isIcon(t)&&(e=t.icon.iconGroup_);var i=t.centerline-t.height/2,n=t.xPos,r="";this.info_.RTL&&(n=-(n+t.width),t.flipRtl&&(n+=t.width,r="scale(-1 1)")),o.blockRendering.Types.isIcon(t)?(e.setAttribute("display","block"),e.setAttribute("transform","translate("+n+","+i+")"),t.icon.computeIconLocation()):e.setAttribute("transform","translate("+n+","+i+")"+r),this.info_.isInsertionMarker&&e.setAttribute("display","none")},o.blockRendering.Drawer.prototype.drawInlineInput_=function(t){var e=t.width,i=t.height,n=t.connectionOffsetY,r=t.connectionHeight+n;this.inlinePath_+=o.utils.svgPaths.moveTo(t.xPos+t.connectionWidth,t.centerline-i/2)+o.utils.svgPaths.lineOnAxis("v",n)+t.shape.pathDown+o.utils.svgPaths.lineOnAxis("v",i-r)+o.utils.svgPaths.lineOnAxis("h",e-t.connectionWidth)+o.utils.svgPaths.lineOnAxis("v",-i)+"z",this.positionInlineInputConnection_(t)},o.blockRendering.Drawer.prototype.positionInlineInputConnection_=function(t){var e=t.centerline-t.height/2;if(t.connectionModel){var o=t.xPos+t.connectionWidth+t.connectionOffsetX;this.info_.RTL&&(o*=-1),t.connectionModel.setOffsetInBlock(o,e+t.connectionOffsetY)}},o.blockRendering.Drawer.prototype.positionStatementInputConnection_=function(t){var e=t.getLastInput();if(e.connectionModel){var o=t.xPos+t.statementEdge+e.notchOffset;this.info_.RTL&&(o*=-1),e.connectionModel.setOffsetInBlock(o,t.yPos)}},o.blockRendering.Drawer.prototype.positionExternalValueConnection_=function(t){var e=t.getLastInput();if(e.connectionModel){var o=t.xPos+t.width;this.info_.RTL&&(o*=-1),e.connectionModel.setOffsetInBlock(o,t.yPos)}},o.blockRendering.Drawer.prototype.positionPreviousConnection_=function(){var t=this.info_.topRow;if(t.connection){var e=t.xPos+t.notchOffset;t.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-e:e,0)}},o.blockRendering.Drawer.prototype.positionNextConnection_=function(){var t=this.info_.bottomRow;if(t.connection){var e=t.connection,o=e.xPos;e.connectionModel.setOffsetInBlock(this.info_.RTL?-o:o,t.baseline)}},o.blockRendering.Drawer.prototype.positionOutputConnection_=function(){if(this.info_.outputConnection){var t=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-t:t,this.info_.outputConnection.connectionOffsetY)}},o.blockRendering.PathObject=function(t,e,i){this.constants=i,this.svgRoot=t,this.svgPath=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyPath"},this.svgRoot),this.style=e,this.markerSvg=this.cursorSvg=null},o.blockRendering.PathObject.prototype.setPath=function(t){this.svgPath.setAttribute("d",t)},o.blockRendering.PathObject.prototype.flipRTL=function(){this.svgPath.setAttribute("transform","scale(-1 1)")},o.blockRendering.PathObject.prototype.setCursorSvg=function(t){t?(this.svgRoot.appendChild(t),this.cursorSvg=t):this.cursorSvg=null},o.blockRendering.PathObject.prototype.setMarkerSvg=function(t){t?(this.cursorSvg?this.svgRoot.insertBefore(t,this.cursorSvg):this.svgRoot.appendChild(t),this.markerSvg=t):this.markerSvg=null},o.blockRendering.PathObject.prototype.applyColour=function(t){this.svgPath.setAttribute("stroke",this.style.colourTertiary),this.svgPath.setAttribute("fill",this.style.colourPrimary),this.updateShadow_(t.isShadow()),this.updateDisabled_(!t.isEnabled()||t.getInheritedDisabled())},o.blockRendering.PathObject.prototype.setStyle=function(t){this.style=t},o.blockRendering.PathObject.prototype.setClass_=function(t,e){e?o.utils.dom.addClass(this.svgRoot,t):o.utils.dom.removeClass(this.svgRoot,t)},o.blockRendering.PathObject.prototype.updateHighlighted=function(t){t?this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"):this.svgPath.setAttribute("filter","none")},o.blockRendering.PathObject.prototype.updateShadow_=function(t){t&&(this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))},o.blockRendering.PathObject.prototype.updateDisabled_=function(t){this.setClass_("blocklyDisabled",t),t&&this.svgPath.setAttribute("fill","url(#"+this.constants.disabledPatternId+")")},o.blockRendering.PathObject.prototype.updateSelected=function(t){this.setClass_("blocklySelected",t)},o.blockRendering.PathObject.prototype.updateDraggingDelete=function(t){this.setClass_("blocklyDraggingDelete",t)},o.blockRendering.PathObject.prototype.updateInsertionMarker=function(t){this.setClass_("blocklyInsertionMarker",t)},o.blockRendering.PathObject.prototype.updateMovable=function(t){this.setClass_("blocklyDraggable",t)},o.blockRendering.PathObject.prototype.updateReplacementFade=function(t){this.setClass_("blocklyReplaceable",t)},o.blockRendering.PathObject.prototype.updateShapeForInputHighlight=function(t,e){},o.blockRendering.Renderer=function(t){this.name=t,this.overrides=this.constants_=null},o.blockRendering.Renderer.prototype.getClassName=function(){return this.name+"-renderer"},o.blockRendering.Renderer.prototype.init=function(t,e){this.constants_=this.makeConstants_(),e&&(this.overrides=e,o.utils.object.mixin(this.constants_,e)),this.constants_.setTheme(t),this.constants_.init()},o.blockRendering.Renderer.prototype.createDom=function(t,e){this.constants_.createDom(t,this.name+"-"+e.name,"."+this.getClassName()+"."+e.getClassName())},o.blockRendering.Renderer.prototype.refreshDom=function(t,e){var i=this.getConstants();i.dispose(),this.constants_=this.makeConstants_(),this.overrides&&o.utils.object.mixin(this.constants_,this.overrides),this.constants_.randomIdentifier=i.randomIdentifier,this.constants_.setTheme(e),this.constants_.init(),this.createDom(t,e)},o.blockRendering.Renderer.prototype.dispose=function(){this.constants_&&this.constants_.dispose()},o.blockRendering.Renderer.prototype.makeConstants_=function(){return new o.blockRendering.ConstantProvider},o.blockRendering.Renderer.prototype.makeRenderInfo_=function(t){return new o.blockRendering.RenderInfo(this,t)},o.blockRendering.Renderer.prototype.makeDrawer_=function(t,e){return new o.blockRendering.Drawer(t,e)},o.blockRendering.Renderer.prototype.makeDebugger_=function(){if(!o.blockRendering.Debug)throw Error("Missing require for Blockly.blockRendering.Debug");return new o.blockRendering.Debug(this.getConstants())},o.blockRendering.Renderer.prototype.makeMarkerDrawer=function(t,e){return new o.blockRendering.MarkerSvg(t,this.getConstants(),e)},o.blockRendering.Renderer.prototype.makePathObject=function(t,e){return new o.blockRendering.PathObject(t,e,this.constants_)},o.blockRendering.Renderer.prototype.getConstants=function(){return this.constants_},o.blockRendering.Renderer.prototype.shouldHighlightConnection=function(t){return!0},o.blockRendering.Renderer.prototype.orphanCanConnectAtEnd=function(t,e,i){return i==o.OUTPUT_VALUE?(i=e.outputConnection,t=o.Connection.lastConnectionInRow(t,e)):(i=e.previousConnection,t=t.lastConnectionInStack()),!!t&&i.getConnectionChecker().canConnect(t,i,!1)},o.blockRendering.Renderer.prototype.getConnectionPreviewMethod=function(t,e,i){return e.type==o.OUTPUT_VALUE||e.type==o.PREVIOUS_STATEMENT?!t.isConnected()||this.orphanCanConnectAtEnd(i,t.targetBlock(),e.type)?o.InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:o.InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:o.InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER},o.blockRendering.Renderer.prototype.render=function(t){o.blockRendering.useDebugger&&!t.renderingDebugger&&(t.renderingDebugger=this.makeDebugger_());var e=this.makeRenderInfo_(t);e.measure(),this.makeDrawer_(t,e).draw()},o.geras={},o.geras.ConstantProvider=function(){o.geras.ConstantProvider.superClass_.constructor.call(this),this.FIELD_TEXT_BASELINE_CENTER=!1,this.DARK_PATH_OFFSET=1,this.MAX_BOTTOM_WIDTH=30,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2},o.utils.object.inherits(o.geras.ConstantProvider,o.blockRendering.ConstantProvider),o.geras.ConstantProvider.prototype.getCSS_=function(t){return o.geras.ConstantProvider.superClass_.getCSS_.call(this,t).concat([t+" .blocklyInsertionMarker>.blocklyPathLight,",t+" .blocklyInsertionMarker>.blocklyPathDark {","fill-opacity: "+this.INSERTION_MARKER_OPACITY+";","stroke: none;","}"])},o.geras.Highlighter=function(t){this.info_=t,this.inlineSteps_=this.steps_="",this.RTL_=this.info_.RTL,t=t.getRenderer(),this.constants_=t.getConstants(),this.highlightConstants_=t.getHighlightConstants(),this.highlightOffset_=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH},o.geras.Highlighter.prototype.getPath=function(){return this.steps_+"\n"+this.inlineSteps_},o.geras.Highlighter.prototype.drawTopCorner=function(t){this.steps_+=o.utils.svgPaths.moveBy(t.xPos,this.info_.startY);for(var e,i=0;e=t.elements[i];i++)o.blockRendering.Types.isLeftSquareCorner(e)?this.steps_+=this.highlightConstants_.START_POINT:o.blockRendering.Types.isLeftRoundedCorner(e)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):o.blockRendering.Types.isPreviousConnection(e)?this.steps_+=this.notchPaths_.pathLeft:o.blockRendering.Types.isHat(e)?this.steps_+=this.startPaths_.path(this.RTL_):o.blockRendering.Types.isSpacer(e)&&0!=e.width&&(this.steps_+=o.utils.svgPaths.lineOnAxis("H",e.xPos+e.width-this.highlightOffset_));this.steps_+=o.utils.svgPaths.lineOnAxis("H",t.xPos+t.width-this.highlightOffset_)},o.geras.Highlighter.prototype.drawJaggedEdge_=function(t){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+o.utils.svgPaths.lineOnAxis("v",t.height-this.jaggedTeethPaths_.height-this.highlightOffset_))},o.geras.Highlighter.prototype.drawValueInput=function(t){var e=t.getLastInput();if(this.RTL_){var i=t.height-e.connectionHeight;this.steps_+=o.utils.svgPaths.moveTo(e.xPos+e.width-this.highlightOffset_,t.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+o.utils.svgPaths.lineOnAxis("v",i)}else this.steps_+=o.utils.svgPaths.moveTo(e.xPos+e.width,t.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)},o.geras.Highlighter.prototype.drawStatementInput=function(t){var e=t.getLastInput();if(this.RTL_){var i=t.height-2*this.insideCornerPaths_.height;this.steps_+=o.utils.svgPaths.moveTo(e.xPos,t.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+o.utils.svgPaths.lineOnAxis("v",i)+this.insideCornerPaths_.pathBottom(this.RTL_)+o.utils.svgPaths.lineTo(t.width-e.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=o.utils.svgPaths.moveTo(e.xPos,t.yPos+t.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+o.utils.svgPaths.lineTo(t.width-e.xPos-this.insideCornerPaths_.width,0)},o.geras.Highlighter.prototype.drawRightSideRow=function(t){var e=t.xPos+t.width-this.highlightOffset_;t.followsStatement&&(this.steps_+=o.utils.svgPaths.lineOnAxis("H",e)),this.RTL_&&(this.steps_+=o.utils.svgPaths.lineOnAxis("H",e),t.height>this.highlightOffset_&&(this.steps_+=o.utils.svgPaths.lineOnAxis("V",t.yPos+t.height-this.highlightOffset_)))},o.geras.Highlighter.prototype.drawBottomRow=function(t){if(this.RTL_)this.steps_+=o.utils.svgPaths.lineOnAxis("V",t.baseline-this.highlightOffset_);else{var e=this.info_.bottomRow.elements[0];o.blockRendering.Types.isLeftSquareCorner(e)?this.steps_+=o.utils.svgPaths.moveTo(t.xPos+this.highlightOffset_,t.baseline-this.highlightOffset_):o.blockRendering.Types.isLeftRoundedCorner(e)&&(this.steps_+=o.utils.svgPaths.moveTo(t.xPos,t.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}},o.geras.Highlighter.prototype.drawLeft=function(){var t=this.info_.outputConnection;t&&(t=t.connectionOffsetY+t.height,this.RTL_?this.steps_+=o.utils.svgPaths.moveTo(this.info_.startX,t):(this.steps_+=o.utils.svgPaths.moveTo(this.info_.startX+this.highlightOffset_,this.info_.bottomRow.baseline-this.highlightOffset_),this.steps_+=o.utils.svgPaths.lineOnAxis("V",t)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)),this.RTL_||(t=this.info_.topRow,o.blockRendering.Types.isLeftRoundedCorner(t.elements[0])?this.steps_+=o.utils.svgPaths.lineOnAxis("V",this.outsideCornerPaths_.height):this.steps_+=o.utils.svgPaths.lineOnAxis("V",t.capline+this.highlightOffset_))},o.geras.Highlighter.prototype.drawInlineInput=function(t){var e=this.highlightOffset_,i=t.xPos+t.connectionWidth,n=t.centerline-t.height/2,r=t.width-t.connectionWidth,s=n+e;this.RTL_?(n=t.connectionOffsetY-e,t=t.height-(t.connectionOffsetY+t.connectionHeight)+e,this.inlineSteps_+=o.utils.svgPaths.moveTo(i-e,s)+o.utils.svgPaths.lineOnAxis("v",n)+this.puzzleTabPaths_.pathDown(this.RTL_)+o.utils.svgPaths.lineOnAxis("v",t)+o.utils.svgPaths.lineOnAxis("h",r)):this.inlineSteps_+=o.utils.svgPaths.moveTo(t.xPos+t.width+e,s)+o.utils.svgPaths.lineOnAxis("v",t.height)+o.utils.svgPaths.lineOnAxis("h",-r)+o.utils.svgPaths.moveTo(i,n+t.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)},o.geras.InlineInput=function(t,e){o.geras.InlineInput.superClass_.constructor.call(this,t,e),this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)},o.utils.object.inherits(o.geras.InlineInput,o.blockRendering.InlineInput),o.geras.StatementInput=function(t,e){o.geras.StatementInput.superClass_.constructor.call(this,t,e),this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)},o.utils.object.inherits(o.geras.StatementInput,o.blockRendering.StatementInput),o.geras.RenderInfo=function(t,e){o.geras.RenderInfo.superClass_.constructor.call(this,t,e)},o.utils.object.inherits(o.geras.RenderInfo,o.blockRendering.RenderInfo),o.geras.RenderInfo.prototype.getRenderer=function(){return this.renderer_},o.geras.RenderInfo.prototype.populateBottomRow_=function(){o.geras.RenderInfo.superClass_.populateBottomRow_.call(this),this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1].type==o.NEXT_STATEMENT||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)},o.geras.RenderInfo.prototype.addInput_=function(t,e){this.isInline&&t.type==o.INPUT_VALUE?(e.elements.push(new o.geras.InlineInput(this.constants_,t)),e.hasInlineInput=!0):t.type==o.NEXT_STATEMENT?(e.elements.push(new o.geras.StatementInput(this.constants_,t)),e.hasStatement=!0):t.type==o.INPUT_VALUE?(e.elements.push(new o.blockRendering.ExternalValueInput(this.constants_,t)),e.hasExternalInput=!0):t.type==o.DUMMY_INPUT&&(e.minHeight=Math.max(e.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),e.hasDummyInput=!0),this.isInline||null!=e.align||(e.align=t.align)},o.geras.RenderInfo.prototype.addElemSpacing_=function(){for(var t,e=!1,i=0;t=this.rows[i];i++)t.hasExternalInput&&(e=!0);for(i=0;t=this.rows[i];i++){var n=t.elements;if(t.elements=[],t.startsWithElemSpacer()&&t.elements.push(new o.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,n[0]))),n.length){for(var r=0;r<n.length-1;r++){t.elements.push(n[r]);var s=this.getInRowSpacing_(n[r],n[r+1]);t.elements.push(new o.blockRendering.InRowSpacer(this.constants_,s))}t.elements.push(n[n.length-1]),t.endsWithElemSpacer()&&(s=this.getInRowSpacing_(n[n.length-1],null),e&&t.hasDummyInput&&(s+=this.constants_.TAB_WIDTH),t.elements.push(new o.blockRendering.InRowSpacer(this.constants_,s)))}}},o.geras.RenderInfo.prototype.getInRowSpacing_=function(t,e){if(!t)return e&&o.blockRendering.Types.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:e&&o.blockRendering.Types.isInlineInput(e)?this.constants_.MEDIUM_LARGE_PADDING:e&&o.blockRendering.Types.isStatementInput(e)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!o.blockRendering.Types.isInput(t)&&(!e||o.blockRendering.Types.isStatementInput(e)))return o.blockRendering.Types.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:o.blockRendering.Types.isIcon(t)?2*this.constants_.LARGE_PADDING+1:o.blockRendering.Types.isHat(t)?this.constants_.NO_PADDING:o.blockRendering.Types.isPreviousOrNextConnection(t)?this.constants_.LARGE_PADDING:o.blockRendering.Types.isLeftRoundedCorner(t)?this.constants_.MIN_BLOCK_WIDTH:o.blockRendering.Types.isJaggedEdge(t)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isInput(t)&&!e){if(o.blockRendering.Types.isExternalInput(t))return this.constants_.NO_PADDING;if(o.blockRendering.Types.isInlineInput(t))return this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isStatementInput(t))return this.constants_.NO_PADDING}if(!o.blockRendering.Types.isInput(t)&&e&&o.blockRendering.Types.isInput(e)){if(o.blockRendering.Types.isField(t)&&t.isEditable){if(o.blockRendering.Types.isInlineInput(e)||o.blockRendering.Types.isExternalInput(e))return this.constants_.SMALL_PADDING}else{if(o.blockRendering.Types.isInlineInput(e)||o.blockRendering.Types.isExternalInput(e))return this.constants_.MEDIUM_LARGE_PADDING;if(o.blockRendering.Types.isStatementInput(e))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(o.blockRendering.Types.isIcon(t)&&e&&!o.blockRendering.Types.isInput(e))return this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isInlineInput(t)&&e&&o.blockRendering.Types.isField(e))return e.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isLeftSquareCorner(t)&&e){if(o.blockRendering.Types.isHat(e))return this.constants_.NO_PADDING;if(o.blockRendering.Types.isPreviousConnection(e))return e.notchOffset;if(o.blockRendering.Types.isNextConnection(e))return t=(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2,e.notchOffset+t}if(o.blockRendering.Types.isLeftRoundedCorner(t)&&e){if(o.blockRendering.Types.isPreviousConnection(e))return e.notchOffset-this.constants_.CORNER_RADIUS;if(o.blockRendering.Types.isNextConnection(e))return t=(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2,e.notchOffset-this.constants_.CORNER_RADIUS+t}return o.blockRendering.Types.isField(t)&&e&&o.blockRendering.Types.isField(e)&&t.isEditable==e.isEditable||e&&o.blockRendering.Types.isJaggedEdge(e)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING},o.geras.RenderInfo.prototype.getSpacerRowHeight_=function(t,e){return o.blockRendering.Types.isTopRow(t)&&o.blockRendering.Types.isBottomRow(e)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:o.blockRendering.Types.isTopRow(t)||o.blockRendering.Types.isBottomRow(e)?this.constants_.NO_PADDING:t.hasExternalInput&&e.hasExternalInput?this.constants_.LARGE_PADDING:!t.hasStatement&&e.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:t.hasStatement&&e.hasStatement||!t.hasStatement&&e.hasDummyInput||t.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING},o.geras.RenderInfo.prototype.getElemCenterline_=function(t,e){if(o.blockRendering.Types.isSpacer(e))return t.yPos+e.height/2;if(o.blockRendering.Types.isBottomRow(t))return t=t.yPos+t.height-t.descenderHeight,o.blockRendering.Types.isNextConnection(e)?t+e.height/2:t-e.height/2;if(o.blockRendering.Types.isTopRow(t))return o.blockRendering.Types.isHat(e)?t.capline-e.height/2:t.capline+e.height/2;var i=t.yPos;return o.blockRendering.Types.isField(e)||o.blockRendering.Types.isIcon(e)?(i+=e.height/2,(t.hasInlineInput||t.hasStatement)&&e.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=t.height&&(i+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):i=o.blockRendering.Types.isInlineInput(e)?i+e.height/2:i+t.height/2,i},o.geras.RenderInfo.prototype.alignRowElements_=function(){if(this.isInline){for(var t,e=0,i=null,n=this.rows.length-1;t=this.rows[n];n--)t.nextRightEdge=e,o.blockRendering.Types.isInputRow(t)&&(t.hasStatement&&this.alignStatementRow_(t),i&&i.hasStatement&&t.width<i.width?t.nextRightEdge=i.width:e=t.width,i=t);for(n=e=0;t=this.rows[n];n++)t.hasStatement?e=this.getDesiredRowWidth_(t):o.blockRendering.Types.isSpacer(t)?t.width=Math.max(e,t.nextRightEdge):(0<(e=Math.max(e,t.nextRightEdge)-t.width)&&this.addAlignmentPadding_(t,e),e=t.width)}else o.geras.RenderInfo.superClass_.alignRowElements_.call(this)},o.geras.RenderInfo.prototype.getDesiredRowWidth_=function(t){return this.isInline&&t.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:o.geras.RenderInfo.superClass_.getDesiredRowWidth_.call(this,t)},o.geras.RenderInfo.prototype.finalize_=function(){for(var t,e=0,o=0,i=0;t=this.rows[i];i++){t.yPos=o,t.xPos=this.startX,o+=t.height,e=Math.max(e,t.widthWithConnectedBlocks);var n=o-this.topRow.ascenderHeight;t==this.bottomRow&&n<this.constants_.MIN_BLOCK_HEIGHT&&(n=this.constants_.MIN_BLOCK_HEIGHT-n,this.bottomRow.height+=n,o+=n),this.recordElemPositions_(t)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(e=Math.max(e,this.block_.nextConnection.targetBlock().getHeightWidth().width-this.constants_.DARK_PATH_OFFSET)),this.bottomRow.baseline=o-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX+this.constants_.DARK_PATH_OFFSET,this.width+=this.constants_.DARK_PATH_OFFSET,this.height=o+this.constants_.DARK_PATH_OFFSET,this.startY=this.topRow.capline},o.geras.Drawer=function(t,e){o.geras.Drawer.superClass_.constructor.call(this,t,e),this.highlighter_=new o.geras.Highlighter(e)},o.utils.object.inherits(o.geras.Drawer,o.blockRendering.Drawer),o.geras.Drawer.prototype.draw=function(){this.hideHiddenIcons_(),this.drawOutline_(),this.drawInternals_();var t=this.block_.pathObject;t.setPath(this.outlinePath_+"\n"+this.inlinePath_),t.setHighlightPath(this.highlighter_.getPath()),this.info_.RTL&&t.flipRTL(),o.blockRendering.useDebugger&&this.block_.renderingDebugger.drawDebug(this.block_,this.info_),this.recordSizeOnBlock_()},o.geras.Drawer.prototype.drawTop_=function(){this.highlighter_.drawTopCorner(this.info_.topRow),this.highlighter_.drawRightSideRow(this.info_.topRow),o.geras.Drawer.superClass_.drawTop_.call(this)},o.geras.Drawer.prototype.drawJaggedEdge_=function(t){this.highlighter_.drawJaggedEdge_(t),o.geras.Drawer.superClass_.drawJaggedEdge_.call(this,t)},o.geras.Drawer.prototype.drawValueInput_=function(t){this.highlighter_.drawValueInput(t),o.geras.Drawer.superClass_.drawValueInput_.call(this,t)},o.geras.Drawer.prototype.drawStatementInput_=function(t){this.highlighter_.drawStatementInput(t),o.geras.Drawer.superClass_.drawStatementInput_.call(this,t)},o.geras.Drawer.prototype.drawRightSideRow_=function(t){this.highlighter_.drawRightSideRow(t),this.outlinePath_+=o.utils.svgPaths.lineOnAxis("H",t.xPos+t.width)+o.utils.svgPaths.lineOnAxis("V",t.yPos+t.height)},o.geras.Drawer.prototype.drawBottom_=function(){this.highlighter_.drawBottomRow(this.info_.bottomRow),o.geras.Drawer.superClass_.drawBottom_.call(this)},o.geras.Drawer.prototype.drawLeft_=function(){this.highlighter_.drawLeft(),o.geras.Drawer.superClass_.drawLeft_.call(this)},o.geras.Drawer.prototype.drawInlineInput_=function(t){this.highlighter_.drawInlineInput(t),o.geras.Drawer.superClass_.drawInlineInput_.call(this,t)},o.geras.Drawer.prototype.positionInlineInputConnection_=function(t){var e=t.centerline-t.height/2;if(t.connectionModel){var o=t.xPos+t.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(o*=-1),t.connectionModel.setOffsetInBlock(o,e+t.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}},o.geras.Drawer.prototype.positionStatementInputConnection_=function(t){var e=t.getLastInput();if(e.connectionModel){var o=t.xPos+t.statementEdge+e.notchOffset;o=this.info_.RTL?-1*o:o+this.constants_.DARK_PATH_OFFSET,e.connectionModel.setOffsetInBlock(o,t.yPos+this.constants_.DARK_PATH_OFFSET)}},o.geras.Drawer.prototype.positionExternalValueConnection_=function(t){var e=t.getLastInput();if(e.connectionModel){var o=t.xPos+t.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(o*=-1),e.connectionModel.setOffsetInBlock(o,t.yPos)}},o.geras.Drawer.prototype.positionNextConnection_=function(){var t=this.info_.bottomRow;if(t.connection){var e=t.connection,o=e.xPos;e.connectionModel.setOffsetInBlock((this.info_.RTL?-o:o)+this.constants_.DARK_PATH_OFFSET/2,t.baseline+this.constants_.DARK_PATH_OFFSET)}},o.geras.HighlightConstantProvider=function(t){this.constantProvider=t,this.OFFSET=.5,this.START_POINT=o.utils.svgPaths.moveBy(this.OFFSET,this.OFFSET)},o.geras.HighlightConstantProvider.prototype.init=function(){this.INSIDE_CORNER=this.makeInsideCorner(),this.OUTSIDE_CORNER=this.makeOutsideCorner(),this.PUZZLE_TAB=this.makePuzzleTab(),this.NOTCH=this.makeNotch(),this.JAGGED_TEETH=this.makeJaggedTeeth(),this.START_HAT=this.makeStartHat()},o.geras.HighlightConstantProvider.prototype.makeInsideCorner=function(){var t=this.constantProvider.CORNER_RADIUS,e=this.OFFSET,i=(1-Math.SQRT1_2)*(t+e)-e,n=o.utils.svgPaths.moveBy(i,i)+o.utils.svgPaths.arc("a","0 0,0",t,o.utils.svgPaths.point(-i-e,t-i)),r=o.utils.svgPaths.arc("a","0 0,0",t+e,o.utils.svgPaths.point(t+e,t+e)),s=o.utils.svgPaths.moveBy(i,-i)+o.utils.svgPaths.arc("a","0 0,0",t+e,o.utils.svgPaths.point(t-i,i+e));return{width:t+e,height:t,pathTop:function(t){return t?n:""},pathBottom:function(t){return t?r:s}}},o.geras.HighlightConstantProvider.prototype.makeOutsideCorner=function(){var t=this.constantProvider.CORNER_RADIUS,e=this.OFFSET,i=(1-Math.SQRT1_2)*(t-e)+e,n=o.utils.svgPaths.moveBy(i,i)+o.utils.svgPaths.arc("a","0 0,1",t-e,o.utils.svgPaths.point(t-i,-i+e)),r=o.utils.svgPaths.moveBy(e,t)+o.utils.svgPaths.arc("a","0 0,1",t-e,o.utils.svgPaths.point(t,-t+e)),s=-i,a=o.utils.svgPaths.moveBy(i,s)+o.utils.svgPaths.arc("a","0 0,1",t-e,o.utils.svgPaths.point(-i+e,-s-t));return{height:t,topLeft:function(t){return t?n:r},bottomLeft:function(){return a}}},o.geras.HighlightConstantProvider.prototype.makePuzzleTab=function(){var t=this.constantProvider.TAB_WIDTH,e=this.constantProvider.TAB_HEIGHT,i=o.utils.svgPaths.moveBy(-2,3.4-e)+o.utils.svgPaths.lineTo(-.45*t,-2.1),n=o.utils.svgPaths.lineOnAxis("v",2.5)+o.utils.svgPaths.moveBy(.97*-t,2.5)+o.utils.svgPaths.curve("q",[o.utils.svgPaths.point(.05*-t,10),o.utils.svgPaths.point(.3*t,9.5)])+o.utils.svgPaths.moveBy(.67*t,-1.9)+o.utils.svgPaths.lineOnAxis("v",2.5),r=o.utils.svgPaths.lineOnAxis("v",-1.5)+o.utils.svgPaths.moveBy(-.92*t,-.5)+o.utils.svgPaths.curve("q",[o.utils.svgPaths.point(-.19*t,-5.5),o.utils.svgPaths.point(0,-11)])+o.utils.svgPaths.moveBy(.92*t,1),s=o.utils.svgPaths.moveBy(-5,e-.7)+o.utils.svgPaths.lineTo(.46*t,-2.1);return{width:t,height:e,pathUp:function(t){return t?i:r},pathDown:function(t){return t?n:s}}},o.geras.HighlightConstantProvider.prototype.makeNotch=function(){return{pathLeft:o.utils.svgPaths.lineOnAxis("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}},o.geras.HighlightConstantProvider.prototype.makeJaggedTeeth=function(){return{pathLeft:o.utils.svgPaths.lineTo(5.1,2.6)+o.utils.svgPaths.moveBy(-10.2,6.8)+o.utils.svgPaths.lineTo(5.1,2.6),height:12,width:10.2}},o.geras.HighlightConstantProvider.prototype.makeStartHat=function(){var t=this.constantProvider.START_HAT.height,e=o.utils.svgPaths.moveBy(25,-8.7)+o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(29.7,-6.2),o.utils.svgPaths.point(57.2,-.5),o.utils.svgPaths.point(75,8.7)]),i=o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(17.8,-9.2),o.utils.svgPaths.point(45.3,-14.9),o.utils.svgPaths.point(75,-8.7)])+o.utils.svgPaths.moveTo(100.5,t+.5);return{path:function(t){return t?e:i}}},o.geras.PathObject=function(t,e,i){this.constants=i,this.svgRoot=t,this.svgPathDark=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyPathDark",transform:"translate(1,1)"},this.svgRoot),this.svgPath=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyPath"},this.svgRoot),this.svgPathLight=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyPathLight"},this.svgRoot),this.colourDark="#000000",this.style=e},o.utils.object.inherits(o.geras.PathObject,o.blockRendering.PathObject),o.geras.PathObject.prototype.setPath=function(t){this.svgPath.setAttribute("d",t),this.svgPathDark.setAttribute("d",t)},o.geras.PathObject.prototype.setHighlightPath=function(t){this.svgPathLight.setAttribute("d",t)},o.geras.PathObject.prototype.flipRTL=function(){this.svgPath.setAttribute("transform","scale(-1 1)"),this.svgPathLight.setAttribute("transform","scale(-1 1)"),this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")},o.geras.PathObject.prototype.applyColour=function(t){this.svgPathLight.style.display="",this.svgPathDark.style.display="",this.svgPathLight.setAttribute("stroke",this.style.colourTertiary),this.svgPathDark.setAttribute("fill",this.colourDark),o.geras.PathObject.superClass_.applyColour.call(this,t),this.svgPath.setAttribute("stroke","none")},o.geras.PathObject.prototype.setStyle=function(t){this.style=t,this.colourDark=o.utils.colour.blend("#000",this.style.colourPrimary,.2)||this.colourDark},o.geras.PathObject.prototype.updateHighlighted=function(t){t?(this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"),this.svgPathLight.style.display="none"):(this.svgPath.setAttribute("filter","none"),this.svgPathLight.style.display="inline")},o.geras.PathObject.prototype.updateShadow_=function(t){t&&(this.svgPathLight.style.display="none",this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))},o.geras.PathObject.prototype.updateDisabled_=function(t){o.geras.PathObject.superClass_.updateDisabled_.call(this,t),t&&this.svgPath.setAttribute("stroke","none")},o.geras.Renderer=function(t){o.geras.Renderer.superClass_.constructor.call(this,t),this.highlightConstants_=null},o.utils.object.inherits(o.geras.Renderer,o.blockRendering.Renderer),o.geras.Renderer.prototype.init=function(t,e){o.geras.Renderer.superClass_.init.call(this,t,e),this.highlightConstants_=this.makeHighlightConstants_(),this.highlightConstants_.init()},o.geras.Renderer.prototype.refreshDom=function(t,e){o.geras.Renderer.superClass_.refreshDom.call(this,t,e),this.getHighlightConstants().init()},o.geras.Renderer.prototype.makeConstants_=function(){return new o.geras.ConstantProvider},o.geras.Renderer.prototype.makeRenderInfo_=function(t){return new o.geras.RenderInfo(this,t)},o.geras.Renderer.prototype.makeDrawer_=function(t,e){return new o.geras.Drawer(t,e)},o.geras.Renderer.prototype.makePathObject=function(t,e){return new o.geras.PathObject(t,e,this.getConstants())},o.geras.Renderer.prototype.makeHighlightConstants_=function(){return new o.geras.HighlightConstantProvider(this.getConstants())},o.geras.Renderer.prototype.getHighlightConstants=function(){return this.highlightConstants_},o.blockRendering.register("geras",o.geras.Renderer),o.thrasos={},o.thrasos.RenderInfo=function(t,e){o.thrasos.RenderInfo.superClass_.constructor.call(this,t,e)},o.utils.object.inherits(o.thrasos.RenderInfo,o.blockRendering.RenderInfo),o.thrasos.RenderInfo.prototype.getRenderer=function(){return this.renderer_},o.thrasos.RenderInfo.prototype.addElemSpacing_=function(){for(var t,e=!1,i=0;t=this.rows[i];i++)t.hasExternalInput&&(e=!0);for(i=0;t=this.rows[i];i++){var n=t.elements;t.elements=[],t.startsWithElemSpacer()&&t.elements.push(new o.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,n[0])));for(var r=0;r<n.length-1;r++){t.elements.push(n[r]);var s=this.getInRowSpacing_(n[r],n[r+1]);t.elements.push(new o.blockRendering.InRowSpacer(this.constants_,s))}t.elements.push(n[n.length-1]),t.endsWithElemSpacer()&&(s=this.getInRowSpacing_(n[n.length-1],null),e&&t.hasDummyInput&&(s+=this.constants_.TAB_WIDTH),t.elements.push(new o.blockRendering.InRowSpacer(this.constants_,s)))}},o.thrasos.RenderInfo.prototype.getInRowSpacing_=function(t,e){if(!t)return e&&o.blockRendering.Types.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:e&&o.blockRendering.Types.isInlineInput(e)?this.constants_.MEDIUM_LARGE_PADDING:e&&o.blockRendering.Types.isStatementInput(e)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!o.blockRendering.Types.isInput(t)&&!e)return o.blockRendering.Types.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:o.blockRendering.Types.isIcon(t)?2*this.constants_.LARGE_PADDING+1:o.blockRendering.Types.isHat(t)?this.constants_.NO_PADDING:o.blockRendering.Types.isPreviousOrNextConnection(t)?this.constants_.LARGE_PADDING:o.blockRendering.Types.isLeftRoundedCorner(t)?this.constants_.MIN_BLOCK_WIDTH:o.blockRendering.Types.isJaggedEdge(t)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isInput(t)&&!e){if(o.blockRendering.Types.isExternalInput(t))return this.constants_.NO_PADDING;if(o.blockRendering.Types.isInlineInput(t))return this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isStatementInput(t))return this.constants_.NO_PADDING}if(!o.blockRendering.Types.isInput(t)&&e&&o.blockRendering.Types.isInput(e)){if(o.blockRendering.Types.isField(t)&&t.isEditable){if(o.blockRendering.Types.isInlineInput(e)||o.blockRendering.Types.isExternalInput(e))return this.constants_.SMALL_PADDING}else{if(o.blockRendering.Types.isInlineInput(e)||o.blockRendering.Types.isExternalInput(e))return this.constants_.MEDIUM_LARGE_PADDING;if(o.blockRendering.Types.isStatementInput(e))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(o.blockRendering.Types.isIcon(t)&&e&&!o.blockRendering.Types.isInput(e))return this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isInlineInput(t)&&e&&o.blockRendering.Types.isField(e))return e.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(o.blockRendering.Types.isLeftSquareCorner(t)&&e){if(o.blockRendering.Types.isHat(e))return this.constants_.NO_PADDING;if(o.blockRendering.Types.isPreviousConnection(e)||o.blockRendering.Types.isNextConnection(e))return e.notchOffset}return o.blockRendering.Types.isLeftRoundedCorner(t)&&e?e.notchOffset-this.constants_.CORNER_RADIUS:o.blockRendering.Types.isField(t)&&e&&o.blockRendering.Types.isField(e)&&t.isEditable==e.isEditable||e&&o.blockRendering.Types.isJaggedEdge(e)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING},o.thrasos.RenderInfo.prototype.getSpacerRowHeight_=function(t,e){return o.blockRendering.Types.isTopRow(t)&&o.blockRendering.Types.isBottomRow(e)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:o.blockRendering.Types.isTopRow(t)||o.blockRendering.Types.isBottomRow(e)?this.constants_.NO_PADDING:t.hasExternalInput&&e.hasExternalInput?this.constants_.LARGE_PADDING:!t.hasStatement&&e.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:t.hasStatement&&e.hasStatement||t.hasDummyInput||e.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING},o.thrasos.RenderInfo.prototype.getElemCenterline_=function(t,e){if(o.blockRendering.Types.isSpacer(e))return t.yPos+e.height/2;if(o.blockRendering.Types.isBottomRow(t))return t=t.yPos+t.height-t.descenderHeight,o.blockRendering.Types.isNextConnection(e)?t+e.height/2:t-e.height/2;if(o.blockRendering.Types.isTopRow(t))return o.blockRendering.Types.isHat(e)?t.capline-e.height/2:t.capline+e.height/2;var i=t.yPos;return o.blockRendering.Types.isField(e)&&t.hasStatement?i+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+e.height/2):i+t.height/2},o.thrasos.RenderInfo.prototype.finalize_=function(){for(var t,e=0,o=0,i=0;t=this.rows[i];i++){t.yPos=o,t.xPos=this.startX,o+=t.height,e=Math.max(e,t.widthWithConnectedBlocks);var n=o-this.topRow.ascenderHeight;t==this.bottomRow&&n<this.constants_.MIN_BLOCK_HEIGHT&&(n=this.constants_.MIN_BLOCK_HEIGHT-n,this.bottomRow.height+=n,o+=n),this.recordElemPositions_(t)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(e=Math.max(e,this.block_.nextConnection.targetBlock().getHeightWidth().width)),this.bottomRow.baseline=o-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX,this.height=o,this.startY=this.topRow.capline},o.thrasos.Renderer=function(t){o.thrasos.Renderer.superClass_.constructor.call(this,t)},o.utils.object.inherits(o.thrasos.Renderer,o.blockRendering.Renderer),o.thrasos.Renderer.prototype.makeRenderInfo_=function(t){return new o.thrasos.RenderInfo(this,t)},o.blockRendering.register("thrasos",o.thrasos.Renderer),o.zelos={},o.zelos.ConstantProvider=function(){o.zelos.ConstantProvider.superClass_.constructor.call(this),this.SMALL_PADDING=this.GRID_UNIT=4,this.MEDIUM_PADDING=2*this.GRID_UNIT,this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT,this.LARGE_PADDING=4*this.GRID_UNIT,this.CORNER_RADIUS=1*this.GRID_UNIT,this.NOTCH_WIDTH=9*this.GRID_UNIT,this.NOTCH_HEIGHT=2*this.GRID_UNIT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT,this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT,this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT,this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT,this.TAB_OFFSET_FROM_TOP=0,this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT,this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT,this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT,this.CURSOR_WS_WIDTH=20*this.GRID_UNIT,this.CURSOR_COLOUR="#ffa200",this.CURSOR_RADIUS=5,this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0,this.START_HAT_HEIGHT=22,this.START_HAT_WIDTH=96,this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5},this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}},this.FULL_BLOCK_FIELDS=!0,this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT,this.FIELD_TEXT_FONTWEIGHT="bold",this.FIELD_TEXT_FONTFAMILY='"Helvetica Neue", "Segoe UI", Helvetica, sans-serif',this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS,this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT,this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT,this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!0,this.FIELD_COLOUR_DEFAULT_WIDTH=2*this.GRID_UNIT,this.FIELD_COLOUR_DEFAULT_HEIGHT=4*this.GRID_UNIT,this.FIELD_CHECKBOX_X_OFFSET=1*this.GRID_UNIT,this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT,this.SELECTED_GLOW_COLOUR="#fff200",this.SELECTED_GLOW_SIZE=.5,this.REPLACEMENT_GLOW_COLOUR="#fff200",this.REPLACEMENT_GLOW_SIZE=2,this.selectedGlowFilterId="",this.selectedGlowFilter_=null,this.replacementGlowFilterId="",this.replacementGlowFilter_=null},o.utils.object.inherits(o.zelos.ConstantProvider,o.blockRendering.ConstantProvider),o.zelos.ConstantProvider.prototype.setFontConstants_=function(t){o.zelos.ConstantProvider.superClass_.setFontConstants_.call(this,t),this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING},o.zelos.ConstantProvider.prototype.init=function(){o.zelos.ConstantProvider.superClass_.init.call(this),this.HEXAGONAL=this.makeHexagonal(),this.ROUNDED=this.makeRounded(),this.SQUARED=this.makeSquared(),this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth},o.zelos.ConstantProvider.prototype.setDynamicProperties_=function(t){o.zelos.ConstantProvider.superClass_.setDynamicProperties_.call(this,t),this.SELECTED_GLOW_COLOUR=t.getComponentStyle("selectedGlowColour")||this.SELECTED_GLOW_COLOUR;var e=Number(t.getComponentStyle("selectedGlowSize"));this.SELECTED_GLOW_SIZE=e&&!isNaN(e)?e:this.SELECTED_GLOW_SIZE,this.REPLACEMENT_GLOW_COLOUR=t.getComponentStyle("replacementGlowColour")||this.REPLACEMENT_GLOW_COLOUR,this.REPLACEMENT_GLOW_SIZE=(t=Number(t.getComponentStyle("replacementGlowSize")))&&!isNaN(t)?t:this.REPLACEMENT_GLOW_SIZE},o.zelos.ConstantProvider.prototype.dispose=function(){o.zelos.ConstantProvider.superClass_.dispose.call(this),this.selectedGlowFilter_&&o.utils.dom.removeNode(this.selectedGlowFilter_),this.replacementGlowFilter_&&o.utils.dom.removeNode(this.replacementGlowFilter_)},o.zelos.ConstantProvider.prototype.makeStartHat=function(){var t=this.START_HAT_HEIGHT,e=this.START_HAT_WIDTH;return{height:t,width:e,path:o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(25,-t),o.utils.svgPaths.point(71,-t),o.utils.svgPaths.point(e,0)])}},o.zelos.ConstantProvider.prototype.makeHexagonal=function(){function t(t,i,n){var r=t/2;return r=r>e?e:r,n=n?-1:1,t=(i?-1:1)*t/2,o.utils.svgPaths.lineTo(-n*r,t)+o.utils.svgPaths.lineTo(n*r,t)}var e=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width:function(t){return(t/=2)>e?e:t},height:function(t){return t},connectionOffsetY:function(t){return t/2},connectionOffsetX:function(t){return-t},pathDown:function(e){return t(e,!1,!1)},pathUp:function(e){return t(e,!0,!1)},pathRightDown:function(e){return t(e,!1,!0)},pathRightUp:function(e){return t(e,!1,!0)}}},o.zelos.ConstantProvider.prototype.makeRounded=function(){function t(t,e,n){var r=t>i?t-i:0;return t=(t>i?i:t)/2,o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point((e?-1:1)*t,(e?-1:1)*t))+o.utils.svgPaths.lineOnAxis("v",(n?1:-1)*r)+o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point((e?1:-1)*t,(e?-1:1)*t))}var e=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,i=2*e;return{type:this.SHAPES.ROUND,isDynamic:!0,width:function(t){return(t/=2)>e?e:t},height:function(t){return t},connectionOffsetY:function(t){return t/2},connectionOffsetX:function(t){return-t},pathDown:function(e){return t(e,!1,!1)},pathUp:function(e){return t(e,!0,!1)},pathRightDown:function(e){return t(e,!1,!0)},pathRightUp:function(e){return t(e,!1,!0)}}},o.zelos.ConstantProvider.prototype.makeSquared=function(){function t(t,i,n){return t-=2*e,o.utils.svgPaths.arc("a","0 0,1",e,o.utils.svgPaths.point((i?-1:1)*e,(i?-1:1)*e))+o.utils.svgPaths.lineOnAxis("v",(n?1:-1)*t)+o.utils.svgPaths.arc("a","0 0,1",e,o.utils.svgPaths.point((i?1:-1)*e,(i?-1:1)*e))}var e=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width:function(t){return e},height:function(t){return t},connectionOffsetY:function(t){return t/2},connectionOffsetX:function(t){return-t},pathDown:function(e){return t(e,!1,!1)},pathUp:function(e){return t(e,!0,!1)},pathRightDown:function(e){return t(e,!1,!0)},pathRightUp:function(e){return t(e,!1,!0)}}},o.zelos.ConstantProvider.prototype.shapeFor=function(t){var e=t.getCheck();switch(!e&&t.targetConnection&&(e=t.targetConnection.getCheck()),t.type){case o.INPUT_VALUE:case o.OUTPUT_VALUE:if(null!=(t=t.getSourceBlock().getOutputShape()))switch(t){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}return e&&-1!=e.indexOf("Boolean")?this.HEXAGONAL:(e&&-1!=e.indexOf("Number")||e&&e.indexOf("String"),this.ROUNDED);case o.PREVIOUS_STATEMENT:case o.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}},o.zelos.ConstantProvider.prototype.makeNotch=function(){function t(t){return o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(t*r/2,0),o.utils.svgPaths.point(t*r*3/4,a/2),o.utils.svgPaths.point(t*r,a)])+o.utils.svgPaths.line([o.utils.svgPaths.point(t*r,s)])+o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(t*r/4,a/2),o.utils.svgPaths.point(t*r/2,a),o.utils.svgPaths.point(t*r,a)])+o.utils.svgPaths.lineOnAxis("h",t*n)+o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(t*r/2,0),o.utils.svgPaths.point(t*r*3/4,-a/2),o.utils.svgPaths.point(t*r,-a)])+o.utils.svgPaths.line([o.utils.svgPaths.point(t*r,-s)])+o.utils.svgPaths.curve("c",[o.utils.svgPaths.point(t*r/4,-a/2),o.utils.svgPaths.point(t*r/2,-a),o.utils.svgPaths.point(t*r,-a)])}var e=this.NOTCH_WIDTH,i=this.NOTCH_HEIGHT,n=e/3,r=n/3,s=i/2,a=s/2,l=t(1),c=t(-1);return{type:this.SHAPES.NOTCH,width:e,height:i,pathLeft:l,pathRight:c}},o.zelos.ConstantProvider.prototype.makeInsideCorners=function(){var t=this.CORNER_RADIUS,e=o.utils.svgPaths.arc("a","0 0,0",t,o.utils.svgPaths.point(-t,t)),i=o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(-t,t));return{width:t,height:t,pathTop:e,pathBottom:o.utils.svgPaths.arc("a","0 0,0",t,o.utils.svgPaths.point(t,t)),rightWidth:t,rightHeight:t,pathTopRight:i,pathBottomRight:o.utils.svgPaths.arc("a","0 0,1",t,o.utils.svgPaths.point(t,t))}},o.zelos.ConstantProvider.prototype.generateSecondaryColour_=function(t){return o.utils.colour.blend("#000",t,.15)||t},o.zelos.ConstantProvider.prototype.generateTertiaryColour_=function(t){return o.utils.colour.blend("#000",t,.25)||t},o.zelos.ConstantProvider.prototype.createDom=function(t,e,i){o.zelos.ConstantProvider.superClass_.createDom.call(this,t,e,i),t=o.utils.dom.createSvgElement(o.utils.Svg.DEFS,{},t),e=o.utils.dom.createSvgElement(o.utils.Svg.FILTER,{id:"blocklySelectedGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},t),o.utils.dom.createSvgElement(o.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.SELECTED_GLOW_SIZE},e),i=o.utils.dom.createSvgElement(o.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},e),o.utils.dom.createSvgElement(o.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},i),o.utils.dom.createSvgElement(o.utils.Svg.FEFLOOD,{"flood-color":this.SELECTED_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},e),o.utils.dom.createSvgElement(o.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),this.selectedGlowFilterId=e.id,this.selectedGlowFilter_=e,t=o.utils.dom.createSvgElement(o.utils.Svg.FILTER,{id:"blocklyReplacementGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},t),o.utils.dom.createSvgElement(o.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.REPLACEMENT_GLOW_SIZE},t),e=o.utils.dom.createSvgElement(o.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},t),o.utils.dom.createSvgElement(o.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},e),o.utils.dom.createSvgElement(o.utils.Svg.FEFLOOD,{"flood-color":this.REPLACEMENT_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},t),o.utils.dom.createSvgElement(o.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),o.utils.dom.createSvgElement(o.utils.Svg.FECOMPOSITE,{in:"SourceGraphic",in2:"outGlow",operator:"over"},t),this.replacementGlowFilterId=t.id,this.replacementGlowFilter_=t},o.zelos.ConstantProvider.prototype.getCSS_=function(t){return[t+" .blocklyText,",t+" .blocklyFlyoutLabelText {","font: "+this.FIELD_TEXT_FONTWEIGHT+" "+this.FIELD_TEXT_FONTSIZE+"pt "+this.FIELD_TEXT_FONTFAMILY+";","}",t+" .blocklyText {","fill: #fff;","}",t+" .blocklyNonEditableText>rect:not(.blocklyDropdownRect),",t+" .blocklyEditableText>rect:not(.blocklyDropdownRect) {","fill: "+this.FIELD_BORDER_RECT_COLOUR+";","}",t+" .blocklyNonEditableText>text,",t+" .blocklyEditableText>text,",t+" .blocklyNonEditableText>g>text,",t+" .blocklyEditableText>g>text {","fill: #575E75;","}",t+" .blocklyFlyoutLabelText {","fill: #575E75;","}",t+" .blocklyText.blocklyBubbleText {","fill: #575E75;","}",t+" .blocklyDraggable:not(.blocklyDisabled)"," .blocklyEditableText:not(.editing):hover>rect,",t+" .blocklyDraggable:not(.blocklyDisabled)"," .blocklyEditableText:not(.editing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",t+" .blocklyHtmlInput {","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","font-weight: "+this.FIELD_TEXT_FONTWEIGHT+";","color: #575E75;","}",t+" .blocklyDropdownText {","fill: #fff !important;","}",t+".blocklyWidgetDiv .goog-menuitem,",t+".blocklyDropDownDiv .goog-menuitem {","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","}",t+".blocklyDropDownDiv .goog-menuitem-content {","color: #fff;","}",t+" .blocklyHighlightedConnectionPath {","stroke: "+this.SELECTED_GLOW_COLOUR+";","}",t+" .blocklyDisabled > .blocklyOutlinePath {","fill: url(#blocklyDisabledPattern"+this.randomIdentifier+")","}",t+" .blocklyInsertionMarker>.blocklyPath {","fill-opacity: "+this.INSERTION_MARKER_OPACITY+";","stroke: none;","}"]},o.zelos.TopRow=function(t){o.zelos.TopRow.superClass_.constructor.call(this,t)},o.utils.object.inherits(o.zelos.TopRow,o.blockRendering.TopRow),o.zelos.TopRow.prototype.endsWithElemSpacer=function(){return!1},o.zelos.TopRow.prototype.hasLeftSquareCorner=function(t){var e=(t.hat?"cap"===t.hat:this.constants_.ADD_START_HATS)&&!t.outputConnection&&!t.previousConnection;return!!t.outputConnection||e},o.zelos.TopRow.prototype.hasRightSquareCorner=function(t){return!!t.outputConnection&&!t.statementInputCount&&!t.nextConnection},o.zelos.BottomRow=function(t){o.zelos.BottomRow.superClass_.constructor.call(this,t)},o.utils.object.inherits(o.zelos.BottomRow,o.blockRendering.BottomRow),o.zelos.BottomRow.prototype.endsWithElemSpacer=function(){return!1},o.zelos.BottomRow.prototype.hasLeftSquareCorner=function(t){return!!t.outputConnection},o.zelos.BottomRow.prototype.hasRightSquareCorner=function(t){return!!t.outputConnection&&!t.statementInputCount&&!t.nextConnection},o.zelos.RightConnectionShape=function(t){o.zelos.RightConnectionShape.superClass_.constructor.call(this,t),this.type|=o.blockRendering.Types.getType("RIGHT_CONNECTION"),this.width=this.height=0},o.utils.object.inherits(o.zelos.RightConnectionShape,o.blockRendering.Measurable),o.zelos.StatementInput=function(t,e){if(o.zelos.StatementInput.superClass_.constructor.call(this,t,e),this.connectedBlock){for(t=this.connectedBlock;t.getNextBlock();)t=t.getNextBlock();t.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}},o.utils.object.inherits(o.zelos.StatementInput,o.blockRendering.StatementInput),o.zelos.RenderInfo=function(t,e){o.zelos.RenderInfo.superClass_.constructor.call(this,t,e),this.topRow=new o.zelos.TopRow(this.constants_),this.bottomRow=new o.zelos.BottomRow(this.constants_),this.isInline=!0,this.isMultiRow=!e.getInputsInline()||e.isCollapsed(),this.hasStatementInput=0<e.statementInputCount,this.rightSide=this.outputConnection?new o.zelos.RightConnectionShape(this.constants_):null},o.utils.object.inherits(o.zelos.RenderInfo,o.blockRendering.RenderInfo),o.zelos.RenderInfo.prototype.getRenderer=function(){return this.renderer_},o.zelos.RenderInfo.prototype.measure=function(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.adjustXPosition_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()},o.zelos.RenderInfo.prototype.shouldStartNewRow_=function(t,e){return!!e&&(t.type==o.NEXT_STATEMENT||e.type==o.NEXT_STATEMENT||(t.type==o.INPUT_VALUE||t.type==o.DUMMY_INPUT)&&(!this.isInline||this.isMultiRow))},o.zelos.RenderInfo.prototype.getDesiredRowWidth_=function(t){return t.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):o.zelos.RenderInfo.superClass_.getDesiredRowWidth_.call(this,t)},o.zelos.RenderInfo.prototype.getInRowSpacing_=function(t,e){return t&&e||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?!t&&e&&o.blockRendering.Types.isStatementInput(e)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:t&&o.blockRendering.Types.isLeftRoundedCorner(t)&&e&&(o.blockRendering.Types.isPreviousConnection(e)||o.blockRendering.Types.isNextConnection(e))?e.notchOffset-this.constants_.CORNER_RADIUS:t&&o.blockRendering.Types.isLeftSquareCorner(t)&&e&&o.blockRendering.Types.isHat(e)?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING},o.zelos.RenderInfo.prototype.getSpacerRowHeight_=function(t,e){if(o.blockRendering.Types.isTopRow(t)&&o.blockRendering.Types.isBottomRow(e))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;var i=o.blockRendering.Types.isInputRow(t)&&t.hasStatement,n=o.blockRendering.Types.isInputRow(e)&&e.hasStatement;return n||i?(t=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),n&&i?Math.max(t,this.constants_.DUMMY_INPUT_MIN_HEIGHT):t):o.blockRendering.Types.isTopRow(t)?t.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):o.blockRendering.Types.isBottomRow(e)?this.outputConnection?!e.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING},o.zelos.RenderInfo.prototype.getSpacerRowWidth_=function(t,e){var i=this.width-this.startX;return o.blockRendering.Types.isInputRow(t)&&t.hasStatement||o.blockRendering.Types.isInputRow(e)&&e.hasStatement?Math.max(i,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):i},o.zelos.RenderInfo.prototype.getElemCenterline_=function(t,e){if(t.hasStatement&&!o.blockRendering.Types.isSpacer(e)&&!o.blockRendering.Types.isStatementInput(e))return t.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if(o.blockRendering.Types.isInlineInput(e)){var i=e.connectedBlock;if(i&&i.outputConnection&&i.nextConnection)return t.yPos+i.height/2}return o.zelos.RenderInfo.superClass_.getElemCenterline_.call(this,t,e)},o.zelos.RenderInfo.prototype.addInput_=function(t,e){t.type==o.DUMMY_INPUT&&e.hasDummyInput&&e.align==o.ALIGN_LEFT&&t.align==o.ALIGN_RIGHT&&(e.rightAlignedDummyInput=t),o.zelos.RenderInfo.superClass_.addInput_.call(this,t,e)},o.zelos.RenderInfo.prototype.addAlignmentPadding_=function(t,e){if(t.rightAlignedDummyInput){for(var i,n,r=0;(n=t.elements[r])&&(o.blockRendering.Types.isSpacer(n)&&(i=n),!o.blockRendering.Types.isField(n)||n.parentInput!=t.rightAlignedDummyInput);r++);if(i)return i.width+=e,void(t.width+=e)}o.zelos.RenderInfo.superClass_.addAlignmentPadding_.call(this,t,e)},o.zelos.RenderInfo.prototype.adjustXPosition_=function(){for(var t=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH,e=t,i=2;i<this.rows.length-1;i+=2){var n=this.rows[i-1],r=this.rows[i],s=this.rows[i+1];if(n=2==i?!!this.topRow.hasPreviousConnection:!!n.followsStatement,s=i+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!s.precedesStatement,o.blockRendering.Types.isInputRow(r)&&r.hasStatement)r.measure(),e=r.width-r.getLastInput().width+t;else if(n&&(2==i||s)&&o.blockRendering.Types.isInputRow(r)&&!r.hasStatement){s=r.xPos,n=null;for(var a,l=0;a=r.elements[l];l++)o.blockRendering.Types.isSpacer(a)&&(n=a),!(n&&(o.blockRendering.Types.isField(a)||o.blockRendering.Types.isInput(a))&&s<e)||o.blockRendering.Types.isField(a)&&(a.field instanceof o.FieldLabel||a.field instanceof o.FieldImage)||(n.width+=e-s),s+=a.width}}},o.zelos.RenderInfo.prototype.finalizeOutputConnection_=function(){if(this.outputConnection&&this.outputConnection.isDynamicShape){for(var t,e=0,o=0;t=this.rows[o];o++)t.yPos=e,e+=t.height;this.height=e,o=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,e=this.outputConnection.shape.height(o),o=this.outputConnection.shape.width(o),this.outputConnection.height=e,this.outputConnection.width=o,this.outputConnection.startX=o,this.outputConnection.connectionOffsetY=this.outputConnection.shape.connectionOffsetY(e),this.outputConnection.connectionOffsetX=this.outputConnection.shape.connectionOffsetX(o),t=0,this.hasStatementInput||this.bottomRow.hasNextConnection||(t=o,this.rightSide.height=e,this.rightSide.width=t,this.rightSide.centerline=e/2,this.rightSide.xPos=this.width+t),this.startX=o,this.width+=o+t,this.widthWithChildren+=o+t}},o.zelos.RenderInfo.prototype.finalizeHorizontalAlignment_=function(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){for(var t,e=0,i=0;t=this.rows[i];i++)if(o.blockRendering.Types.isInputRow(t)){e=t.elements[t.elements.length-2];var n=this.getNegativeSpacing_(t.elements[1]),r=this.getNegativeSpacing_(e);e=n+r;var s=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-e<s&&(n=(e=this.width-s)/2,r=e/2),t.elements.unshift(new o.blockRendering.InRowSpacer(this.constants_,-n)),t.elements.push(new o.blockRendering.InRowSpacer(this.constants_,-r))}if(e)for(this.width-=e,this.widthWithChildren-=e,this.rightSide.xPos-=e,i=0;t=this.rows[i];i++)o.blockRendering.Types.isTopOrBottomRow(t)&&(t.elements[1].width-=e,t.elements[1].widthWithConnectedBlocks-=e),t.width-=e,t.widthWithConnectedBlocks-=e}},o.zelos.RenderInfo.prototype.getNegativeSpacing_=function(t){if(!t)return 0;var e=this.outputConnection.width,i=this.outputConnection.shape.type,n=this.constants_;if(this.isMultiRow&&1<this.inputRows.length)switch(i){case n.SHAPES.ROUND:return i=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,e-(i=this.height/2>i?i:this.height/2)*(1-Math.sin(Math.acos((i-this.constants_.SMALL_PADDING)/i)));default:return 0}if(o.blockRendering.Types.isInlineInput(t)){var r=t.connectedBlock;return t=r?r.pathObject.outputShapeType:t.shape.type,r&&r.outputConnection&&(r.statementInputCount||r.nextConnection)||i==n.SHAPES.HEXAGONAL&&i!=t?0:e-this.constants_.SHAPE_IN_SHAPE_PADDING[i][t]}return o.blockRendering.Types.isField(t)?i==n.SHAPES.ROUND&&t.field instanceof o.FieldTextInput?e-2.75*n.GRID_UNIT:e-this.constants_.SHAPE_IN_SHAPE_PADDING[i][0]:o.blockRendering.Types.isIcon(t)?this.constants_.SMALL_PADDING:0},o.zelos.RenderInfo.prototype.finalizeVerticalAlignment_=function(){if(!this.outputConnection)for(var t=2;t<this.rows.length-1;t+=2){var e=this.rows[t-1],i=this.rows[t],n=this.rows[t+1],r=2==t,s=t+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!n.precedesStatement;if(r?this.topRow.hasPreviousConnection:e.followsStatement){var a=3==i.elements.length&&(i.elements[1].field instanceof o.FieldLabel||i.elements[1].field instanceof o.FieldImage);if(!r&&a)e.height-=this.constants_.SMALL_PADDING,n.height-=this.constants_.SMALL_PADDING,i.height-=this.constants_.MEDIUM_PADDING;else if(r||s){if(s){for(r=!1,s=0;a=i.elements[s];s++)if(o.blockRendering.Types.isInlineInput(a)&&a.connectedBlock&&!a.connectedBlock.isShadow()&&40<=a.connectedBlock.getHeightWidth().height){r=!0;break}r&&(e.height-=this.constants_.SMALL_PADDING,n.height-=this.constants_.SMALL_PADDING)}}else e.height+=this.constants_.SMALL_PADDING}}},o.zelos.RenderInfo.prototype.finalize_=function(){this.finalizeOutputConnection_(),this.finalizeHorizontalAlignment_(),this.finalizeVerticalAlignment_(),o.zelos.RenderInfo.superClass_.finalize_.call(this),this.rightSide&&(this.widthWithChildren+=this.rightSide.width)},o.zelos.Drawer=function(t,e){o.zelos.Drawer.superClass_.constructor.call(this,t,e)},o.utils.object.inherits(o.zelos.Drawer,o.blockRendering.Drawer),o.zelos.Drawer.prototype.draw=function(){var t=this.block_.pathObject;t.beginDrawing(),this.hideHiddenIcons_(),this.drawOutline_(),this.drawInternals_(),t.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&t.flipRTL(),o.blockRendering.useDebugger&&this.block_.renderingDebugger.drawDebug(this.block_,this.info_),this.recordSizeOnBlock_(),this.info_.outputConnection&&(t.outputShapeType=this.info_.outputConnection.shape.type),t.endDrawing()},o.zelos.Drawer.prototype.drawOutline_=function(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):o.zelos.Drawer.superClass_.drawOutline_.call(this)},o.zelos.Drawer.prototype.drawLeft_=function(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?this.drawLeftDynamicConnection_():o.zelos.Drawer.superClass_.drawLeft_.call(this)},o.zelos.Drawer.prototype.drawRightSideRow_=function(t){if(!(0>=t.height))if(t.precedesStatement||t.followsStatement){var e=this.constants_.INSIDE_CORNERS.rightHeight;e=t.height-(t.precedesStatement?e:0),this.outlinePath_+=(t.followsStatement?this.constants_.INSIDE_CORNERS.pathBottomRight:"")+(0<e?o.utils.svgPaths.lineOnAxis("V",t.yPos+e):"")+(t.precedesStatement?this.constants_.INSIDE_CORNERS.pathTopRight:"")}else this.outlinePath_+=o.utils.svgPaths.lineOnAxis("V",t.yPos+t.height)},o.zelos.Drawer.prototype.drawRightDynamicConnection_=function(){this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)},o.zelos.Drawer.prototype.drawLeftDynamicConnection_=function(){this.positionOutputConnection_(),this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height),this.outlinePath_+="z"},o.zelos.Drawer.prototype.drawFlatTop_=function(){var t=this.info_.topRow;this.positionPreviousConnection_(),this.outlinePath_+=o.utils.svgPaths.moveBy(t.xPos,this.info_.startY),this.outlinePath_+=o.utils.svgPaths.lineOnAxis("h",t.width)},o.zelos.Drawer.prototype.drawFlatBottom_=function(){var t=this.info_.bottomRow;this.positionNextConnection_(),this.outlinePath_+=o.utils.svgPaths.lineOnAxis("V",t.baseline),this.outlinePath_+=o.utils.svgPaths.lineOnAxis("h",-t.width)},o.zelos.Drawer.prototype.drawInlineInput_=function(t){this.positionInlineInputConnection_(t);var e=t.input.name;if(!t.connectedBlock&&!this.info_.isInsertionMarker){var i=t.width-2*t.connectionWidth;t=o.utils.svgPaths.moveTo(t.xPos+t.connectionWidth,t.centerline-t.height/2)+o.utils.svgPaths.lineOnAxis("h",i)+t.shape.pathRightDown(t.height)+o.utils.svgPaths.lineOnAxis("h",-i)+t.shape.pathUp(t.height)+"z",this.block_.pathObject.setOutlinePath(e,t)}},o.zelos.Drawer.prototype.drawStatementInput_=function(t){var e=t.getLastInput(),i=e.xPos+e.notchOffset+e.shape.width,n=e.shape.pathRight+o.utils.svgPaths.lineOnAxis("h",-(e.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop,r=t.height-2*this.constants_.INSIDE_CORNERS.height;e=this.constants_.INSIDE_CORNERS.pathBottom+o.utils.svgPaths.lineOnAxis("h",e.notchOffset-this.constants_.INSIDE_CORNERS.width)+(e.connectedBottomNextConnection?"":e.shape.pathLeft),this.outlinePath_+=o.utils.svgPaths.lineOnAxis("H",i)+n+o.utils.svgPaths.lineOnAxis("v",r)+e+o.utils.svgPaths.lineOnAxis("H",t.xPos+t.width),this.positionStatementInputConnection_(t)},o.zelos.PathObject=function(t,e,i){o.zelos.PathObject.superClass_.constructor.call(this,t,e,i),this.constants=i,this.svgPathSelected_=null,this.outlines_={},this.outputShapeType=this.remainingOutlines_=null},o.utils.object.inherits(o.zelos.PathObject,o.blockRendering.PathObject),o.zelos.PathObject.prototype.setPath=function(t){o.zelos.PathObject.superClass_.setPath.call(this,t),this.svgPathSelected_&&this.svgPathSelected_.setAttribute("d",t)},o.zelos.PathObject.prototype.applyColour=function(t){o.zelos.PathObject.superClass_.applyColour.call(this,t),t.isShadow()&&t.getParent()&&this.svgPath.setAttribute("stroke",t.getParent().style.colourTertiary),t=0;for(var e,i=Object.keys(this.outlines_);e=i[t];t++)this.outlines_[e].setAttribute("fill",this.style.colourTertiary)},o.zelos.PathObject.prototype.flipRTL=function(){o.zelos.PathObject.superClass_.flipRTL.call(this);for(var t,e=0,i=Object.keys(this.outlines_);t=i[e];e++)this.outlines_[t].setAttribute("transform","scale(-1 1)")},o.zelos.PathObject.prototype.updateSelected=function(t){this.setClass_("blocklySelected",t),t?this.svgPathSelected_||(this.svgPathSelected_=this.svgPath.cloneNode(!0),this.svgPathSelected_.setAttribute("fill","none"),this.svgPathSelected_.setAttribute("filter","url(#"+this.constants.selectedGlowFilterId+")"),this.svgRoot.appendChild(this.svgPathSelected_)):this.svgPathSelected_&&(this.svgRoot.removeChild(this.svgPathSelected_),this.svgPathSelected_=null)},o.zelos.PathObject.prototype.updateReplacementFade=function(t){this.setClass_("blocklyReplaceable",t),t?this.svgPath.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):this.svgPath.removeAttribute("filter")},o.zelos.PathObject.prototype.updateShapeForInputHighlight=function(t,e){t=t.getParentInput().name,(t=this.getOutlinePath_(t))&&(e?t.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):t.removeAttribute("filter"))},o.zelos.PathObject.prototype.beginDrawing=function(){this.remainingOutlines_={};for(var t,e=0,o=Object.keys(this.outlines_);t=o[e];e++)this.remainingOutlines_[t]=1},o.zelos.PathObject.prototype.endDrawing=function(){if(this.remainingOutlines_)for(var t,e=0,o=Object.keys(this.remainingOutlines_);t=o[e];e++)this.removeOutlinePath_(t);this.remainingOutlines_=null},o.zelos.PathObject.prototype.setOutlinePath=function(t,e){(t=this.getOutlinePath_(t)).setAttribute("d",e),t.setAttribute("fill",this.style.colourTertiary)},o.zelos.PathObject.prototype.getOutlinePath_=function(t){return this.outlines_[t]||(this.outlines_[t]=o.utils.dom.createSvgElement(o.utils.Svg.PATH,{class:"blocklyOutlinePath",d:""},this.svgRoot)),this.remainingOutlines_&&delete this.remainingOutlines_[t],this.outlines_[t]},o.zelos.PathObject.prototype.removeOutlinePath_=function(t){this.outlines_[t].parentNode.removeChild(this.outlines_[t]),delete this.outlines_[t]},o.zelos.MarkerSvg=function(t,e,i){o.zelos.MarkerSvg.superClass_.constructor.call(this,t,e,i)},o.utils.object.inherits(o.zelos.MarkerSvg,o.blockRendering.MarkerSvg),o.zelos.MarkerSvg.prototype.showWithInputOutput_=function(t){var e=t.getSourceBlock();t=t.getLocation().getOffsetInBlock(),this.positionCircle_(t.x,t.y),this.setParent_(e),this.showCurrent_()},o.zelos.MarkerSvg.prototype.showWithOutput_=function(t){this.showWithInputOutput_(t)},o.zelos.MarkerSvg.prototype.showWithInput_=function(t){this.showWithInputOutput_(t)},o.zelos.MarkerSvg.prototype.showWithBlock_=function(t){var e=(t=t.getLocation()).getHeightWidth();this.positionRect_(0,0,e.width,e.height),this.setParent_(t),this.showCurrent_()},o.zelos.MarkerSvg.prototype.positionCircle_=function(t,e){this.markerCircle_.setAttribute("cx",t),this.markerCircle_.setAttribute("cy",e),this.currentMarkerSvg=this.markerCircle_},o.zelos.MarkerSvg.prototype.hide=function(){o.zelos.MarkerSvg.superClass_.hide.call(this),this.markerCircle_.style.display="none"},o.zelos.MarkerSvg.prototype.createDomInternal_=function(){if(o.zelos.MarkerSvg.superClass_.createDomInternal_.call(this),this.markerCircle_=o.utils.dom.createSvgElement(o.utils.Svg.CIRCLE,{r:this.constants_.CURSOR_RADIUS,style:"display: none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.isCursor()){var t=this.getBlinkProperties_();o.utils.dom.createSvgElement(o.utils.Svg.ANIMATE,t,this.markerCircle_)}return this.markerSvg_},o.zelos.MarkerSvg.prototype.applyColour_=function(t){o.zelos.MarkerSvg.superClass_.applyColour_.call(this,t),this.markerCircle_.setAttribute("fill",this.colour_),this.markerCircle_.setAttribute("stroke",this.colour_),this.isCursor()&&this.markerCircle_.firstChild.setAttribute("values",this.colour_+";transparent;transparent;")},o.zelos.Renderer=function(t){o.zelos.Renderer.superClass_.constructor.call(this,t)},o.utils.object.inherits(o.zelos.Renderer,o.blockRendering.Renderer),o.zelos.Renderer.prototype.makeConstants_=function(){return new o.zelos.ConstantProvider},o.zelos.Renderer.prototype.makeRenderInfo_=function(t){return new o.zelos.RenderInfo(this,t)},o.zelos.Renderer.prototype.makeDrawer_=function(t,e){return new o.zelos.Drawer(t,e)},o.zelos.Renderer.prototype.makeMarkerDrawer=function(t,e){return new o.zelos.MarkerSvg(t,this.getConstants(),e)},o.zelos.Renderer.prototype.makePathObject=function(t,e){return new o.zelos.PathObject(t,e,this.getConstants())},o.zelos.Renderer.prototype.shouldHighlightConnection=function(t){return t.type!=o.INPUT_VALUE&&t.type!==o.OUTPUT_VALUE},o.zelos.Renderer.prototype.getConnectionPreviewMethod=function(t,e,i){return e.type==o.OUTPUT_VALUE?t.isConnected()?o.InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:o.InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE:o.zelos.Renderer.superClass_.getConnectionPreviewMethod(t,e,i)},o.blockRendering.register("zelos",o.zelos.Renderer),o.Themes.Dark=o.Theme.defineTheme("dark",{base:o.Themes.Classic,componentStyles:{workspaceBackgroundColour:"#1e1e1e",toolboxBackgroundColour:"blackBackground",toolboxForegroundColour:"#fff",flyoutBackgroundColour:"#252526",flyoutForegroundColour:"#ccc",flyoutOpacity:1,scrollbarColour:"#797979",insertionMarkerColour:"#fff",insertionMarkerOpacity:.3,scrollbarOpacity:.4,cursorColour:"#d0d0d0",blackBackground:"#333"}}),o.Themes.Deuteranopia={},o.Themes.Deuteranopia.defaultBlockStyles={colour_blocks:{colourPrimary:"#f2a72c",colourSecondary:"#f1c172",colourTertiary:"#da921c"},list_blocks:{colourPrimary:"#7d65ab",colourSecondary:"#a88be0",colourTertiary:"#66518e"},logic_blocks:{colourPrimary:"#9fd2f1",colourSecondary:"#c0e0f4",colourTertiary:"#74bae5"},loop_blocks:{colourPrimary:"#795a07",colourSecondary:"#ac8726",colourTertiary:"#c4a03f"},math_blocks:{colourPrimary:"#e6da39",colourSecondary:"#f3ec8e",colourTertiary:"#f2eeb7"},procedure_blocks:{colourPrimary:"#590721",colourSecondary:"#8c475d",colourTertiary:"#885464"},text_blocks:{colourPrimary:"#058863",colourSecondary:"#5ecfaf",colourTertiary:"#04684c"},variable_blocks:{colourPrimary:"#47025a",colourSecondary:"#820fa1",colourTertiary:"#8e579d"},variable_dynamic_blocks:{colourPrimary:"#47025a",colourSecondary:"#820fa1",colourTertiary:"#8e579d"}},o.Themes.Deuteranopia.categoryStyles={colour_category:{colour:"#f2a72c"},list_category:{colour:"#7d65ab"},logic_category:{colour:"#9fd2f1"},loop_category:{colour:"#795a07"},math_category:{colour:"#e6da39"},procedure_category:{colour:"#590721"},text_category:{colour:"#058863"},variable_category:{colour:"#47025a"},variable_dynamic_category:{colour:"#47025a"}},o.Themes.Deuteranopia=new o.Theme("deuteranopia",o.Themes.Deuteranopia.defaultBlockStyles,o.Themes.Deuteranopia.categoryStyles),o.Themes.HighContrast={},o.Themes.HighContrast.defaultBlockStyles={colour_blocks:{colourPrimary:"#a52714",colourSecondary:"#FB9B8C",colourTertiary:"#FBE1DD"},list_blocks:{colourPrimary:"#4a148c",colourSecondary:"#AD7BE9",colourTertiary:"#CDB6E9"},logic_blocks:{colourPrimary:"#01579b",colourSecondary:"#64C7FF",colourTertiary:"#C5EAFF"},loop_blocks:{colourPrimary:"#33691e",colourSecondary:"#9AFF78",colourTertiary:"#E1FFD7"},math_blocks:{colourPrimary:"#1a237e",colourSecondary:"#8A9EFF",colourTertiary:"#DCE2FF"},procedure_blocks:{colourPrimary:"#006064",colourSecondary:"#77E6EE",colourTertiary:"#CFECEE"},text_blocks:{colourPrimary:"#004d40",colourSecondary:"#5ae27c",colourTertiary:"#D2FFDD"},variable_blocks:{colourPrimary:"#880e4f",colourSecondary:"#FF73BE",colourTertiary:"#FFD4EB"},variable_dynamic_blocks:{colourPrimary:"#880e4f",colourSecondary:"#FF73BE",colourTertiary:"#FFD4EB"},hat_blocks:{colourPrimary:"#880e4f",colourSecondary:"#FF73BE",colourTertiary:"#FFD4EB",hat:"cap"}},o.Themes.HighContrast.categoryStyles={colour_category:{colour:"#a52714"},list_category:{colour:"#4a148c"},logic_category:{colour:"#01579b"},loop_category:{colour:"#33691e"},math_category:{colour:"#1a237e"},procedure_category:{colour:"#006064"},text_category:{colour:"#004d40"},variable_category:{colour:"#880e4f"},variable_dynamic_category:{colour:"#880e4f"}},o.Themes.HighContrast=new o.Theme("highcontrast",o.Themes.HighContrast.defaultBlockStyles,o.Themes.HighContrast.categoryStyles),o.Themes.HighContrast.setComponentStyle("selectedGlowColour","#000000"),o.Themes.HighContrast.setComponentStyle("selectedGlowSize",1),o.Themes.HighContrast.setComponentStyle("replacementGlowColour","#000000"),o.Themes.HighContrast.setFontStyle({family:null,weight:null,size:16}),o.Themes.Tritanopia={},o.Themes.Tritanopia.defaultBlockStyles={colour_blocks:{colourPrimary:"#05427f",colourSecondary:"#2974c0",colourTertiary:"#2d74bb"},list_blocks:{colourPrimary:"#b69ce8",colourSecondary:"#ccbaef",colourTertiary:"#9176c5"},logic_blocks:{colourPrimary:"#9fd2f1",colourSecondary:"#c0e0f4",colourTertiary:"#74bae5"},loop_blocks:{colourPrimary:"#aa1846",colourSecondary:"#d36185",colourTertiary:"#7c1636"},math_blocks:{colourPrimary:"#e6da39",colourSecondary:"#f3ec8e",colourTertiary:"#f2eeb7"},procedure_blocks:{colourPrimary:"#590721",colourSecondary:"#8c475d",colourTertiary:"#885464"},text_blocks:{colourPrimary:"#058863",colourSecondary:"#5ecfaf",colourTertiary:"#04684c"},variable_blocks:{colourPrimary:"#4b2d84",colourSecondary:"#816ea7",colourTertiary:"#83759e"},variable_dynamic_blocks:{colourPrimary:"#4b2d84",colourSecondary:"#816ea7",colourTertiary:"#83759e"}},o.Themes.Tritanopia.categoryStyles={colour_category:{colour:"#05427f"},list_category:{colour:"#b69ce8"},logic_category:{colour:"#9fd2f1"},loop_category:{colour:"#aa1846"},math_category:{colour:"#e6da39"},procedure_category:{colour:"#590721"},text_category:{colour:"#058863"},variable_category:{colour:"#4b2d84"},variable_dynamic_category:{colour:"#4b2d84"}},o.Themes.Tritanopia=new o.Theme("tritanopia",o.Themes.Tritanopia.defaultBlockStyles,o.Themes.Tritanopia.categoryStyles),o.requires={},o)})),z=G((function(t,e){t.exports=K})),j=G((function(t,e){var o;t.exports=((o=z).setLocale=function(t){o.Msg=o.Msg||{},Object.keys(t).forEach((function(e){o.Msg[e]=t[e]}))},o)})),$=G((function(t,e){var o;t.exports=(o=j,(o={Msg:{}}).Msg.ADD_COMMENT="Add Comment",o.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE="Can't delete the variable '%1' because it's part of the definition of the function '%2'",o.Msg.CHANGE_VALUE_TITLE="Change value:",o.Msg.CLEAN_UP="Clean up Blocks",o.Msg.COLLAPSED_WARNINGS_WARNING="Collapsed blocks contain warnings.",o.Msg.COLLAPSE_ALL="Collapse Blocks",o.Msg.COLLAPSE_BLOCK="Collapse Block",o.Msg.COLOUR_BLEND_COLOUR1="colour 1",o.Msg.COLOUR_BLEND_COLOUR2="colour 2",o.Msg.COLOUR_BLEND_HELPURL="https://meyerweb.com/eric/tools/color-blend/#:::rgbp",o.Msg.COLOUR_BLEND_RATIO="ratio",o.Msg.COLOUR_BLEND_TITLE="blend",o.Msg.COLOUR_BLEND_TOOLTIP="Blends two colours together with a given ratio (0.0 - 1.0).",o.Msg.COLOUR_PICKER_HELPURL="https://en.wikipedia.org/wiki/Color",o.Msg.COLOUR_PICKER_TOOLTIP="Choose a colour from the palette.",o.Msg.COLOUR_RANDOM_HELPURL="http://randomcolour.com",o.Msg.COLOUR_RANDOM_TITLE="random colour",o.Msg.COLOUR_RANDOM_TOOLTIP="Choose a colour at random.",o.Msg.COLOUR_RGB_BLUE="blue",o.Msg.COLOUR_RGB_GREEN="green",o.Msg.COLOUR_RGB_HELPURL="https://www.december.com/html/spec/colorpercompact.html",o.Msg.COLOUR_RGB_RED="red",o.Msg.COLOUR_RGB_TITLE="colour with",o.Msg.COLOUR_RGB_TOOLTIP="Create a colour with the specified amount of red, green, and blue. All values must be between 0 and 100.",o.Msg.CONTROLS_FLOW_STATEMENTS_HELPURL="https://github.com/google/blockly/wiki/Loops#loop-termination-blocks",o.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK="break out of loop",o.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE="continue with next iteration of loop",o.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK="Break out of the containing loop.",o.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE="Skip the rest of this loop, and continue with the next iteration.",o.Msg.CONTROLS_FLOW_STATEMENTS_WARNING="Warning: This block may only be used within a loop.",o.Msg.CONTROLS_FOREACH_HELPURL="https://github.com/google/blockly/wiki/Loops#for-each",o.Msg.CONTROLS_FOREACH_TITLE="for each item %1 in list %2",o.Msg.CONTROLS_FOREACH_TOOLTIP="For each item in a list, set the variable '%1' to the item, and then do some statements.",o.Msg.CONTROLS_FOR_HELPURL="https://github.com/google/blockly/wiki/Loops#count-with",o.Msg.CONTROLS_FOR_TITLE="count with %1 from %2 to %3 by %4",o.Msg.CONTROLS_FOR_TOOLTIP="Have the variable '%1' take on the values from the start number to the end number, counting by the specified interval, and do the specified blocks.",o.Msg.CONTROLS_IF_ELSEIF_TOOLTIP="Add a condition to the if block.",o.Msg.CONTROLS_IF_ELSE_TOOLTIP="Add a final, catch-all condition to the if block.",o.Msg.CONTROLS_IF_HELPURL="https://github.com/google/blockly/wiki/IfElse",o.Msg.CONTROLS_IF_IF_TOOLTIP="Add, remove, or reorder sections to reconfigure this if block.",o.Msg.CONTROLS_IF_MSG_ELSE="else",o.Msg.CONTROLS_IF_MSG_ELSEIF="else if",o.Msg.CONTROLS_IF_MSG_IF="if",o.Msg.CONTROLS_IF_TOOLTIP_1="If a value is true, then do some statements.",o.Msg.CONTROLS_IF_TOOLTIP_2="If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",o.Msg.CONTROLS_IF_TOOLTIP_3="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",o.Msg.CONTROLS_IF_TOOLTIP_4="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",o.Msg.CONTROLS_REPEAT_HELPURL="https://en.wikipedia.org/wiki/For_loop",o.Msg.CONTROLS_REPEAT_INPUT_DO="do",o.Msg.CONTROLS_REPEAT_TITLE="repeat %1 times",o.Msg.CONTROLS_REPEAT_TOOLTIP="Do some statements several times.",o.Msg.CONTROLS_WHILEUNTIL_HELPURL="https://github.com/google/blockly/wiki/Loops#repeat",o.Msg.CONTROLS_WHILEUNTIL_OPERATOR_UNTIL="repeat until",o.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE="repeat while",o.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL="While a value is false, then do some statements.",o.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_WHILE="While a value is true, then do some statements.",o.Msg.DELETE_ALL_BLOCKS="Delete all %1 blocks?",o.Msg.DELETE_BLOCK="Delete Block",o.Msg.DELETE_VARIABLE="Delete the '%1' variable",o.Msg.DELETE_VARIABLE_CONFIRMATION="Delete %1 uses of the '%2' variable?",o.Msg.DELETE_X_BLOCKS="Delete %1 Blocks",o.Msg.DISABLE_BLOCK="Disable Block",o.Msg.DUPLICATE_BLOCK="Duplicate",o.Msg.DUPLICATE_COMMENT="Duplicate Comment",o.Msg.ENABLE_BLOCK="Enable Block",o.Msg.EXPAND_ALL="Expand Blocks",o.Msg.EXPAND_BLOCK="Expand Block",o.Msg.EXTERNAL_INPUTS="External Inputs",o.Msg.HELP="Help",o.Msg.INLINE_INPUTS="Inline Inputs",o.Msg.IOS_CANCEL="Cancel",o.Msg.IOS_ERROR="Error",o.Msg.IOS_OK="OK",o.Msg.IOS_PROCEDURES_ADD_INPUT="+ Add Input",o.Msg.IOS_PROCEDURES_ALLOW_STATEMENTS="Allow statements",o.Msg.IOS_PROCEDURES_DUPLICATE_INPUTS_ERROR="This function has duplicate inputs.",o.Msg.IOS_PROCEDURES_INPUTS="INPUTS",o.Msg.IOS_VARIABLES_ADD_BUTTON="Add",o.Msg.IOS_VARIABLES_ADD_VARIABLE="+ Add Variable",o.Msg.IOS_VARIABLES_DELETE_BUTTON="Delete",o.Msg.IOS_VARIABLES_EMPTY_NAME_ERROR="You can't use an empty variable name.",o.Msg.IOS_VARIABLES_RENAME_BUTTON="Rename",o.Msg.IOS_VARIABLES_VARIABLE_NAME="Variable name",o.Msg.LISTS_CREATE_EMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#create-empty-list",o.Msg.LISTS_CREATE_EMPTY_TITLE="create empty list",o.Msg.LISTS_CREATE_EMPTY_TOOLTIP="Returns a list, of length 0, containing no data records",o.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD="list",o.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP="Add, remove, or reorder sections to reconfigure this list block.",o.Msg.LISTS_CREATE_WITH_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",o.Msg.LISTS_CREATE_WITH_INPUT_WITH="create list with",o.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP="Add an item to the list.",o.Msg.LISTS_CREATE_WITH_TOOLTIP="Create a list with any number of items.",o.Msg.LISTS_GET_INDEX_FIRST="first",o.Msg.LISTS_GET_INDEX_FROM_END="# from end",o.Msg.LISTS_GET_INDEX_FROM_START="#",o.Msg.LISTS_GET_INDEX_GET="get",o.Msg.LISTS_GET_INDEX_GET_REMOVE="get and remove",o.Msg.LISTS_GET_INDEX_LAST="last",o.Msg.LISTS_GET_INDEX_RANDOM="random",o.Msg.LISTS_GET_INDEX_REMOVE="remove",o.Msg.LISTS_GET_INDEX_TAIL="",o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST="Returns the first item in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM="Returns the item at the specified position in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST="Returns the last item in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM="Returns a random item in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST="Removes and returns the first item in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM="Removes and returns the item at the specified position in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST="Removes and returns the last item in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM="Removes and returns a random item in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST="Removes the first item in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM="Removes the item at the specified position in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST="Removes the last item in a list.",o.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM="Removes a random item in a list.",o.Msg.LISTS_GET_SUBLIST_END_FROM_END="to # from end",o.Msg.LISTS_GET_SUBLIST_END_FROM_START="to #",o.Msg.LISTS_GET_SUBLIST_END_LAST="to last",o.Msg.LISTS_GET_SUBLIST_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-a-sublist",o.Msg.LISTS_GET_SUBLIST_START_FIRST="get sub-list from first",o.Msg.LISTS_GET_SUBLIST_START_FROM_END="get sub-list from # from end",o.Msg.LISTS_GET_SUBLIST_START_FROM_START="get sub-list from #",o.Msg.LISTS_GET_SUBLIST_TAIL="",o.Msg.LISTS_GET_SUBLIST_TOOLTIP="Creates a copy of the specified portion of a list.",o.Msg.LISTS_INDEX_FROM_END_TOOLTIP="%1 is the last item.",o.Msg.LISTS_INDEX_FROM_START_TOOLTIP="%1 is the first item.",o.Msg.LISTS_INDEX_OF_FIRST="find first occurrence of item",o.Msg.LISTS_INDEX_OF_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-items-from-a-list",o.Msg.LISTS_INDEX_OF_LAST="find last occurrence of item",o.Msg.LISTS_INDEX_OF_TOOLTIP="Returns the index of the first/last occurrence of the item in the list. Returns %1 if item is not found.",o.Msg.LISTS_INLIST="in list",o.Msg.LISTS_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#is-empty",o.Msg.LISTS_ISEMPTY_TITLE="%1 is empty",o.Msg.LISTS_ISEMPTY_TOOLTIP="Returns true if the list is empty.",o.Msg.LISTS_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Lists#length-of",o.Msg.LISTS_LENGTH_TITLE="length of %1",o.Msg.LISTS_LENGTH_TOOLTIP="Returns the length of a list.",o.Msg.LISTS_REPEAT_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",o.Msg.LISTS_REPEAT_TITLE="create list with item %1 repeated %2 times",o.Msg.LISTS_REPEAT_TOOLTIP="Creates a list consisting of the given value repeated the specified number of times.",o.Msg.LISTS_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Lists#reversing-a-list",o.Msg.LISTS_REVERSE_MESSAGE0="reverse %1",o.Msg.LISTS_REVERSE_TOOLTIP="Reverse a copy of a list.",o.Msg.LISTS_SET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#in-list--set",o.Msg.LISTS_SET_INDEX_INPUT_TO="as",o.Msg.LISTS_SET_INDEX_INSERT="insert at",o.Msg.LISTS_SET_INDEX_SET="set",o.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST="Inserts the item at the start of a list.",o.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM="Inserts the item at the specified position in a list.",o.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST="Append the item to the end of a list.",o.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM="Inserts the item randomly in a list.",o.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST="Sets the first item in a list.",o.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM="Sets the item at the specified position in a list.",o.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST="Sets the last item in a list.",o.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM="Sets a random item in a list.",o.Msg.LISTS_SORT_HELPURL="https://github.com/google/blockly/wiki/Lists#sorting-a-list",o.Msg.LISTS_SORT_ORDER_ASCENDING="ascending",o.Msg.LISTS_SORT_ORDER_DESCENDING="descending",o.Msg.LISTS_SORT_TITLE="sort %1 %2 %3",o.Msg.LISTS_SORT_TOOLTIP="Sort a copy of a list.",o.Msg.LISTS_SORT_TYPE_IGNORECASE="alphabetic, ignore case",o.Msg.LISTS_SORT_TYPE_NUMERIC="numeric",o.Msg.LISTS_SORT_TYPE_TEXT="alphabetic",o.Msg.LISTS_SPLIT_HELPURL="https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists",o.Msg.LISTS_SPLIT_LIST_FROM_TEXT="make list from text",o.Msg.LISTS_SPLIT_TEXT_FROM_LIST="make text from list",o.Msg.LISTS_SPLIT_TOOLTIP_JOIN="Join a list of texts into one text, separated by a delimiter.",o.Msg.LISTS_SPLIT_TOOLTIP_SPLIT="Split text into a list of texts, breaking at each delimiter.",o.Msg.LISTS_SPLIT_WITH_DELIMITER="with delimiter",o.Msg.LOGIC_BOOLEAN_FALSE="false",o.Msg.LOGIC_BOOLEAN_HELPURL="https://github.com/google/blockly/wiki/Logic#values",o.Msg.LOGIC_BOOLEAN_TOOLTIP="Returns either true or false.",o.Msg.LOGIC_BOOLEAN_TRUE="true",o.Msg.LOGIC_COMPARE_HELPURL="https://en.wikipedia.org/wiki/Inequality_(mathematics)",o.Msg.LOGIC_COMPARE_TOOLTIP_EQ="Return true if both inputs equal each other.",o.Msg.LOGIC_COMPARE_TOOLTIP_GT="Return true if the first input is greater than the second input.",o.Msg.LOGIC_COMPARE_TOOLTIP_GTE="Return true if the first input is greater than or equal to the second input.",o.Msg.LOGIC_COMPARE_TOOLTIP_LT="Return true if the first input is smaller than the second input.",o.Msg.LOGIC_COMPARE_TOOLTIP_LTE="Return true if the first input is smaller than or equal to the second input.",o.Msg.LOGIC_COMPARE_TOOLTIP_NEQ="Return true if both inputs are not equal to each other.",o.Msg.LOGIC_NEGATE_HELPURL="https://github.com/google/blockly/wiki/Logic#not",o.Msg.LOGIC_NEGATE_TITLE="not %1",o.Msg.LOGIC_NEGATE_TOOLTIP="Returns true if the input is false. Returns false if the input is true.",o.Msg.LOGIC_NULL="null",o.Msg.LOGIC_NULL_HELPURL="https://en.wikipedia.org/wiki/Nullable_type",o.Msg.LOGIC_NULL_TOOLTIP="Returns null.",o.Msg.LOGIC_OPERATION_AND="and",o.Msg.LOGIC_OPERATION_HELPURL="https://github.com/google/blockly/wiki/Logic#logical-operations",o.Msg.LOGIC_OPERATION_OR="or",o.Msg.LOGIC_OPERATION_TOOLTIP_AND="Return true if both inputs are true.",o.Msg.LOGIC_OPERATION_TOOLTIP_OR="Return true if at least one of the inputs is true.",o.Msg.LOGIC_TERNARY_CONDITION="test",o.Msg.LOGIC_TERNARY_HELPURL="https://en.wikipedia.org/wiki/%3F:",o.Msg.LOGIC_TERNARY_IF_FALSE="if false",o.Msg.LOGIC_TERNARY_IF_TRUE="if true",o.Msg.LOGIC_TERNARY_TOOLTIP="Check the condition in 'test'. If the condition is true, returns the 'if true' value; otherwise returns the 'if false' value.",o.Msg.MATH_ADDITION_SYMBOL="+",o.Msg.MATH_ARITHMETIC_HELPURL="https://en.wikipedia.org/wiki/Arithmetic",o.Msg.MATH_ARITHMETIC_TOOLTIP_ADD="Return the sum of the two numbers.",o.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE="Return the quotient of the two numbers.",o.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS="Return the difference of the two numbers.",o.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY="Return the product of the two numbers.",o.Msg.MATH_ARITHMETIC_TOOLTIP_POWER="Return the first number raised to the power of the second number.",o.Msg.MATH_ATAN2_HELPURL="https://en.wikipedia.org/wiki/Atan2",o.Msg.MATH_ATAN2_TITLE="atan2 of X:%1 Y:%2",o.Msg.MATH_ATAN2_TOOLTIP="Return the arctangent of point (X, Y) in degrees from -180 to 180.",o.Msg.MATH_CHANGE_HELPURL="https://en.wikipedia.org/wiki/Programming_idiom#Incrementing_a_counter",o.Msg.MATH_CHANGE_TITLE="change %1 by %2",o.Msg.MATH_CHANGE_TOOLTIP="Add a number to variable '%1'.",o.Msg.MATH_CONSTANT_HELPURL="https://en.wikipedia.org/wiki/Mathematical_constant",o.Msg.MATH_CONSTANT_TOOLTIP="Return one of the common constants:  (3.141), e (2.718),  (1.618), sqrt(2) (1.414), sqrt() (0.707), or  (infinity).",o.Msg.MATH_CONSTRAIN_HELPURL="https://en.wikipedia.org/wiki/Clamping_(graphics)",o.Msg.MATH_CONSTRAIN_TITLE="constrain %1 low %2 high %3",o.Msg.MATH_CONSTRAIN_TOOLTIP="Constrain a number to be between the specified limits (inclusive).",o.Msg.MATH_DIVISION_SYMBOL="",o.Msg.MATH_IS_DIVISIBLE_BY="is divisible by",o.Msg.MATH_IS_EVEN="is even",o.Msg.MATH_IS_NEGATIVE="is negative",o.Msg.MATH_IS_ODD="is odd",o.Msg.MATH_IS_POSITIVE="is positive",o.Msg.MATH_IS_PRIME="is prime",o.Msg.MATH_IS_TOOLTIP="Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",o.Msg.MATH_IS_WHOLE="is whole",o.Msg.MATH_MODULO_HELPURL="https://en.wikipedia.org/wiki/Modulo_operation",o.Msg.MATH_MODULO_TITLE="remainder of %1  %2",o.Msg.MATH_MODULO_TOOLTIP="Return the remainder from dividing the two numbers.",o.Msg.MATH_MULTIPLICATION_SYMBOL="",o.Msg.MATH_NUMBER_HELPURL="https://en.wikipedia.org/wiki/Number",o.Msg.MATH_NUMBER_TOOLTIP="A number.",o.Msg.MATH_ONLIST_HELPURL="",o.Msg.MATH_ONLIST_OPERATOR_AVERAGE="average of list",o.Msg.MATH_ONLIST_OPERATOR_MAX="max of list",o.Msg.MATH_ONLIST_OPERATOR_MEDIAN="median of list",o.Msg.MATH_ONLIST_OPERATOR_MIN="min of list",o.Msg.MATH_ONLIST_OPERATOR_MODE="modes of list",o.Msg.MATH_ONLIST_OPERATOR_RANDOM="random item of list",o.Msg.MATH_ONLIST_OPERATOR_STD_DEV="standard deviation of list",o.Msg.MATH_ONLIST_OPERATOR_SUM="sum of list",o.Msg.MATH_ONLIST_TOOLTIP_AVERAGE="Return the average (arithmetic mean) of the numeric values in the list.",o.Msg.MATH_ONLIST_TOOLTIP_MAX="Return the largest number in the list.",o.Msg.MATH_ONLIST_TOOLTIP_MEDIAN="Return the median number in the list.",o.Msg.MATH_ONLIST_TOOLTIP_MIN="Return the smallest number in the list.",o.Msg.MATH_ONLIST_TOOLTIP_MODE="Return a list of the most common item(s) in the list.",o.Msg.MATH_ONLIST_TOOLTIP_RANDOM="Return a random element from the list.",o.Msg.MATH_ONLIST_TOOLTIP_STD_DEV="Return the standard deviation of the list.",o.Msg.MATH_ONLIST_TOOLTIP_SUM="Return the sum of all the numbers in the list.",o.Msg.MATH_POWER_SYMBOL="^",o.Msg.MATH_RANDOM_FLOAT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",o.Msg.MATH_RANDOM_FLOAT_TITLE_RANDOM="random fraction",o.Msg.MATH_RANDOM_FLOAT_TOOLTIP="Return a random fraction between 0.0 (inclusive) and 1.0 (exclusive).",o.Msg.MATH_RANDOM_INT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",o.Msg.MATH_RANDOM_INT_TITLE="random integer from %1 to %2",o.Msg.MATH_RANDOM_INT_TOOLTIP="Return a random integer between the two specified limits, inclusive.",o.Msg.MATH_ROUND_HELPURL="https://en.wikipedia.org/wiki/Rounding",o.Msg.MATH_ROUND_OPERATOR_ROUND="round",o.Msg.MATH_ROUND_OPERATOR_ROUNDDOWN="round down",o.Msg.MATH_ROUND_OPERATOR_ROUNDUP="round up",o.Msg.MATH_ROUND_TOOLTIP="Round a number up or down.",o.Msg.MATH_SINGLE_HELPURL="https://en.wikipedia.org/wiki/Square_root",o.Msg.MATH_SINGLE_OP_ABSOLUTE="absolute",o.Msg.MATH_SINGLE_OP_ROOT="square root",o.Msg.MATH_SINGLE_TOOLTIP_ABS="Return the absolute value of a number.",o.Msg.MATH_SINGLE_TOOLTIP_EXP="Return e to the power of a number.",o.Msg.MATH_SINGLE_TOOLTIP_LN="Return the natural logarithm of a number.",o.Msg.MATH_SINGLE_TOOLTIP_LOG10="Return the base 10 logarithm of a number.",o.Msg.MATH_SINGLE_TOOLTIP_NEG="Return the negation of a number.",o.Msg.MATH_SINGLE_TOOLTIP_POW10="Return 10 to the power of a number.",o.Msg.MATH_SINGLE_TOOLTIP_ROOT="Return the square root of a number.",o.Msg.MATH_SUBTRACTION_SYMBOL="-",o.Msg.MATH_TRIG_ACOS="acos",o.Msg.MATH_TRIG_ASIN="asin",o.Msg.MATH_TRIG_ATAN="atan",o.Msg.MATH_TRIG_COS="cos",o.Msg.MATH_TRIG_HELPURL="https://en.wikipedia.org/wiki/Trigonometric_functions",o.Msg.MATH_TRIG_SIN="sin",o.Msg.MATH_TRIG_TAN="tan",o.Msg.MATH_TRIG_TOOLTIP_ACOS="Return the arccosine of a number.",o.Msg.MATH_TRIG_TOOLTIP_ASIN="Return the arcsine of a number.",o.Msg.MATH_TRIG_TOOLTIP_ATAN="Return the arctangent of a number.",o.Msg.MATH_TRIG_TOOLTIP_COS="Return the cosine of a degree (not radian).",o.Msg.MATH_TRIG_TOOLTIP_SIN="Return the sine of a degree (not radian).",o.Msg.MATH_TRIG_TOOLTIP_TAN="Return the tangent of a degree (not radian).",o.Msg.NEW_COLOUR_VARIABLE="Create colour variable...",o.Msg.NEW_NUMBER_VARIABLE="Create number variable...",o.Msg.NEW_STRING_VARIABLE="Create string variable...",o.Msg.NEW_VARIABLE="Create variable...",o.Msg.NEW_VARIABLE_TITLE="New variable name:",o.Msg.NEW_VARIABLE_TYPE_TITLE="New variable type:",o.Msg.ORDINAL_NUMBER_SUFFIX="",o.Msg.PROCEDURES_ALLOW_STATEMENTS="allow statements",o.Msg.PROCEDURES_BEFORE_PARAMS="with:",o.Msg.PROCEDURES_CALLNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",o.Msg.PROCEDURES_CALLNORETURN_TOOLTIP="Run the user-defined function '%1'.",o.Msg.PROCEDURES_CALLRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",o.Msg.PROCEDURES_CALLRETURN_TOOLTIP="Run the user-defined function '%1' and use its output.",o.Msg.PROCEDURES_CALL_BEFORE_PARAMS="with:",o.Msg.PROCEDURES_CREATE_DO="Create '%1'",o.Msg.PROCEDURES_DEFNORETURN_COMMENT="Describe this function...",o.Msg.PROCEDURES_DEFNORETURN_DO="",o.Msg.PROCEDURES_DEFNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",o.Msg.PROCEDURES_DEFNORETURN_PROCEDURE="do something",o.Msg.PROCEDURES_DEFNORETURN_TITLE="to",o.Msg.PROCEDURES_DEFNORETURN_TOOLTIP="Creates a function with no output.",o.Msg.PROCEDURES_DEFRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",o.Msg.PROCEDURES_DEFRETURN_RETURN="return",o.Msg.PROCEDURES_DEFRETURN_TOOLTIP="Creates a function with an output.",o.Msg.PROCEDURES_DEF_DUPLICATE_WARNING="Warning: This function has duplicate parameters.",o.Msg.PROCEDURES_HIGHLIGHT_DEF="Highlight function definition",o.Msg.PROCEDURES_IFRETURN_HELPURL="http://c2.com/cgi/wiki?GuardClause",o.Msg.PROCEDURES_IFRETURN_TOOLTIP="If a value is true, then return a second value.",o.Msg.PROCEDURES_IFRETURN_WARNING="Warning: This block may be used only within a function definition.",o.Msg.PROCEDURES_MUTATORARG_TITLE="input name:",o.Msg.PROCEDURES_MUTATORARG_TOOLTIP="Add an input to the function.",o.Msg.PROCEDURES_MUTATORCONTAINER_TITLE="inputs",o.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP="Add, remove, or reorder inputs to this function.",o.Msg.REDO="Redo",o.Msg.REMOVE_COMMENT="Remove Comment",o.Msg.RENAME_VARIABLE="Rename variable...",o.Msg.RENAME_VARIABLE_TITLE="Rename all '%1' variables to:",o.Msg.TEXT_APPEND_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",o.Msg.TEXT_APPEND_TITLE="to %1 append text %2",o.Msg.TEXT_APPEND_TOOLTIP="Append some text to variable '%1'.",o.Msg.TEXT_CHANGECASE_HELPURL="https://github.com/google/blockly/wiki/Text#adjusting-text-case",o.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE="to lower case",o.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE="to Title Case",o.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE="to UPPER CASE",o.Msg.TEXT_CHANGECASE_TOOLTIP="Return a copy of the text in a different case.",o.Msg.TEXT_CHARAT_FIRST="get first letter",o.Msg.TEXT_CHARAT_FROM_END="get letter # from end",o.Msg.TEXT_CHARAT_FROM_START="get letter #",o.Msg.TEXT_CHARAT_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-text",o.Msg.TEXT_CHARAT_LAST="get last letter",o.Msg.TEXT_CHARAT_RANDOM="get random letter",o.Msg.TEXT_CHARAT_TAIL="",o.Msg.TEXT_CHARAT_TITLE="in text %1 %2",o.Msg.TEXT_CHARAT_TOOLTIP="Returns the letter at the specified position.",o.Msg.TEXT_COUNT_HELPURL="https://github.com/google/blockly/wiki/Text#counting-substrings",o.Msg.TEXT_COUNT_MESSAGE0="count %1 in %2",o.Msg.TEXT_COUNT_TOOLTIP="Count how many times some text occurs within some other text.",o.Msg.TEXT_CREATE_JOIN_ITEM_TOOLTIP="Add an item to the text.",o.Msg.TEXT_CREATE_JOIN_TITLE_JOIN="join",o.Msg.TEXT_CREATE_JOIN_TOOLTIP="Add, remove, or reorder sections to reconfigure this text block.",o.Msg.TEXT_GET_SUBSTRING_END_FROM_END="to letter # from end",o.Msg.TEXT_GET_SUBSTRING_END_FROM_START="to letter #",o.Msg.TEXT_GET_SUBSTRING_END_LAST="to last letter",o.Msg.TEXT_GET_SUBSTRING_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-a-region-of-text",o.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT="in text",o.Msg.TEXT_GET_SUBSTRING_START_FIRST="get substring from first letter",o.Msg.TEXT_GET_SUBSTRING_START_FROM_END="get substring from letter # from end",o.Msg.TEXT_GET_SUBSTRING_START_FROM_START="get substring from letter #",o.Msg.TEXT_GET_SUBSTRING_TAIL="",o.Msg.TEXT_GET_SUBSTRING_TOOLTIP="Returns a specified portion of the text.",o.Msg.TEXT_INDEXOF_HELPURL="https://github.com/google/blockly/wiki/Text#finding-text",o.Msg.TEXT_INDEXOF_OPERATOR_FIRST="find first occurrence of text",o.Msg.TEXT_INDEXOF_OPERATOR_LAST="find last occurrence of text",o.Msg.TEXT_INDEXOF_TITLE="in text %1 %2 %3",o.Msg.TEXT_INDEXOF_TOOLTIP="Returns the index of the first/last occurrence of the first text in the second text. Returns %1 if text is not found.",o.Msg.TEXT_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Text#checking-for-empty-text",o.Msg.TEXT_ISEMPTY_TITLE="%1 is empty",o.Msg.TEXT_ISEMPTY_TOOLTIP="Returns true if the provided text is empty.",o.Msg.TEXT_JOIN_HELPURL="https://github.com/google/blockly/wiki/Text#text-creation",o.Msg.TEXT_JOIN_TITLE_CREATEWITH="create text with",o.Msg.TEXT_JOIN_TOOLTIP="Create a piece of text by joining together any number of items.",o.Msg.TEXT_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",o.Msg.TEXT_LENGTH_TITLE="length of %1",o.Msg.TEXT_LENGTH_TOOLTIP="Returns the number of letters (including spaces) in the provided text.",o.Msg.TEXT_PRINT_HELPURL="https://github.com/google/blockly/wiki/Text#printing-text",o.Msg.TEXT_PRINT_TITLE="print %1",o.Msg.TEXT_PRINT_TOOLTIP="Print the specified text, number or other value.",o.Msg.TEXT_PROMPT_HELPURL="https://github.com/google/blockly/wiki/Text#getting-input-from-the-user",o.Msg.TEXT_PROMPT_TOOLTIP_NUMBER="Prompt for user for a number.",o.Msg.TEXT_PROMPT_TOOLTIP_TEXT="Prompt for user for some text.",o.Msg.TEXT_PROMPT_TYPE_NUMBER="prompt for number with message",o.Msg.TEXT_PROMPT_TYPE_TEXT="prompt for text with message",o.Msg.TEXT_REPLACE_HELPURL="https://github.com/google/blockly/wiki/Text#replacing-substrings",o.Msg.TEXT_REPLACE_MESSAGE0="replace %1 with %2 in %3",o.Msg.TEXT_REPLACE_TOOLTIP="Replace all occurances of some text within some other text.",o.Msg.TEXT_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Text#reversing-text",o.Msg.TEXT_REVERSE_MESSAGE0="reverse %1",o.Msg.TEXT_REVERSE_TOOLTIP="Reverses the order of the characters in the text.",o.Msg.TEXT_TEXT_HELPURL="https://en.wikipedia.org/wiki/String_(computer_science)",o.Msg.TEXT_TEXT_TOOLTIP="A letter, word, or line of text.",o.Msg.TEXT_TRIM_HELPURL="https://github.com/google/blockly/wiki/Text#trimming-removing-spaces",o.Msg.TEXT_TRIM_OPERATOR_BOTH="trim spaces from both sides of",o.Msg.TEXT_TRIM_OPERATOR_LEFT="trim spaces from left side of",o.Msg.TEXT_TRIM_OPERATOR_RIGHT="trim spaces from right side of",o.Msg.TEXT_TRIM_TOOLTIP="Return a copy of the text with spaces removed from one or both ends.",o.Msg.TODAY="Today",o.Msg.UNDO="Undo",o.Msg.UNNAMED_KEY="unnamed",o.Msg.VARIABLES_DEFAULT_NAME="item",o.Msg.VARIABLES_GET_CREATE_SET="Create 'set %1'",o.Msg.VARIABLES_GET_HELPURL="https://github.com/google/blockly/wiki/Variables#get",o.Msg.VARIABLES_GET_TOOLTIP="Returns the value of this variable.",o.Msg.VARIABLES_SET="set %1 to %2",o.Msg.VARIABLES_SET_CREATE_GET="Create 'get %1'",o.Msg.VARIABLES_SET_HELPURL="https://github.com/google/blockly/wiki/Variables#set",o.Msg.VARIABLES_SET_TOOLTIP="Sets this variable to be equal to the input.",o.Msg.VARIABLE_ALREADY_EXISTS="A variable named '%1' already exists.",o.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE="A variable named '%1' already exists for another type: '%2'.",o.Msg.WORKSPACE_ARIA_LABEL="Blockly Workspace",o.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="Say something...",o.Msg.CONTROLS_FOREACH_INPUT_DO=o.Msg.CONTROLS_REPEAT_INPUT_DO,o.Msg.CONTROLS_FOR_INPUT_DO=o.Msg.CONTROLS_REPEAT_INPUT_DO,o.Msg.CONTROLS_IF_ELSEIF_TITLE_ELSEIF=o.Msg.CONTROLS_IF_MSG_ELSEIF,o.Msg.CONTROLS_IF_ELSE_TITLE_ELSE=o.Msg.CONTROLS_IF_MSG_ELSE,o.Msg.CONTROLS_IF_IF_TITLE_IF=o.Msg.CONTROLS_IF_MSG_IF,o.Msg.CONTROLS_IF_MSG_THEN=o.Msg.CONTROLS_REPEAT_INPUT_DO,o.Msg.CONTROLS_WHILEUNTIL_INPUT_DO=o.Msg.CONTROLS_REPEAT_INPUT_DO,o.Msg.LISTS_CREATE_WITH_ITEM_TITLE=o.Msg.VARIABLES_DEFAULT_NAME,o.Msg.LISTS_GET_INDEX_HELPURL=o.Msg.LISTS_INDEX_OF_HELPURL,o.Msg.LISTS_GET_INDEX_INPUT_IN_LIST=o.Msg.LISTS_INLIST,o.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST=o.Msg.LISTS_INLIST,o.Msg.LISTS_INDEX_OF_INPUT_IN_LIST=o.Msg.LISTS_INLIST,o.Msg.LISTS_SET_INDEX_INPUT_IN_LIST=o.Msg.LISTS_INLIST,o.Msg.MATH_CHANGE_TITLE_ITEM=o.Msg.VARIABLES_DEFAULT_NAME,o.Msg.PROCEDURES_DEFRETURN_COMMENT=o.Msg.PROCEDURES_DEFNORETURN_COMMENT,o.Msg.PROCEDURES_DEFRETURN_DO=o.Msg.PROCEDURES_DEFNORETURN_DO,o.Msg.PROCEDURES_DEFRETURN_PROCEDURE=o.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,o.Msg.PROCEDURES_DEFRETURN_TITLE=o.Msg.PROCEDURES_DEFNORETURN_TITLE,o.Msg.TEXT_APPEND_VARIABLE=o.Msg.VARIABLES_DEFAULT_NAME,o.Msg.TEXT_CREATE_JOIN_ITEM_TITLE_ITEM=o.Msg.VARIABLES_DEFAULT_NAME,o.Msg.MATH_HUE="230",o.Msg.LOOPS_HUE="120",o.Msg.LISTS_HUE="260",o.Msg.LOGIC_HUE="210",o.Msg.VARIABLES_HUE="330",o.Msg.TEXTS_HUE="160",o.Msg.PROCEDURES_HUE="290",o.Msg.COLOUR_HUE="20",o.Msg.VARIABLES_DYNAMIC_HUE="310",o.Msg)})),Z=G((function(t,e){var o;t.exports=((o=K).Blocks.colour={},o.Constants={},o.Constants.Colour={},o.Constants.Colour.HUE=20,o.defineBlocksWithJsonArray([{type:"colour_picker",message0:"%1",args0:[{type:"field_colour",name:"COLOUR",colour:"#ff0000"}],output:"Colour",helpUrl:"%{BKY_COLOUR_PICKER_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_PICKER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"colour_random",message0:"%{BKY_COLOUR_RANDOM_TITLE}",output:"Colour",helpUrl:"%{BKY_COLOUR_RANDOM_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_RANDOM_TOOLTIP}"},{type:"colour_rgb",message0:"%{BKY_COLOUR_RGB_TITLE} %{BKY_COLOUR_RGB_RED} %1 %{BKY_COLOUR_RGB_GREEN} %2 %{BKY_COLOUR_RGB_BLUE} %3",args0:[{type:"input_value",name:"RED",check:"Number",align:"RIGHT"},{type:"input_value",name:"GREEN",check:"Number",align:"RIGHT"},{type:"input_value",name:"BLUE",check:"Number",align:"RIGHT"}],output:"Colour",helpUrl:"%{BKY_COLOUR_RGB_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_RGB_TOOLTIP}"},{type:"colour_blend",message0:"%{BKY_COLOUR_BLEND_TITLE} %{BKY_COLOUR_BLEND_COLOUR1} %1 %{BKY_COLOUR_BLEND_COLOUR2} %2 %{BKY_COLOUR_BLEND_RATIO} %3",args0:[{type:"input_value",name:"COLOUR1",check:"Colour",align:"RIGHT"},{type:"input_value",name:"COLOUR2",check:"Colour",align:"RIGHT"},{type:"input_value",name:"RATIO",check:"Number",align:"RIGHT"}],output:"Colour",helpUrl:"%{BKY_COLOUR_BLEND_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_BLEND_TOOLTIP}"}]),o.Blocks.lists={},o.Constants.Lists={},o.Constants.Lists.HUE=260,o.defineBlocksWithJsonArray([{type:"lists_create_empty",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE}",output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_CREATE_EMPTY_HELPURL}"},{type:"lists_repeat",message0:"%{BKY_LISTS_REPEAT_TITLE}",args0:[{type:"input_value",name:"ITEM"},{type:"input_value",name:"NUM",check:"Number"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_LISTS_REPEAT_HELPURL}"},{type:"lists_reverse",message0:"%{BKY_LISTS_REVERSE_MESSAGE0}",args0:[{type:"input_value",name:"LIST",check:"Array"}],output:"Array",inputsInline:!0,style:"list_blocks",tooltip:"%{BKY_LISTS_REVERSE_TOOLTIP}",helpUrl:"%{BKY_LISTS_REVERSE_HELPURL}"},{type:"lists_isEmpty",message0:"%{BKY_LISTS_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"list_blocks",tooltip:"%{BKY_LISTS_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_ISEMPTY_HELPURL}"},{type:"lists_length",message0:"%{BKY_LISTS_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"list_blocks",tooltip:"%{BKY_LISTS_LENGTH_TOOLTIP}",helpUrl:"%{BKY_LISTS_LENGTH_HELPURL}"}]),o.Blocks.lists_create_with={init:function(){this.setHelpUrl(o.Msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.itemCount_=3,this.updateShape_(),this.setOutput(!0,"Array"),this.setMutator(new o.Mutator(["lists_create_with_item"])),this.setTooltip(o.Msg.LISTS_CREATE_WITH_TOOLTIP)},mutationToDom:function(){var t=o.utils.xml.createElement("mutation");return t.setAttribute("items",this.itemCount_),t},domToMutation:function(t){this.itemCount_=parseInt(t.getAttribute("items"),10),this.updateShape_()},decompose:function(t){var e=t.newBlock("lists_create_with_container");e.initSvg();for(var o=e.getInput("STACK").connection,i=0;i<this.itemCount_;i++){var n=t.newBlock("lists_create_with_item");n.initSvg(),o.connect(n.previousConnection),o=n.nextConnection}return e},compose:function(t){var e=t.getInputTargetBlock("STACK");for(t=[];e&&!e.isInsertionMarker();)t.push(e.valueConnection_),e=e.nextConnection&&e.nextConnection.targetBlock();for(e=0;e<this.itemCount_;e++){var i=this.getInput("ADD"+e).connection.targetConnection;i&&-1==t.indexOf(i)&&i.disconnect()}for(this.itemCount_=t.length,this.updateShape_(),e=0;e<this.itemCount_;e++)o.Mutator.reconnect(t[e],this,"ADD"+e)},saveConnections:function(t){t=t.getInputTargetBlock("STACK");for(var e=0;t;){var o=this.getInput("ADD"+e);t.valueConnection_=o&&o.connection.targetConnection,e++,t=t.nextConnection&&t.nextConnection.targetBlock()}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(o.Msg.LISTS_CREATE_EMPTY_TITLE);for(var t=0;t<this.itemCount_;t++)if(!this.getInput("ADD"+t)){var e=this.appendValueInput("ADD"+t).setAlign(o.ALIGN_RIGHT);0==t&&e.appendField(o.Msg.LISTS_CREATE_WITH_INPUT_WITH)}for(;this.getInput("ADD"+t);)this.removeInput("ADD"+t),t++}},o.Blocks.lists_create_with_container={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(o.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD),this.appendStatementInput("STACK"),this.setTooltip(o.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP),this.contextMenu=!1}},o.Blocks.lists_create_with_item={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(o.Msg.LISTS_CREATE_WITH_ITEM_TITLE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(o.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP),this.contextMenu=!1}},o.Blocks.lists_indexOf={init:function(){var t=[[o.Msg.LISTS_INDEX_OF_FIRST,"FIRST"],[o.Msg.LISTS_INDEX_OF_LAST,"LAST"]];this.setHelpUrl(o.Msg.LISTS_INDEX_OF_HELPURL),this.setStyle("list_blocks"),this.setOutput(!0,"Number"),this.appendValueInput("VALUE").setCheck("Array").appendField(o.Msg.LISTS_INDEX_OF_INPUT_IN_LIST),this.appendValueInput("FIND").appendField(new o.FieldDropdown(t),"END"),this.setInputsInline(!0);var e=this;this.setTooltip((function(){return o.Msg.LISTS_INDEX_OF_TOOLTIP.replace("%1",e.workspace.options.oneBasedIndex?"0":"-1")}))}},o.Blocks.lists_getIndex={init:function(){var t=[[o.Msg.LISTS_GET_INDEX_GET,"GET"],[o.Msg.LISTS_GET_INDEX_GET_REMOVE,"GET_REMOVE"],[o.Msg.LISTS_GET_INDEX_REMOVE,"REMOVE"]];this.WHERE_OPTIONS=[[o.Msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[o.Msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[o.Msg.LISTS_GET_INDEX_FIRST,"FIRST"],[o.Msg.LISTS_GET_INDEX_LAST,"LAST"],[o.Msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(o.Msg.LISTS_GET_INDEX_HELPURL),this.setStyle("list_blocks"),t=new o.FieldDropdown(t,(function(t){t="REMOVE"==t,this.getSourceBlock().updateStatement_(t)})),this.appendValueInput("VALUE").setCheck("Array").appendField(o.Msg.LISTS_GET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(t,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),o.Msg.LISTS_GET_INDEX_TAIL&&this.appendDummyInput("TAIL").appendField(o.Msg.LISTS_GET_INDEX_TAIL),this.setInputsInline(!0),this.setOutput(!0),this.updateAt_(!0);var e=this;this.setTooltip((function(){var t=e.getFieldValue("MODE"),i=e.getFieldValue("WHERE"),n="";switch(t+" "+i){case"GET FROM_START":case"GET FROM_END":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM;break;case"GET FIRST":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST;break;case"GET LAST":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST;break;case"GET RANDOM":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM;break;case"GET_REMOVE FROM_START":case"GET_REMOVE FROM_END":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM;break;case"GET_REMOVE FIRST":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST;break;case"GET_REMOVE LAST":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST;break;case"GET_REMOVE RANDOM":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM;break;case"REMOVE FROM_START":case"REMOVE FROM_END":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM;break;case"REMOVE FIRST":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST;break;case"REMOVE LAST":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST;break;case"REMOVE RANDOM":n=o.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM}return"FROM_START"!=i&&"FROM_END"!=i||(n+="  "+("FROM_START"==i?o.Msg.LISTS_INDEX_FROM_START_TOOLTIP:o.Msg.LISTS_INDEX_FROM_END_TOOLTIP).replace("%1",e.workspace.options.oneBasedIndex?"#1":"#0")),n}))},mutationToDom:function(){var t=o.utils.xml.createElement("mutation");t.setAttribute("statement",!this.outputConnection);var e=this.getInput("AT").type==o.INPUT_VALUE;return t.setAttribute("at",e),t},domToMutation:function(t){var e="true"==t.getAttribute("statement");this.updateStatement_(e),t="false"!=t.getAttribute("at"),this.updateAt_(t)},updateStatement_:function(t){t!=!this.outputConnection&&(this.unplug(!0,!0),t?(this.setOutput(!1),this.setPreviousStatement(!0),this.setNextStatement(!0)):(this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0)))},updateAt_:function(t){this.removeInput("AT"),this.removeInput("ORDINAL",!0),t?(this.appendValueInput("AT").setCheck("Number"),o.Msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(o.Msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");var e=new o.FieldDropdown(this.WHERE_OPTIONS,(function(e){var o="FROM_START"==e||"FROM_END"==e;if(o!=t){var i=this.getSourceBlock();return i.updateAt_(o),i.setFieldValue(e,"WHERE"),null}}));this.getInput("AT").appendField(e,"WHERE"),o.Msg.LISTS_GET_INDEX_TAIL&&this.moveInputBefore("TAIL",null)}},o.Blocks.lists_setIndex={init:function(){var t=[[o.Msg.LISTS_SET_INDEX_SET,"SET"],[o.Msg.LISTS_SET_INDEX_INSERT,"INSERT"]];this.WHERE_OPTIONS=[[o.Msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[o.Msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[o.Msg.LISTS_GET_INDEX_FIRST,"FIRST"],[o.Msg.LISTS_GET_INDEX_LAST,"LAST"],[o.Msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(o.Msg.LISTS_SET_INDEX_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(o.Msg.LISTS_SET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(new o.FieldDropdown(t),"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),this.appendValueInput("TO").appendField(o.Msg.LISTS_SET_INDEX_INPUT_TO),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(o.Msg.LISTS_SET_INDEX_TOOLTIP),this.updateAt_(!0);var e=this;this.setTooltip((function(){var t=e.getFieldValue("MODE"),i=e.getFieldValue("WHERE"),n="";switch(t+" "+i){case"SET FROM_START":case"SET FROM_END":n=o.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM;break;case"SET FIRST":n=o.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST;break;case"SET LAST":n=o.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST;break;case"SET RANDOM":n=o.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM;break;case"INSERT FROM_START":case"INSERT FROM_END":n=o.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM;break;case"INSERT FIRST":n=o.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST;break;case"INSERT LAST":n=o.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST;break;case"INSERT RANDOM":n=o.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM}return"FROM_START"!=i&&"FROM_END"!=i||(n+="  "+o.Msg.LISTS_INDEX_FROM_START_TOOLTIP.replace("%1",e.workspace.options.oneBasedIndex?"#1":"#0")),n}))},mutationToDom:function(){var t=o.utils.xml.createElement("mutation"),e=this.getInput("AT").type==o.INPUT_VALUE;return t.setAttribute("at",e),t},domToMutation:function(t){t="false"!=t.getAttribute("at"),this.updateAt_(t)},updateAt_:function(t){this.removeInput("AT"),this.removeInput("ORDINAL",!0),t?(this.appendValueInput("AT").setCheck("Number"),o.Msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(o.Msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");var e=new o.FieldDropdown(this.WHERE_OPTIONS,(function(e){var o="FROM_START"==e||"FROM_END"==e;if(o!=t){var i=this.getSourceBlock();return i.updateAt_(o),i.setFieldValue(e,"WHERE"),null}}));this.moveInputBefore("AT","TO"),this.getInput("ORDINAL")&&this.moveInputBefore("ORDINAL","TO"),this.getInput("AT").appendField(e,"WHERE")}},o.Blocks.lists_getSublist={init:function(){this.WHERE_OPTIONS_1=[[o.Msg.LISTS_GET_SUBLIST_START_FROM_START,"FROM_START"],[o.Msg.LISTS_GET_SUBLIST_START_FROM_END,"FROM_END"],[o.Msg.LISTS_GET_SUBLIST_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[o.Msg.LISTS_GET_SUBLIST_END_FROM_START,"FROM_START"],[o.Msg.LISTS_GET_SUBLIST_END_FROM_END,"FROM_END"],[o.Msg.LISTS_GET_SUBLIST_END_LAST,"LAST"]],this.setHelpUrl(o.Msg.LISTS_GET_SUBLIST_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(o.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),o.Msg.LISTS_GET_SUBLIST_TAIL&&this.appendDummyInput("TAIL").appendField(o.Msg.LISTS_GET_SUBLIST_TAIL),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(o.Msg.LISTS_GET_SUBLIST_TOOLTIP)},mutationToDom:function(){var t=o.utils.xml.createElement("mutation"),e=this.getInput("AT1").type==o.INPUT_VALUE;return t.setAttribute("at1",e),e=this.getInput("AT2").type==o.INPUT_VALUE,t.setAttribute("at2",e),t},domToMutation:function(t){var e="true"==t.getAttribute("at1");t="true"==t.getAttribute("at2"),this.updateAt_(1,e),this.updateAt_(2,t)},updateAt_:function(t,e){this.removeInput("AT"+t),this.removeInput("ORDINAL"+t,!0),e?(this.appendValueInput("AT"+t).setCheck("Number"),o.Msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+t).appendField(o.Msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+t);var i=new o.FieldDropdown(this["WHERE_OPTIONS_"+t],(function(o){var i="FROM_START"==o||"FROM_END"==o;if(i!=e){var n=this.getSourceBlock();return n.updateAt_(t,i),n.setFieldValue(o,"WHERE"+t),null}}));this.getInput("AT"+t).appendField(i,"WHERE"+t),1==t&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2")),o.Msg.LISTS_GET_SUBLIST_TAIL&&this.moveInputBefore("TAIL",null)}},o.Blocks.lists_sort={init:function(){this.jsonInit({message0:o.Msg.LISTS_SORT_TITLE,args0:[{type:"field_dropdown",name:"TYPE",options:[[o.Msg.LISTS_SORT_TYPE_NUMERIC,"NUMERIC"],[o.Msg.LISTS_SORT_TYPE_TEXT,"TEXT"],[o.Msg.LISTS_SORT_TYPE_IGNORECASE,"IGNORE_CASE"]]},{type:"field_dropdown",name:"DIRECTION",options:[[o.Msg.LISTS_SORT_ORDER_ASCENDING,"1"],[o.Msg.LISTS_SORT_ORDER_DESCENDING,"-1"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Array",style:"list_blocks",tooltip:o.Msg.LISTS_SORT_TOOLTIP,helpUrl:o.Msg.LISTS_SORT_HELPURL})}},o.Blocks.lists_split={init:function(){var t=this,e=new o.FieldDropdown([[o.Msg.LISTS_SPLIT_LIST_FROM_TEXT,"SPLIT"],[o.Msg.LISTS_SPLIT_TEXT_FROM_LIST,"JOIN"]],(function(e){t.updateType_(e)}));this.setHelpUrl(o.Msg.LISTS_SPLIT_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("INPUT").setCheck("String").appendField(e,"MODE"),this.appendValueInput("DELIM").setCheck("String").appendField(o.Msg.LISTS_SPLIT_WITH_DELIMITER),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.setTooltip((function(){var e=t.getFieldValue("MODE");if("SPLIT"==e)return o.Msg.LISTS_SPLIT_TOOLTIP_SPLIT;if("JOIN"==e)return o.Msg.LISTS_SPLIT_TOOLTIP_JOIN;throw Error("Unknown mode: "+e)}))},updateType_:function(t){if(this.getFieldValue("MODE")!=t){var e=this.getInput("INPUT").connection;e.setShadowDom(null);var o=e.targetBlock();o&&(e.disconnect(),o.isShadow()?o.dispose():this.bumpNeighbours())}"SPLIT"==t?(this.outputConnection.setCheck("Array"),this.getInput("INPUT").setCheck("String")):(this.outputConnection.setCheck("String"),this.getInput("INPUT").setCheck("Array"))},mutationToDom:function(){var t=o.utils.xml.createElement("mutation");return t.setAttribute("mode",this.getFieldValue("MODE")),t},domToMutation:function(t){this.updateType_(t.getAttribute("mode"))}},o.Blocks.logic={},o.Constants.Logic={},o.Constants.Logic.HUE=210,o.defineBlocksWithJsonArray([{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[["%{BKY_LOGIC_BOOLEAN_TRUE}","TRUE"],["%{BKY_LOGIC_BOOLEAN_FALSE}","FALSE"]]}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_BOOLEAN_TOOLTIP}",helpUrl:"%{BKY_LOGIC_BOOLEAN_HELPURL}"},{type:"controls_if",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],previousStatement:null,nextStatement:null,style:"logic_blocks",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",mutator:"controls_if_mutator",extensions:["controls_if_tooltip"]},{type:"controls_ifelse",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],message2:"%{BKY_CONTROLS_IF_MSG_ELSE} %1",args2:[{type:"input_statement",name:"ELSE"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",extensions:["controls_if_tooltip"]},{type:"logic_compare",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A"},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["","NEQ"],["<","LT"],["","LTE"],[">","GT"],["","GTE"]]},{type:"input_value",name:"B"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",extensions:["logic_compare","logic_op_tooltip"]},{type:"logic_operation",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[["%{BKY_LOGIC_OPERATION_AND}","AND"],["%{BKY_LOGIC_OPERATION_OR}","OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_OPERATION_HELPURL}",extensions:["logic_op_tooltip"]},{type:"logic_negate",message0:"%{BKY_LOGIC_NEGATE_TITLE}",args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_NEGATE_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NEGATE_HELPURL}"},{type:"logic_null",message0:"%{BKY_LOGIC_NULL}",output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_NULL_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NULL_HELPURL}"},{type:"logic_ternary",message0:"%{BKY_LOGIC_TERNARY_CONDITION} %1",args0:[{type:"input_value",name:"IF",check:"Boolean"}],message1:"%{BKY_LOGIC_TERNARY_IF_TRUE} %1",args1:[{type:"input_value",name:"THEN"}],message2:"%{BKY_LOGIC_TERNARY_IF_FALSE} %1",args2:[{type:"input_value",name:"ELSE"}],output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_TERNARY_TOOLTIP}",helpUrl:"%{BKY_LOGIC_TERNARY_HELPURL}",extensions:["logic_ternary"]}]),o.defineBlocksWithJsonArray([{type:"controls_if_if",message0:"%{BKY_CONTROLS_IF_IF_TITLE_IF}",nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_IF_TOOLTIP}"},{type:"controls_if_elseif",message0:"%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}",previousStatement:null,nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}"},{type:"controls_if_else",message0:"%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}",previousStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSE_TOOLTIP}"}]),o.Constants.Logic.TOOLTIPS_BY_OP={EQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}",NEQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}",LT:"%{BKY_LOGIC_COMPARE_TOOLTIP_LT}",LTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}",GT:"%{BKY_LOGIC_COMPARE_TOOLTIP_GT}",GTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}",AND:"%{BKY_LOGIC_OPERATION_TOOLTIP_AND}",OR:"%{BKY_LOGIC_OPERATION_TOOLTIP_OR}"},o.Extensions.register("logic_op_tooltip",o.Extensions.buildTooltipForDropdown("OP",o.Constants.Logic.TOOLTIPS_BY_OP)),o.Constants.Logic.CONTROLS_IF_MUTATOR_MIXIN={elseifCount_:0,elseCount_:0,suppressPrefixSuffix:!0,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;var t=o.utils.xml.createElement("mutation");return this.elseifCount_&&t.setAttribute("elseif",this.elseifCount_),this.elseCount_&&t.setAttribute("else",1),t},domToMutation:function(t){this.elseifCount_=parseInt(t.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(t.getAttribute("else"),10)||0,this.rebuildShape_()},decompose:function(t){var e=t.newBlock("controls_if_if");e.initSvg();for(var o=e.nextConnection,i=1;i<=this.elseifCount_;i++){var n=t.newBlock("controls_if_elseif");n.initSvg(),o.connect(n.previousConnection),o=n.nextConnection}return this.elseCount_&&((t=t.newBlock("controls_if_else")).initSvg(),o.connect(t.previousConnection)),e},compose:function(t){t=t.nextConnection.targetBlock(),this.elseCount_=this.elseifCount_=0;for(var e=[null],o=[null],i=null;t&&!t.isInsertionMarker();){switch(t.type){case"controls_if_elseif":this.elseifCount_++,e.push(t.valueConnection_),o.push(t.statementConnection_);break;case"controls_if_else":this.elseCount_++,i=t.statementConnection_;break;default:throw TypeError("Unknown block type: "+t.type)}t=t.nextConnection&&t.nextConnection.targetBlock()}this.updateShape_(),this.reconnectChildBlocks_(e,o,i)},saveConnections:function(t){t=t.nextConnection.targetBlock();for(var e=1;t;){switch(t.type){case"controls_if_elseif":var o=this.getInput("IF"+e),i=this.getInput("DO"+e);t.valueConnection_=o&&o.connection.targetConnection,t.statementConnection_=i&&i.connection.targetConnection,e++;break;case"controls_if_else":i=this.getInput("ELSE"),t.statementConnection_=i&&i.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+t.type)}t=t.nextConnection&&t.nextConnection.targetBlock()}},rebuildShape_:function(){var t=[null],e=[null],o=null;this.getInput("ELSE")&&(o=this.getInput("ELSE").connection.targetConnection);for(var i=1;this.getInput("IF"+i);){var n=this.getInput("IF"+i),r=this.getInput("DO"+i);t.push(n.connection.targetConnection),e.push(r.connection.targetConnection),i++}this.updateShape_(),this.reconnectChildBlocks_(t,e,o)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var t=1;this.getInput("IF"+t);)this.removeInput("IF"+t),this.removeInput("DO"+t),t++;for(t=1;t<=this.elseifCount_;t++)this.appendValueInput("IF"+t).setCheck("Boolean").appendField(o.Msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+t).appendField(o.Msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(o.Msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(t,e,i){for(var n=1;n<=this.elseifCount_;n++)o.Mutator.reconnect(t[n],this,"IF"+n),o.Mutator.reconnect(e[n],this,"DO"+n);o.Mutator.reconnect(i,this,"ELSE")}},o.Extensions.registerMutator("controls_if_mutator",o.Constants.Logic.CONTROLS_IF_MUTATOR_MIXIN,null,["controls_if_elseif","controls_if_else"]),o.Constants.Logic.CONTROLS_IF_TOOLTIP_EXTENSION=function(){this.setTooltip(function(){return this.elseifCount_||this.elseCount_?!this.elseifCount_&&this.elseCount_?o.Msg.CONTROLS_IF_TOOLTIP_2:this.elseifCount_&&!this.elseCount_?o.Msg.CONTROLS_IF_TOOLTIP_3:this.elseifCount_&&this.elseCount_?o.Msg.CONTROLS_IF_TOOLTIP_4:"":o.Msg.CONTROLS_IF_TOOLTIP_1}.bind(this))},o.Extensions.register("controls_if_tooltip",o.Constants.Logic.CONTROLS_IF_TOOLTIP_EXTENSION),o.Constants.Logic.LOGIC_COMPARE_ONCHANGE_MIXIN={onchange:function(t){this.prevBlocks_||(this.prevBlocks_=[null,null]);var e=this.getInputTargetBlock("A"),i=this.getInputTargetBlock("B");e&&i&&!this.workspace.connectionChecker.doTypeChecks(e.outputConnection,i.outputConnection)&&(o.Events.setGroup(t.group),(t=this.prevBlocks_[0])!==e&&(e.unplug(),!t||t.isDisposed()||t.isShadow()||this.getInput("A").connection.connect(t.outputConnection)),(e=this.prevBlocks_[1])!==i&&(i.unplug(),!e||e.isDisposed()||e.isShadow()||this.getInput("B").connection.connect(e.outputConnection)),this.bumpNeighbours(),o.Events.setGroup(!1)),this.prevBlocks_[0]=this.getInputTargetBlock("A"),this.prevBlocks_[1]=this.getInputTargetBlock("B")}},o.Constants.Logic.LOGIC_COMPARE_EXTENSION=function(){this.mixin(o.Constants.Logic.LOGIC_COMPARE_ONCHANGE_MIXIN)},o.Extensions.register("logic_compare",o.Constants.Logic.LOGIC_COMPARE_EXTENSION),o.Constants.Logic.LOGIC_TERNARY_ONCHANGE_MIXIN={prevParentConnection_:null,onchange:function(t){var e=this.getInputTargetBlock("THEN"),i=this.getInputTargetBlock("ELSE"),n=this.outputConnection.targetConnection;if((e||i)&&n)for(var r=0;2>r;r++){var s=1==r?e:i;s&&!s.workspace.connectionChecker.doTypeChecks(s.outputConnection,n)&&(o.Events.setGroup(t.group),n===this.prevParentConnection_?(this.unplug(),n.getSourceBlock().bumpNeighbours()):(s.unplug(),s.bumpNeighbours()),o.Events.setGroup(!1))}this.prevParentConnection_=n}},o.Extensions.registerMixin("logic_ternary",o.Constants.Logic.LOGIC_TERNARY_ONCHANGE_MIXIN),o.Blocks.loops={},o.Constants.Loops={},o.Constants.Loops.HUE=120,o.defineBlocksWithJsonArray([{type:"controls_repeat_ext",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"input_value",name:"TIMES",check:"Number"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_repeat",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"field_number",name:"TIMES",value:10,min:0,precision:1}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_whileUntil",message0:"%1 %2",args0:[{type:"field_dropdown",name:"MODE",options:[["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}","WHILE"],["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}","UNTIL"]]},{type:"input_value",name:"BOOL",check:"Boolean"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_WHILEUNTIL_HELPURL}",extensions:["controls_whileUntil_tooltip"]},{type:"controls_for",message0:"%{BKY_CONTROLS_FOR_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"FROM",check:"Number",align:"RIGHT"},{type:"input_value",name:"TO",check:"Number",align:"RIGHT"},{type:"input_value",name:"BY",check:"Number",align:"RIGHT"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],inputsInline:!0,previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOR_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_for_tooltip"]},{type:"controls_forEach",message0:"%{BKY_CONTROLS_FOREACH_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"LIST",check:"Array"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOREACH_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_forEach_tooltip"]},{type:"controls_flow_statements",message0:"%1",args0:[{type:"field_dropdown",name:"FLOW",options:[["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}","BREAK"],["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}","CONTINUE"]]}],previousStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}",extensions:["controls_flow_tooltip","controls_flow_in_loop_check"]}]),o.Constants.Loops.WHILE_UNTIL_TOOLTIPS={WHILE:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}",UNTIL:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}"},o.Extensions.register("controls_whileUntil_tooltip",o.Extensions.buildTooltipForDropdown("MODE",o.Constants.Loops.WHILE_UNTIL_TOOLTIPS)),o.Constants.Loops.BREAK_CONTINUE_TOOLTIPS={BREAK:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}",CONTINUE:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}"},o.Extensions.register("controls_flow_tooltip",o.Extensions.buildTooltipForDropdown("FLOW",o.Constants.Loops.BREAK_CONTINUE_TOOLTIPS)),o.Constants.Loops.CUSTOM_CONTEXT_MENU_CREATE_VARIABLES_GET_MIXIN={customContextMenu:function(t){if(!this.isInFlyout){var e=this.getField("VAR").getVariable(),i=e.name;if(!this.isCollapsed()&&null!=i){var n={enabled:!0};n.text=o.Msg.VARIABLES_SET_CREATE_GET.replace("%1",i),e=o.Variables.generateVariableFieldDom(e),(i=o.utils.xml.createElement("block")).setAttribute("type","variables_get"),i.appendChild(e),n.callback=o.ContextMenu.callbackFactory(this,i),t.push(n)}}}},o.Extensions.registerMixin("contextMenu_newGetVariableBlock",o.Constants.Loops.CUSTOM_CONTEXT_MENU_CREATE_VARIABLES_GET_MIXIN),o.Extensions.register("controls_for_tooltip",o.Extensions.buildTooltipWithFieldText("%{BKY_CONTROLS_FOR_TOOLTIP}","VAR")),o.Extensions.register("controls_forEach_tooltip",o.Extensions.buildTooltipWithFieldText("%{BKY_CONTROLS_FOREACH_TOOLTIP}","VAR")),o.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN={LOOP_TYPES:["controls_repeat","controls_repeat_ext","controls_forEach","controls_for","controls_whileUntil"],suppressPrefixSuffix:!0,getSurroundLoop:function(t){do{if(-1!=o.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.LOOP_TYPES.indexOf(t.type))return t;t=t.getSurroundParent()}while(t);return null},onchange:function(t){if(this.workspace.isDragging&&!this.workspace.isDragging()&&t.type==o.Events.BLOCK_MOVE){var e=o.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(this);if(this.setWarningText(e?null:o.Msg.CONTROLS_FLOW_STATEMENTS_WARNING),!this.isInFlyout){var i=o.Events.getGroup();o.Events.setGroup(t.group),this.setEnabled(e),o.Events.setGroup(i)}}}},o.Extensions.registerMixin("controls_flow_in_loop_check",o.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN),o.Blocks.math={},o.Constants.Math={},o.Constants.Math.HUE=230,o.defineBlocksWithJsonArray([{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_arithmetic",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ADDITION_SYMBOL}","ADD"],["%{BKY_MATH_SUBTRACTION_SYMBOL}","MINUS"],["%{BKY_MATH_MULTIPLICATION_SYMBOL}","MULTIPLY"],["%{BKY_MATH_DIVISION_SYMBOL}","DIVIDE"],["%{BKY_MATH_POWER_SYMBOL}","POWER"]]},{type:"input_value",name:"B",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ARITHMETIC_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_single",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_SINGLE_OP_ROOT}","ROOT"],["%{BKY_MATH_SINGLE_OP_ABSOLUTE}","ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_SINGLE_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_trig",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_TRIG_SIN}","SIN"],["%{BKY_MATH_TRIG_COS}","COS"],["%{BKY_MATH_TRIG_TAN}","TAN"],["%{BKY_MATH_TRIG_ASIN}","ASIN"],["%{BKY_MATH_TRIG_ACOS}","ACOS"],["%{BKY_MATH_TRIG_ATAN}","ATAN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_TRIG_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_constant",message0:"%1",args0:[{type:"field_dropdown",name:"CONSTANT",options:[["","PI"],["e","E"],["","GOLDEN_RATIO"],["sqrt(2)","SQRT2"],["sqrt()","SQRT1_2"],["","INFINITY"]]}],output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTANT_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTANT_HELPURL}"},{type:"math_number_property",message0:"%1 %2",args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[["%{BKY_MATH_IS_EVEN}","EVEN"],["%{BKY_MATH_IS_ODD}","ODD"],["%{BKY_MATH_IS_PRIME}","PRIME"],["%{BKY_MATH_IS_WHOLE}","WHOLE"],["%{BKY_MATH_IS_POSITIVE}","POSITIVE"],["%{BKY_MATH_IS_NEGATIVE}","NEGATIVE"],["%{BKY_MATH_IS_DIVISIBLE_BY}","DIVISIBLE_BY"]]}],inputsInline:!0,output:"Boolean",style:"math_blocks",tooltip:"%{BKY_MATH_IS_TOOLTIP}",mutator:"math_is_divisibleby_mutator"},{type:"math_change",message0:"%{BKY_MATH_CHANGE_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_MATH_CHANGE_TITLE_ITEM}"},{type:"input_value",name:"DELTA",check:"Number"}],previousStatement:null,nextStatement:null,style:"variable_blocks",helpUrl:"%{BKY_MATH_CHANGE_HELPURL}",extensions:["math_change_tooltip"]},{type:"math_round",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ROUND_OPERATOR_ROUND}","ROUND"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}","ROUNDUP"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}","ROUNDDOWN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ROUND_HELPURL}",tooltip:"%{BKY_MATH_ROUND_TOOLTIP}"},{type:"math_on_list",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ONLIST_OPERATOR_SUM}","SUM"],["%{BKY_MATH_ONLIST_OPERATOR_MIN}","MIN"],["%{BKY_MATH_ONLIST_OPERATOR_MAX}","MAX"],["%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}","AVERAGE"],["%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}","MEDIAN"],["%{BKY_MATH_ONLIST_OPERATOR_MODE}","MODE"],["%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}","STD_DEV"],["%{BKY_MATH_ONLIST_OPERATOR_RANDOM}","RANDOM"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ONLIST_HELPURL}",mutator:"math_modes_of_list_mutator",extensions:["math_op_tooltip"]},{type:"math_modulo",message0:"%{BKY_MATH_MODULO_TITLE}",args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_MODULO_TOOLTIP}",helpUrl:"%{BKY_MATH_MODULO_HELPURL}"},{type:"math_constrain",message0:"%{BKY_MATH_CONSTRAIN_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"Number"},{type:"input_value",name:"LOW",check:"Number"},{type:"input_value",name:"HIGH",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTRAIN_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTRAIN_HELPURL}"},{type:"math_random_int",message0:"%{BKY_MATH_RANDOM_INT_TITLE}",args0:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_INT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_INT_HELPURL}"},{type:"math_random_float",message0:"%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}",output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_FLOAT_HELPURL}"},{type:"math_atan2",message0:"%{BKY_MATH_ATAN2_TITLE}",args0:[{type:"input_value",name:"X",check:"Number"},{type:"input_value",name:"Y",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_ATAN2_TOOLTIP}",helpUrl:"%{BKY_MATH_ATAN2_HELPURL}"}]),o.Constants.Math.TOOLTIPS_BY_OP={ADD:"%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}",MINUS:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}",MULTIPLY:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}",DIVIDE:"%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}",POWER:"%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}",ROOT:"%{BKY_MATH_SINGLE_TOOLTIP_ROOT}",ABS:"%{BKY_MATH_SINGLE_TOOLTIP_ABS}",NEG:"%{BKY_MATH_SINGLE_TOOLTIP_NEG}",LN:"%{BKY_MATH_SINGLE_TOOLTIP_LN}",LOG10:"%{BKY_MATH_SINGLE_TOOLTIP_LOG10}",EXP:"%{BKY_MATH_SINGLE_TOOLTIP_EXP}",POW10:"%{BKY_MATH_SINGLE_TOOLTIP_POW10}",SIN:"%{BKY_MATH_TRIG_TOOLTIP_SIN}",COS:"%{BKY_MATH_TRIG_TOOLTIP_COS}",TAN:"%{BKY_MATH_TRIG_TOOLTIP_TAN}",ASIN:"%{BKY_MATH_TRIG_TOOLTIP_ASIN}",ACOS:"%{BKY_MATH_TRIG_TOOLTIP_ACOS}",ATAN:"%{BKY_MATH_TRIG_TOOLTIP_ATAN}",SUM:"%{BKY_MATH_ONLIST_TOOLTIP_SUM}",MIN:"%{BKY_MATH_ONLIST_TOOLTIP_MIN}",MAX:"%{BKY_MATH_ONLIST_TOOLTIP_MAX}",AVERAGE:"%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}",MEDIAN:"%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}",MODE:"%{BKY_MATH_ONLIST_TOOLTIP_MODE}",STD_DEV:"%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}",RANDOM:"%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}"},o.Extensions.register("math_op_tooltip",o.Extensions.buildTooltipForDropdown("OP",o.Constants.Math.TOOLTIPS_BY_OP)),o.Constants.Math.IS_DIVISIBLEBY_MUTATOR_MIXIN={mutationToDom:function(){var t=o.utils.xml.createElement("mutation"),e="DIVISIBLE_BY"==this.getFieldValue("PROPERTY");return t.setAttribute("divisor_input",e),t},domToMutation:function(t){t="true"==t.getAttribute("divisor_input"),this.updateShape_(t)},updateShape_:function(t){var e=this.getInput("DIVISOR");t?e||this.appendValueInput("DIVISOR").setCheck("Number"):e&&this.removeInput("DIVISOR")}},o.Constants.Math.IS_DIVISIBLE_MUTATOR_EXTENSION=function(){this.getField("PROPERTY").setValidator((function(t){t="DIVISIBLE_BY"==t,this.getSourceBlock().updateShape_(t)}))},o.Extensions.registerMutator("math_is_divisibleby_mutator",o.Constants.Math.IS_DIVISIBLEBY_MUTATOR_MIXIN,o.Constants.Math.IS_DIVISIBLE_MUTATOR_EXTENSION),o.Extensions.register("math_change_tooltip",o.Extensions.buildTooltipWithFieldText("%{BKY_MATH_CHANGE_TOOLTIP}","VAR")),o.Constants.Math.LIST_MODES_MUTATOR_MIXIN={updateType_:function(t){"MODE"==t?this.outputConnection.setCheck("Array"):this.outputConnection.setCheck("Number")},mutationToDom:function(){var t=o.utils.xml.createElement("mutation");return t.setAttribute("op",this.getFieldValue("OP")),t},domToMutation:function(t){this.updateType_(t.getAttribute("op"))}},o.Constants.Math.LIST_MODES_MUTATOR_EXTENSION=function(){this.getField("OP").setValidator(function(t){this.updateType_(t)}.bind(this))},o.Extensions.registerMutator("math_modes_of_list_mutator",o.Constants.Math.LIST_MODES_MUTATOR_MIXIN,o.Constants.Math.LIST_MODES_MUTATOR_EXTENSION),o.Blocks.procedures={},o.Blocks.procedures_defnoreturn={init:function(){var t=o.Procedures.findLegalName("",this);(t=new o.FieldTextInput(t,o.Procedures.rename)).setSpellcheck(!1),this.appendDummyInput().appendField(o.Msg.PROCEDURES_DEFNORETURN_TITLE).appendField(t,"NAME").appendField("","PARAMS"),this.setMutator(new o.Mutator(["procedures_mutatorarg"])),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&o.Msg.PROCEDURES_DEFNORETURN_COMMENT&&this.setCommentText(o.Msg.PROCEDURES_DEFNORETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(o.Msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(o.Msg.PROCEDURES_DEFNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},setStatements_:function(t){this.hasStatements_!==t&&(t?(this.appendStatementInput("STACK").appendField(o.Msg.PROCEDURES_DEFNORETURN_DO),this.getInput("RETURN")&&this.moveInputBefore("STACK","RETURN")):this.removeInput("STACK",!0),this.hasStatements_=t)},updateParams_:function(){var t="";this.arguments_.length&&(t=o.Msg.PROCEDURES_BEFORE_PARAMS+" "+this.arguments_.join(", ")),o.Events.disable();try{this.setFieldValue(t,"PARAMS")}finally{o.Events.enable()}},mutationToDom:function(t){var e=o.utils.xml.createElement("mutation");t&&e.setAttribute("name",this.getFieldValue("NAME"));for(var i=0;i<this.argumentVarModels_.length;i++){var n=o.utils.xml.createElement("arg"),r=this.argumentVarModels_[i];n.setAttribute("name",r.name),n.setAttribute("varid",r.getId()),t&&this.paramIds_&&n.setAttribute("paramId",this.paramIds_[i]),e.appendChild(n)}return this.hasStatements_||e.setAttribute("statements","false"),e},domToMutation:function(t){this.arguments_=[],this.argumentVarModels_=[];for(var e,i=0;e=t.childNodes[i];i++)if("arg"==e.nodeName.toLowerCase()){var n=e.getAttribute("name");e=e.getAttribute("varid")||e.getAttribute("varId"),this.arguments_.push(n),null!=(e=o.Variables.getOrCreateVariablePackage(this.workspace,e,n,""))?this.argumentVarModels_.push(e):console.log("Failed to create a variable with name "+n+", ignoring.")}this.updateParams_(),o.Procedures.mutateCallers(this),this.setStatements_("false"!==t.getAttribute("statements"))},decompose:function(t){var e=o.utils.xml.createElement("block");e.setAttribute("type","procedures_mutatorcontainer");var i=o.utils.xml.createElement("statement");i.setAttribute("name","STACK"),e.appendChild(i);for(var n=0;n<this.arguments_.length;n++){var r=o.utils.xml.createElement("block");r.setAttribute("type","procedures_mutatorarg");var s=o.utils.xml.createElement("field");s.setAttribute("name","NAME");var a=o.utils.xml.createTextNode(this.arguments_[n]);s.appendChild(a),r.appendChild(s),s=o.utils.xml.createElement("next"),r.appendChild(s),i.appendChild(r),i=s}return t=o.Xml.domToBlock(e,t),"procedures_defreturn"==this.type?t.setFieldValue(this.hasStatements_,"STATEMENTS"):t.removeInput("STATEMENT_INPUT"),o.Procedures.mutateCallers(this),t},compose:function(t){this.arguments_=[],this.paramIds_=[],this.argumentVarModels_=[];for(var e=t.getInputTargetBlock("STACK");e&&!e.isInsertionMarker();){var i=e.getFieldValue("NAME");this.arguments_.push(i),i=this.workspace.getVariable(i,""),this.argumentVarModels_.push(i),this.paramIds_.push(e.id),e=e.nextConnection&&e.nextConnection.targetBlock()}this.updateParams_(),o.Procedures.mutateCallers(this),null!==(t=t.getFieldValue("STATEMENTS"))&&(t="TRUE"==t,this.hasStatements_!=t)&&(t?(this.setStatements_(!0),o.Mutator.reconnect(this.statementConnection_,this,"STACK"),this.statementConnection_=null):(t=this.getInput("STACK").connection,(this.statementConnection_=t.targetConnection)&&((t=t.targetBlock()).unplug(),t.bumpNeighbours()),this.setStatements_(!1)))},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!1]},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},renameVarById:function(t,e){var i=this.workspace.getVariableById(t);if(""==i.type){i=i.name,e=this.workspace.getVariableById(e);for(var n=!1,r=0;r<this.argumentVarModels_.length;r++)this.argumentVarModels_[r].getId()==t&&(this.arguments_[r]=e.name,this.argumentVarModels_[r]=e,n=!0);n&&(this.displayRenamedVar_(i,e.name),o.Procedures.mutateCallers(this))}},updateVarName:function(t){for(var e=t.name,i=!1,n=0;n<this.argumentVarModels_.length;n++)if(this.argumentVarModels_[n].getId()==t.getId()){var r=this.arguments_[n];this.arguments_[n]=e,i=!0}i&&(this.displayRenamedVar_(r,e),o.Procedures.mutateCallers(this))},displayRenamedVar_:function(t,e){if(this.updateParams_(),this.mutator&&this.mutator.isVisible())for(var i,n=this.mutator.workspace_.getAllBlocks(!1),r=0;i=n[r];r++)"procedures_mutatorarg"==i.type&&o.Names.equals(t,i.getFieldValue("NAME"))&&i.setFieldValue(e,"NAME")},customContextMenu:function(t){if(!this.isInFlyout){var e={enabled:!0},i=this.getFieldValue("NAME");e.text=o.Msg.PROCEDURES_CREATE_DO.replace("%1",i);var n=o.utils.xml.createElement("mutation");for(n.setAttribute("name",i),i=0;i<this.arguments_.length;i++){var r=o.utils.xml.createElement("arg");r.setAttribute("name",this.arguments_[i]),n.appendChild(r)}if((i=o.utils.xml.createElement("block")).setAttribute("type",this.callType_),i.appendChild(n),e.callback=o.ContextMenu.callbackFactory(this,i),t.push(e),!this.isCollapsed())for(i=0;i<this.argumentVarModels_.length;i++)e={enabled:!0},n=this.argumentVarModels_[i],e.text=o.Msg.VARIABLES_SET_CREATE_GET.replace("%1",n.name),n=o.Variables.generateVariableFieldDom(n),(r=o.utils.xml.createElement("block")).setAttribute("type","variables_get"),r.appendChild(n),e.callback=o.ContextMenu.callbackFactory(this,r),t.push(e)}},callType_:"procedures_callnoreturn"},o.Blocks.procedures_defreturn={init:function(){var t=o.Procedures.findLegalName("",this);(t=new o.FieldTextInput(t,o.Procedures.rename)).setSpellcheck(!1),this.appendDummyInput().appendField(o.Msg.PROCEDURES_DEFRETURN_TITLE).appendField(t,"NAME").appendField("","PARAMS"),this.appendValueInput("RETURN").setAlign(o.ALIGN_RIGHT).appendField(o.Msg.PROCEDURES_DEFRETURN_RETURN),this.setMutator(new o.Mutator(["procedures_mutatorarg"])),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&o.Msg.PROCEDURES_DEFRETURN_COMMENT&&this.setCommentText(o.Msg.PROCEDURES_DEFRETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(o.Msg.PROCEDURES_DEFRETURN_TOOLTIP),this.setHelpUrl(o.Msg.PROCEDURES_DEFRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},setStatements_:o.Blocks.procedures_defnoreturn.setStatements_,updateParams_:o.Blocks.procedures_defnoreturn.updateParams_,mutationToDom:o.Blocks.procedures_defnoreturn.mutationToDom,domToMutation:o.Blocks.procedures_defnoreturn.domToMutation,decompose:o.Blocks.procedures_defnoreturn.decompose,compose:o.Blocks.procedures_defnoreturn.compose,getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!0]},getVars:o.Blocks.procedures_defnoreturn.getVars,getVarModels:o.Blocks.procedures_defnoreturn.getVarModels,renameVarById:o.Blocks.procedures_defnoreturn.renameVarById,updateVarName:o.Blocks.procedures_defnoreturn.updateVarName,displayRenamedVar_:o.Blocks.procedures_defnoreturn.displayRenamedVar_,customContextMenu:o.Blocks.procedures_defnoreturn.customContextMenu,callType_:"procedures_callreturn"},o.Blocks.procedures_mutatorcontainer={init:function(){this.appendDummyInput().appendField(o.Msg.PROCEDURES_MUTATORCONTAINER_TITLE),this.appendStatementInput("STACK"),this.appendDummyInput("STATEMENT_INPUT").appendField(o.Msg.PROCEDURES_ALLOW_STATEMENTS).appendField(new o.FieldCheckbox("TRUE"),"STATEMENTS"),this.setStyle("procedure_blocks"),this.setTooltip(o.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP),this.contextMenu=!1}},o.Blocks.procedures_mutatorarg={init:function(){var t=new o.FieldTextInput(o.Procedures.DEFAULT_ARG,this.validator_);t.oldShowEditorFn_=t.showEditor_,t.showEditor_=function(){this.createdVariables_=[],this.oldShowEditorFn_()},this.appendDummyInput().appendField(o.Msg.PROCEDURES_MUTATORARG_TITLE).appendField(t,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(o.Msg.PROCEDURES_MUTATORARG_TOOLTIP),this.contextMenu=!1,t.onFinishEditing_=this.deleteIntermediateVars_,t.createdVariables_=[],t.onFinishEditing_("x")},validator_:function(t){var e=this.getSourceBlock(),i=o.Mutator.findParentWs(e.workspace);if(!(t=t.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,"")))return null;for(var n=(e.workspace.targetWorkspace||e.workspace).getAllBlocks(!1),r=t.toLowerCase(),s=0;s<n.length;s++)if(n[s].id!=this.getSourceBlock().id){var a=n[s].getFieldValue("NAME");if(a&&a.toLowerCase()==r)return null}return e.isInFlyout||((e=i.getVariable(t,""))&&e.name!=t&&i.renameVariableById(e.getId(),t),e||(e=i.createVariable(t,""))&&this.createdVariables_&&this.createdVariables_.push(e)),t},deleteIntermediateVars_:function(t){var e=o.Mutator.findParentWs(this.getSourceBlock().workspace);if(e)for(var i=0;i<this.createdVariables_.length;i++){var n=this.createdVariables_[i];n.name!=t&&e.deleteVariableById(n.getId())}}},o.Blocks.procedures_callnoreturn={init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(o.Msg.PROCEDURES_CALLNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null,this.previousEnabledState_=!0},getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(t,e){o.Names.equals(t,this.getProcedureCall())&&(this.setFieldValue(e,"NAME"),this.setTooltip((this.outputConnection?o.Msg.PROCEDURES_CALLRETURN_TOOLTIP:o.Msg.PROCEDURES_CALLNORETURN_TOOLTIP).replace("%1",e)))},setProcedureParameters_:function(t,e){var i=o.Procedures.getDefinition(this.getProcedureCall(),this.workspace),n=i&&i.mutator&&i.mutator.isVisible();if(n||(this.quarkConnections_={},this.quarkIds_=null),e)if(t.join("\n")==this.arguments_.join("\n"))this.quarkIds_=e;else{if(e.length!=t.length)throw RangeError("paramNames and paramIds must be the same length.");this.setCollapsed(!1),this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]),i=this.rendered,this.rendered=!1;for(var r=0;r<this.arguments_.length;r++){var s=this.getInput("ARG"+r);s&&(s=s.connection.targetConnection,this.quarkConnections_[this.quarkIds_[r]]=s,n&&s&&-1==e.indexOf(this.quarkIds_[r])&&(s.disconnect(),s.getSourceBlock().bumpNeighbours()))}for(this.arguments_=[].concat(t),this.argumentVarModels_=[],r=0;r<this.arguments_.length;r++)t=o.Variables.getOrCreateVariablePackage(this.workspace,null,this.arguments_[r],""),this.argumentVarModels_.push(t);if(this.updateShape_(),this.quarkIds_=e)for(r=0;r<this.arguments_.length;r++)(e=this.quarkIds_[r])in this.quarkConnections_&&(s=this.quarkConnections_[e],o.Mutator.reconnect(s,this,"ARG"+r)||delete this.quarkConnections_[e]);(this.rendered=i)&&this.render()}},updateShape_:function(){for(var t=0;t<this.arguments_.length;t++){var e=this.getField("ARGNAME"+t);if(e){o.Events.disable();try{e.setValue(this.arguments_[t])}finally{o.Events.enable()}}else e=new o.FieldLabel(this.arguments_[t]),this.appendValueInput("ARG"+t).setAlign(o.ALIGN_RIGHT).appendField(e,"ARGNAME"+t).init()}for(;this.getInput("ARG"+t);)this.removeInput("ARG"+t),t++;(t=this.getInput("TOPROW"))&&(this.arguments_.length?this.getField("WITH")||(t.appendField(o.Msg.PROCEDURES_CALL_BEFORE_PARAMS,"WITH"),t.init()):this.getField("WITH")&&t.removeField("WITH"))},mutationToDom:function(){var t=o.utils.xml.createElement("mutation");t.setAttribute("name",this.getProcedureCall());for(var e=0;e<this.arguments_.length;e++){var i=o.utils.xml.createElement("arg");i.setAttribute("name",this.arguments_[e]),t.appendChild(i)}return t},domToMutation:function(t){var e=t.getAttribute("name");this.renameProcedure(this.getProcedureCall(),e),e=[];for(var o,i=[],n=0;o=t.childNodes[n];n++)"arg"==o.nodeName.toLowerCase()&&(e.push(o.getAttribute("name")),i.push(o.getAttribute("paramId")));this.setProcedureParameters_(e,i)},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},onchange:function(t){if(this.workspace&&!this.workspace.isFlyout&&t.recordUndo)if(t.type==o.Events.BLOCK_CREATE&&-1!=t.ids.indexOf(this.id)){var e=this.getProcedureCall();if(!(e=o.Procedures.getDefinition(e,this.workspace))||e.type==this.defType_&&JSON.stringify(e.getVars())==JSON.stringify(this.arguments_)||(e=null),!e){o.Events.setGroup(t.group),t=o.utils.xml.createElement("xml"),(e=o.utils.xml.createElement("block")).setAttribute("type",this.defType_);var i=this.getRelativeToSurfaceXY(),n=i.y+2*o.SNAP_RADIUS;e.setAttribute("x",i.x+o.SNAP_RADIUS*(this.RTL?-1:1)),e.setAttribute("y",n),i=this.mutationToDom(),e.appendChild(i),(i=o.utils.xml.createElement("field")).setAttribute("name","NAME"),(n=this.getProcedureCall())||(n=o.Procedures.findLegalName("",this),this.renameProcedure("",n)),i.appendChild(o.utils.xml.createTextNode(n)),e.appendChild(i),t.appendChild(e),o.Xml.domToWorkspace(t,this.workspace),o.Events.setGroup(!1)}}else t.type==o.Events.BLOCK_DELETE?(e=this.getProcedureCall(),(e=o.Procedures.getDefinition(e,this.workspace))||(o.Events.setGroup(t.group),this.dispose(!0),o.Events.setGroup(!1))):t.type==o.Events.CHANGE&&"disabled"==t.element&&(e=this.getProcedureCall(),(e=o.Procedures.getDefinition(e,this.workspace))&&e.id==t.blockId&&((e=o.Events.getGroup())&&console.log("Saw an existing group while responding to a definition change"),o.Events.setGroup(t.group),t.newValue?(this.previousEnabledState_=this.isEnabled(),this.setEnabled(!1)):this.setEnabled(this.previousEnabledState_),o.Events.setGroup(e)))},customContextMenu:function(t){if(this.workspace.isMovable()){var e={enabled:!0};e.text=o.Msg.PROCEDURES_HIGHLIGHT_DEF;var i=this.getProcedureCall(),n=this.workspace;e.callback=function(){var t=o.Procedures.getDefinition(i,n);t&&(n.centerOnBlock(t.id),t.select())},t.push(e)}},defType_:"procedures_defnoreturn"},o.Blocks.procedures_callreturn={init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setOutput(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(o.Msg.PROCEDURES_CALLRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null,this.previousEnabledState_=!0},getProcedureCall:o.Blocks.procedures_callnoreturn.getProcedureCall,renameProcedure:o.Blocks.procedures_callnoreturn.renameProcedure,setProcedureParameters_:o.Blocks.procedures_callnoreturn.setProcedureParameters_,updateShape_:o.Blocks.procedures_callnoreturn.updateShape_,mutationToDom:o.Blocks.procedures_callnoreturn.mutationToDom,domToMutation:o.Blocks.procedures_callnoreturn.domToMutation,getVars:o.Blocks.procedures_callnoreturn.getVars,getVarModels:o.Blocks.procedures_callnoreturn.getVarModels,onchange:o.Blocks.procedures_callnoreturn.onchange,customContextMenu:o.Blocks.procedures_callnoreturn.customContextMenu,defType_:"procedures_defreturn"},o.Blocks.procedures_ifreturn={init:function(){this.appendValueInput("CONDITION").setCheck("Boolean").appendField(o.Msg.CONTROLS_IF_MSG_IF),this.appendValueInput("VALUE").appendField(o.Msg.PROCEDURES_DEFRETURN_RETURN),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(o.Msg.PROCEDURES_IFRETURN_TOOLTIP),this.setHelpUrl(o.Msg.PROCEDURES_IFRETURN_HELPURL),this.hasReturnValue_=!0},mutationToDom:function(){var t=o.utils.xml.createElement("mutation");return t.setAttribute("value",Number(this.hasReturnValue_)),t},domToMutation:function(t){this.hasReturnValue_=1==t.getAttribute("value"),this.hasReturnValue_||(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(o.Msg.PROCEDURES_DEFRETURN_RETURN))},onchange:function(t){if(this.workspace.isDragging&&!this.workspace.isDragging()){t=!1;var e=this;do{if(-1!=this.FUNCTION_TYPES.indexOf(e.type)){t=!0;break}e=e.getSurroundParent()}while(e);t?("procedures_defnoreturn"==e.type&&this.hasReturnValue_?(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(o.Msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!1):"procedures_defreturn"!=e.type||this.hasReturnValue_||(this.removeInput("VALUE"),this.appendValueInput("VALUE").appendField(o.Msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!0),this.setWarningText(null),this.isInFlyout||this.setEnabled(!0)):(this.setWarningText(o.Msg.PROCEDURES_IFRETURN_WARNING),this.isInFlyout||this.getInheritedDisabled()||this.setEnabled(!1))}},FUNCTION_TYPES:["procedures_defnoreturn","procedures_defreturn"]},o.Blocks.texts={},o.Constants.Text={},o.Constants.Text.HUE=160,o.defineBlocksWithJsonArray([{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"text_multiline",message0:"%1 %2",args0:[{type:"field_image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAARCAYAAADpPU2iAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAdhgAAHYYBXaITgQAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMS42/U4J6AAAAP1JREFUOE+Vks0KQUEYhjmRIja4ABtZ2dm5A3t3Ia6AUm7CylYuQRaUhZSlLZJiQbFAyRnPN33y01HOW08z8873zpwzM4F3GWOCruvGIE4/rLaV+Nq1hVGMBqzhqlxgCys4wJA65xnogMHsQ5lujnYHTejBBCK2mE4abjCgMGhNxHgDFWjDSG07kdfVa2pZMf4ZyMAdWmpZMfYOsLiDMYMjlMB+K613QISRhTnITnsYg5yUd0DETmEoMlkFOeIT/A58iyK5E18BuTBfgYXfwNJv4P9/oEBerLylOnRhygmGdPpTTBZAPkde61lbQe4moWUvYUZYLfUNftIY4zwA5X2Z9AYnQrEAAAAASUVORK5CYII=",width:12,height:17,alt:""},{type:"field_multilinetext",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"text_join",message0:"",output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"text_join_mutator"},{type:"text_create_join_container",message0:"%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_TOOLTIP}",enableContextMenu:!1},{type:"text_create_join_item",message0:"%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}",previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}",enableContextMenu:!1},{type:"text_append",message0:"%{BKY_TEXT_APPEND_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_TEXT_APPEND_VARIABLE}"},{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",extensions:["text_append_tooltip"]},{type:"text_length",message0:"%{BKY_TEXT_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"text_blocks",tooltip:"%{BKY_TEXT_LENGTH_TOOLTIP}",helpUrl:"%{BKY_TEXT_LENGTH_HELPURL}"},{type:"text_isEmpty",message0:"%{BKY_TEXT_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"text_blocks",tooltip:"%{BKY_TEXT_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_TEXT_ISEMPTY_HELPURL}"},{type:"text_indexOf",message0:"%{BKY_TEXT_INDEXOF_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"END",options:[["%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}","FIRST"],["%{BKY_TEXT_INDEXOF_OPERATOR_LAST}","LAST"]]},{type:"input_value",name:"FIND",check:"String"}],output:"Number",style:"text_blocks",helpUrl:"%{BKY_TEXT_INDEXOF_HELPURL}",inputsInline:!0,extensions:["text_indexOf_tooltip"]},{type:"text_charAt",message0:"%{BKY_TEXT_CHARAT_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"WHERE",options:[["%{BKY_TEXT_CHARAT_FROM_START}","FROM_START"],["%{BKY_TEXT_CHARAT_FROM_END}","FROM_END"],["%{BKY_TEXT_CHARAT_FIRST}","FIRST"],["%{BKY_TEXT_CHARAT_LAST}","LAST"],["%{BKY_TEXT_CHARAT_RANDOM}","RANDOM"]]}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_CHARAT_HELPURL}",inputsInline:!0,mutator:"text_charAt_mutator"}]),o.Blocks.text_getSubstring={init:function(){this.WHERE_OPTIONS_1=[[o.Msg.TEXT_GET_SUBSTRING_START_FROM_START,"FROM_START"],[o.Msg.TEXT_GET_SUBSTRING_START_FROM_END,"FROM_END"],[o.Msg.TEXT_GET_SUBSTRING_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[o.Msg.TEXT_GET_SUBSTRING_END_FROM_START,"FROM_START"],[o.Msg.TEXT_GET_SUBSTRING_END_FROM_END,"FROM_END"],[o.Msg.TEXT_GET_SUBSTRING_END_LAST,"LAST"]],this.setHelpUrl(o.Msg.TEXT_GET_SUBSTRING_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("STRING").setCheck("String").appendField(o.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),o.Msg.TEXT_GET_SUBSTRING_TAIL&&this.appendDummyInput("TAIL").appendField(o.Msg.TEXT_GET_SUBSTRING_TAIL),this.setInputsInline(!0),this.setOutput(!0,"String"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(o.Msg.TEXT_GET_SUBSTRING_TOOLTIP)},mutationToDom:function(){var t=o.utils.xml.createElement("mutation"),e=this.getInput("AT1").type==o.INPUT_VALUE;return t.setAttribute("at1",e),e=this.getInput("AT2").type==o.INPUT_VALUE,t.setAttribute("at2",e),t},domToMutation:function(t){var e="true"==t.getAttribute("at1");t="true"==t.getAttribute("at2"),this.updateAt_(1,e),this.updateAt_(2,t)},updateAt_:function(t,e){this.removeInput("AT"+t),this.removeInput("ORDINAL"+t,!0),e?(this.appendValueInput("AT"+t).setCheck("Number"),o.Msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+t).appendField(o.Msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+t),2==t&&o.Msg.TEXT_GET_SUBSTRING_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(o.Msg.TEXT_GET_SUBSTRING_TAIL));var i=new o.FieldDropdown(this["WHERE_OPTIONS_"+t],(function(o){var i="FROM_START"==o||"FROM_END"==o;if(i!=e){var n=this.getSourceBlock();return n.updateAt_(t,i),n.setFieldValue(o,"WHERE"+t),null}}));this.getInput("AT"+t).appendField(i,"WHERE"+t),1==t&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2"))}},o.Blocks.text_changeCase={init:function(){var t=[[o.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE,"UPPERCASE"],[o.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE,"LOWERCASE"],[o.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE,"TITLECASE"]];this.setHelpUrl(o.Msg.TEXT_CHANGECASE_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(new o.FieldDropdown(t),"CASE"),this.setOutput(!0,"String"),this.setTooltip(o.Msg.TEXT_CHANGECASE_TOOLTIP)}},o.Blocks.text_trim={init:function(){var t=[[o.Msg.TEXT_TRIM_OPERATOR_BOTH,"BOTH"],[o.Msg.TEXT_TRIM_OPERATOR_LEFT,"LEFT"],[o.Msg.TEXT_TRIM_OPERATOR_RIGHT,"RIGHT"]];this.setHelpUrl(o.Msg.TEXT_TRIM_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(new o.FieldDropdown(t),"MODE"),this.setOutput(!0,"String"),this.setTooltip(o.Msg.TEXT_TRIM_TOOLTIP)}},o.Blocks.text_print={init:function(){this.jsonInit({message0:o.Msg.TEXT_PRINT_TITLE,args0:[{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:o.Msg.TEXT_PRINT_TOOLTIP,helpUrl:o.Msg.TEXT_PRINT_HELPURL})}},o.Blocks.text_prompt_ext={init:function(){var t=[[o.Msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[o.Msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(o.Msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks");var e=this;t=new o.FieldDropdown(t,(function(t){e.updateType_(t)})),this.appendValueInput("TEXT").appendField(t,"TYPE"),this.setOutput(!0,"String"),this.setTooltip((function(){return"TEXT"==e.getFieldValue("TYPE")?o.Msg.TEXT_PROMPT_TOOLTIP_TEXT:o.Msg.TEXT_PROMPT_TOOLTIP_NUMBER}))},updateType_:function(t){this.outputConnection.setCheck("NUMBER"==t?"Number":"String")},mutationToDom:function(){var t=o.utils.xml.createElement("mutation");return t.setAttribute("type",this.getFieldValue("TYPE")),t},domToMutation:function(t){this.updateType_(t.getAttribute("type"))}},o.Blocks.text_prompt={init:function(){this.mixin(o.Constants.Text.QUOTE_IMAGE_MIXIN);var t=[[o.Msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[o.Msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]],e=this;this.setHelpUrl(o.Msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),t=new o.FieldDropdown(t,(function(t){e.updateType_(t)})),this.appendDummyInput().appendField(t,"TYPE").appendField(this.newQuote_(!0)).appendField(new o.FieldTextInput(""),"TEXT").appendField(this.newQuote_(!1)),this.setOutput(!0,"String"),this.setTooltip((function(){return"TEXT"==e.getFieldValue("TYPE")?o.Msg.TEXT_PROMPT_TOOLTIP_TEXT:o.Msg.TEXT_PROMPT_TOOLTIP_NUMBER}))},updateType_:o.Blocks.text_prompt_ext.updateType_,mutationToDom:o.Blocks.text_prompt_ext.mutationToDom,domToMutation:o.Blocks.text_prompt_ext.domToMutation},o.Blocks.text_count={init:function(){this.jsonInit({message0:o.Msg.TEXT_COUNT_MESSAGE0,args0:[{type:"input_value",name:"SUB",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"Number",inputsInline:!0,style:"text_blocks",tooltip:o.Msg.TEXT_COUNT_TOOLTIP,helpUrl:o.Msg.TEXT_COUNT_HELPURL})}},o.Blocks.text_replace={init:function(){this.jsonInit({message0:o.Msg.TEXT_REPLACE_MESSAGE0,args0:[{type:"input_value",name:"FROM",check:"String"},{type:"input_value",name:"TO",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:o.Msg.TEXT_REPLACE_TOOLTIP,helpUrl:o.Msg.TEXT_REPLACE_HELPURL})}},o.Blocks.text_reverse={init:function(){this.jsonInit({message0:o.Msg.TEXT_REVERSE_MESSAGE0,args0:[{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:o.Msg.TEXT_REVERSE_TOOLTIP,helpUrl:o.Msg.TEXT_REVERSE_HELPURL})}},o.Constants.Text.QUOTE_IMAGE_MIXIN={QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:12,QUOTE_IMAGE_HEIGHT:12,quoteField_:function(t){for(var e,o=0;e=this.inputList[o];o++)for(var i,n=0;i=e.fieldRow[n];n++)if(t==i.name)return e.insertFieldAt(n,this.newQuote_(!0)),void e.insertFieldAt(n+2,this.newQuote_(!1));console.warn('field named "'+t+'" not found in '+this.toDevString())},newQuote_:function(t){return t=this.RTL?!t:t,new o.FieldImage(t?this.QUOTE_IMAGE_LEFT_DATAURI:this.QUOTE_IMAGE_RIGHT_DATAURI,this.QUOTE_IMAGE_WIDTH,this.QUOTE_IMAGE_HEIGHT,t?"":"")}},o.Constants.Text.TEXT_QUOTES_EXTENSION=function(){this.mixin(o.Constants.Text.QUOTE_IMAGE_MIXIN),this.quoteField_("TEXT")},o.Constants.Text.TEXT_JOIN_MUTATOR_MIXIN={mutationToDom:function(){var t=o.utils.xml.createElement("mutation");return t.setAttribute("items",this.itemCount_),t},domToMutation:function(t){this.itemCount_=parseInt(t.getAttribute("items"),10),this.updateShape_()},decompose:function(t){var e=t.newBlock("text_create_join_container");e.initSvg();for(var o=e.getInput("STACK").connection,i=0;i<this.itemCount_;i++){var n=t.newBlock("text_create_join_item");n.initSvg(),o.connect(n.previousConnection),o=n.nextConnection}return e},compose:function(t){var e=t.getInputTargetBlock("STACK");for(t=[];e&&!e.isInsertionMarker();)t.push(e.valueConnection_),e=e.nextConnection&&e.nextConnection.targetBlock();for(e=0;e<this.itemCount_;e++){var i=this.getInput("ADD"+e).connection.targetConnection;i&&-1==t.indexOf(i)&&i.disconnect()}for(this.itemCount_=t.length,this.updateShape_(),e=0;e<this.itemCount_;e++)o.Mutator.reconnect(t[e],this,"ADD"+e)},saveConnections:function(t){t=t.getInputTargetBlock("STACK");for(var e=0;t;){var o=this.getInput("ADD"+e);t.valueConnection_=o&&o.connection.targetConnection,e++,t=t.nextConnection&&t.nextConnection.targetBlock()}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1));for(var t=0;t<this.itemCount_;t++)if(!this.getInput("ADD"+t)){var e=this.appendValueInput("ADD"+t).setAlign(o.ALIGN_RIGHT);0==t&&e.appendField(o.Msg.TEXT_JOIN_TITLE_CREATEWITH)}for(;this.getInput("ADD"+t);)this.removeInput("ADD"+t),t++}},o.Constants.Text.TEXT_JOIN_EXTENSION=function(){this.mixin(o.Constants.Text.QUOTE_IMAGE_MIXIN),this.itemCount_=2,this.updateShape_(),this.setMutator(new o.Mutator(["text_create_join_item"]))},o.Extensions.register("text_append_tooltip",o.Extensions.buildTooltipWithFieldText("%{BKY_TEXT_APPEND_TOOLTIP}","VAR")),o.Constants.Text.TEXT_INDEXOF_TOOLTIP_EXTENSION=function(){var t=this;this.setTooltip((function(){return o.Msg.TEXT_INDEXOF_TOOLTIP.replace("%1",t.workspace.options.oneBasedIndex?"0":"-1")}))},o.Constants.Text.TEXT_CHARAT_MUTATOR_MIXIN={mutationToDom:function(){var t=o.utils.xml.createElement("mutation");return t.setAttribute("at",!!this.isAt_),t},domToMutation:function(t){t="false"!=t.getAttribute("at"),this.updateAt_(t)},updateAt_:function(t){this.removeInput("AT",!0),this.removeInput("ORDINAL",!0),t&&(this.appendValueInput("AT").setCheck("Number"),o.Msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(o.Msg.ORDINAL_NUMBER_SUFFIX)),o.Msg.TEXT_CHARAT_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(o.Msg.TEXT_CHARAT_TAIL)),this.isAt_=t}},o.Constants.Text.TEXT_CHARAT_EXTENSION=function(){this.getField("WHERE").setValidator((function(t){(t="FROM_START"==t||"FROM_END"==t)!=this.isAt_&&this.getSourceBlock().updateAt_(t)})),this.updateAt_(!0);var t=this;this.setTooltip((function(){var e=t.getFieldValue("WHERE"),i=o.Msg.TEXT_CHARAT_TOOLTIP;return("FROM_START"==e||"FROM_END"==e)&&(e="FROM_START"==e?o.Msg.LISTS_INDEX_FROM_START_TOOLTIP:o.Msg.LISTS_INDEX_FROM_END_TOOLTIP)&&(i+="  "+e.replace("%1",t.workspace.options.oneBasedIndex?"#1":"#0")),i}))},o.Extensions.register("text_indexOf_tooltip",o.Constants.Text.TEXT_INDEXOF_TOOLTIP_EXTENSION),o.Extensions.register("text_quotes",o.Constants.Text.TEXT_QUOTES_EXTENSION),o.Extensions.registerMutator("text_join_mutator",o.Constants.Text.TEXT_JOIN_MUTATOR_MIXIN,o.Constants.Text.TEXT_JOIN_EXTENSION),o.Extensions.registerMutator("text_charAt_mutator",o.Constants.Text.TEXT_CHARAT_MUTATOR_MIXIN,o.Constants.Text.TEXT_CHARAT_EXTENSION),o.Blocks.variables={},o.Constants.Variables={},o.Constants.Variables.HUE=330,o.defineBlocksWithJsonArray([{type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]},{type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}]),o.Constants.Variables.CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN={customContextMenu:function(t){if(this.isInFlyout)"variables_get"!=this.type&&"variables_get_reporter"!=this.type||(e={text:o.Msg.RENAME_VARIABLE,enabled:!0,callback:o.Constants.Variables.RENAME_OPTION_CALLBACK_FACTORY(this)},r=this.getField("VAR").getText(),n={text:o.Msg.DELETE_VARIABLE.replace("%1",r),enabled:!0,callback:o.Constants.Variables.DELETE_OPTION_CALLBACK_FACTORY(this)},t.unshift(e),t.unshift(n));else{if("variables_get"==this.type)var e="variables_set",i=o.Msg.VARIABLES_GET_CREATE_SET;else e="variables_get",i=o.Msg.VARIABLES_SET_CREATE_GET;var n={enabled:0<this.workspace.remainingCapacity()},r=this.getField("VAR").getText();n.text=i.replace("%1",r),(i=o.utils.xml.createElement("field")).setAttribute("name","VAR"),i.appendChild(o.utils.xml.createTextNode(r)),(r=o.utils.xml.createElement("block")).setAttribute("type",e),r.appendChild(i),n.callback=o.ContextMenu.callbackFactory(this,r),t.push(n)}}},o.Constants.Variables.RENAME_OPTION_CALLBACK_FACTORY=function(t){return function(){var e=t.workspace,i=t.getField("VAR").getVariable();o.Variables.renameVariable(e,i)}},o.Constants.Variables.DELETE_OPTION_CALLBACK_FACTORY=function(t){return function(){var e=t.workspace,o=t.getField("VAR").getVariable();e.deleteVariableById(o.getId()),e.refreshToolboxSelection()}},o.Extensions.registerMixin("contextMenu_variableSetterGetter",o.Constants.Variables.CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN),o.Constants.VariablesDynamic={},o.Constants.VariablesDynamic.HUE=310,o.defineBlocksWithJsonArray([{type:"variables_get_dynamic",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_dynamic_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableDynamicSetterGetter"]},{type:"variables_set_dynamic",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_dynamic_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableDynamicSetterGetter"]}]),o.Constants.VariablesDynamic.CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN={customContextMenu:function(t){if(this.isInFlyout)"variables_get_dynamic"!=this.type&&"variables_get_reporter_dynamic"!=this.type||(e={text:o.Msg.RENAME_VARIABLE,enabled:!0,callback:o.Constants.Variables.RENAME_OPTION_CALLBACK_FACTORY(this)},s=this.getField("VAR").getText(),r={text:o.Msg.DELETE_VARIABLE.replace("%1",s),enabled:!0,callback:o.Constants.Variables.DELETE_OPTION_CALLBACK_FACTORY(this)},t.unshift(e),t.unshift(r));else{var e=this.getFieldValue("VAR"),i=this.workspace.getVariableById(e).type;if("variables_get_dynamic"==this.type){e="variables_set_dynamic";var n=o.Msg.VARIABLES_GET_CREATE_SET}else e="variables_get_dynamic",n=o.Msg.VARIABLES_SET_CREATE_GET;var r={enabled:0<this.workspace.remainingCapacity()},s=this.getField("VAR").getText();r.text=n.replace("%1",s),(n=o.utils.xml.createElement("field")).setAttribute("name","VAR"),n.setAttribute("variabletype",i),n.appendChild(o.utils.xml.createTextNode(s)),(s=o.utils.xml.createElement("block")).setAttribute("type",e),s.appendChild(n),r.callback=o.ContextMenu.callbackFactory(this,s),t.push(r)}},onchange:function(t){t=this.getFieldValue("VAR"),t=o.Variables.getVariable(this.workspace,t),"variables_get_dynamic"==this.type?this.outputConnection.setCheck(t.type):this.getInput("VALUE").connection.setCheck(t.type)}},o.Constants.VariablesDynamic.RENAME_OPTION_CALLBACK_FACTORY=function(t){return function(){var e=t.workspace,i=t.getField("VAR").getVariable();o.Variables.renameVariable(e,i)}},o.Constants.VariablesDynamic.DELETE_OPTION_CALLBACK_FACTORY=function(t){return function(){var e=t.workspace,o=t.getField("VAR").getVariable();e.deleteVariableById(o.getId()),e.refreshToolboxSelection()}},o.Extensions.registerMixin("contextMenu_variableDynamicSetterGetter",o.Constants.VariablesDynamic.CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN),o.Blocks)})),q=G((function(t,e){var o;t.exports=((o=Z).Blocks={},o.Blocks)})),Q=G((function(t,e){var o;t.exports=((o=K).JavaScript=new o.Generator("JavaScript"),o.JavaScript.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(o.utils.global).join(",")),o.JavaScript.ORDER_ATOMIC=0,o.JavaScript.ORDER_NEW=1.1,o.JavaScript.ORDER_MEMBER=1.2,o.JavaScript.ORDER_FUNCTION_CALL=2,o.JavaScript.ORDER_INCREMENT=3,o.JavaScript.ORDER_DECREMENT=3,o.JavaScript.ORDER_BITWISE_NOT=4.1,o.JavaScript.ORDER_UNARY_PLUS=4.2,o.JavaScript.ORDER_UNARY_NEGATION=4.3,o.JavaScript.ORDER_LOGICAL_NOT=4.4,o.JavaScript.ORDER_TYPEOF=4.5,o.JavaScript.ORDER_VOID=4.6,o.JavaScript.ORDER_DELETE=4.7,o.JavaScript.ORDER_AWAIT=4.8,o.JavaScript.ORDER_EXPONENTIATION=5,o.JavaScript.ORDER_MULTIPLICATION=5.1,o.JavaScript.ORDER_DIVISION=5.2,o.JavaScript.ORDER_MODULUS=5.3,o.JavaScript.ORDER_SUBTRACTION=6.1,o.JavaScript.ORDER_ADDITION=6.2,o.JavaScript.ORDER_BITWISE_SHIFT=7,o.JavaScript.ORDER_RELATIONAL=8,o.JavaScript.ORDER_IN=8,o.JavaScript.ORDER_INSTANCEOF=8,o.JavaScript.ORDER_EQUALITY=9,o.JavaScript.ORDER_BITWISE_AND=10,o.JavaScript.ORDER_BITWISE_XOR=11,o.JavaScript.ORDER_BITWISE_OR=12,o.JavaScript.ORDER_LOGICAL_AND=13,o.JavaScript.ORDER_LOGICAL_OR=14,o.JavaScript.ORDER_CONDITIONAL=15,o.JavaScript.ORDER_ASSIGNMENT=16,o.JavaScript.ORDER_YIELD=17,o.JavaScript.ORDER_COMMA=18,o.JavaScript.ORDER_NONE=99,o.JavaScript.ORDER_OVERRIDES=[[o.JavaScript.ORDER_FUNCTION_CALL,o.JavaScript.ORDER_MEMBER],[o.JavaScript.ORDER_FUNCTION_CALL,o.JavaScript.ORDER_FUNCTION_CALL],[o.JavaScript.ORDER_MEMBER,o.JavaScript.ORDER_MEMBER],[o.JavaScript.ORDER_MEMBER,o.JavaScript.ORDER_FUNCTION_CALL],[o.JavaScript.ORDER_LOGICAL_NOT,o.JavaScript.ORDER_LOGICAL_NOT],[o.JavaScript.ORDER_MULTIPLICATION,o.JavaScript.ORDER_MULTIPLICATION],[o.JavaScript.ORDER_ADDITION,o.JavaScript.ORDER_ADDITION],[o.JavaScript.ORDER_LOGICAL_AND,o.JavaScript.ORDER_LOGICAL_AND],[o.JavaScript.ORDER_LOGICAL_OR,o.JavaScript.ORDER_LOGICAL_OR]],o.JavaScript.isInitialized=!1,o.JavaScript.init=function(t){o.JavaScript.definitions_=Object.create(null),o.JavaScript.functionNames_=Object.create(null),o.JavaScript.variableDB_?o.JavaScript.variableDB_.reset():o.JavaScript.variableDB_=new o.Names(o.JavaScript.RESERVED_WORDS_),o.JavaScript.variableDB_.setVariableMap(t.getVariableMap());for(var e=[],i=o.Variables.allDeveloperVariables(t),n=0;n<i.length;n++)e.push(o.JavaScript.variableDB_.getName(i[n],o.Names.DEVELOPER_VARIABLE_TYPE));for(t=o.Variables.allUsedVarModels(t),n=0;n<t.length;n++)e.push(o.JavaScript.variableDB_.getName(t[n].getId(),o.VARIABLE_CATEGORY_NAME));e.length&&(o.JavaScript.definitions_.variables="var "+e.join(", ")+";"),this.isInitialized=!0},o.JavaScript.finish=function(t){var e,i=[];for(e in o.JavaScript.definitions_)i.push(o.JavaScript.definitions_[e]);return delete o.JavaScript.definitions_,delete o.JavaScript.functionNames_,o.JavaScript.variableDB_.reset(),i.join("\n\n")+"\n\n\n"+t},o.JavaScript.scrubNakedValue=function(t){return t+";\n"},o.JavaScript.quote_=function(t){return"'"+(t=t.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"},o.JavaScript.multiline_quote_=function(t){return t.split(/\n/g).map(o.JavaScript.quote_).join(" + '\\n' +\n")},o.JavaScript.scrub_=function(t,e,i){var n="";if(!t.outputConnection||!t.outputConnection.targetConnection){var r=t.getCommentText();r&&(r=o.utils.string.wrap(r,o.JavaScript.COMMENT_WRAP-3),n+=o.JavaScript.prefixLines(r+"\n","// "));for(var s=0;s<t.inputList.length;s++)t.inputList[s].type==o.INPUT_VALUE&&(r=t.inputList[s].connection.targetBlock())&&(r=o.JavaScript.allNestedComments(r))&&(n+=o.JavaScript.prefixLines(r,"// "))}return t=t.nextConnection&&t.nextConnection.targetBlock(),n+e+(i=i?"":o.JavaScript.blockToCode(t))},o.JavaScript.getAdjusted=function(t,e,i,n,r){i=i||0,r=r||o.JavaScript.ORDER_NONE,t.workspace.options.oneBasedIndex&&i--;var s=t.workspace.options.oneBasedIndex?"1":"0";if(t=0<i?o.JavaScript.valueToCode(t,e,o.JavaScript.ORDER_ADDITION)||s:0>i?o.JavaScript.valueToCode(t,e,o.JavaScript.ORDER_SUBTRACTION)||s:n?o.JavaScript.valueToCode(t,e,o.JavaScript.ORDER_UNARY_NEGATION)||s:o.JavaScript.valueToCode(t,e,r)||s,o.isNumber(t))t=Number(t)+i,n&&(t=-t);else{if(0<i){t=t+" + "+i;var a=o.JavaScript.ORDER_ADDITION}else 0>i&&(t=t+" - "+-i,a=o.JavaScript.ORDER_SUBTRACTION);n&&(t=i?"-("+t+")":"-"+t,a=o.JavaScript.ORDER_UNARY_NEGATION),a=Math.floor(a),r=Math.floor(r),a&&r>=a&&(t="("+t+")")}return t},o.JavaScript.colour={},o.JavaScript.colour_picker=function(t){return[o.JavaScript.quote_(t.getFieldValue("COLOUR")),o.JavaScript.ORDER_ATOMIC]},o.JavaScript.colour_random=function(t){return[o.JavaScript.provideFunction_("colourRandom",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"() {","  var num = Math.floor(Math.random() * Math.pow(2, 24));","  return '#' + ('00000' + num.toString(16)).substr(-6);","}"])+"()",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.colour_rgb=function(t){var e=o.JavaScript.valueToCode(t,"RED",o.JavaScript.ORDER_NONE)||0,i=o.JavaScript.valueToCode(t,"GREEN",o.JavaScript.ORDER_NONE)||0;return t=o.JavaScript.valueToCode(t,"BLUE",o.JavaScript.ORDER_NONE)||0,[o.JavaScript.provideFunction_("colourRgb",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(r, g, b) {","  r = Math.max(Math.min(Number(r), 100), 0) * 2.55;","  g = Math.max(Math.min(Number(g), 100), 0) * 2.55;","  b = Math.max(Math.min(Number(b), 100), 0) * 2.55;","  r = ('0' + (Math.round(r) || 0).toString(16)).slice(-2);","  g = ('0' + (Math.round(g) || 0).toString(16)).slice(-2);","  b = ('0' + (Math.round(b) || 0).toString(16)).slice(-2);","  return '#' + r + g + b;","}"])+"("+e+", "+i+", "+t+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.colour_blend=function(t){var e=o.JavaScript.valueToCode(t,"COLOUR1",o.JavaScript.ORDER_NONE)||"'#000000'",i=o.JavaScript.valueToCode(t,"COLOUR2",o.JavaScript.ORDER_NONE)||"'#000000'";return t=o.JavaScript.valueToCode(t,"RATIO",o.JavaScript.ORDER_NONE)||.5,[o.JavaScript.provideFunction_("colourBlend",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(c1, c2, ratio) {","  ratio = Math.max(Math.min(Number(ratio), 1), 0);","  var r1 = parseInt(c1.substring(1, 3), 16);","  var g1 = parseInt(c1.substring(3, 5), 16);","  var b1 = parseInt(c1.substring(5, 7), 16);","  var r2 = parseInt(c2.substring(1, 3), 16);","  var g2 = parseInt(c2.substring(3, 5), 16);","  var b2 = parseInt(c2.substring(5, 7), 16);","  var r = Math.round(r1 * (1 - ratio) + r2 * ratio);","  var g = Math.round(g1 * (1 - ratio) + g2 * ratio);","  var b = Math.round(b1 * (1 - ratio) + b2 * ratio);","  r = ('0' + (r || 0).toString(16)).slice(-2);","  g = ('0' + (g || 0).toString(16)).slice(-2);","  b = ('0' + (b || 0).toString(16)).slice(-2);","  return '#' + r + g + b;","}"])+"("+e+", "+i+", "+t+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.lists={},o.JavaScript.lists_create_empty=function(t){return["[]",o.JavaScript.ORDER_ATOMIC]},o.JavaScript.lists_create_with=function(t){for(var e=Array(t.itemCount_),i=0;i<t.itemCount_;i++)e[i]=o.JavaScript.valueToCode(t,"ADD"+i,o.JavaScript.ORDER_NONE)||"null";return["["+e.join(", ")+"]",o.JavaScript.ORDER_ATOMIC]},o.JavaScript.lists_repeat=function(t){return[o.JavaScript.provideFunction_("listsRepeat",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(value, n) {","  var array = [];","  for (var i = 0; i < n; i++) {","    array[i] = value;","  }","  return array;","}"])+"("+(o.JavaScript.valueToCode(t,"ITEM",o.JavaScript.ORDER_NONE)||"null")+", "+(t=o.JavaScript.valueToCode(t,"NUM",o.JavaScript.ORDER_NONE)||"0")+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.lists_length=function(t){return[(o.JavaScript.valueToCode(t,"VALUE",o.JavaScript.ORDER_MEMBER)||"[]")+".length",o.JavaScript.ORDER_MEMBER]},o.JavaScript.lists_isEmpty=function(t){return["!"+(o.JavaScript.valueToCode(t,"VALUE",o.JavaScript.ORDER_MEMBER)||"[]")+".length",o.JavaScript.ORDER_LOGICAL_NOT]},o.JavaScript.lists_indexOf=function(t){var e="FIRST"==t.getFieldValue("END")?"indexOf":"lastIndexOf",i=o.JavaScript.valueToCode(t,"FIND",o.JavaScript.ORDER_NONE)||"''";return e=(o.JavaScript.valueToCode(t,"VALUE",o.JavaScript.ORDER_MEMBER)||"[]")+"."+e+"("+i+")",t.workspace.options.oneBasedIndex?[e+" + 1",o.JavaScript.ORDER_ADDITION]:[e,o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.lists_getIndex=function(t){var e=t.getFieldValue("MODE")||"GET",i=t.getFieldValue("WHERE")||"FROM_START",n=o.JavaScript.valueToCode(t,"VALUE","RANDOM"==i?o.JavaScript.ORDER_NONE:o.JavaScript.ORDER_MEMBER)||"[]";switch(i){case"FIRST":if("GET"==e)return[n+"[0]",o.JavaScript.ORDER_MEMBER];if("GET_REMOVE"==e)return[n+".shift()",o.JavaScript.ORDER_MEMBER];if("REMOVE"==e)return n+".shift();\n";break;case"LAST":if("GET"==e)return[n+".slice(-1)[0]",o.JavaScript.ORDER_MEMBER];if("GET_REMOVE"==e)return[n+".pop()",o.JavaScript.ORDER_MEMBER];if("REMOVE"==e)return n+".pop();\n";break;case"FROM_START":if(t=o.JavaScript.getAdjusted(t,"AT"),"GET"==e)return[n+"["+t+"]",o.JavaScript.ORDER_MEMBER];if("GET_REMOVE"==e)return[n+".splice("+t+", 1)[0]",o.JavaScript.ORDER_FUNCTION_CALL];if("REMOVE"==e)return n+".splice("+t+", 1);\n";break;case"FROM_END":if(t=o.JavaScript.getAdjusted(t,"AT",1,!0),"GET"==e)return[n+".slice("+t+")[0]",o.JavaScript.ORDER_FUNCTION_CALL];if("GET_REMOVE"==e)return[n+".splice("+t+", 1)[0]",o.JavaScript.ORDER_FUNCTION_CALL];if("REMOVE"==e)return n+".splice("+t+", 1);";break;case"RANDOM":if(n=o.JavaScript.provideFunction_("listsGetRandomItem",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(list, remove) {","  var x = Math.floor(Math.random() * list.length);","  if (remove) {","    return list.splice(x, 1)[0];","  } else {","    return list[x];","  }","}"])+"("+n+", "+("GET"!=e)+")","GET"==e||"GET_REMOVE"==e)return[n,o.JavaScript.ORDER_FUNCTION_CALL];if("REMOVE"==e)return n+";\n"}throw Error("Unhandled combination (lists_getIndex).")},o.JavaScript.lists_setIndex=function(t){function e(){if(i.match(/^\w+$/))return"";var t=o.JavaScript.variableDB_.getDistinctName("tmpList",o.VARIABLE_CATEGORY_NAME),e="var "+t+" = "+i+";\n";return i=t,e}var i=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_MEMBER)||"[]",n=t.getFieldValue("MODE")||"GET",r=t.getFieldValue("WHERE")||"FROM_START",s=o.JavaScript.valueToCode(t,"TO",o.JavaScript.ORDER_ASSIGNMENT)||"null";switch(r){case"FIRST":if("SET"==n)return i+"[0] = "+s+";\n";if("INSERT"==n)return i+".unshift("+s+");\n";break;case"LAST":if("SET"==n)return(t=e())+(i+"[")+i+".length - 1] = "+s+";\n";if("INSERT"==n)return i+".push("+s+");\n";break;case"FROM_START":if(r=o.JavaScript.getAdjusted(t,"AT"),"SET"==n)return i+"["+r+"] = "+s+";\n";if("INSERT"==n)return i+".splice("+r+", 0, "+s+");\n";break;case"FROM_END":if(r=o.JavaScript.getAdjusted(t,"AT",1,!1,o.JavaScript.ORDER_SUBTRACTION),t=e(),"SET"==n)return t+(i+"[")+i+".length - "+r+"] = "+s+";\n";if("INSERT"==n)return t+(i+".splice(")+i+".length - "+r+", 0, "+s+");\n";break;case"RANDOM":if(t=e(),t+="var "+(r=o.JavaScript.variableDB_.getDistinctName("tmpX",o.VARIABLE_CATEGORY_NAME))+" = Math.floor(Math.random() * "+i+".length);\n","SET"==n)return t+(i+"[")+r+"] = "+s+";\n";if("INSERT"==n)return t+(i+".splice(")+r+", 0, "+s+");\n"}throw Error("Unhandled combination (lists_setIndex).")},o.JavaScript.lists.getIndex_=function(t,e,o){return"FIRST"==e?"0":"FROM_END"==e?t+".length - 1 - "+o:"LAST"==e?t+".length - 1":o},o.JavaScript.lists_getSublist=function(t){var e=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_MEMBER)||"[]",i=t.getFieldValue("WHERE1"),n=t.getFieldValue("WHERE2");if("FIRST"==i&&"LAST"==n)e+=".slice(0)";else if(e.match(/^\w+$/)||"FROM_END"!=i&&"FROM_START"==n){switch(i){case"FROM_START":var r=o.JavaScript.getAdjusted(t,"AT1");break;case"FROM_END":r=e+".length - "+(r=o.JavaScript.getAdjusted(t,"AT1",1,!1,o.JavaScript.ORDER_SUBTRACTION));break;case"FIRST":r="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(n){case"FROM_START":t=o.JavaScript.getAdjusted(t,"AT2",1);break;case"FROM_END":t=e+".length - "+(t=o.JavaScript.getAdjusted(t,"AT2",0,!1,o.JavaScript.ORDER_SUBTRACTION));break;case"LAST":t=e+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}e=e+".slice("+r+", "+t+")"}else{r=o.JavaScript.getAdjusted(t,"AT1"),t=o.JavaScript.getAdjusted(t,"AT2");var s=o.JavaScript.lists.getIndex_,a={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};e=o.JavaScript.provideFunction_("subsequence"+a[i]+a[n],["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(sequence"+("FROM_END"==i||"FROM_START"==i?", at1":"")+("FROM_END"==n||"FROM_START"==n?", at2":"")+") {","  var start = "+s("sequence",i,"at1")+";","  var end = "+s("sequence",n,"at2")+" + 1;","  return sequence.slice(start, end);","}"])+"("+e+("FROM_END"==i||"FROM_START"==i?", "+r:"")+("FROM_END"==n||"FROM_START"==n?", "+t:"")+")"}return[e,o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.lists_sort=function(t){var e=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_FUNCTION_CALL)||"[]",i="1"===t.getFieldValue("DIRECTION")?1:-1;return t=t.getFieldValue("TYPE"),[e+".slice().sort("+o.JavaScript.provideFunction_("listsGetSortCompare",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(type, direction) {","  var compareFuncs = {",'    "NUMERIC": function(a, b) {',"        return Number(a) - Number(b); },",'    "TEXT": function(a, b) {',"        return a.toString() > b.toString() ? 1 : -1; },",'    "IGNORE_CASE": function(a, b) {',"        return a.toString().toLowerCase() > b.toString().toLowerCase() ? 1 : -1; },","  };","  var compare = compareFuncs[type];","  return function(a, b) { return compare(a, b) * direction; }","}"])+'("'+t+'", '+i+"))",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.lists_split=function(t){var e=o.JavaScript.valueToCode(t,"INPUT",o.JavaScript.ORDER_MEMBER),i=o.JavaScript.valueToCode(t,"DELIM",o.JavaScript.ORDER_NONE)||"''";if("SPLIT"==(t=t.getFieldValue("MODE")))e||(e="''"),t="split";else{if("JOIN"!=t)throw Error("Unknown mode: "+t);e||(e="[]"),t="join"}return[e+"."+t+"("+i+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.lists_reverse=function(t){return[(o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_FUNCTION_CALL)||"[]")+".slice().reverse()",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.logic={},o.JavaScript.controls_if=function(t){var e=0,i="";o.JavaScript.STATEMENT_PREFIX&&(i+=o.JavaScript.injectId(o.JavaScript.STATEMENT_PREFIX,t));do{var n=o.JavaScript.valueToCode(t,"IF"+e,o.JavaScript.ORDER_NONE)||"false",r=o.JavaScript.statementToCode(t,"DO"+e);o.JavaScript.STATEMENT_SUFFIX&&(r=o.JavaScript.prefixLines(o.JavaScript.injectId(o.JavaScript.STATEMENT_SUFFIX,t),o.JavaScript.INDENT)+r),i+=(0<e?" else ":"")+"if ("+n+") {\n"+r+"}",++e}while(t.getInput("IF"+e));return(t.getInput("ELSE")||o.JavaScript.STATEMENT_SUFFIX)&&(r=o.JavaScript.statementToCode(t,"ELSE"),o.JavaScript.STATEMENT_SUFFIX&&(r=o.JavaScript.prefixLines(o.JavaScript.injectId(o.JavaScript.STATEMENT_SUFFIX,t),o.JavaScript.INDENT)+r),i+=" else {\n"+r+"}"),i+"\n"},o.JavaScript.controls_ifelse=o.JavaScript.controls_if,o.JavaScript.logic_compare=function(t){var e={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[t.getFieldValue("OP")],i="=="==e||"!="==e?o.JavaScript.ORDER_EQUALITY:o.JavaScript.ORDER_RELATIONAL;return[(o.JavaScript.valueToCode(t,"A",i)||"0")+" "+e+" "+(t=o.JavaScript.valueToCode(t,"B",i)||"0"),i]},o.JavaScript.logic_operation=function(t){var e="AND"==t.getFieldValue("OP")?"&&":"||",i="&&"==e?o.JavaScript.ORDER_LOGICAL_AND:o.JavaScript.ORDER_LOGICAL_OR,n=o.JavaScript.valueToCode(t,"A",i);if(t=o.JavaScript.valueToCode(t,"B",i),n||t){var r="&&"==e?"true":"false";n||(n=r),t||(t=r)}else t=n="false";return[n+" "+e+" "+t,i]},o.JavaScript.logic_negate=function(t){var e=o.JavaScript.ORDER_LOGICAL_NOT;return["!"+(o.JavaScript.valueToCode(t,"BOOL",e)||"true"),e]},o.JavaScript.logic_boolean=function(t){return["TRUE"==t.getFieldValue("BOOL")?"true":"false",o.JavaScript.ORDER_ATOMIC]},o.JavaScript.logic_null=function(t){return["null",o.JavaScript.ORDER_ATOMIC]},o.JavaScript.logic_ternary=function(t){return[(o.JavaScript.valueToCode(t,"IF",o.JavaScript.ORDER_CONDITIONAL)||"false")+" ? "+(o.JavaScript.valueToCode(t,"THEN",o.JavaScript.ORDER_CONDITIONAL)||"null")+" : "+(t=o.JavaScript.valueToCode(t,"ELSE",o.JavaScript.ORDER_CONDITIONAL)||"null"),o.JavaScript.ORDER_CONDITIONAL]},o.JavaScript.loops={},o.JavaScript.controls_repeat_ext=function(t){var e=t.getField("TIMES")?String(Number(t.getFieldValue("TIMES"))):o.JavaScript.valueToCode(t,"TIMES",o.JavaScript.ORDER_ASSIGNMENT)||"0",i=o.JavaScript.statementToCode(t,"DO");i=o.JavaScript.addLoopTrap(i,t),t="";var n=o.JavaScript.variableDB_.getDistinctName("count",o.VARIABLE_CATEGORY_NAME),r=e;return e.match(/^\w+$/)||o.isNumber(e)||(t+="var "+(r=o.JavaScript.variableDB_.getDistinctName("repeat_end",o.VARIABLE_CATEGORY_NAME))+" = "+e+";\n"),t+"for (var "+n+" = 0; "+n+" < "+r+"; "+n+"++) {\n"+i+"}\n"},o.JavaScript.controls_repeat=o.JavaScript.controls_repeat_ext,o.JavaScript.controls_whileUntil=function(t){var e="UNTIL"==t.getFieldValue("MODE"),i=o.JavaScript.valueToCode(t,"BOOL",e?o.JavaScript.ORDER_LOGICAL_NOT:o.JavaScript.ORDER_NONE)||"false",n=o.JavaScript.statementToCode(t,"DO");return e&&(i="!"+i),"while ("+i+") {\n"+(n=o.JavaScript.addLoopTrap(n,t))+"}\n"},o.JavaScript.controls_for=function(t){var e=o.JavaScript.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),i=o.JavaScript.valueToCode(t,"FROM",o.JavaScript.ORDER_ASSIGNMENT)||"0",n=o.JavaScript.valueToCode(t,"TO",o.JavaScript.ORDER_ASSIGNMENT)||"0",r=o.JavaScript.valueToCode(t,"BY",o.JavaScript.ORDER_ASSIGNMENT)||"1",s=o.JavaScript.statementToCode(t,"DO");if(s=o.JavaScript.addLoopTrap(s,t),o.isNumber(i)&&o.isNumber(n)&&o.isNumber(r)){var a=Number(i)<=Number(n);t="for ("+e+" = "+i+"; "+e+(a?" <= ":" >= ")+n+"; "+e,t=(1==(e=Math.abs(Number(r)))?t+(a?"++":"--"):t+(a?" += ":" -= ")+e)+") {\n"+s+"}\n"}else t="",a=i,i.match(/^\w+$/)||o.isNumber(i)||(t+="var "+(a=o.JavaScript.variableDB_.getDistinctName(e+"_start",o.VARIABLE_CATEGORY_NAME))+" = "+i+";\n"),i=n,n.match(/^\w+$/)||o.isNumber(n)||(t+="var "+(i=o.JavaScript.variableDB_.getDistinctName(e+"_end",o.VARIABLE_CATEGORY_NAME))+" = "+n+";\n"),t+="var "+(n=o.JavaScript.variableDB_.getDistinctName(e+"_inc",o.VARIABLE_CATEGORY_NAME))+" = ",t=(t=o.isNumber(r)?t+(Math.abs(r)+";\n"):t+"Math.abs("+r+");\n")+"if ("+a+" > "+i+") {\n"+(o.JavaScript.INDENT+n)+" = -"+n+";\n",t+="}\n",t+="for ("+e+" = "+a+"; "+n+" >= 0 ? "+e+" <= "+i+" : "+e+" >= "+i+"; "+e+" += "+n+") {\n"+s+"}\n";return t},o.JavaScript.controls_forEach=function(t){var e=o.JavaScript.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),i=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_ASSIGNMENT)||"[]",n=o.JavaScript.statementToCode(t,"DO");n=o.JavaScript.addLoopTrap(n,t),t="";var r=i;return i.match(/^\w+$/)||(t+="var "+(r=o.JavaScript.variableDB_.getDistinctName(e+"_list",o.VARIABLE_CATEGORY_NAME))+" = "+i+";\n"),t+"for (var "+(i=o.JavaScript.variableDB_.getDistinctName(e+"_index",o.VARIABLE_CATEGORY_NAME))+" in "+r+") {\n"+(n=o.JavaScript.INDENT+e+" = "+r+"["+i+"];\n"+n)+"}\n"},o.JavaScript.controls_flow_statements=function(t){var e="";if(o.JavaScript.STATEMENT_PREFIX&&(e+=o.JavaScript.injectId(o.JavaScript.STATEMENT_PREFIX,t)),o.JavaScript.STATEMENT_SUFFIX&&(e+=o.JavaScript.injectId(o.JavaScript.STATEMENT_SUFFIX,t)),o.JavaScript.STATEMENT_PREFIX){var i=o.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(t);i&&!i.suppressPrefixSuffix&&(e+=o.JavaScript.injectId(o.JavaScript.STATEMENT_PREFIX,i))}switch(t.getFieldValue("FLOW")){case"BREAK":return e+"break;\n";case"CONTINUE":return e+"continue;\n"}throw Error("Unknown flow statement.")},o.JavaScript.math={},o.JavaScript.math_number=function(t){return[t=Number(t.getFieldValue("NUM")),0<=t?o.JavaScript.ORDER_ATOMIC:o.JavaScript.ORDER_UNARY_NEGATION]},o.JavaScript.math_arithmetic=function(t){var e={ADD:[" + ",o.JavaScript.ORDER_ADDITION],MINUS:[" - ",o.JavaScript.ORDER_SUBTRACTION],MULTIPLY:[" * ",o.JavaScript.ORDER_MULTIPLICATION],DIVIDE:[" / ",o.JavaScript.ORDER_DIVISION],POWER:[null,o.JavaScript.ORDER_NONE]}[t.getFieldValue("OP")],i=e[0];e=e[1];var n=o.JavaScript.valueToCode(t,"A",e)||"0";return t=o.JavaScript.valueToCode(t,"B",e)||"0",i?[n+i+t,e]:["Math.pow("+n+", "+t+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.math_single=function(t){var e=t.getFieldValue("OP");if("NEG"==e)return"-"==(t=o.JavaScript.valueToCode(t,"NUM",o.JavaScript.ORDER_UNARY_NEGATION)||"0")[0]&&(t=" "+t),["-"+t,o.JavaScript.ORDER_UNARY_NEGATION];switch(t="SIN"==e||"COS"==e||"TAN"==e?o.JavaScript.valueToCode(t,"NUM",o.JavaScript.ORDER_DIVISION)||"0":o.JavaScript.valueToCode(t,"NUM",o.JavaScript.ORDER_NONE)||"0",e){case"ABS":var i="Math.abs("+t+")";break;case"ROOT":i="Math.sqrt("+t+")";break;case"LN":i="Math.log("+t+")";break;case"EXP":i="Math.exp("+t+")";break;case"POW10":i="Math.pow(10,"+t+")";break;case"ROUND":i="Math.round("+t+")";break;case"ROUNDUP":i="Math.ceil("+t+")";break;case"ROUNDDOWN":i="Math.floor("+t+")";break;case"SIN":i="Math.sin("+t+" / 180 * Math.PI)";break;case"COS":i="Math.cos("+t+" / 180 * Math.PI)";break;case"TAN":i="Math.tan("+t+" / 180 * Math.PI)"}if(i)return[i,o.JavaScript.ORDER_FUNCTION_CALL];switch(e){case"LOG10":i="Math.log("+t+") / Math.log(10)";break;case"ASIN":i="Math.asin("+t+") / Math.PI * 180";break;case"ACOS":i="Math.acos("+t+") / Math.PI * 180";break;case"ATAN":i="Math.atan("+t+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+e)}return[i,o.JavaScript.ORDER_DIVISION]},o.JavaScript.math_constant=function(t){return{PI:["Math.PI",o.JavaScript.ORDER_MEMBER],E:["Math.E",o.JavaScript.ORDER_MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",o.JavaScript.ORDER_DIVISION],SQRT2:["Math.SQRT2",o.JavaScript.ORDER_MEMBER],SQRT1_2:["Math.SQRT1_2",o.JavaScript.ORDER_MEMBER],INFINITY:["Infinity",o.JavaScript.ORDER_ATOMIC]}[t.getFieldValue("CONSTANT")]},o.JavaScript.math_number_property=function(t){var e=o.JavaScript.valueToCode(t,"NUMBER_TO_CHECK",o.JavaScript.ORDER_MODULUS)||"0",i=t.getFieldValue("PROPERTY");if("PRIME"==i)return[o.JavaScript.provideFunction_("mathIsPrime",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(n) {","  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if (n == 2 || n == 3) {","    return true;","  }","  // False if n is NaN, negative, is 1, or not whole.","  // And false if n is divisible by 2 or 3.","  if (isNaN(n) || n <= 1 || n % 1 != 0 || n % 2 == 0 || n % 3 == 0) {","    return false;","  }","  // Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {","    if (n % (x - 1) == 0 || n % (x + 1) == 0) {","      return false;","    }","  }","  return true;","}"])+"("+e+")",o.JavaScript.ORDER_FUNCTION_CALL];switch(i){case"EVEN":var n=e+" % 2 == 0";break;case"ODD":n=e+" % 2 == 1";break;case"WHOLE":n=e+" % 1 == 0";break;case"POSITIVE":n=e+" > 0";break;case"NEGATIVE":n=e+" < 0";break;case"DIVISIBLE_BY":n=e+" % "+(t=o.JavaScript.valueToCode(t,"DIVISOR",o.JavaScript.ORDER_MODULUS)||"0")+" == 0"}return[n,o.JavaScript.ORDER_EQUALITY]},o.JavaScript.math_change=function(t){var e=o.JavaScript.valueToCode(t,"DELTA",o.JavaScript.ORDER_ADDITION)||"0";return(t=o.JavaScript.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME))+" = (typeof "+t+" == 'number' ? "+t+" : 0) + "+e+";\n"},o.JavaScript.math_round=o.JavaScript.math_single,o.JavaScript.math_trig=o.JavaScript.math_single,o.JavaScript.math_on_list=function(t){var e=t.getFieldValue("OP");switch(e){case"SUM":t=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_MEMBER)||"[]",t+=".reduce(function(x, y) {return x + y;})";break;case"MIN":t="Math.min.apply(null, "+(t=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_NONE)||"[]")+")";break;case"MAX":t="Math.max.apply(null, "+(t=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_NONE)||"[]")+")";break;case"AVERAGE":t=(e=o.JavaScript.provideFunction_("mathMean",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(myList) {","  return myList.reduce(function(x, y) {return x + y;}) / myList.length;","}"]))+"("+(t=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_NONE)||"[]")+")";break;case"MEDIAN":t=(e=o.JavaScript.provideFunction_("mathMedian",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(myList) {","  var localList = myList.filter(function (x) {return typeof x == 'number';});","  if (!localList.length) return null;","  localList.sort(function(a, b) {return b - a;});","  if (localList.length % 2 == 0) {","    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;","  } else {","    return localList[(localList.length - 1) / 2];","  }","}"]))+"("+(t=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_NONE)||"[]")+")";break;case"MODE":t=(e=o.JavaScript.provideFunction_("mathModes",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(values) {","  var modes = [];","  var counts = [];","  var maxCount = 0;","  for (var i = 0; i < values.length; i++) {","    var value = values[i];","    var found = false;","    var thisCount;","    for (var j = 0; j < counts.length; j++) {","      if (counts[j][0] === value) {","        thisCount = ++counts[j][1];","        found = true;","        break;","      }","    }","    if (!found) {","      counts.push([value, 1]);","      thisCount = 1;","    }","    maxCount = Math.max(thisCount, maxCount);","  }","  for (var j = 0; j < counts.length; j++) {","    if (counts[j][1] == maxCount) {","        modes.push(counts[j][0]);","    }","  }","  return modes;","}"]))+"("+(t=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_NONE)||"[]")+")";break;case"STD_DEV":t=(e=o.JavaScript.provideFunction_("mathStandardDeviation",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(numbers) {","  var n = numbers.length;","  if (!n) return null;","  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;","  var variance = 0;","  for (var j = 0; j < n; j++) {","    variance += Math.pow(numbers[j] - mean, 2);","  }","  variance = variance / n;","  return Math.sqrt(variance);","}"]))+"("+(t=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_NONE)||"[]")+")";break;case"RANDOM":t=(e=o.JavaScript.provideFunction_("mathRandomList",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(list) {","  var x = Math.floor(Math.random() * list.length);","  return list[x];","}"]))+"("+(t=o.JavaScript.valueToCode(t,"LIST",o.JavaScript.ORDER_NONE)||"[]")+")";break;default:throw Error("Unknown operator: "+e)}return[t,o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.math_modulo=function(t){return[(o.JavaScript.valueToCode(t,"DIVIDEND",o.JavaScript.ORDER_MODULUS)||"0")+" % "+(t=o.JavaScript.valueToCode(t,"DIVISOR",o.JavaScript.ORDER_MODULUS)||"0"),o.JavaScript.ORDER_MODULUS]},o.JavaScript.math_constrain=function(t){return["Math.min(Math.max("+(o.JavaScript.valueToCode(t,"VALUE",o.JavaScript.ORDER_NONE)||"0")+", "+(o.JavaScript.valueToCode(t,"LOW",o.JavaScript.ORDER_NONE)||"0")+"), "+(t=o.JavaScript.valueToCode(t,"HIGH",o.JavaScript.ORDER_NONE)||"Infinity")+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.math_random_int=function(t){var e=o.JavaScript.valueToCode(t,"FROM",o.JavaScript.ORDER_NONE)||"0";return t=o.JavaScript.valueToCode(t,"TO",o.JavaScript.ORDER_NONE)||"0",[o.JavaScript.provideFunction_("mathRandomInt",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(a, b) {","  if (a > b) {","    // Swap a and b to ensure a is smaller.","    var c = a;","    a = b;","    b = c;","  }","  return Math.floor(Math.random() * (b - a + 1) + a);","}"])+"("+e+", "+t+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.math_random_float=function(t){return["Math.random()",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.math_atan2=function(t){var e=o.JavaScript.valueToCode(t,"X",o.JavaScript.ORDER_NONE)||"0";return["Math.atan2("+(o.JavaScript.valueToCode(t,"Y",o.JavaScript.ORDER_NONE)||"0")+", "+e+") / Math.PI * 180",o.JavaScript.ORDER_DIVISION]},o.JavaScript.procedures={},o.JavaScript.procedures_defreturn=function(t){var e=o.JavaScript.variableDB_.getName(t.getFieldValue("NAME"),o.PROCEDURE_CATEGORY_NAME),i="";o.JavaScript.STATEMENT_PREFIX&&(i+=o.JavaScript.injectId(o.JavaScript.STATEMENT_PREFIX,t)),o.JavaScript.STATEMENT_SUFFIX&&(i+=o.JavaScript.injectId(o.JavaScript.STATEMENT_SUFFIX,t)),i&&(i=o.JavaScript.prefixLines(i,o.JavaScript.INDENT));var n="";o.JavaScript.INFINITE_LOOP_TRAP&&(n=o.JavaScript.prefixLines(o.JavaScript.injectId(o.JavaScript.INFINITE_LOOP_TRAP,t),o.JavaScript.INDENT));var r=o.JavaScript.statementToCode(t,"STACK"),s=o.JavaScript.valueToCode(t,"RETURN",o.JavaScript.ORDER_NONE)||"",a="";r&&s&&(a=i),s&&(s=o.JavaScript.INDENT+"return "+s+";\n");for(var l=[],c=t.getVars(),u=0;u<c.length;u++)l[u]=o.JavaScript.variableDB_.getName(c[u],o.VARIABLE_CATEGORY_NAME);return i="function "+e+"("+l.join(", ")+") {\n"+i+n+r+a+s+"}",i=o.JavaScript.scrub_(t,i),o.JavaScript.definitions_["%"+e]=i,null},o.JavaScript.procedures_defnoreturn=o.JavaScript.procedures_defreturn,o.JavaScript.procedures_callreturn=function(t){for(var e=o.JavaScript.variableDB_.getName(t.getFieldValue("NAME"),o.PROCEDURE_CATEGORY_NAME),i=[],n=t.getVars(),r=0;r<n.length;r++)i[r]=o.JavaScript.valueToCode(t,"ARG"+r,o.JavaScript.ORDER_NONE)||"null";return[e+"("+i.join(", ")+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.procedures_callnoreturn=function(t){return o.JavaScript.procedures_callreturn(t)[0]+";\n"},o.JavaScript.procedures_ifreturn=function(t){var e="if ("+(o.JavaScript.valueToCode(t,"CONDITION",o.JavaScript.ORDER_NONE)||"false")+") {\n";return o.JavaScript.STATEMENT_SUFFIX&&(e+=o.JavaScript.prefixLines(o.JavaScript.injectId(o.JavaScript.STATEMENT_SUFFIX,t),o.JavaScript.INDENT)),t.hasReturnValue_?(t=o.JavaScript.valueToCode(t,"VALUE",o.JavaScript.ORDER_NONE)||"null",e+=o.JavaScript.INDENT+"return "+t+";\n"):e+=o.JavaScript.INDENT+"return;\n",e+"}\n"},o.JavaScript.texts={},o.JavaScript.text=function(t){return[o.JavaScript.quote_(t.getFieldValue("TEXT")),o.JavaScript.ORDER_ATOMIC]},o.JavaScript.text_multiline=function(t){var e=-1!=(t=o.JavaScript.multiline_quote_(t.getFieldValue("TEXT"))).indexOf("+")?o.JavaScript.ORDER_ADDITION:o.JavaScript.ORDER_ATOMIC;return[t,e]},o.JavaScript.text.forceString_=function(t){return o.JavaScript.text.forceString_.strRegExp.test(t)?[t,o.JavaScript.ORDER_ATOMIC]:["String("+t+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.text.forceString_.strRegExp=/^\s*'([^']|\\')*'\s*$/,o.JavaScript.text_join=function(t){switch(t.itemCount_){case 0:return["''",o.JavaScript.ORDER_ATOMIC];case 1:return t=o.JavaScript.valueToCode(t,"ADD0",o.JavaScript.ORDER_NONE)||"''",o.JavaScript.text.forceString_(t);case 2:var e=o.JavaScript.valueToCode(t,"ADD0",o.JavaScript.ORDER_NONE)||"''";return t=o.JavaScript.valueToCode(t,"ADD1",o.JavaScript.ORDER_NONE)||"''",[t=o.JavaScript.text.forceString_(e)[0]+" + "+o.JavaScript.text.forceString_(t)[0],o.JavaScript.ORDER_ADDITION];default:e=Array(t.itemCount_);for(var i=0;i<t.itemCount_;i++)e[i]=o.JavaScript.valueToCode(t,"ADD"+i,o.JavaScript.ORDER_NONE)||"''";return[t="["+e.join(",")+"].join('')",o.JavaScript.ORDER_FUNCTION_CALL]}},o.JavaScript.text_append=function(t){var e=o.JavaScript.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME);return t=o.JavaScript.valueToCode(t,"TEXT",o.JavaScript.ORDER_NONE)||"''",e+" += "+o.JavaScript.text.forceString_(t)[0]+";\n"},o.JavaScript.text_length=function(t){return[(o.JavaScript.valueToCode(t,"VALUE",o.JavaScript.ORDER_MEMBER)||"''")+".length",o.JavaScript.ORDER_MEMBER]},o.JavaScript.text_isEmpty=function(t){return["!"+(o.JavaScript.valueToCode(t,"VALUE",o.JavaScript.ORDER_MEMBER)||"''")+".length",o.JavaScript.ORDER_LOGICAL_NOT]},o.JavaScript.text_indexOf=function(t){var e="FIRST"==t.getFieldValue("END")?"indexOf":"lastIndexOf",i=o.JavaScript.valueToCode(t,"FIND",o.JavaScript.ORDER_NONE)||"''";return e=(o.JavaScript.valueToCode(t,"VALUE",o.JavaScript.ORDER_MEMBER)||"''")+"."+e+"("+i+")",t.workspace.options.oneBasedIndex?[e+" + 1",o.JavaScript.ORDER_ADDITION]:[e,o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.text_charAt=function(t){var e=t.getFieldValue("WHERE")||"FROM_START",i=o.JavaScript.valueToCode(t,"VALUE","RANDOM"==e?o.JavaScript.ORDER_NONE:o.JavaScript.ORDER_MEMBER)||"''";switch(e){case"FIRST":return[i+".charAt(0)",o.JavaScript.ORDER_FUNCTION_CALL];case"LAST":return[i+".slice(-1)",o.JavaScript.ORDER_FUNCTION_CALL];case"FROM_START":return[i+".charAt("+(t=o.JavaScript.getAdjusted(t,"AT"))+")",o.JavaScript.ORDER_FUNCTION_CALL];case"FROM_END":return[i+".slice("+(t=o.JavaScript.getAdjusted(t,"AT",1,!0))+").charAt(0)",o.JavaScript.ORDER_FUNCTION_CALL];case"RANDOM":return[o.JavaScript.provideFunction_("textRandomLetter",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(text) {","  var x = Math.floor(Math.random() * text.length);","  return text[x];","}"])+"("+i+")",o.JavaScript.ORDER_FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},o.JavaScript.text.getIndex_=function(t,e,o){return"FIRST"==e?"0":"FROM_END"==e?t+".length - 1 - "+o:"LAST"==e?t+".length - 1":o},o.JavaScript.text_getSubstring=function(t){var e=t.getFieldValue("WHERE1"),i=t.getFieldValue("WHERE2"),n="FROM_END"!=e&&"LAST"!=e&&"FROM_END"!=i&&"LAST"!=i,r=o.JavaScript.valueToCode(t,"STRING",n?o.JavaScript.ORDER_MEMBER:o.JavaScript.ORDER_NONE)||"''";if("FIRST"==e&&"LAST"==i)return[r,o.JavaScript.ORDER_NONE];if(r.match(/^'?\w+'?$/)||n){switch(e){case"FROM_START":n=o.JavaScript.getAdjusted(t,"AT1");break;case"FROM_END":n=r+".length - "+(n=o.JavaScript.getAdjusted(t,"AT1",1,!1,o.JavaScript.ORDER_SUBTRACTION));break;case"FIRST":n="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(i){case"FROM_START":t=o.JavaScript.getAdjusted(t,"AT2",1);break;case"FROM_END":t=r+".length - "+(t=o.JavaScript.getAdjusted(t,"AT2",0,!1,o.JavaScript.ORDER_SUBTRACTION));break;case"LAST":t=r+".length";break;default:throw Error("Unhandled option (text_getSubstring).")}e=r+".slice("+n+", "+t+")"}else{n=o.JavaScript.getAdjusted(t,"AT1"),t=o.JavaScript.getAdjusted(t,"AT2");var s=o.JavaScript.text.getIndex_,a={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};e=o.JavaScript.provideFunction_("subsequence"+a[e]+a[i],["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(sequence"+("FROM_END"==e||"FROM_START"==e?", at1":"")+("FROM_END"==i||"FROM_START"==i?", at2":"")+") {","  var start = "+s("sequence",e,"at1")+";","  var end = "+s("sequence",i,"at2")+" + 1;","  return sequence.slice(start, end);","}"])+"("+r+("FROM_END"==e||"FROM_START"==e?", "+n:"")+("FROM_END"==i||"FROM_START"==i?", "+t:"")+")"}return[e,o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.text_changeCase=function(t){var e={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[t.getFieldValue("CASE")];return t=o.JavaScript.valueToCode(t,"TEXT",e?o.JavaScript.ORDER_MEMBER:o.JavaScript.ORDER_NONE)||"''",[e?t+e:o.JavaScript.provideFunction_("textToTitleCase",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(str) {","  return str.replace(/\\S+/g,","      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});","}"])+"("+t+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.text_trim=function(t){var e={LEFT:".replace(/^[\\s\\xa0]+/, '')",RIGHT:".replace(/[\\s\\xa0]+$/, '')",BOTH:".trim()"}[t.getFieldValue("MODE")];return[(o.JavaScript.valueToCode(t,"TEXT",o.JavaScript.ORDER_MEMBER)||"''")+e,o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.text_print=function(t){return"window.alert("+(o.JavaScript.valueToCode(t,"TEXT",o.JavaScript.ORDER_NONE)||"''")+");\n"},o.JavaScript.text_prompt_ext=function(t){var e="window.prompt("+(t.getField("TEXT")?o.JavaScript.quote_(t.getFieldValue("TEXT")):o.JavaScript.valueToCode(t,"TEXT",o.JavaScript.ORDER_NONE)||"''")+")";return"NUMBER"==t.getFieldValue("TYPE")&&(e="Number("+e+")"),[e,o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.text_prompt=o.JavaScript.text_prompt_ext,o.JavaScript.text_count=function(t){var e=o.JavaScript.valueToCode(t,"TEXT",o.JavaScript.ORDER_NONE)||"''";return t=o.JavaScript.valueToCode(t,"SUB",o.JavaScript.ORDER_NONE)||"''",[o.JavaScript.provideFunction_("textCount",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(haystack, needle) {","  if (needle.length === 0) {","    return haystack.length + 1;","  } else {","    return haystack.split(needle).length - 1;","  }","}"])+"("+e+", "+t+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.text_replace=function(t){var e=o.JavaScript.valueToCode(t,"TEXT",o.JavaScript.ORDER_NONE)||"''",i=o.JavaScript.valueToCode(t,"FROM",o.JavaScript.ORDER_NONE)||"''";return t=o.JavaScript.valueToCode(t,"TO",o.JavaScript.ORDER_NONE)||"''",[o.JavaScript.provideFunction_("textReplace",["function "+o.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(haystack, needle, replacement) {",'  needle = needle.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g,"\\\\$1")','                 .replace(/\\x08/g,"\\\\x08");',"  return haystack.replace(new RegExp(needle, 'g'), replacement);","}"])+"("+e+", "+i+", "+t+")",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.text_reverse=function(t){return[(o.JavaScript.valueToCode(t,"TEXT",o.JavaScript.ORDER_MEMBER)||"''")+".split('').reverse().join('')",o.JavaScript.ORDER_FUNCTION_CALL]},o.JavaScript.variables={},o.JavaScript.variables_get=function(t){return[o.JavaScript.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),o.JavaScript.ORDER_ATOMIC]},o.JavaScript.variables_set=function(t){var e=o.JavaScript.valueToCode(t,"VALUE",o.JavaScript.ORDER_ASSIGNMENT)||"0";return o.JavaScript.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME)+" = "+e+";\n"},o.JavaScript.variablesDynamic={},o.JavaScript.variables_get_dynamic=o.JavaScript.variables_get,o.JavaScript.variables_set_dynamic=o.JavaScript.variables_set,o.JavaScript)})),tt=G((function(t,e){var o;t.exports=(o=Q,j.JavaScript=o,o)})),et=G((function(t,e){var o;t.exports=((o=K).Python=new o.Generator("Python"),o.Python.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip"),o.Python.ORDER_ATOMIC=0,o.Python.ORDER_COLLECTION=1,o.Python.ORDER_STRING_CONVERSION=1,o.Python.ORDER_MEMBER=2.1,o.Python.ORDER_FUNCTION_CALL=2.2,o.Python.ORDER_EXPONENTIATION=3,o.Python.ORDER_UNARY_SIGN=4,o.Python.ORDER_BITWISE_NOT=4,o.Python.ORDER_MULTIPLICATIVE=5,o.Python.ORDER_ADDITIVE=6,o.Python.ORDER_BITWISE_SHIFT=7,o.Python.ORDER_BITWISE_AND=8,o.Python.ORDER_BITWISE_XOR=9,o.Python.ORDER_BITWISE_OR=10,o.Python.ORDER_RELATIONAL=11,o.Python.ORDER_LOGICAL_NOT=12,o.Python.ORDER_LOGICAL_AND=13,o.Python.ORDER_LOGICAL_OR=14,o.Python.ORDER_CONDITIONAL=15,o.Python.ORDER_LAMBDA=16,o.Python.ORDER_NONE=99,o.Python.ORDER_OVERRIDES=[[o.Python.ORDER_FUNCTION_CALL,o.Python.ORDER_MEMBER],[o.Python.ORDER_FUNCTION_CALL,o.Python.ORDER_FUNCTION_CALL],[o.Python.ORDER_MEMBER,o.Python.ORDER_MEMBER],[o.Python.ORDER_MEMBER,o.Python.ORDER_FUNCTION_CALL],[o.Python.ORDER_LOGICAL_NOT,o.Python.ORDER_LOGICAL_NOT],[o.Python.ORDER_LOGICAL_AND,o.Python.ORDER_LOGICAL_AND],[o.Python.ORDER_LOGICAL_OR,o.Python.ORDER_LOGICAL_OR]],o.Python.isInitialized=!1,o.Python.init=function(t){o.Python.PASS=this.INDENT+"pass\n",o.Python.definitions_=Object.create(null),o.Python.functionNames_=Object.create(null),o.Python.variableDB_?o.Python.variableDB_.reset():o.Python.variableDB_=new o.Names(o.Python.RESERVED_WORDS_),o.Python.variableDB_.setVariableMap(t.getVariableMap());for(var e=[],i=o.Variables.allDeveloperVariables(t),n=0;n<i.length;n++)e.push(o.Python.variableDB_.getName(i[n],o.Names.DEVELOPER_VARIABLE_TYPE)+" = None");for(t=o.Variables.allUsedVarModels(t),n=0;n<t.length;n++)e.push(o.Python.variableDB_.getName(t[n].getId(),o.VARIABLE_CATEGORY_NAME)+" = None");o.Python.definitions_.variables=e.join("\n"),this.isInitialized=!0},o.Python.finish=function(t){var e,i=[],n=[];for(e in o.Python.definitions_){var r=o.Python.definitions_[e];r.match(/^(from\s+\S+\s+)?import\s+\S+/)?i.push(r):n.push(r)}return delete o.Python.definitions_,delete o.Python.functionNames_,o.Python.variableDB_.reset(),(i.join("\n")+"\n\n"+n.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+t},o.Python.scrubNakedValue=function(t){return t+"\n"},o.Python.quote_=function(t){var e="'";return-1!==(t=t.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n")).indexOf("'")&&(-1===t.indexOf('"')?e='"':t=t.replace(/'/g,"\\'")),e+t+e},o.Python.multiline_quote_=function(t){return t.split(/\n/g).map(o.Python.quote_).join(" + '\\n' + \n")},o.Python.scrub_=function(t,e,i){var n="";if(!t.outputConnection||!t.outputConnection.targetConnection){var r=t.getCommentText();r&&(r=o.utils.string.wrap(r,o.Python.COMMENT_WRAP-3),n+=o.Python.prefixLines(r+"\n","# "));for(var s=0;s<t.inputList.length;s++)t.inputList[s].type==o.INPUT_VALUE&&(r=t.inputList[s].connection.targetBlock())&&(r=o.Python.allNestedComments(r))&&(n+=o.Python.prefixLines(r,"# "))}return t=t.nextConnection&&t.nextConnection.targetBlock(),n+e+(i=i?"":o.Python.blockToCode(t))},o.Python.getAdjustedInt=function(t,e,i,n){i=i||0,t.workspace.options.oneBasedIndex&&i--;var r=t.workspace.options.oneBasedIndex?"1":"0";return t=o.Python.valueToCode(t,e,i?o.Python.ORDER_ADDITIVE:o.Python.ORDER_NONE)||r,o.isNumber(t)?(t=parseInt(t,10)+i,n&&(t=-t)):(t=0<i?"int("+t+" + "+i+")":0>i?"int("+t+" - "+-i+")":"int("+t+")",n&&(t="-"+t)),t},o.Python.colour={},o.Python.colour_picker=function(t){return[o.Python.quote_(t.getFieldValue("COLOUR")),o.Python.ORDER_ATOMIC]},o.Python.colour_random=function(t){return o.Python.definitions_.import_random="import random",["'#%06x' % random.randint(0, 2**24 - 1)",o.Python.ORDER_FUNCTION_CALL]},o.Python.colour_rgb=function(t){return[o.Python.provideFunction_("colour_rgb",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(r, g, b):","  r = round(min(100, max(0, r)) * 2.55)","  g = round(min(100, max(0, g)) * 2.55)","  b = round(min(100, max(0, b)) * 2.55)","  return '#%02x%02x%02x' % (r, g, b)"])+"("+(o.Python.valueToCode(t,"RED",o.Python.ORDER_NONE)||0)+", "+(o.Python.valueToCode(t,"GREEN",o.Python.ORDER_NONE)||0)+", "+(t=o.Python.valueToCode(t,"BLUE",o.Python.ORDER_NONE)||0)+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.colour_blend=function(t){return[o.Python.provideFunction_("colour_blend",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(colour1, colour2, ratio):","  r1, r2 = int(colour1[1:3], 16), int(colour2[1:3], 16)","  g1, g2 = int(colour1[3:5], 16), int(colour2[3:5], 16)","  b1, b2 = int(colour1[5:7], 16), int(colour2[5:7], 16)","  ratio = min(1, max(0, ratio))","  r = round(r1 * (1 - ratio) + r2 * ratio)","  g = round(g1 * (1 - ratio) + g2 * ratio)","  b = round(b1 * (1 - ratio) + b2 * ratio)","  return '#%02x%02x%02x' % (r, g, b)"])+"("+(o.Python.valueToCode(t,"COLOUR1",o.Python.ORDER_NONE)||"'#000000'")+", "+(o.Python.valueToCode(t,"COLOUR2",o.Python.ORDER_NONE)||"'#000000'")+", "+(t=o.Python.valueToCode(t,"RATIO",o.Python.ORDER_NONE)||0)+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.lists={},o.Python.lists_create_empty=function(t){return["[]",o.Python.ORDER_ATOMIC]},o.Python.lists_create_with=function(t){for(var e=Array(t.itemCount_),i=0;i<t.itemCount_;i++)e[i]=o.Python.valueToCode(t,"ADD"+i,o.Python.ORDER_NONE)||"None";return["["+e.join(", ")+"]",o.Python.ORDER_ATOMIC]},o.Python.lists_repeat=function(t){return["["+(o.Python.valueToCode(t,"ITEM",o.Python.ORDER_NONE)||"None")+"] * "+(t=o.Python.valueToCode(t,"NUM",o.Python.ORDER_MULTIPLICATIVE)||"0"),o.Python.ORDER_MULTIPLICATIVE]},o.Python.lists_length=function(t){return["len("+(o.Python.valueToCode(t,"VALUE",o.Python.ORDER_NONE)||"[]")+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.lists_isEmpty=function(t){return["not len("+(o.Python.valueToCode(t,"VALUE",o.Python.ORDER_NONE)||"[]")+")",o.Python.ORDER_LOGICAL_NOT]},o.Python.lists_indexOf=function(t){var e=o.Python.valueToCode(t,"FIND",o.Python.ORDER_NONE)||"[]",i=o.Python.valueToCode(t,"VALUE",o.Python.ORDER_NONE)||"''";if(t.workspace.options.oneBasedIndex)var n=" 0",r=" + 1",s="";else n=" -1",r="",s=" - 1";return"FIRST"==t.getFieldValue("END")?[(t=o.Python.provideFunction_("first_index",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(my_list, elem):","  try: index = my_list.index(elem)"+r,"  except: index ="+n,"  return index"]))+"("+i+", "+e+")",o.Python.ORDER_FUNCTION_CALL]:[(t=o.Python.provideFunction_("last_index",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(my_list, elem):","  try: index = len(my_list) - my_list[::-1].index(elem)"+s,"  except: index ="+n,"  return index"]))+"("+i+", "+e+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.lists_getIndex=function(t){var e=t.getFieldValue("MODE")||"GET",i=t.getFieldValue("WHERE")||"FROM_START",n=o.Python.valueToCode(t,"VALUE","RANDOM"==i?o.Python.ORDER_NONE:o.Python.ORDER_MEMBER)||"[]";switch(i){case"FIRST":if("GET"==e)return[n+"[0]",o.Python.ORDER_MEMBER];if("GET_REMOVE"==e)return[n+".pop(0)",o.Python.ORDER_FUNCTION_CALL];if("REMOVE"==e)return n+".pop(0)\n";break;case"LAST":if("GET"==e)return[n+"[-1]",o.Python.ORDER_MEMBER];if("GET_REMOVE"==e)return[n+".pop()",o.Python.ORDER_FUNCTION_CALL];if("REMOVE"==e)return n+".pop()\n";break;case"FROM_START":if(t=o.Python.getAdjustedInt(t,"AT"),"GET"==e)return[n+"["+t+"]",o.Python.ORDER_MEMBER];if("GET_REMOVE"==e)return[n+".pop("+t+")",o.Python.ORDER_FUNCTION_CALL];if("REMOVE"==e)return n+".pop("+t+")\n";break;case"FROM_END":if(t=o.Python.getAdjustedInt(t,"AT",1,!0),"GET"==e)return[n+"["+t+"]",o.Python.ORDER_MEMBER];if("GET_REMOVE"==e)return[n+".pop("+t+")",o.Python.ORDER_FUNCTION_CALL];if("REMOVE"==e)return n+".pop("+t+")\n";break;case"RANDOM":if(o.Python.definitions_.import_random="import random","GET"==e)return["random.choice("+n+")",o.Python.ORDER_FUNCTION_CALL];if(n=o.Python.provideFunction_("lists_remove_random_item",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(myList):","  x = int(random.random() * len(myList))","  return myList.pop(x)"])+"("+n+")","GET_REMOVE"==e)return[n,o.Python.ORDER_FUNCTION_CALL];if("REMOVE"==e)return n+"\n"}throw Error("Unhandled combination (lists_getIndex).")},o.Python.lists_setIndex=function(t){var e=o.Python.valueToCode(t,"LIST",o.Python.ORDER_MEMBER)||"[]",i=t.getFieldValue("MODE")||"GET",n=t.getFieldValue("WHERE")||"FROM_START",r=o.Python.valueToCode(t,"TO",o.Python.ORDER_NONE)||"None";switch(n){case"FIRST":if("SET"==i)return e+"[0] = "+r+"\n";if("INSERT"==i)return e+".insert(0, "+r+")\n";break;case"LAST":if("SET"==i)return e+"[-1] = "+r+"\n";if("INSERT"==i)return e+".append("+r+")\n";break;case"FROM_START":if(t=o.Python.getAdjustedInt(t,"AT"),"SET"==i)return e+"["+t+"] = "+r+"\n";if("INSERT"==i)return e+".insert("+t+", "+r+")\n";break;case"FROM_END":if(t=o.Python.getAdjustedInt(t,"AT",1,!0),"SET"==i)return e+"["+t+"] = "+r+"\n";if("INSERT"==i)return e+".insert("+t+", "+r+")\n";break;case"RANDOM":if(o.Python.definitions_.import_random="import random",e.match(/^\w+$/)?t="":(n=(t=o.Python.variableDB_.getDistinctName("tmp_list",o.VARIABLE_CATEGORY_NAME))+" = "+e+"\n",e=t,t=n),t+=(n=o.Python.variableDB_.getDistinctName("tmp_x",o.VARIABLE_CATEGORY_NAME))+" = int(random.random() * len("+e+"))\n","SET"==i)return t+(e+"[")+n+"] = "+r+"\n";if("INSERT"==i)return t+(e+".insert(")+n+", "+r+")\n"}throw Error("Unhandled combination (lists_setIndex).")},o.Python.lists_getSublist=function(t){var e=o.Python.valueToCode(t,"LIST",o.Python.ORDER_MEMBER)||"[]",i=t.getFieldValue("WHERE1"),n=t.getFieldValue("WHERE2");switch(i){case"FROM_START":"0"==(i=o.Python.getAdjustedInt(t,"AT1"))&&(i="");break;case"FROM_END":i=o.Python.getAdjustedInt(t,"AT1",1,!0);break;case"FIRST":i="";break;default:throw Error("Unhandled option (lists_getSublist)")}switch(n){case"FROM_START":t=o.Python.getAdjustedInt(t,"AT2",1);break;case"FROM_END":t=o.Python.getAdjustedInt(t,"AT2",0,!0),o.isNumber(String(t))?"0"==t&&(t=""):(o.Python.definitions_.import_sys="import sys",t+=" or sys.maxsize");break;case"LAST":t="";break;default:throw Error("Unhandled option (lists_getSublist)")}return[e+"["+i+" : "+t+"]",o.Python.ORDER_MEMBER]},o.Python.lists_sort=function(t){var e=o.Python.valueToCode(t,"LIST",o.Python.ORDER_NONE)||"[]",i=t.getFieldValue("TYPE");return t="1"===t.getFieldValue("DIRECTION")?"False":"True",[o.Python.provideFunction_("lists_sort",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(my_list, type, reverse):","  def try_float(s):","    try:","      return float(s)","    except:","      return 0","  key_funcs = {",'    "NUMERIC": try_float,','    "TEXT": str,','    "IGNORE_CASE": lambda s: str(s).lower()',"  }","  key_func = key_funcs[type]","  list_cpy = list(my_list)","  return sorted(list_cpy, key=key_func, reverse=reverse)"])+"("+e+', "'+i+'", '+t+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.lists_split=function(t){var e=t.getFieldValue("MODE");if("SPLIT"==e)t=(e=o.Python.valueToCode(t,"INPUT",o.Python.ORDER_MEMBER)||"''")+".split("+(t=o.Python.valueToCode(t,"DELIM",o.Python.ORDER_NONE))+")";else{if("JOIN"!=e)throw Error("Unknown mode: "+e);e=o.Python.valueToCode(t,"INPUT",o.Python.ORDER_NONE)||"[]",t=(t=o.Python.valueToCode(t,"DELIM",o.Python.ORDER_MEMBER)||"''")+".join("+e+")"}return[t,o.Python.ORDER_FUNCTION_CALL]},o.Python.lists_reverse=function(t){return["list(reversed("+(o.Python.valueToCode(t,"LIST",o.Python.ORDER_NONE)||"[]")+"))",o.Python.ORDER_FUNCTION_CALL]},o.Python.logic={},o.Python.controls_if=function(t){var e=0,i="";o.Python.STATEMENT_PREFIX&&(i+=o.Python.injectId(o.Python.STATEMENT_PREFIX,t));do{var n=o.Python.valueToCode(t,"IF"+e,o.Python.ORDER_NONE)||"False",r=o.Python.statementToCode(t,"DO"+e)||o.Python.PASS;o.Python.STATEMENT_SUFFIX&&(r=o.Python.prefixLines(o.Python.injectId(o.Python.STATEMENT_SUFFIX,t),o.Python.INDENT)+r),i+=(0==e?"if ":"elif ")+n+":\n"+r,++e}while(t.getInput("IF"+e));return(t.getInput("ELSE")||o.Python.STATEMENT_SUFFIX)&&(r=o.Python.statementToCode(t,"ELSE")||o.Python.PASS,o.Python.STATEMENT_SUFFIX&&(r=o.Python.prefixLines(o.Python.injectId(o.Python.STATEMENT_SUFFIX,t),o.Python.INDENT)+r),i+="else:\n"+r),i},o.Python.controls_ifelse=o.Python.controls_if,o.Python.logic_compare=function(t){var e={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[t.getFieldValue("OP")],i=o.Python.ORDER_RELATIONAL;return[(o.Python.valueToCode(t,"A",i)||"0")+" "+e+" "+(t=o.Python.valueToCode(t,"B",i)||"0"),i]},o.Python.logic_operation=function(t){var e="AND"==t.getFieldValue("OP")?"and":"or",i="and"==e?o.Python.ORDER_LOGICAL_AND:o.Python.ORDER_LOGICAL_OR,n=o.Python.valueToCode(t,"A",i);if(t=o.Python.valueToCode(t,"B",i),n||t){var r="and"==e?"True":"False";n||(n=r),t||(t=r)}else t=n="False";return[n+" "+e+" "+t,i]},o.Python.logic_negate=function(t){return["not "+(o.Python.valueToCode(t,"BOOL",o.Python.ORDER_LOGICAL_NOT)||"True"),o.Python.ORDER_LOGICAL_NOT]},o.Python.logic_boolean=function(t){return["TRUE"==t.getFieldValue("BOOL")?"True":"False",o.Python.ORDER_ATOMIC]},o.Python.logic_null=function(t){return["None",o.Python.ORDER_ATOMIC]},o.Python.logic_ternary=function(t){var e=o.Python.valueToCode(t,"IF",o.Python.ORDER_CONDITIONAL)||"False";return[(o.Python.valueToCode(t,"THEN",o.Python.ORDER_CONDITIONAL)||"None")+" if "+e+" else "+(t=o.Python.valueToCode(t,"ELSE",o.Python.ORDER_CONDITIONAL)||"None"),o.Python.ORDER_CONDITIONAL]},o.Python.loops={},o.Python.controls_repeat_ext=function(t){var e=t.getField("TIMES")?String(parseInt(t.getFieldValue("TIMES"),10)):o.Python.valueToCode(t,"TIMES",o.Python.ORDER_NONE)||"0";e=o.isNumber(e)?parseInt(e,10):"int("+e+")";var i=o.Python.statementToCode(t,"DO");return i=o.Python.addLoopTrap(i,t)||o.Python.PASS,"for "+o.Python.variableDB_.getDistinctName("count",o.VARIABLE_CATEGORY_NAME)+" in range("+e+"):\n"+i},o.Python.controls_repeat=o.Python.controls_repeat_ext,o.Python.controls_whileUntil=function(t){var e="UNTIL"==t.getFieldValue("MODE"),i=o.Python.valueToCode(t,"BOOL",e?o.Python.ORDER_LOGICAL_NOT:o.Python.ORDER_NONE)||"False",n=o.Python.statementToCode(t,"DO");return e&&(i="not "+i),"while "+i+":\n"+(n=o.Python.addLoopTrap(n,t)||o.Python.PASS)},o.Python.controls_for=function(t){var e=o.Python.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),i=o.Python.valueToCode(t,"FROM",o.Python.ORDER_NONE)||"0",n=o.Python.valueToCode(t,"TO",o.Python.ORDER_NONE)||"0",r=o.Python.valueToCode(t,"BY",o.Python.ORDER_NONE)||"1",s=o.Python.statementToCode(t,"DO");s=o.Python.addLoopTrap(s,t)||o.Python.PASS;var a="",l=function(){return o.Python.provideFunction_("upRange",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(start, stop, step):","  while start <= stop:","    yield start","    start += abs(step)"])},c=function(){return o.Python.provideFunction_("downRange",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(start, stop, step):","  while start >= stop:","    yield start","    start -= abs(step)"])};if(t=function(t,e,o){return"("+t+" <= "+e+") and "+l()+"("+t+", "+e+", "+o+") or "+c()+"("+t+", "+e+", "+o+")"},o.isNumber(i)&&o.isNumber(n)&&o.isNumber(r))i=Number(i),n=Number(n),r=Math.abs(Number(r)),0==i%1&&0==n%1&&0==r%1?(i<=n?(n++,t=0==i&&1==r?n:i+", "+n,1!=r&&(t+=", "+r)):t=i+", "+--n+", -"+r,t="range("+t+")"):(t=i<n?l():c(),t+="("+i+", "+n+", "+r+")");else{var u=function(t,i){return o.isNumber(t)?t=Number(t):t.match(/^\w+$/)?t="float("+t+")":(i=o.Python.variableDB_.getDistinctName(e+i,o.VARIABLE_CATEGORY_NAME),a+=i+" = float("+t+")\n",t=i),t};i=u(i,"_start"),n=u(n,"_end"),r=u(r,"_inc"),"number"==typeof i&&"number"==typeof n?(t=i<n?l():c(),t+="("+i+", "+n+", "+r+")"):t=t(i,n,r)}return a+="for "+e+" in "+t+":\n"+s},o.Python.controls_forEach=function(t){var e=o.Python.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),i=o.Python.valueToCode(t,"LIST",o.Python.ORDER_RELATIONAL)||"[]",n=o.Python.statementToCode(t,"DO");return"for "+e+" in "+i+":\n"+(n=o.Python.addLoopTrap(n,t)||o.Python.PASS)},o.Python.controls_flow_statements=function(t){var e="";if(o.Python.STATEMENT_PREFIX&&(e+=o.Python.injectId(o.Python.STATEMENT_PREFIX,t)),o.Python.STATEMENT_SUFFIX&&(e+=o.Python.injectId(o.Python.STATEMENT_SUFFIX,t)),o.Python.STATEMENT_PREFIX){var i=o.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(t);i&&!i.suppressPrefixSuffix&&(e+=o.Python.injectId(o.Python.STATEMENT_PREFIX,i))}switch(t.getFieldValue("FLOW")){case"BREAK":return e+"break\n";case"CONTINUE":return e+"continue\n"}throw Error("Unknown flow statement.")},o.Python.math={},o.Python.addReservedWords("math,random,Number"),o.Python.math_number=function(t){if(1/0==(t=Number(t.getFieldValue("NUM")))){t='float("inf")';var e=o.Python.ORDER_FUNCTION_CALL}else-1/0==t?(t='-float("inf")',e=o.Python.ORDER_UNARY_SIGN):e=0>t?o.Python.ORDER_UNARY_SIGN:o.Python.ORDER_ATOMIC;return[t,e]},o.Python.math_arithmetic=function(t){var e={ADD:[" + ",o.Python.ORDER_ADDITIVE],MINUS:[" - ",o.Python.ORDER_ADDITIVE],MULTIPLY:[" * ",o.Python.ORDER_MULTIPLICATIVE],DIVIDE:[" / ",o.Python.ORDER_MULTIPLICATIVE],POWER:[" ** ",o.Python.ORDER_EXPONENTIATION]}[t.getFieldValue("OP")],i=e[0];return e=e[1],[(o.Python.valueToCode(t,"A",e)||"0")+i+(t=o.Python.valueToCode(t,"B",e)||"0"),e]},o.Python.math_single=function(t){var e=t.getFieldValue("OP");if("NEG"==e){var i=o.Python.valueToCode(t,"NUM",o.Python.ORDER_UNARY_SIGN)||"0";return["-"+i,o.Python.ORDER_UNARY_SIGN]}switch(o.Python.definitions_.import_math="import math",t="SIN"==e||"COS"==e||"TAN"==e?o.Python.valueToCode(t,"NUM",o.Python.ORDER_MULTIPLICATIVE)||"0":o.Python.valueToCode(t,"NUM",o.Python.ORDER_NONE)||"0",e){case"ABS":i="math.fabs("+t+")";break;case"ROOT":i="math.sqrt("+t+")";break;case"LN":i="math.log("+t+")";break;case"LOG10":i="math.log10("+t+")";break;case"EXP":i="math.exp("+t+")";break;case"POW10":i="math.pow(10,"+t+")";break;case"ROUND":i="round("+t+")";break;case"ROUNDUP":i="math.ceil("+t+")";break;case"ROUNDDOWN":i="math.floor("+t+")";break;case"SIN":i="math.sin("+t+" / 180.0 * math.pi)";break;case"COS":i="math.cos("+t+" / 180.0 * math.pi)";break;case"TAN":i="math.tan("+t+" / 180.0 * math.pi)"}if(i)return[i,o.Python.ORDER_FUNCTION_CALL];switch(e){case"ASIN":i="math.asin("+t+") / math.pi * 180";break;case"ACOS":i="math.acos("+t+") / math.pi * 180";break;case"ATAN":i="math.atan("+t+") / math.pi * 180";break;default:throw Error("Unknown math operator: "+e)}return[i,o.Python.ORDER_MULTIPLICATIVE]},o.Python.math_constant=function(t){var e={PI:["math.pi",o.Python.ORDER_MEMBER],E:["math.e",o.Python.ORDER_MEMBER],GOLDEN_RATIO:["(1 + math.sqrt(5)) / 2",o.Python.ORDER_MULTIPLICATIVE],SQRT2:["math.sqrt(2)",o.Python.ORDER_MEMBER],SQRT1_2:["math.sqrt(1.0 / 2)",o.Python.ORDER_MEMBER],INFINITY:["float('inf')",o.Python.ORDER_ATOMIC]};return"INFINITY"!=(t=t.getFieldValue("CONSTANT"))&&(o.Python.definitions_.import_math="import math"),e[t]},o.Python.math_number_property=function(t){var e=o.Python.valueToCode(t,"NUMBER_TO_CHECK",o.Python.ORDER_MULTIPLICATIVE)||"0",i=t.getFieldValue("PROPERTY");if("PRIME"==i)return o.Python.definitions_.import_math="import math",o.Python.definitions_.from_numbers_import_Number="from numbers import Number",[o.Python.provideFunction_("math_isPrime",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(n):","  # https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  # If n is not a number but a string, try parsing it.","  if not isinstance(n, Number):","    try:","      n = float(n)","    except:","      return False","  if n == 2 or n == 3:","    return True","  # False if n is negative, is 1, or not whole, or if n is divisible by 2 or 3.","  if n <= 1 or n % 1 != 0 or n % 2 == 0 or n % 3 == 0:","    return False","  # Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for x in range(6, int(math.sqrt(n)) + 2, 6):","    if n % (x - 1) == 0 or n % (x + 1) == 0:","      return False","  return True"])+"("+e+")",o.Python.ORDER_FUNCTION_CALL];switch(i){case"EVEN":var n=e+" % 2 == 0";break;case"ODD":n=e+" % 2 == 1";break;case"WHOLE":n=e+" % 1 == 0";break;case"POSITIVE":n=e+" > 0";break;case"NEGATIVE":n=e+" < 0";break;case"DIVISIBLE_BY":if(!(t=o.Python.valueToCode(t,"DIVISOR",o.Python.ORDER_MULTIPLICATIVE))||"0"==t)return["False",o.Python.ORDER_ATOMIC];n=e+" % "+t+" == 0"}return[n,o.Python.ORDER_RELATIONAL]},o.Python.math_change=function(t){o.Python.definitions_.from_numbers_import_Number="from numbers import Number";var e=o.Python.valueToCode(t,"DELTA",o.Python.ORDER_ADDITIVE)||"0";return(t=o.Python.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME))+" = ("+t+" if isinstance("+t+", Number) else 0) + "+e+"\n"},o.Python.math_round=o.Python.math_single,o.Python.math_trig=o.Python.math_single,o.Python.math_on_list=function(t){var e=t.getFieldValue("OP");switch(t=o.Python.valueToCode(t,"LIST",o.Python.ORDER_NONE)||"[]",e){case"SUM":e="sum("+t+")";break;case"MIN":e="min("+t+")";break;case"MAX":e="max("+t+")";break;case"AVERAGE":o.Python.definitions_.from_numbers_import_Number="from numbers import Number",e=(e=o.Python.provideFunction_("math_mean",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(myList):","  localList = [e for e in myList if isinstance(e, Number)]","  if not localList: return","  return float(sum(localList)) / len(localList)"]))+"("+t+")";break;case"MEDIAN":o.Python.definitions_.from_numbers_import_Number="from numbers import Number",e=(e=o.Python.provideFunction_("math_median",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(myList):","  localList = sorted([e for e in myList if isinstance(e, Number)])","  if not localList: return","  if len(localList) % 2 == 0:","    return (localList[len(localList) // 2 - 1] + localList[len(localList) // 2]) / 2.0","  else:","    return localList[(len(localList) - 1) // 2]"]))+"("+t+")";break;case"MODE":e=(e=o.Python.provideFunction_("math_modes",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(some_list):","  modes = []","  # Using a lists of [item, count] to keep count rather than dict",'  # to avoid "unhashable" errors when the counted item is itself a list or dict.',"  counts = []","  maxCount = 1","  for item in some_list:","    found = False","    for count in counts:","      if count[0] == item:","        count[1] += 1","        maxCount = max(maxCount, count[1])","        found = True","    if not found:","      counts.append([item, 1])","  for counted_item, item_count in counts:","    if item_count == maxCount:","      modes.append(counted_item)","  return modes"]))+"("+t+")";break;case"STD_DEV":o.Python.definitions_.import_math="import math",e=(e=o.Python.provideFunction_("math_standard_deviation",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(numbers):","  n = len(numbers)","  if n == 0: return","  mean = float(sum(numbers)) / n","  variance = sum((x - mean) ** 2 for x in numbers) / n","  return math.sqrt(variance)"]))+"("+t+")";break;case"RANDOM":o.Python.definitions_.import_random="import random",e="random.choice("+t+")";break;default:throw Error("Unknown operator: "+e)}return[e,o.Python.ORDER_FUNCTION_CALL]},o.Python.math_modulo=function(t){return[(o.Python.valueToCode(t,"DIVIDEND",o.Python.ORDER_MULTIPLICATIVE)||"0")+" % "+(t=o.Python.valueToCode(t,"DIVISOR",o.Python.ORDER_MULTIPLICATIVE)||"0"),o.Python.ORDER_MULTIPLICATIVE]},o.Python.math_constrain=function(t){return["min(max("+(o.Python.valueToCode(t,"VALUE",o.Python.ORDER_NONE)||"0")+", "+(o.Python.valueToCode(t,"LOW",o.Python.ORDER_NONE)||"0")+"), "+(t=o.Python.valueToCode(t,"HIGH",o.Python.ORDER_NONE)||"float('inf')")+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.math_random_int=function(t){return o.Python.definitions_.import_random="import random",["random.randint("+(o.Python.valueToCode(t,"FROM",o.Python.ORDER_NONE)||"0")+", "+(t=o.Python.valueToCode(t,"TO",o.Python.ORDER_NONE)||"0")+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.math_random_float=function(t){return o.Python.definitions_.import_random="import random",["random.random()",o.Python.ORDER_FUNCTION_CALL]},o.Python.math_atan2=function(t){o.Python.definitions_.import_math="import math";var e=o.Python.valueToCode(t,"X",o.Python.ORDER_NONE)||"0";return["math.atan2("+(o.Python.valueToCode(t,"Y",o.Python.ORDER_NONE)||"0")+", "+e+") / math.pi * 180",o.Python.ORDER_MULTIPLICATIVE]},o.Python.procedures={},o.Python.procedures_defreturn=function(t){for(var e,i=[],n=t.workspace,r=o.Variables.allUsedVarModels(n)||[],s=0;e=r[s];s++)e=e.name,-1==t.getVars().indexOf(e)&&i.push(o.Python.variableDB_.getName(e,o.VARIABLE_CATEGORY_NAME));for(r=o.Variables.allDeveloperVariables(n),s=0;s<r.length;s++)i.push(o.Python.variableDB_.getName(r[s],o.Names.DEVELOPER_VARIABLE_TYPE));i=i.length?o.Python.INDENT+"global "+i.join(", ")+"\n":"",n=o.Python.variableDB_.getName(t.getFieldValue("NAME"),o.PROCEDURE_CATEGORY_NAME),e="",o.Python.STATEMENT_PREFIX&&(e+=o.Python.injectId(o.Python.STATEMENT_PREFIX,t)),o.Python.STATEMENT_SUFFIX&&(e+=o.Python.injectId(o.Python.STATEMENT_SUFFIX,t)),e&&(e=o.Python.prefixLines(e,o.Python.INDENT));var a="";o.Python.INFINITE_LOOP_TRAP&&(a=o.Python.prefixLines(o.Python.injectId(o.Python.INFINITE_LOOP_TRAP,t),o.Python.INDENT));var l=o.Python.statementToCode(t,"STACK"),c=o.Python.valueToCode(t,"RETURN",o.Python.ORDER_NONE)||"",u="";l&&c&&(u=e),c?c=o.Python.INDENT+"return "+c+"\n":l||(l=o.Python.PASS);var h=[];for(r=t.getVars(),s=0;s<r.length;s++)h[s]=o.Python.variableDB_.getName(r[s],o.VARIABLE_CATEGORY_NAME);return i="def "+n+"("+h.join(", ")+"):\n"+i+e+a+l+u+c,i=o.Python.scrub_(t,i),o.Python.definitions_["%"+n]=i,null},o.Python.procedures_defnoreturn=o.Python.procedures_defreturn,o.Python.procedures_callreturn=function(t){for(var e=o.Python.variableDB_.getName(t.getFieldValue("NAME"),o.PROCEDURE_CATEGORY_NAME),i=[],n=t.getVars(),r=0;r<n.length;r++)i[r]=o.Python.valueToCode(t,"ARG"+r,o.Python.ORDER_NONE)||"None";return[e+"("+i.join(", ")+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.procedures_callnoreturn=function(t){return o.Python.procedures_callreturn(t)[0]+"\n"},o.Python.procedures_ifreturn=function(t){var e="if "+(o.Python.valueToCode(t,"CONDITION",o.Python.ORDER_NONE)||"False")+":\n";return o.Python.STATEMENT_SUFFIX&&(e+=o.Python.prefixLines(o.Python.injectId(o.Python.STATEMENT_SUFFIX,t),o.Python.INDENT)),t.hasReturnValue_?(t=o.Python.valueToCode(t,"VALUE",o.Python.ORDER_NONE)||"None",e+=o.Python.INDENT+"return "+t+"\n"):e+=o.Python.INDENT+"return\n",e},o.Python.texts={},o.Python.text=function(t){return[o.Python.quote_(t.getFieldValue("TEXT")),o.Python.ORDER_ATOMIC]},o.Python.text_multiline=function(t){var e=-1!=(t=o.Python.multiline_quote_(t.getFieldValue("TEXT"))).indexOf("+")?o.Python.ORDER_ADDITIVE:o.Python.ORDER_ATOMIC;return[t,e]},o.Python.text.forceString_=function(t){return o.Python.text.forceString_.strRegExp.test(t)?[t,o.Python.ORDER_ATOMIC]:["str("+t+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.text.forceString_.strRegExp=/^\s*'([^']|\\')*'\s*$/,o.Python.text_join=function(t){switch(t.itemCount_){case 0:return["''",o.Python.ORDER_ATOMIC];case 1:return t=o.Python.valueToCode(t,"ADD0",o.Python.ORDER_NONE)||"''",o.Python.text.forceString_(t);case 2:var e=o.Python.valueToCode(t,"ADD0",o.Python.ORDER_NONE)||"''";return t=o.Python.valueToCode(t,"ADD1",o.Python.ORDER_NONE)||"''",[t=o.Python.text.forceString_(e)[0]+" + "+o.Python.text.forceString_(t)[0],o.Python.ORDER_ADDITIVE];default:e=[];for(var i=0;i<t.itemCount_;i++)e[i]=o.Python.valueToCode(t,"ADD"+i,o.Python.ORDER_NONE)||"''";return[t="''.join([str("+(t=o.Python.variableDB_.getDistinctName("x",o.VARIABLE_CATEGORY_NAME))+") for "+t+" in ["+e.join(", ")+"]])",o.Python.ORDER_FUNCTION_CALL]}},o.Python.text_append=function(t){var e=o.Python.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME);return t=o.Python.valueToCode(t,"TEXT",o.Python.ORDER_NONE)||"''",e+" = str("+e+") + "+o.Python.text.forceString_(t)[0]+"\n"},o.Python.text_length=function(t){return["len("+(o.Python.valueToCode(t,"VALUE",o.Python.ORDER_NONE)||"''")+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.text_isEmpty=function(t){return["not len("+(o.Python.valueToCode(t,"VALUE",o.Python.ORDER_NONE)||"''")+")",o.Python.ORDER_LOGICAL_NOT]},o.Python.text_indexOf=function(t){var e="FIRST"==t.getFieldValue("END")?"find":"rfind",i=o.Python.valueToCode(t,"FIND",o.Python.ORDER_NONE)||"''";return e=(o.Python.valueToCode(t,"VALUE",o.Python.ORDER_MEMBER)||"''")+"."+e+"("+i+")",t.workspace.options.oneBasedIndex?[e+" + 1",o.Python.ORDER_ADDITIVE]:[e,o.Python.ORDER_FUNCTION_CALL]},o.Python.text_charAt=function(t){var e=t.getFieldValue("WHERE")||"FROM_START",i=o.Python.valueToCode(t,"VALUE","RANDOM"==e?o.Python.ORDER_NONE:o.Python.ORDER_MEMBER)||"''";switch(e){case"FIRST":return[i+"[0]",o.Python.ORDER_MEMBER];case"LAST":return[i+"[-1]",o.Python.ORDER_MEMBER];case"FROM_START":return[i+"["+(t=o.Python.getAdjustedInt(t,"AT"))+"]",o.Python.ORDER_MEMBER];case"FROM_END":return[i+"["+(t=o.Python.getAdjustedInt(t,"AT",1,!0))+"]",o.Python.ORDER_MEMBER];case"RANDOM":return o.Python.definitions_.import_random="import random",[o.Python.provideFunction_("text_random_letter",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(text):","  x = int(random.random() * len(text))","  return text[x];"])+"("+i+")",o.Python.ORDER_FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},o.Python.text_getSubstring=function(t){var e=t.getFieldValue("WHERE1"),i=t.getFieldValue("WHERE2"),n=o.Python.valueToCode(t,"STRING",o.Python.ORDER_MEMBER)||"''";switch(e){case"FROM_START":"0"==(e=o.Python.getAdjustedInt(t,"AT1"))&&(e="");break;case"FROM_END":e=o.Python.getAdjustedInt(t,"AT1",1,!0);break;case"FIRST":e="";break;default:throw Error("Unhandled option (text_getSubstring)")}switch(i){case"FROM_START":t=o.Python.getAdjustedInt(t,"AT2",1);break;case"FROM_END":t=o.Python.getAdjustedInt(t,"AT2",0,!0),o.isNumber(String(t))?"0"==t&&(t=""):(o.Python.definitions_.import_sys="import sys",t+=" or sys.maxsize");break;case"LAST":t="";break;default:throw Error("Unhandled option (text_getSubstring)")}return[n+"["+e+" : "+t+"]",o.Python.ORDER_MEMBER]},o.Python.text_changeCase=function(t){var e={UPPERCASE:".upper()",LOWERCASE:".lower()",TITLECASE:".title()"}[t.getFieldValue("CASE")];return[(o.Python.valueToCode(t,"TEXT",o.Python.ORDER_MEMBER)||"''")+e,o.Python.ORDER_FUNCTION_CALL]},o.Python.text_trim=function(t){var e={LEFT:".lstrip()",RIGHT:".rstrip()",BOTH:".strip()"}[t.getFieldValue("MODE")];return[(o.Python.valueToCode(t,"TEXT",o.Python.ORDER_MEMBER)||"''")+e,o.Python.ORDER_FUNCTION_CALL]},o.Python.text_print=function(t){return"print("+(o.Python.valueToCode(t,"TEXT",o.Python.ORDER_NONE)||"''")+")\n"},o.Python.text_prompt_ext=function(t){var e=o.Python.provideFunction_("text_prompt",["def "+o.Python.FUNCTION_NAME_PLACEHOLDER_+"(msg):","  try:","    return raw_input(msg)","  except NameError:","    return input(msg)"]);return e=e+"("+(t.getField("TEXT")?o.Python.quote_(t.getFieldValue("TEXT")):o.Python.valueToCode(t,"TEXT",o.Python.ORDER_NONE)||"''")+")","NUMBER"==t.getFieldValue("TYPE")&&(e="float("+e+")"),[e,o.Python.ORDER_FUNCTION_CALL]},o.Python.text_prompt=o.Python.text_prompt_ext,o.Python.text_count=function(t){return[(o.Python.valueToCode(t,"TEXT",o.Python.ORDER_MEMBER)||"''")+".count("+(t=o.Python.valueToCode(t,"SUB",o.Python.ORDER_NONE)||"''")+")",o.Python.ORDER_FUNCTION_CALL]},o.Python.text_replace=function(t){return[(o.Python.valueToCode(t,"TEXT",o.Python.ORDER_MEMBER)||"''")+".replace("+(o.Python.valueToCode(t,"FROM",o.Python.ORDER_NONE)||"''")+", "+(t=o.Python.valueToCode(t,"TO",o.Python.ORDER_NONE)||"''")+")",o.Python.ORDER_MEMBER]},o.Python.text_reverse=function(t){return[(o.Python.valueToCode(t,"TEXT",o.Python.ORDER_MEMBER)||"''")+"[::-1]",o.Python.ORDER_MEMBER]},o.Python.variables={},o.Python.variables_get=function(t){return[o.Python.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),o.Python.ORDER_ATOMIC]},o.Python.variables_set=function(t){var e=o.Python.valueToCode(t,"VALUE",o.Python.ORDER_NONE)||"0";return o.Python.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME)+" = "+e+"\n"},o.Python.variablesDynamic={},o.Python.variables_get_dynamic=o.Python.variables_get,o.Python.variables_set_dynamic=o.Python.variables_set,o.Python)})),ot=G((function(t,e){var o;t.exports=(o=et,j.Python=o,o)})),it=G((function(t,e){var o;t.exports=((o=K).PHP=new o.Generator("PHP"),o.PHP.addReservedWords("__halt_compiler,abstract,and,array,as,break,callable,case,catch,class,clone,const,continue,declare,default,die,do,echo,else,elseif,empty,enddeclare,endfor,endforeach,endif,endswitch,endwhile,eval,exit,extends,final,for,foreach,function,global,goto,if,implements,include,include_once,instanceof,insteadof,interface,isset,list,namespace,new,or,print,private,protected,public,require,require_once,return,static,switch,throw,trait,try,unset,use,var,while,xor,PHP_VERSION,PHP_MAJOR_VERSION,PHP_MINOR_VERSION,PHP_RELEASE_VERSION,PHP_VERSION_ID,PHP_EXTRA_VERSION,PHP_ZTS,PHP_DEBUG,PHP_MAXPATHLEN,PHP_OS,PHP_SAPI,PHP_EOL,PHP_INT_MAX,PHP_INT_SIZE,DEFAULT_INCLUDE_PATH,PEAR_INSTALL_DIR,PEAR_EXTENSION_DIR,PHP_EXTENSION_DIR,PHP_PREFIX,PHP_BINDIR,PHP_BINARY,PHP_MANDIR,PHP_LIBDIR,PHP_DATADIR,PHP_SYSCONFDIR,PHP_LOCALSTATEDIR,PHP_CONFIG_FILE_PATH,PHP_CONFIG_FILE_SCAN_DIR,PHP_SHLIB_SUFFIX,E_ERROR,E_WARNING,E_PARSE,E_NOTICE,E_CORE_ERROR,E_CORE_WARNING,E_COMPILE_ERROR,E_COMPILE_WARNING,E_USER_ERROR,E_USER_WARNING,E_USER_NOTICE,E_DEPRECATED,E_USER_DEPRECATED,E_ALL,E_STRICT,__COMPILER_HALT_OFFSET__,TRUE,FALSE,NULL,__CLASS__,__DIR__,__FILE__,__FUNCTION__,__LINE__,__METHOD__,__NAMESPACE__,__TRAIT__"),o.PHP.ORDER_ATOMIC=0,o.PHP.ORDER_CLONE=1,o.PHP.ORDER_NEW=1,o.PHP.ORDER_MEMBER=2.1,o.PHP.ORDER_FUNCTION_CALL=2.2,o.PHP.ORDER_POWER=3,o.PHP.ORDER_INCREMENT=4,o.PHP.ORDER_DECREMENT=4,o.PHP.ORDER_BITWISE_NOT=4,o.PHP.ORDER_CAST=4,o.PHP.ORDER_SUPPRESS_ERROR=4,o.PHP.ORDER_INSTANCEOF=5,o.PHP.ORDER_LOGICAL_NOT=6,o.PHP.ORDER_UNARY_PLUS=7.1,o.PHP.ORDER_UNARY_NEGATION=7.2,o.PHP.ORDER_MULTIPLICATION=8.1,o.PHP.ORDER_DIVISION=8.2,o.PHP.ORDER_MODULUS=8.3,o.PHP.ORDER_ADDITION=9.1,o.PHP.ORDER_SUBTRACTION=9.2,o.PHP.ORDER_STRING_CONCAT=9.3,o.PHP.ORDER_BITWISE_SHIFT=10,o.PHP.ORDER_RELATIONAL=11,o.PHP.ORDER_EQUALITY=12,o.PHP.ORDER_REFERENCE=13,o.PHP.ORDER_BITWISE_AND=13,o.PHP.ORDER_BITWISE_XOR=14,o.PHP.ORDER_BITWISE_OR=15,o.PHP.ORDER_LOGICAL_AND=16,o.PHP.ORDER_LOGICAL_OR=17,o.PHP.ORDER_IF_NULL=18,o.PHP.ORDER_CONDITIONAL=19,o.PHP.ORDER_ASSIGNMENT=20,o.PHP.ORDER_LOGICAL_AND_WEAK=21,o.PHP.ORDER_LOGICAL_XOR=22,o.PHP.ORDER_LOGICAL_OR_WEAK=23,o.PHP.ORDER_NONE=99,o.PHP.ORDER_OVERRIDES=[[o.PHP.ORDER_MEMBER,o.PHP.ORDER_FUNCTION_CALL],[o.PHP.ORDER_MEMBER,o.PHP.ORDER_MEMBER],[o.PHP.ORDER_LOGICAL_NOT,o.PHP.ORDER_LOGICAL_NOT],[o.PHP.ORDER_MULTIPLICATION,o.PHP.ORDER_MULTIPLICATION],[o.PHP.ORDER_ADDITION,o.PHP.ORDER_ADDITION],[o.PHP.ORDER_LOGICAL_AND,o.PHP.ORDER_LOGICAL_AND],[o.PHP.ORDER_LOGICAL_OR,o.PHP.ORDER_LOGICAL_OR]],o.PHP.isInitialized=!1,o.PHP.init=function(t){o.PHP.definitions_=Object.create(null),o.PHP.functionNames_=Object.create(null),o.PHP.variableDB_?o.PHP.variableDB_.reset():o.PHP.variableDB_=new o.Names(o.PHP.RESERVED_WORDS_,"$"),o.PHP.variableDB_.setVariableMap(t.getVariableMap());for(var e=[],i=o.Variables.allDeveloperVariables(t),n=0;n<i.length;n++)e.push(o.PHP.variableDB_.getName(i[n],o.Names.DEVELOPER_VARIABLE_TYPE)+";");for(t=o.Variables.allUsedVarModels(t),n=0;i=t[n];n++)e.push(o.PHP.variableDB_.getName(i.getId(),o.VARIABLE_CATEGORY_NAME)+";");o.PHP.definitions_.variables=e.join("\n"),this.isInitialized=!0},o.PHP.finish=function(t){var e,i=[];for(e in o.PHP.definitions_)i.push(o.PHP.definitions_[e]);return delete o.PHP.definitions_,delete o.PHP.functionNames_,o.PHP.variableDB_.reset(),i.join("\n\n")+"\n\n\n"+t},o.PHP.scrubNakedValue=function(t){return t+";\n"},o.PHP.quote_=function(t){return"'"+(t=t.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"},o.PHP.multiline_quote_=function(t){return t.split(/\n/g).map(o.PHP.quote_).join(' . "\\n" .\n')},o.PHP.scrub_=function(t,e,i){var n="";if(!t.outputConnection||!t.outputConnection.targetConnection){var r=t.getCommentText();r&&(r=o.utils.string.wrap(r,o.PHP.COMMENT_WRAP-3),n+=o.PHP.prefixLines(r,"// ")+"\n");for(var s=0;s<t.inputList.length;s++)t.inputList[s].type==o.INPUT_VALUE&&(r=t.inputList[s].connection.targetBlock())&&(r=o.PHP.allNestedComments(r))&&(n+=o.PHP.prefixLines(r,"// "))}return t=t.nextConnection&&t.nextConnection.targetBlock(),n+e+(i=i?"":o.PHP.blockToCode(t))},o.PHP.getAdjusted=function(t,e,i,n,r){i=i||0,r=r||o.PHP.ORDER_NONE,t.workspace.options.oneBasedIndex&&i--;var s=t.workspace.options.oneBasedIndex?"1":"0";if(t=0<i?o.PHP.valueToCode(t,e,o.PHP.ORDER_ADDITION)||s:0>i?o.PHP.valueToCode(t,e,o.PHP.ORDER_SUBTRACTION)||s:n?o.PHP.valueToCode(t,e,o.PHP.ORDER_UNARY_NEGATION)||s:o.PHP.valueToCode(t,e,r)||s,o.isNumber(t))t=Number(t)+i,n&&(t=-t);else{if(0<i){t=t+" + "+i;var a=o.PHP.ORDER_ADDITION}else 0>i&&(t=t+" - "+-i,a=o.PHP.ORDER_SUBTRACTION);n&&(t=i?"-("+t+")":"-"+t,a=o.PHP.ORDER_UNARY_NEGATION),a=Math.floor(a),r=Math.floor(r),a&&r>=a&&(t="("+t+")")}return t},o.PHP.colour={},o.PHP.colour_picker=function(t){return[o.PHP.quote_(t.getFieldValue("COLOUR")),o.PHP.ORDER_ATOMIC]},o.PHP.colour_random=function(t){return[o.PHP.provideFunction_("colour_random",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"() {","  return '#' . str_pad(dechex(mt_rand(0, 0xFFFFFF)), 6, '0', STR_PAD_LEFT);","}"])+"()",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.colour_rgb=function(t){var e=o.PHP.valueToCode(t,"RED",o.PHP.ORDER_NONE)||0,i=o.PHP.valueToCode(t,"GREEN",o.PHP.ORDER_NONE)||0;return t=o.PHP.valueToCode(t,"BLUE",o.PHP.ORDER_NONE)||0,[o.PHP.provideFunction_("colour_rgb",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($r, $g, $b) {","  $r = round(max(min($r, 100), 0) * 2.55);","  $g = round(max(min($g, 100), 0) * 2.55);","  $b = round(max(min($b, 100), 0) * 2.55);","  $hex = '#';","  $hex .= str_pad(dechex($r), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($g), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($b), 2, '0', STR_PAD_LEFT);","  return $hex;","}"])+"("+e+", "+i+", "+t+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.colour_blend=function(t){var e=o.PHP.valueToCode(t,"COLOUR1",o.PHP.ORDER_NONE)||"'#000000'",i=o.PHP.valueToCode(t,"COLOUR2",o.PHP.ORDER_NONE)||"'#000000'";return t=o.PHP.valueToCode(t,"RATIO",o.PHP.ORDER_NONE)||.5,[o.PHP.provideFunction_("colour_blend",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($c1, $c2, $ratio) {","  $ratio = max(min($ratio, 1), 0);","  $r1 = hexdec(substr($c1, 1, 2));","  $g1 = hexdec(substr($c1, 3, 2));","  $b1 = hexdec(substr($c1, 5, 2));","  $r2 = hexdec(substr($c2, 1, 2));","  $g2 = hexdec(substr($c2, 3, 2));","  $b2 = hexdec(substr($c2, 5, 2));","  $r = round($r1 * (1 - $ratio) + $r2 * $ratio);","  $g = round($g1 * (1 - $ratio) + $g2 * $ratio);","  $b = round($b1 * (1 - $ratio) + $b2 * $ratio);","  $hex = '#';","  $hex .= str_pad(dechex($r), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($g), 2, '0', STR_PAD_LEFT);","  $hex .= str_pad(dechex($b), 2, '0', STR_PAD_LEFT);","  return $hex;","}"])+"("+e+", "+i+", "+t+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.lists={},o.PHP.lists_create_empty=function(t){return["array()",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.lists_create_with=function(t){for(var e=Array(t.itemCount_),i=0;i<t.itemCount_;i++)e[i]=o.PHP.valueToCode(t,"ADD"+i,o.PHP.ORDER_NONE)||"null";return[e="array("+e.join(", ")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.lists_repeat=function(t){return[o.PHP.provideFunction_("lists_repeat",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value, $count) {","  $array = array();","  for ($index = 0; $index < $count; $index++) {","    $array[] = $value;","  }","  return $array;","}"])+"("+(o.PHP.valueToCode(t,"ITEM",o.PHP.ORDER_NONE)||"null")+", "+(t=o.PHP.valueToCode(t,"NUM",o.PHP.ORDER_NONE)||"0")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.lists_length=function(t){return[o.PHP.provideFunction_("length",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value) {","  if (is_string($value)) {","    return strlen($value);","  } else {","    return count($value);","  }","}"])+"("+(t=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"''")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.lists_isEmpty=function(t){return["empty("+(o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_FUNCTION_CALL)||"array()")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.lists_indexOf=function(t){var e=o.PHP.valueToCode(t,"FIND",o.PHP.ORDER_NONE)||"''",i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_MEMBER)||"[]";if(t.workspace.options.oneBasedIndex)var n=" 0",r=" + 1";else n=" -1",r="";return[("FIRST"==t.getFieldValue("END")?o.PHP.provideFunction_("indexOf",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($haystack, $needle) {","  for ($index = 0; $index < count($haystack); $index++) {","    if ($haystack[$index] == $needle) return $index"+r+";","  }","  return "+n+";","}"]):o.PHP.provideFunction_("lastIndexOf",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($haystack, $needle) {","  $last = "+n+";","  for ($index = 0; $index < count($haystack); $index++) {","    if ($haystack[$index] == $needle) $last = $index"+r+";","  }","  return $last;","}"]))+"("+i+", "+e+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.lists_getIndex=function(t){var e=t.getFieldValue("MODE")||"GET";switch(t.getFieldValue("WHERE")||"FROM_START"){case"FIRST":if("GET"==e){var i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_MEMBER)||"array()";return[i+"[0]",o.PHP.ORDER_MEMBER]}if("GET_REMOVE"==e)return["array_shift("+(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"array()")+")",o.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return"array_shift("+(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"array()")+");\n";break;case"LAST":if("GET"==e)return["end("+(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"array()")+")",o.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==e)return["array_pop("+(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"array()")+")",o.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return"array_pop("+(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"array()")+");\n";break;case"FROM_START":var n=o.PHP.getAdjusted(t,"AT");if("GET"==e)return[(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_MEMBER)||"array()")+"["+n+"]",o.PHP.ORDER_MEMBER];if("GET_REMOVE"==e)return["array_splice("+(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"array()")+", "+n+", 1)[0]",o.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return"array_splice("+(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"array()")+", "+n+", 1);\n";break;case"FROM_END":if("GET"==e)return["array_slice("+(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"array()")+", "+(n=o.PHP.getAdjusted(t,"AT",1,!0))+", 1)[0]",o.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==e||"REMOVE"==e){if(i="array_splice("+(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"array()")+", count("+i+") - "+(n=o.PHP.getAdjusted(t,"AT",1,!1,o.PHP.ORDER_SUBTRACTION))+", 1)[0]","GET_REMOVE"==e)return[i,o.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return i+";\n"}break;case"RANDOM":if(i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"array()","GET"==e)return[(e=o.PHP.provideFunction_("lists_get_random_item",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list) {","  return $list[rand(0,count($list)-1)];","}"]))+"("+i+")",o.PHP.ORDER_FUNCTION_CALL];if("GET_REMOVE"==e)return[(e=o.PHP.provideFunction_("lists_get_remove_random_item",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list) {","  $x = rand(0,count($list)-1);","  unset($list[$x]);","  return array_values($list);","}"]))+"("+i+")",o.PHP.ORDER_FUNCTION_CALL];if("REMOVE"==e)return(e=o.PHP.provideFunction_("lists_remove_random_item",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list) {","  unset($list[rand(0,count($list)-1)]);","}"]))+"("+i+");\n"}throw Error("Unhandled combination (lists_getIndex).")},o.PHP.lists_setIndex=function(t){var e=t.getFieldValue("MODE")||"GET",i=t.getFieldValue("WHERE")||"FROM_START",n=o.PHP.valueToCode(t,"TO",o.PHP.ORDER_ASSIGNMENT)||"null";switch(i){case"FIRST":if("SET"==e)return(i=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_MEMBER)||"array()")+"[0] = "+n+";\n";if("INSERT"==e)return"array_unshift("+(i=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"array()")+", "+n+");\n";break;case"LAST":if(i=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"array()","SET"==e)return(e=o.PHP.provideFunction_("lists_set_last_item",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $value) {","  $list[count($list) - 1] = $value;","}"]))+"("+i+", "+n+");\n";if("INSERT"==e)return"array_push("+i+", "+n+");\n";break;case"FROM_START":var r=o.PHP.getAdjusted(t,"AT");if("SET"==e)return(i=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_MEMBER)||"array()")+"["+r+"] = "+n+";\n";if("INSERT"==e)return"array_splice("+(i=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"array()")+", "+r+", 0, "+n+");\n";break;case"FROM_END":if(i=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"array()",r=o.PHP.getAdjusted(t,"AT",1),"SET"==e)return(e=o.PHP.provideFunction_("lists_set_from_end",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $at, $value) {","  $list[count($list) - $at] = $value;","}"]))+"("+i+", "+r+", "+n+");\n";if("INSERT"==e)return(e=o.PHP.provideFunction_("lists_insert_from_end",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"(&$list, $at, $value) {","  return array_splice($list, count($list) - $at, 0, $value);","}"]))+"("+i+", "+r+", "+n+");\n";break;case"RANDOM":if((i=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_REFERENCE)||"array()").match(/^\$\w+$/)?t="":(r=(t=o.PHP.variableDB_.getDistinctName("tmp_list",o.VARIABLE_CATEGORY_NAME))+" = &"+i+";\n",i=t,t=r),t+=(r=o.PHP.variableDB_.getDistinctName("tmp_x",o.VARIABLE_CATEGORY_NAME))+" = rand(0, count("+i+")-1);\n","SET"==e)return t+(i+"[")+r+"] = "+n+";\n";if("INSERT"==e)return t+"array_splice("+i+", "+r+", 0, "+n+");\n"}throw Error("Unhandled combination (lists_setIndex).")},o.PHP.lists_getSublist=function(t){var e=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"array()",i=t.getFieldValue("WHERE1"),n=t.getFieldValue("WHERE2");if("FIRST"!=i||"LAST"!=n)if(e.match(/^\$\w+$/)||"FROM_END"!=i&&"FROM_START"==n){switch(i){case"FROM_START":var r=o.PHP.getAdjusted(t,"AT1");break;case"FROM_END":r="count("+e+") - "+(r=o.PHP.getAdjusted(t,"AT1",1,!1,o.PHP.ORDER_SUBTRACTION));break;case"FIRST":r="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(n){case"FROM_START":i=(t=o.PHP.getAdjusted(t,"AT2",0,!1,o.PHP.ORDER_SUBTRACTION))+" - ",i=o.isNumber(String(r))||String(r).match(/^\(.+\)$/)?i+r:i+"("+r+")",i+=" + 1";break;case"FROM_END":i="count("+e+") - "+(t=o.PHP.getAdjusted(t,"AT2",0,!1,o.PHP.ORDER_SUBTRACTION))+" - ",i=o.isNumber(String(r))||String(r).match(/^\(.+\)$/)?i+r:i+"("+r+")";break;case"LAST":i="count("+e+") - ",i=o.isNumber(String(r))||String(r).match(/^\(.+\)$/)?i+r:i+"("+r+")";break;default:throw Error("Unhandled option (lists_getSublist).")}e="array_slice("+e+", "+r+", "+i+")"}else r=o.PHP.getAdjusted(t,"AT1"),t=o.PHP.getAdjusted(t,"AT2"),e=o.PHP.provideFunction_("lists_get_sublist",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list, $where1, $at1, $where2, $at2) {","  if ($where1 == 'FROM_END') {","    $at1 = count($list) - 1 - $at1;","  } else if ($where1 == 'FIRST') {","    $at1 = 0;","  } else if ($where1 != 'FROM_START') {","    throw new Exception('Unhandled option (lists_get_sublist).');","  }","  $length = 0;","  if ($where2 == 'FROM_START') {","    $length = $at2 - $at1 + 1;","  } else if ($where2 == 'FROM_END') {","    $length = count($list) - $at1 - $at2;","  } else if ($where2 == 'LAST') {","    $length = count($list) - $at1;","  } else {","    throw new Exception('Unhandled option (lists_get_sublist).');","  }","  return array_slice($list, $at1, $length);","}"])+"("+e+", '"+i+"', "+r+", '"+n+"', "+t+")";return[e,o.PHP.ORDER_FUNCTION_CALL]},o.PHP.lists_sort=function(t){var e=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"array()",i="1"===t.getFieldValue("DIRECTION")?1:-1;return t=t.getFieldValue("TYPE"),[o.PHP.provideFunction_("lists_sort",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list, $type, $direction) {","  $sortCmpFuncs = array(",'    "NUMERIC" => "strnatcasecmp",','    "TEXT" => "strcmp",','    "IGNORE_CASE" => "strcasecmp"',"  );","  $sortCmp = $sortCmpFuncs[$type];","  $list2 = $list;","  usort($list2, $sortCmp);","  if ($direction == -1) {","    $list2 = array_reverse($list2);","  }","  return $list2;","}"])+"("+e+', "'+t+'", '+i+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.lists_split=function(t){var e=o.PHP.valueToCode(t,"INPUT",o.PHP.ORDER_NONE),i=o.PHP.valueToCode(t,"DELIM",o.PHP.ORDER_NONE)||"''";if("SPLIT"==(t=t.getFieldValue("MODE")))e||(e="''"),t="explode";else{if("JOIN"!=t)throw Error("Unknown mode: "+t);e||(e="array()"),t="implode"}return[t+"("+i+", "+e+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.lists_reverse=function(t){return["array_reverse("+(o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"[]")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.logic={},o.PHP.controls_if=function(t){var e=0,i="";o.PHP.STATEMENT_PREFIX&&(i+=o.PHP.injectId(o.PHP.STATEMENT_PREFIX,t));do{var n=o.PHP.valueToCode(t,"IF"+e,o.PHP.ORDER_NONE)||"false",r=o.PHP.statementToCode(t,"DO"+e);o.PHP.STATEMENT_SUFFIX&&(r=o.PHP.prefixLines(o.PHP.injectId(o.PHP.STATEMENT_SUFFIX,t),o.PHP.INDENT)+r),i+=(0<e?" else ":"")+"if ("+n+") {\n"+r+"}",++e}while(t.getInput("IF"+e));return(t.getInput("ELSE")||o.PHP.STATEMENT_SUFFIX)&&(r=o.PHP.statementToCode(t,"ELSE"),o.PHP.STATEMENT_SUFFIX&&(r=o.PHP.prefixLines(o.PHP.injectId(o.PHP.STATEMENT_SUFFIX,t),o.PHP.INDENT)+r),i+=" else {\n"+r+"}"),i+"\n"},o.PHP.controls_ifelse=o.PHP.controls_if,o.PHP.logic_compare=function(t){var e={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[t.getFieldValue("OP")],i="=="==e||"!="==e?o.PHP.ORDER_EQUALITY:o.PHP.ORDER_RELATIONAL;return[(o.PHP.valueToCode(t,"A",i)||"0")+" "+e+" "+(t=o.PHP.valueToCode(t,"B",i)||"0"),i]},o.PHP.logic_operation=function(t){var e="AND"==t.getFieldValue("OP")?"&&":"||",i="&&"==e?o.PHP.ORDER_LOGICAL_AND:o.PHP.ORDER_LOGICAL_OR,n=o.PHP.valueToCode(t,"A",i);if(t=o.PHP.valueToCode(t,"B",i),n||t){var r="&&"==e?"true":"false";n||(n=r),t||(t=r)}else t=n="false";return[n+" "+e+" "+t,i]},o.PHP.logic_negate=function(t){var e=o.PHP.ORDER_LOGICAL_NOT;return["!"+(o.PHP.valueToCode(t,"BOOL",e)||"true"),e]},o.PHP.logic_boolean=function(t){return["TRUE"==t.getFieldValue("BOOL")?"true":"false",o.PHP.ORDER_ATOMIC]},o.PHP.logic_null=function(t){return["null",o.PHP.ORDER_ATOMIC]},o.PHP.logic_ternary=function(t){return[(o.PHP.valueToCode(t,"IF",o.PHP.ORDER_CONDITIONAL)||"false")+" ? "+(o.PHP.valueToCode(t,"THEN",o.PHP.ORDER_CONDITIONAL)||"null")+" : "+(t=o.PHP.valueToCode(t,"ELSE",o.PHP.ORDER_CONDITIONAL)||"null"),o.PHP.ORDER_CONDITIONAL]},o.PHP.loops={},o.PHP.controls_repeat_ext=function(t){var e=t.getField("TIMES")?String(Number(t.getFieldValue("TIMES"))):o.PHP.valueToCode(t,"TIMES",o.PHP.ORDER_ASSIGNMENT)||"0",i=o.PHP.statementToCode(t,"DO");i=o.PHP.addLoopTrap(i,t),t="";var n=o.PHP.variableDB_.getDistinctName("count",o.VARIABLE_CATEGORY_NAME),r=e;return e.match(/^\w+$/)||o.isNumber(e)||(t+=(r=o.PHP.variableDB_.getDistinctName("repeat_end",o.VARIABLE_CATEGORY_NAME))+" = "+e+";\n"),t+"for ("+n+" = 0; "+n+" < "+r+"; "+n+"++) {\n"+i+"}\n"},o.PHP.controls_repeat=o.PHP.controls_repeat_ext,o.PHP.controls_whileUntil=function(t){var e="UNTIL"==t.getFieldValue("MODE"),i=o.PHP.valueToCode(t,"BOOL",e?o.PHP.ORDER_LOGICAL_NOT:o.PHP.ORDER_NONE)||"false",n=o.PHP.statementToCode(t,"DO");return e&&(i="!"+i),"while ("+i+") {\n"+(n=o.PHP.addLoopTrap(n,t))+"}\n"},o.PHP.controls_for=function(t){var e=o.PHP.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),i=o.PHP.valueToCode(t,"FROM",o.PHP.ORDER_ASSIGNMENT)||"0",n=o.PHP.valueToCode(t,"TO",o.PHP.ORDER_ASSIGNMENT)||"0",r=o.PHP.valueToCode(t,"BY",o.PHP.ORDER_ASSIGNMENT)||"1",s=o.PHP.statementToCode(t,"DO");if(s=o.PHP.addLoopTrap(s,t),o.isNumber(i)&&o.isNumber(n)&&o.isNumber(r)){var a=Number(i)<=Number(n);t="for ("+e+" = "+i+"; "+e+(a?" <= ":" >= ")+n+"; "+e,t=(1==(e=Math.abs(Number(r)))?t+(a?"++":"--"):t+(a?" += ":" -= ")+e)+") {\n"+s+"}\n"}else t="",a=i,i.match(/^\w+$/)||o.isNumber(i)||(t+=(a=o.PHP.variableDB_.getDistinctName(e+"_start",o.VARIABLE_CATEGORY_NAME))+" = "+i+";\n"),i=n,n.match(/^\w+$/)||o.isNumber(n)||(t+=(i=o.PHP.variableDB_.getDistinctName(e+"_end",o.VARIABLE_CATEGORY_NAME))+" = "+n+";\n"),t+=(n=o.PHP.variableDB_.getDistinctName(e+"_inc",o.VARIABLE_CATEGORY_NAME))+" = ",t=(t=o.isNumber(r)?t+(Math.abs(r)+";\n"):t+"abs("+r+");\n")+"if ("+a+" > "+i+") {\n"+(o.PHP.INDENT+n)+" = -"+n+";\n",t+="}\n",t+="for ("+e+" = "+a+"; "+n+" >= 0 ? "+e+" <= "+i+" : "+e+" >= "+i+"; "+e+" += "+n+") {\n"+s+"}\n";return t},o.PHP.controls_forEach=function(t){var e=o.PHP.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),i=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_ASSIGNMENT)||"[]",n=o.PHP.statementToCode(t,"DO");return"foreach ("+i+" as "+e+") {\n"+(n=o.PHP.addLoopTrap(n,t))+"}\n"},o.PHP.controls_flow_statements=function(t){var e="";if(o.PHP.STATEMENT_PREFIX&&(e+=o.PHP.injectId(o.PHP.STATEMENT_PREFIX,t)),o.PHP.STATEMENT_SUFFIX&&(e+=o.PHP.injectId(o.PHP.STATEMENT_SUFFIX,t)),o.PHP.STATEMENT_PREFIX){var i=o.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(t);i&&!i.suppressPrefixSuffix&&(e+=o.PHP.injectId(o.PHP.STATEMENT_PREFIX,i))}switch(t.getFieldValue("FLOW")){case"BREAK":return e+"break;\n";case"CONTINUE":return e+"continue;\n"}throw Error("Unknown flow statement.")},o.PHP.math={},o.PHP.math_number=function(t){var e=0<=(t=Number(t.getFieldValue("NUM")))?o.PHP.ORDER_ATOMIC:o.PHP.ORDER_UNARY_NEGATION;return 1/0==t?t="INF":-1/0==t&&(t="-INF"),[t,e]},o.PHP.math_arithmetic=function(t){var e={ADD:[" + ",o.PHP.ORDER_ADDITION],MINUS:[" - ",o.PHP.ORDER_SUBTRACTION],MULTIPLY:[" * ",o.PHP.ORDER_MULTIPLICATION],DIVIDE:[" / ",o.PHP.ORDER_DIVISION],POWER:[" ** ",o.PHP.ORDER_POWER]}[t.getFieldValue("OP")],i=e[0];return e=e[1],[(o.PHP.valueToCode(t,"A",e)||"0")+i+(t=o.PHP.valueToCode(t,"B",e)||"0"),e]},o.PHP.math_single=function(t){var e=t.getFieldValue("OP");if("NEG"==e)return"-"==(t=o.PHP.valueToCode(t,"NUM",o.PHP.ORDER_UNARY_NEGATION)||"0")[0]&&(t=" "+t),["-"+t,o.PHP.ORDER_UNARY_NEGATION];switch(t="SIN"==e||"COS"==e||"TAN"==e?o.PHP.valueToCode(t,"NUM",o.PHP.ORDER_DIVISION)||"0":o.PHP.valueToCode(t,"NUM",o.PHP.ORDER_NONE)||"0",e){case"ABS":var i="abs("+t+")";break;case"ROOT":i="sqrt("+t+")";break;case"LN":i="log("+t+")";break;case"EXP":i="exp("+t+")";break;case"POW10":i="pow(10,"+t+")";break;case"ROUND":i="round("+t+")";break;case"ROUNDUP":i="ceil("+t+")";break;case"ROUNDDOWN":i="floor("+t+")";break;case"SIN":i="sin("+t+" / 180 * pi())";break;case"COS":i="cos("+t+" / 180 * pi())";break;case"TAN":i="tan("+t+" / 180 * pi())"}if(i)return[i,o.PHP.ORDER_FUNCTION_CALL];switch(e){case"LOG10":i="log("+t+") / log(10)";break;case"ASIN":i="asin("+t+") / pi() * 180";break;case"ACOS":i="acos("+t+") / pi() * 180";break;case"ATAN":i="atan("+t+") / pi() * 180";break;default:throw Error("Unknown math operator: "+e)}return[i,o.PHP.ORDER_DIVISION]},o.PHP.math_constant=function(t){return{PI:["M_PI",o.PHP.ORDER_ATOMIC],E:["M_E",o.PHP.ORDER_ATOMIC],GOLDEN_RATIO:["(1 + sqrt(5)) / 2",o.PHP.ORDER_DIVISION],SQRT2:["M_SQRT2",o.PHP.ORDER_ATOMIC],SQRT1_2:["M_SQRT1_2",o.PHP.ORDER_ATOMIC],INFINITY:["INF",o.PHP.ORDER_ATOMIC]}[t.getFieldValue("CONSTANT")]},o.PHP.math_number_property=function(t){var e=o.PHP.valueToCode(t,"NUMBER_TO_CHECK",o.PHP.ORDER_MODULUS)||"0",i=t.getFieldValue("PROPERTY");if("PRIME"==i)return[o.PHP.provideFunction_("math_isPrime",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($n) {","  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if ($n == 2 || $n == 3) {","    return true;","  }","  // False if n is NaN, negative, is 1, or not whole.","  // And false if n is divisible by 2 or 3.","  if (!is_numeric($n) || $n <= 1 || $n % 1 != 0 || $n % 2 == 0 || $n % 3 == 0) {","    return false;","  }","  // Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for ($x = 6; $x <= sqrt($n) + 1; $x += 6) {","    if ($n % ($x - 1) == 0 || $n % ($x + 1) == 0) {","      return false;","    }","  }","  return true;","}"])+"("+e+")",o.PHP.ORDER_FUNCTION_CALL];switch(i){case"EVEN":var n=e+" % 2 == 0";break;case"ODD":n=e+" % 2 == 1";break;case"WHOLE":n="is_int("+e+")";break;case"POSITIVE":n=e+" > 0";break;case"NEGATIVE":n=e+" < 0";break;case"DIVISIBLE_BY":n=e+" % "+(t=o.PHP.valueToCode(t,"DIVISOR",o.PHP.ORDER_MODULUS)||"0")+" == 0"}return[n,o.PHP.ORDER_EQUALITY]},o.PHP.math_change=function(t){var e=o.PHP.valueToCode(t,"DELTA",o.PHP.ORDER_ADDITION)||"0";return o.PHP.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME)+" += "+e+";\n"},o.PHP.math_round=o.PHP.math_single,o.PHP.math_trig=o.PHP.math_single,o.PHP.math_on_list=function(t){var e=t.getFieldValue("OP");switch(e){case"SUM":t="array_sum("+(t=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"MIN":t="min("+(t=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"MAX":t="max("+(t=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_FUNCTION_CALL)||"array()")+")";break;case"AVERAGE":t=(e=o.PHP.provideFunction_("math_mean",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($myList) {","  return array_sum($myList) / count($myList);","}"]))+"("+(t=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"array()")+")";break;case"MEDIAN":t=(e=o.PHP.provideFunction_("math_median",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($arr) {","  sort($arr,SORT_NUMERIC);","  return (count($arr) % 2) ? $arr[floor(count($arr)/2)] : ","      ($arr[floor(count($arr)/2)] + $arr[floor(count($arr)/2) - 1]) / 2;","}"]))+"("+(t=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"[]")+")";break;case"MODE":t=(e=o.PHP.provideFunction_("math_modes",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($values) {","  if (empty($values)) return array();","  $counts = array_count_values($values);","  arsort($counts); // Sort counts in descending order","  $modes = array_keys($counts, current($counts), true);","  return $modes;","}"]))+"("+(t=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"[]")+")";break;case"STD_DEV":t=(e=o.PHP.provideFunction_("math_standard_deviation",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($numbers) {","  $n = count($numbers);","  if (!$n) return null;","  $mean = array_sum($numbers) / count($numbers);","  foreach($numbers as $key => $num) $devs[$key] = pow($num - $mean, 2);","  return sqrt(array_sum($devs) / (count($devs) - 1));","}"]))+"("+(t=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"[]")+")";break;case"RANDOM":t=(e=o.PHP.provideFunction_("math_random_list",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($list) {","  $x = rand(0, count($list)-1);","  return $list[$x];","}"]))+"("+(t=o.PHP.valueToCode(t,"LIST",o.PHP.ORDER_NONE)||"[]")+")";break;default:throw Error("Unknown operator: "+e)}return[t,o.PHP.ORDER_FUNCTION_CALL]},o.PHP.math_modulo=function(t){return[(o.PHP.valueToCode(t,"DIVIDEND",o.PHP.ORDER_MODULUS)||"0")+" % "+(t=o.PHP.valueToCode(t,"DIVISOR",o.PHP.ORDER_MODULUS)||"0"),o.PHP.ORDER_MODULUS]},o.PHP.math_constrain=function(t){return["min(max("+(o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"0")+", "+(o.PHP.valueToCode(t,"LOW",o.PHP.ORDER_NONE)||"0")+"), "+(t=o.PHP.valueToCode(t,"HIGH",o.PHP.ORDER_NONE)||"Infinity")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.math_random_int=function(t){var e=o.PHP.valueToCode(t,"FROM",o.PHP.ORDER_NONE)||"0";return t=o.PHP.valueToCode(t,"TO",o.PHP.ORDER_NONE)||"0",[o.PHP.provideFunction_("math_random_int",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($a, $b) {","  if ($a > $b) {","    return rand($b, $a);","  }","  return rand($a, $b);","}"])+"("+e+", "+t+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.math_random_float=function(t){return["(float)rand()/(float)getrandmax()",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.math_atan2=function(t){var e=o.PHP.valueToCode(t,"X",o.PHP.ORDER_NONE)||"0";return["atan2("+(o.PHP.valueToCode(t,"Y",o.PHP.ORDER_NONE)||"0")+", "+e+") / pi() * 180",o.PHP.ORDER_DIVISION]},o.PHP.procedures={},o.PHP.procedures_defreturn=function(t){for(var e,i=[],n=t.workspace,r=o.Variables.allUsedVarModels(n)||[],s=0;e=r[s];s++)e=e.name,-1==t.getVars().indexOf(e)&&i.push(o.PHP.variableDB_.getName(e,o.VARIABLE_CATEGORY_NAME));for(r=o.Variables.allDeveloperVariables(n),s=0;s<r.length;s++)i.push(o.PHP.variableDB_.getName(r[s],o.Names.DEVELOPER_VARIABLE_TYPE));i=i.length?o.PHP.INDENT+"global "+i.join(", ")+";\n":"",n=o.PHP.variableDB_.getName(t.getFieldValue("NAME"),o.PROCEDURE_CATEGORY_NAME),e="",o.PHP.STATEMENT_PREFIX&&(e+=o.PHP.injectId(o.PHP.STATEMENT_PREFIX,t)),o.PHP.STATEMENT_SUFFIX&&(e+=o.PHP.injectId(o.PHP.STATEMENT_SUFFIX,t)),e&&(e=o.PHP.prefixLines(e,o.PHP.INDENT));var a="";o.PHP.INFINITE_LOOP_TRAP&&(a=o.PHP.prefixLines(o.PHP.injectId(o.PHP.INFINITE_LOOP_TRAP,t),o.PHP.INDENT));var l=o.PHP.statementToCode(t,"STACK"),c=o.PHP.valueToCode(t,"RETURN",o.PHP.ORDER_NONE)||"",u="";l&&c&&(u=e),c&&(c=o.PHP.INDENT+"return "+c+";\n");var h=[];for(r=t.getVars(),s=0;s<r.length;s++)h[s]=o.PHP.variableDB_.getName(r[s],o.VARIABLE_CATEGORY_NAME);return i="function "+n+"("+h.join(", ")+") {\n"+i+e+a+l+u+c+"}",i=o.PHP.scrub_(t,i),o.PHP.definitions_["%"+n]=i,null},o.PHP.procedures_defnoreturn=o.PHP.procedures_defreturn,o.PHP.procedures_callreturn=function(t){for(var e=o.PHP.variableDB_.getName(t.getFieldValue("NAME"),o.PROCEDURE_CATEGORY_NAME),i=[],n=t.getVars(),r=0;r<n.length;r++)i[r]=o.PHP.valueToCode(t,"ARG"+r,o.PHP.ORDER_NONE)||"null";return[e+"("+i.join(", ")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.procedures_callnoreturn=function(t){return o.PHP.procedures_callreturn(t)[0]+";\n"},o.PHP.procedures_ifreturn=function(t){var e="if ("+(o.PHP.valueToCode(t,"CONDITION",o.PHP.ORDER_NONE)||"false")+") {\n";return o.PHP.STATEMENT_SUFFIX&&(e+=o.PHP.prefixLines(o.PHP.injectId(o.PHP.STATEMENT_SUFFIX,t),o.PHP.INDENT)),t.hasReturnValue_?(t=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"null",e+=o.PHP.INDENT+"return "+t+";\n"):e+=o.PHP.INDENT+"return;\n",e+"}\n"},o.PHP.texts={},o.PHP.text=function(t){return[o.PHP.quote_(t.getFieldValue("TEXT")),o.PHP.ORDER_ATOMIC]},o.PHP.text_multiline=function(t){var e=-1!=(t=o.PHP.multiline_quote_(t.getFieldValue("TEXT"))).indexOf(".")?o.PHP.ORDER_STRING_CONCAT:o.PHP.ORDER_ATOMIC;return[t,e]},o.PHP.text_join=function(t){if(0==t.itemCount_)return["''",o.PHP.ORDER_ATOMIC];if(1==t.itemCount_)return[o.PHP.valueToCode(t,"ADD0",o.PHP.ORDER_NONE)||"''",o.PHP.ORDER_NONE];if(2==t.itemCount_){var e=o.PHP.valueToCode(t,"ADD0",o.PHP.ORDER_STRING_CONCAT)||"''";return[e+" . "+(t=o.PHP.valueToCode(t,"ADD1",o.PHP.ORDER_STRING_CONCAT)||"''"),o.PHP.ORDER_STRING_CONCAT]}e=Array(t.itemCount_);for(var i=0;i<t.itemCount_;i++)e[i]=o.PHP.valueToCode(t,"ADD"+i,o.PHP.ORDER_NONE)||"''";return[t="implode('', array("+e.join(",")+"))",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.text_append=function(t){return o.PHP.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME)+" .= "+(t=o.PHP.valueToCode(t,"TEXT",o.PHP.ORDER_ASSIGNMENT)||"''")+";\n"},o.PHP.text_length=function(t){return[o.PHP.provideFunction_("length",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($value) {","  if (is_string($value)) {","    return strlen($value);","  } else {","    return count($value);","  }","}"])+"("+(t=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"''")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.text_isEmpty=function(t){return["empty("+(o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"''")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.text_indexOf=function(t){var e="FIRST"==t.getFieldValue("END")?"strpos":"strrpos",i=o.PHP.valueToCode(t,"FIND",o.PHP.ORDER_NONE)||"''",n=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"''";if(t.workspace.options.oneBasedIndex)var r=" 0",s=" + 1";else r=" -1",s="";return[o.PHP.provideFunction_("FIRST"==t.getFieldValue("END")?"text_indexOf":"text_lastIndexOf",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text, $search) {","  $pos = "+e+"($text, $search);","  return $pos === false ? "+r+" : $pos"+s+";","}"])+"("+n+", "+i+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.text_charAt=function(t){var e=t.getFieldValue("WHERE")||"FROM_START",i=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_NONE)||"''";switch(e){case"FIRST":return["substr("+i+", 0, 1)",o.PHP.ORDER_FUNCTION_CALL];case"LAST":return["substr("+i+", -1)",o.PHP.ORDER_FUNCTION_CALL];case"FROM_START":return["substr("+i+", "+(t=o.PHP.getAdjusted(t,"AT"))+", 1)",o.PHP.ORDER_FUNCTION_CALL];case"FROM_END":return["substr("+i+", "+(t=o.PHP.getAdjusted(t,"AT",1,!0))+", 1)",o.PHP.ORDER_FUNCTION_CALL];case"RANDOM":return[o.PHP.provideFunction_("text_random_letter",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text) {","  return $text[rand(0, strlen($text) - 1)];","}"])+"("+i+")",o.PHP.ORDER_FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},o.PHP.text_getSubstring=function(t){var e=t.getFieldValue("WHERE1"),i=t.getFieldValue("WHERE2"),n=o.PHP.valueToCode(t,"STRING",o.PHP.ORDER_NONE)||"''";if("FIRST"==e&&"LAST"==i)return[n,o.PHP.ORDER_NONE];var r=o.PHP.getAdjusted(t,"AT1");return t=o.PHP.getAdjusted(t,"AT2"),[o.PHP.provideFunction_("text_get_substring",["function "+o.PHP.FUNCTION_NAME_PLACEHOLDER_+"($text, $where1, $at1, $where2, $at2) {","  if ($where1 == 'FROM_END') {","    $at1 = strlen($text) - 1 - $at1;","  } else if ($where1 == 'FIRST') {","    $at1 = 0;","  } else if ($where1 != 'FROM_START') {","    throw new Exception('Unhandled option (text_get_substring).');","  }","  $length = 0;","  if ($where2 == 'FROM_START') {","    $length = $at2 - $at1 + 1;","  } else if ($where2 == 'FROM_END') {","    $length = strlen($text) - $at1 - $at2;","  } else if ($where2 == 'LAST') {","    $length = strlen($text) - $at1;","  } else {","    throw new Exception('Unhandled option (text_get_substring).');","  }","  return substr($text, $at1, $length);","}"])+"("+n+", '"+e+"', "+r+", '"+i+"', "+t+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.text_changeCase=function(t){var e=o.PHP.valueToCode(t,"TEXT",o.PHP.ORDER_NONE)||"''";if("UPPERCASE"==t.getFieldValue("CASE"))var i="strtoupper("+e+")";else"LOWERCASE"==t.getFieldValue("CASE")?i="strtolower("+e+")":"TITLECASE"==t.getFieldValue("CASE")&&(i="ucwords(strtolower("+e+"))");return[i,o.PHP.ORDER_FUNCTION_CALL]},o.PHP.text_trim=function(t){return[{LEFT:"ltrim",RIGHT:"rtrim",BOTH:"trim"}[t.getFieldValue("MODE")]+"("+(t=o.PHP.valueToCode(t,"TEXT",o.PHP.ORDER_NONE)||"''")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.text_print=function(t){return"print("+(o.PHP.valueToCode(t,"TEXT",o.PHP.ORDER_NONE)||"''")+");\n"},o.PHP.text_prompt_ext=function(t){var e="readline("+(t.getField("TEXT")?o.PHP.quote_(t.getFieldValue("TEXT")):o.PHP.valueToCode(t,"TEXT",o.PHP.ORDER_NONE)||"''")+")";return"NUMBER"==t.getFieldValue("TYPE")&&(e="floatval("+e+")"),[e,o.PHP.ORDER_FUNCTION_CALL]},o.PHP.text_prompt=o.PHP.text_prompt_ext,o.PHP.text_count=function(t){var e=o.PHP.valueToCode(t,"TEXT",o.PHP.ORDER_NONE)||"''";return["strlen("+(t=o.PHP.valueToCode(t,"SUB",o.PHP.ORDER_NONE)||"''")+") === 0 ? strlen("+e+") + 1 : substr_count("+e+", "+t+")",o.PHP.ORDER_CONDITIONAL]},o.PHP.text_replace=function(t){var e=o.PHP.valueToCode(t,"TEXT",o.PHP.ORDER_NONE)||"''";return["str_replace("+(o.PHP.valueToCode(t,"FROM",o.PHP.ORDER_NONE)||"''")+", "+(t=o.PHP.valueToCode(t,"TO",o.PHP.ORDER_NONE)||"''")+", "+e+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.text_reverse=function(t){return["strrev("+(o.PHP.valueToCode(t,"TEXT",o.PHP.ORDER_NONE)||"''")+")",o.PHP.ORDER_FUNCTION_CALL]},o.PHP.variables={},o.PHP.variables_get=function(t){return[o.PHP.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),o.PHP.ORDER_ATOMIC]},o.PHP.variables_set=function(t){var e=o.PHP.valueToCode(t,"VALUE",o.PHP.ORDER_ASSIGNMENT)||"0";return o.PHP.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME)+" = "+e+";\n"},o.PHP.variablesDynamic={},o.PHP.variables_get_dynamic=o.PHP.variables_get,o.PHP.variables_set_dynamic=o.PHP.variables_set,o.PHP)})),nt=G((function(t,e){var o;t.exports=(o=it,j.PHP=o,o)})),rt=G((function(t,e){var o;t.exports=((o=K).Lua=new o.Generator("Lua"),o.Lua.addReservedWords("_,__inext,assert,bit,colors,colours,coroutine,disk,dofile,error,fs,fetfenv,getmetatable,gps,help,io,ipairs,keys,loadfile,loadstring,math,native,next,os,paintutils,pairs,parallel,pcall,peripheral,print,printError,rawequal,rawget,rawset,read,rednet,redstone,rs,select,setfenv,setmetatable,sleep,string,table,term,textutils,tonumber,tostring,turtle,type,unpack,vector,write,xpcall,_VERSION,__indext,HTTP,and,break,do,else,elseif,end,false,for,function,if,in,local,nil,not,or,repeat,return,then,true,until,while,add,sub,mul,div,mod,pow,unm,concat,len,eq,lt,le,index,newindex,call,assert,collectgarbage,dofile,error,_G,getmetatable,inpairs,load,loadfile,next,pairs,pcall,print,rawequal,rawget,rawlen,rawset,select,setmetatable,tonumber,tostring,type,_VERSION,xpcall,require,package,string,table,math,bit32,io,file,os,debug"),o.Lua.ORDER_ATOMIC=0,o.Lua.ORDER_HIGH=1,o.Lua.ORDER_EXPONENTIATION=2,o.Lua.ORDER_UNARY=3,o.Lua.ORDER_MULTIPLICATIVE=4,o.Lua.ORDER_ADDITIVE=5,o.Lua.ORDER_CONCATENATION=6,o.Lua.ORDER_RELATIONAL=7,o.Lua.ORDER_AND=8,o.Lua.ORDER_OR=9,o.Lua.ORDER_NONE=99,o.Lua.isInitialized=!1,o.Lua.init=function(t){o.Lua.definitions_=Object.create(null),o.Lua.functionNames_=Object.create(null),o.Lua.variableDB_?o.Lua.variableDB_.reset():o.Lua.variableDB_=new o.Names(o.Lua.RESERVED_WORDS_),o.Lua.variableDB_.setVariableMap(t.getVariableMap()),this.isInitialized=!0},o.Lua.finish=function(t){var e,i=[];for(e in o.Lua.definitions_)i.push(o.Lua.definitions_[e]);return delete o.Lua.definitions_,delete o.Lua.functionNames_,o.Lua.variableDB_.reset(),i.join("\n\n")+"\n\n\n"+t},o.Lua.scrubNakedValue=function(t){return"local _ = "+t+"\n"},o.Lua.quote_=function(t){return"'"+(t=t.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/'/g,"\\'"))+"'"},o.Lua.multiline_quote_=function(t){return t.split(/\n/g).map(o.Lua.quote_).join(" .. '\\n' ..\n")},o.Lua.scrub_=function(t,e,i){var n="";if(!t.outputConnection||!t.outputConnection.targetConnection){var r=t.getCommentText();r&&(r=o.utils.string.wrap(r,o.Lua.COMMENT_WRAP-3),n+=o.Lua.prefixLines(r,"-- ")+"\n");for(var s=0;s<t.inputList.length;s++)t.inputList[s].type==o.INPUT_VALUE&&(r=t.inputList[s].connection.targetBlock())&&(r=o.Lua.allNestedComments(r))&&(n+=o.Lua.prefixLines(r,"-- "))}return t=t.nextConnection&&t.nextConnection.targetBlock(),n+e+(i=i?"":o.Lua.blockToCode(t))},o.Lua.colour={},o.Lua.colour_picker=function(t){return[o.Lua.quote_(t.getFieldValue("COLOUR")),o.Lua.ORDER_ATOMIC]},o.Lua.colour_random=function(t){return['string.format("#%06x", math.random(0, 2^24 - 1))',o.Lua.ORDER_HIGH]},o.Lua.colour_rgb=function(t){return[o.Lua.provideFunction_("colour_rgb",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(r, g, b)","  r = math.floor(math.min(100, math.max(0, r)) * 2.55 + .5)","  g = math.floor(math.min(100, math.max(0, g)) * 2.55 + .5)","  b = math.floor(math.min(100, math.max(0, b)) * 2.55 + .5)",'  return string.format("#%02x%02x%02x", r, g, b)',"end"])+"("+(o.Lua.valueToCode(t,"RED",o.Lua.ORDER_NONE)||0)+", "+(o.Lua.valueToCode(t,"GREEN",o.Lua.ORDER_NONE)||0)+", "+(t=o.Lua.valueToCode(t,"BLUE",o.Lua.ORDER_NONE)||0)+")",o.Lua.ORDER_HIGH]},o.Lua.colour_blend=function(t){return[o.Lua.provideFunction_("colour_blend",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(colour1, colour2, ratio)","  local r1 = tonumber(string.sub(colour1, 2, 3), 16)","  local r2 = tonumber(string.sub(colour2, 2, 3), 16)","  local g1 = tonumber(string.sub(colour1, 4, 5), 16)","  local g2 = tonumber(string.sub(colour2, 4, 5), 16)","  local b1 = tonumber(string.sub(colour1, 6, 7), 16)","  local b2 = tonumber(string.sub(colour2, 6, 7), 16)","  local ratio = math.min(1, math.max(0, ratio))","  local r = math.floor(r1 * (1 - ratio) + r2 * ratio + .5)","  local g = math.floor(g1 * (1 - ratio) + g2 * ratio + .5)","  local b = math.floor(b1 * (1 - ratio) + b2 * ratio + .5)",'  return string.format("#%02x%02x%02x", r, g, b)',"end"])+"("+(o.Lua.valueToCode(t,"COLOUR1",o.Lua.ORDER_NONE)||"'#000000'")+", "+(o.Lua.valueToCode(t,"COLOUR2",o.Lua.ORDER_NONE)||"'#000000'")+", "+(t=o.Lua.valueToCode(t,"RATIO",o.Lua.ORDER_NONE)||0)+")",o.Lua.ORDER_HIGH]},o.Lua.lists={},o.Lua.lists_create_empty=function(t){return["{}",o.Lua.ORDER_HIGH]},o.Lua.lists_create_with=function(t){for(var e=Array(t.itemCount_),i=0;i<t.itemCount_;i++)e[i]=o.Lua.valueToCode(t,"ADD"+i,o.Lua.ORDER_NONE)||"None";return["{"+e.join(", ")+"}",o.Lua.ORDER_HIGH]},o.Lua.lists_repeat=function(t){return[o.Lua.provideFunction_("create_list_repeated",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(item, count)","  local t = {}","  for i = 1, count do","    table.insert(t, item)","  end","  return t","end"])+"("+(o.Lua.valueToCode(t,"ITEM",o.Lua.ORDER_NONE)||"None")+", "+(t=o.Lua.valueToCode(t,"NUM",o.Lua.ORDER_NONE)||"0")+")",o.Lua.ORDER_HIGH]},o.Lua.lists_length=function(t){return["#"+(o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_UNARY)||"{}"),o.Lua.ORDER_UNARY]},o.Lua.lists_isEmpty=function(t){return["#"+(o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_UNARY)||"{}")+" == 0",o.Lua.ORDER_RELATIONAL]},o.Lua.lists_indexOf=function(t){var e=o.Lua.valueToCode(t,"FIND",o.Lua.ORDER_NONE)||"''",i=o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_NONE)||"{}";return[("FIRST"==t.getFieldValue("END")?o.Lua.provideFunction_("first_index",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t, elem)","  for k, v in ipairs(t) do","    if v == elem then","      return k","    end","  end","  return 0","end"]):o.Lua.provideFunction_("last_index",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t, elem)","  for i = #t, 1, -1 do","    if t[i] == elem then","      return i","    end","  end","  return 0","end"]))+"("+i+", "+e+")",o.Lua.ORDER_HIGH]},o.Lua.lists.getIndex_=function(t,e,o){return"FIRST"==e?"1":"FROM_END"==e?"#"+t+" + 1 - "+o:"LAST"==e?"#"+t:"RANDOM"==e?"math.random(#"+t+")":o},o.Lua.lists_getIndex=function(t){var e=t.getFieldValue("MODE")||"GET",i=t.getFieldValue("WHERE")||"FROM_START",n=o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_HIGH)||"({})",r=o.Lua.lists.getIndex_;if("LAST"!=i&&"FROM_END"!=i&&"RANDOM"!=i||n.match(/^\w+$/))return s="GET"==e&&"FROM_END"==i?o.Lua.ORDER_ADDITIVE:o.Lua.ORDER_NONE,t=r(n,i,t=o.Lua.valueToCode(t,"AT",s)||"1"),"GET"==e?[n+"["+t+"]",o.Lua.ORDER_HIGH]:(i="table.remove("+n+", "+t+")","GET_REMOVE"==e?[i,o.Lua.ORDER_HIGH]:i+"\n");if("REMOVE"==e){var s="FROM_END"==i?o.Lua.ORDER_ADDITIVE:o.Lua.ORDER_NONE;return t=o.Lua.valueToCode(t,"AT",s)||"1",(e=o.Lua.variableDB_.getDistinctName("tmp_list",o.VARIABLE_CATEGORY_NAME))+" = "+n+"\ntable.remove("+e+", "+(t=r(e,i,t))+")\n"}return t=o.Lua.valueToCode(t,"AT",o.Lua.ORDER_NONE)||"1",[("GET"==e?o.Lua.provideFunction_("list_get_"+i.toLowerCase(),["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t"+("FROM_END"==i||"FROM_START"==i?", at)":")"),"  return t["+r("t",i,"at")+"]","end"]):o.Lua.provideFunction_("list_remove_"+i.toLowerCase(),["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t"+("FROM_END"==i||"FROM_START"==i?", at)":")"),"  return table.remove(t, "+r("t",i,"at")+")","end"]))+"("+n+("FROM_END"==i||"FROM_START"==i?", "+t:"")+")",o.Lua.ORDER_HIGH]},o.Lua.lists_setIndex=function(t){var e=o.Lua.valueToCode(t,"LIST",o.Lua.ORDER_HIGH)||"{}",i=t.getFieldValue("MODE")||"SET",n=t.getFieldValue("WHERE")||"FROM_START",r=o.Lua.valueToCode(t,"AT",o.Lua.ORDER_ADDITIVE)||"1";t=o.Lua.valueToCode(t,"TO",o.Lua.ORDER_NONE)||"None";var s=o.Lua.lists.getIndex_,a="";if(("LAST"==n||"FROM_END"==n||"RANDOM"==n)&&!e.match(/^\w+$/)){var l=o.Lua.variableDB_.getDistinctName("tmp_list",o.VARIABLE_CATEGORY_NAME);a=l+" = "+e+"\n",e=l}return(a="SET"==i?a+(e+"[")+s(e,n,r)+"] = "+t:a+"table.insert("+e+", "+s(e,n,r)+("LAST"==n?" + 1":"")+", "+t+")")+"\n"},o.Lua.lists_getSublist=function(t){var e=o.Lua.valueToCode(t,"LIST",o.Lua.ORDER_NONE)||"{}",i=t.getFieldValue("WHERE1"),n=t.getFieldValue("WHERE2"),r=o.Lua.valueToCode(t,"AT1",o.Lua.ORDER_NONE)||"1";t=o.Lua.valueToCode(t,"AT2",o.Lua.ORDER_NONE)||"1";var s=o.Lua.lists.getIndex_;return[o.Lua.provideFunction_("list_sublist_"+i.toLowerCase()+"_"+n.toLowerCase(),["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(source"+("FROM_END"==i||"FROM_START"==i?", at1":"")+("FROM_END"==n||"FROM_START"==n?", at2":"")+")","  local t = {}","  local start = "+s("source",i,"at1"),"  local finish = "+s("source",n,"at2"),"  for i = start, finish do","    table.insert(t, source[i])","  end","  return t","end"])+"("+e+("FROM_END"==i||"FROM_START"==i?", "+r:"")+("FROM_END"==n||"FROM_START"==n?", "+t:"")+")",o.Lua.ORDER_HIGH]},o.Lua.lists_sort=function(t){var e=o.Lua.valueToCode(t,"LIST",o.Lua.ORDER_NONE)||"{}",i="1"===t.getFieldValue("DIRECTION")?1:-1;return t=t.getFieldValue("TYPE"),[o.Lua.provideFunction_("list_sort",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(list, typev, direction)","  local t = {}","  for n,v in pairs(list) do table.insert(t, v) end","  local compareFuncs = {","    NUMERIC = function(a, b)","      return (tonumber(tostring(a)) or 0)","          < (tonumber(tostring(b)) or 0) end,","    TEXT = function(a, b)","      return tostring(a) < tostring(b) end,","    IGNORE_CASE = function(a, b)","      return string.lower(tostring(a)) < string.lower(tostring(b)) end","  }","  local compareTemp = compareFuncs[typev]","  local compare = compareTemp","  if direction == -1","  then compare = function(a, b) return compareTemp(b, a) end","  end","  table.sort(t, compare)","  return t","end"])+"("+e+',"'+t+'", '+i+")",o.Lua.ORDER_HIGH]},o.Lua.lists_split=function(t){var e=o.Lua.valueToCode(t,"INPUT",o.Lua.ORDER_NONE),i=o.Lua.valueToCode(t,"DELIM",o.Lua.ORDER_NONE)||"''";if("SPLIT"==(t=t.getFieldValue("MODE")))e||(e="''"),t=o.Lua.provideFunction_("list_string_split",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(input, delim)","  local t = {}","  local pos = 1","  while true do","    next_delim = string.find(input, delim, pos)","    if next_delim == nil then","      table.insert(t, string.sub(input, pos))","      break","    else","      table.insert(t, string.sub(input, pos, next_delim-1))","      pos = next_delim + #delim","    end","  end","  return t","end"]);else{if("JOIN"!=t)throw Error("Unknown mode: "+t);e||(e="{}"),t="table.concat"}return[t+"("+e+", "+i+")",o.Lua.ORDER_HIGH]},o.Lua.lists_reverse=function(t){return t=o.Lua.valueToCode(t,"LIST",o.Lua.ORDER_NONE)||"{}",[o.Lua.provideFunction_("list_reverse",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(input)","  local reversed = {}","  for i = #input, 1, -1 do","    table.insert(reversed, input[i])","  end","  return reversed","end"])+"("+t+")",o.Lua.ORDER_HIGH]},o.Lua.logic={},o.Lua.controls_if=function(t){var e=0,i="";o.Lua.STATEMENT_PREFIX&&(i+=o.Lua.injectId(o.Lua.STATEMENT_PREFIX,t));do{var n=o.Lua.valueToCode(t,"IF"+e,o.Lua.ORDER_NONE)||"false",r=o.Lua.statementToCode(t,"DO"+e);o.Lua.STATEMENT_SUFFIX&&(r=o.Lua.prefixLines(o.Lua.injectId(o.Lua.STATEMENT_SUFFIX,t),o.Lua.INDENT)+r),i+=(0<e?"else":"")+"if "+n+" then\n"+r,++e}while(t.getInput("IF"+e));return(t.getInput("ELSE")||o.Lua.STATEMENT_SUFFIX)&&(r=o.Lua.statementToCode(t,"ELSE"),o.Lua.STATEMENT_SUFFIX&&(r=o.Lua.prefixLines(o.Lua.injectId(o.Lua.STATEMENT_SUFFIX,t),o.Lua.INDENT)+r),i+="else\n"+r),i+"end\n"},o.Lua.controls_ifelse=o.Lua.controls_if,o.Lua.logic_compare=function(t){var e={EQ:"==",NEQ:"~=",LT:"<",LTE:"<=",GT:">",GTE:">="}[t.getFieldValue("OP")];return[(o.Lua.valueToCode(t,"A",o.Lua.ORDER_RELATIONAL)||"0")+" "+e+" "+(t=o.Lua.valueToCode(t,"B",o.Lua.ORDER_RELATIONAL)||"0"),o.Lua.ORDER_RELATIONAL]},o.Lua.logic_operation=function(t){var e="AND"==t.getFieldValue("OP")?"and":"or",i="and"==e?o.Lua.ORDER_AND:o.Lua.ORDER_OR,n=o.Lua.valueToCode(t,"A",i);if(t=o.Lua.valueToCode(t,"B",i),n||t){var r="and"==e?"true":"false";n||(n=r),t||(t=r)}else t=n="false";return[n+" "+e+" "+t,i]},o.Lua.logic_negate=function(t){return["not "+(o.Lua.valueToCode(t,"BOOL",o.Lua.ORDER_UNARY)||"true"),o.Lua.ORDER_UNARY]},o.Lua.logic_boolean=function(t){return["TRUE"==t.getFieldValue("BOOL")?"true":"false",o.Lua.ORDER_ATOMIC]},o.Lua.logic_null=function(t){return["nil",o.Lua.ORDER_ATOMIC]},o.Lua.logic_ternary=function(t){return[(o.Lua.valueToCode(t,"IF",o.Lua.ORDER_AND)||"false")+" and "+(o.Lua.valueToCode(t,"THEN",o.Lua.ORDER_AND)||"nil")+" or "+(t=o.Lua.valueToCode(t,"ELSE",o.Lua.ORDER_OR)||"nil"),o.Lua.ORDER_OR]},o.Lua.loops={},o.Lua.CONTINUE_STATEMENT="goto continue\n",o.Lua.addContinueLabel_=function(t){return-1!=t.indexOf(o.Lua.CONTINUE_STATEMENT)?t+o.Lua.INDENT+"::continue::\n":t},o.Lua.controls_repeat_ext=function(t){var e=t.getField("TIMES")?String(Number(t.getFieldValue("TIMES"))):o.Lua.valueToCode(t,"TIMES",o.Lua.ORDER_NONE)||"0";e=o.isNumber(e)?parseInt(e,10):"math.floor("+e+")";var i=o.Lua.statementToCode(t,"DO");return i=o.Lua.addLoopTrap(i,t),i=o.Lua.addContinueLabel_(i),"for "+o.Lua.variableDB_.getDistinctName("count",o.VARIABLE_CATEGORY_NAME)+" = 1, "+e+" do\n"+i+"end\n"},o.Lua.controls_repeat=o.Lua.controls_repeat_ext,o.Lua.controls_whileUntil=function(t){var e="UNTIL"==t.getFieldValue("MODE"),i=o.Lua.valueToCode(t,"BOOL",e?o.Lua.ORDER_UNARY:o.Lua.ORDER_NONE)||"false",n=o.Lua.statementToCode(t,"DO");return n=o.Lua.addLoopTrap(n,t),e&&(i="not "+i),"while "+i+" do\n"+(n=o.Lua.addContinueLabel_(n))+"end\n"},o.Lua.controls_for=function(t){var e=o.Lua.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),i=o.Lua.valueToCode(t,"FROM",o.Lua.ORDER_NONE)||"0",n=o.Lua.valueToCode(t,"TO",o.Lua.ORDER_NONE)||"0",r=o.Lua.valueToCode(t,"BY",o.Lua.ORDER_NONE)||"1",s=o.Lua.statementToCode(t,"DO");if(s=o.Lua.addLoopTrap(s,t),s=o.Lua.addContinueLabel_(s),t="",o.isNumber(i)&&o.isNumber(n)&&o.isNumber(r))var a=(Number(i)<=Number(n)?"":"-")+Math.abs(Number(r));else t="",t+=(a=o.Lua.variableDB_.getDistinctName(e+"_inc",o.VARIABLE_CATEGORY_NAME))+" = ",t=(t=o.isNumber(r)?t+(Math.abs(r)+"\n"):t+"math.abs("+r+")\n")+"if ("+i+") > ("+n+") then\n"+(o.Lua.INDENT+a)+" = -"+a+"\n",t+="end\n";return t+"for "+e+" = "+i+", "+n+", "+a+" do\n"+s+"end\n"},o.Lua.controls_forEach=function(t){var e=o.Lua.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),i=o.Lua.valueToCode(t,"LIST",o.Lua.ORDER_NONE)||"{}",n=o.Lua.statementToCode(t,"DO");return n=o.Lua.addLoopTrap(n,t),"for _, "+e+" in ipairs("+i+") do \n"+(n=o.Lua.addContinueLabel_(n))+"end\n"},o.Lua.controls_flow_statements=function(t){var e="";if(o.Lua.STATEMENT_PREFIX&&(e+=o.Lua.injectId(o.Lua.STATEMENT_PREFIX,t)),o.Lua.STATEMENT_SUFFIX&&(e+=o.Lua.injectId(o.Lua.STATEMENT_SUFFIX,t)),o.Lua.STATEMENT_PREFIX){var i=o.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(t);i&&!i.suppressPrefixSuffix&&(e+=o.Lua.injectId(o.Lua.STATEMENT_PREFIX,i))}switch(t.getFieldValue("FLOW")){case"BREAK":return e+"break\n";case"CONTINUE":return e+o.Lua.CONTINUE_STATEMENT}throw Error("Unknown flow statement.")},o.Lua.math={},o.Lua.math_number=function(t){return[t=Number(t.getFieldValue("NUM")),0>t?o.Lua.ORDER_UNARY:o.Lua.ORDER_ATOMIC]},o.Lua.math_arithmetic=function(t){var e={ADD:[" + ",o.Lua.ORDER_ADDITIVE],MINUS:[" - ",o.Lua.ORDER_ADDITIVE],MULTIPLY:[" * ",o.Lua.ORDER_MULTIPLICATIVE],DIVIDE:[" / ",o.Lua.ORDER_MULTIPLICATIVE],POWER:[" ^ ",o.Lua.ORDER_EXPONENTIATION]}[t.getFieldValue("OP")],i=e[0];return e=e[1],[(o.Lua.valueToCode(t,"A",e)||"0")+i+(t=o.Lua.valueToCode(t,"B",e)||"0"),e]},o.Lua.math_single=function(t){var e=t.getFieldValue("OP");if("NEG"==e)return["-"+(t=o.Lua.valueToCode(t,"NUM",o.Lua.ORDER_UNARY)||"0"),o.Lua.ORDER_UNARY];if("POW10"==e)return["10 ^ "+(t=o.Lua.valueToCode(t,"NUM",o.Lua.ORDER_EXPONENTIATION)||"0"),o.Lua.ORDER_EXPONENTIATION];switch(t="ROUND"==e?o.Lua.valueToCode(t,"NUM",o.Lua.ORDER_ADDITIVE)||"0":o.Lua.valueToCode(t,"NUM",o.Lua.ORDER_NONE)||"0",e){case"ABS":e="math.abs("+t+")";break;case"ROOT":e="math.sqrt("+t+")";break;case"LN":e="math.log("+t+")";break;case"LOG10":e="math.log("+t+", 10)";break;case"EXP":e="math.exp("+t+")";break;case"ROUND":e="math.floor("+t+" + .5)";break;case"ROUNDUP":e="math.ceil("+t+")";break;case"ROUNDDOWN":e="math.floor("+t+")";break;case"SIN":e="math.sin(math.rad("+t+"))";break;case"COS":e="math.cos(math.rad("+t+"))";break;case"TAN":e="math.tan(math.rad("+t+"))";break;case"ASIN":e="math.deg(math.asin("+t+"))";break;case"ACOS":e="math.deg(math.acos("+t+"))";break;case"ATAN":e="math.deg(math.atan("+t+"))";break;default:throw Error("Unknown math operator: "+e)}return[e,o.Lua.ORDER_HIGH]},o.Lua.math_constant=function(t){return{PI:["math.pi",o.Lua.ORDER_HIGH],E:["math.exp(1)",o.Lua.ORDER_HIGH],GOLDEN_RATIO:["(1 + math.sqrt(5)) / 2",o.Lua.ORDER_MULTIPLICATIVE],SQRT2:["math.sqrt(2)",o.Lua.ORDER_HIGH],SQRT1_2:["math.sqrt(1 / 2)",o.Lua.ORDER_HIGH],INFINITY:["math.huge",o.Lua.ORDER_HIGH]}[t.getFieldValue("CONSTANT")]},o.Lua.math_number_property=function(t){var e=o.Lua.valueToCode(t,"NUMBER_TO_CHECK",o.Lua.ORDER_MULTIPLICATIVE)||"0",i=t.getFieldValue("PROPERTY");if("PRIME"==i)return[o.Lua.provideFunction_("math_isPrime",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(n)","  -- https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if n == 2 or n == 3 then","    return true","  end","  -- False if n is NaN, negative, is 1, or not whole.","  -- And false if n is divisible by 2 or 3.","  if not(n > 1) or n % 1 ~= 0 or n % 2 == 0 or n % 3 == 0 then","    return false","  end","  -- Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for x = 6, math.sqrt(n) + 1.5, 6 do","    if n % (x - 1) == 0 or n % (x + 1) == 0 then","      return false","    end","  end","  return true","end"])+"("+e+")",o.Lua.ORDER_HIGH];switch(i){case"EVEN":var n=e+" % 2 == 0";break;case"ODD":n=e+" % 2 == 1";break;case"WHOLE":n=e+" % 1 == 0";break;case"POSITIVE":n=e+" > 0";break;case"NEGATIVE":n=e+" < 0";break;case"DIVISIBLE_BY":if(!(t=o.Lua.valueToCode(t,"DIVISOR",o.Lua.ORDER_MULTIPLICATIVE))||"0"==t)return["nil",o.Lua.ORDER_ATOMIC];n=e+" % "+t+" == 0"}return[n,o.Lua.ORDER_RELATIONAL]},o.Lua.math_change=function(t){var e=o.Lua.valueToCode(t,"DELTA",o.Lua.ORDER_ADDITIVE)||"0";return(t=o.Lua.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME))+" = "+t+" + "+e+"\n"},o.Lua.math_round=o.Lua.math_single,o.Lua.math_trig=o.Lua.math_single,o.Lua.math_on_list=function(t){function e(){return o.Lua.provideFunction_("math_sum",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  local result = 0","  for _, v in ipairs(t) do","    result = result + v","  end","  return result","end"])}var i=t.getFieldValue("OP");switch(t=o.Lua.valueToCode(t,"LIST",o.Lua.ORDER_NONE)||"{}",i){case"SUM":i=e();break;case"MIN":i=o.Lua.provideFunction_("math_min",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return 0","  end","  local result = math.huge","  for _, v in ipairs(t) do","    if v < result then","      result = v","    end","  end","  return result","end"]);break;case"AVERAGE":i=o.Lua.provideFunction_("math_average",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return 0","  end","  return "+e()+"(t) / #t","end"]);break;case"MAX":i=o.Lua.provideFunction_("math_max",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return 0","  end","  local result = -math.huge","  for _, v in ipairs(t) do","    if v > result then","      result = v","    end","  end","  return result","end"]);break;case"MEDIAN":i=o.Lua.provideFunction_("math_median",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  -- Source: http://lua-users.org/wiki/SimpleStats","  if #t == 0 then","    return 0","  end","  local temp={}","  for _, v in ipairs(t) do",'    if type(v) == "number" then',"      table.insert(temp, v)","    end","  end","  table.sort(temp)","  if #temp % 2 == 0 then","    return (temp[#temp/2] + temp[(#temp/2)+1]) / 2","  else","    return temp[math.ceil(#temp/2)]","  end","end"]);break;case"MODE":i=o.Lua.provideFunction_("math_modes",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  -- Source: http://lua-users.org/wiki/SimpleStats","  local counts={}","  for _, v in ipairs(t) do","    if counts[v] == nil then","      counts[v] = 1","    else","      counts[v] = counts[v] + 1","    end","  end","  local biggestCount = 0","  for _, v  in pairs(counts) do","    if v > biggestCount then","      biggestCount = v","    end","  end","  local temp={}","  for k, v in pairs(counts) do","    if v == biggestCount then","      table.insert(temp, k)","    end","  end","  return temp","end"]);break;case"STD_DEV":i=o.Lua.provideFunction_("math_standard_deviation",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  local m","  local vm","  local total = 0","  local count = 0","  local result","  m = #t == 0 and 0 or "+e()+"(t) / #t","  for _, v in ipairs(t) do","    if type(v) == 'number' then","      vm = v - m","      total = total + (vm * vm)","      count = count + 1","    end","  end","  result = math.sqrt(total / (count-1))","  return result","end"]);break;case"RANDOM":i=o.Lua.provideFunction_("math_random_list",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(t)","  if #t == 0 then","    return nil","  end","  return t[math.random(#t)]","end"]);break;default:throw Error("Unknown operator: "+i)}return[i+"("+t+")",o.Lua.ORDER_HIGH]},o.Lua.math_modulo=function(t){return[(o.Lua.valueToCode(t,"DIVIDEND",o.Lua.ORDER_MULTIPLICATIVE)||"0")+" % "+(t=o.Lua.valueToCode(t,"DIVISOR",o.Lua.ORDER_MULTIPLICATIVE)||"0"),o.Lua.ORDER_MULTIPLICATIVE]},o.Lua.math_constrain=function(t){return["math.min(math.max("+(o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_NONE)||"0")+", "+(o.Lua.valueToCode(t,"LOW",o.Lua.ORDER_NONE)||"-math.huge")+"), "+(t=o.Lua.valueToCode(t,"HIGH",o.Lua.ORDER_NONE)||"math.huge")+")",o.Lua.ORDER_HIGH]},o.Lua.math_random_int=function(t){return["math.random("+(o.Lua.valueToCode(t,"FROM",o.Lua.ORDER_NONE)||"0")+", "+(t=o.Lua.valueToCode(t,"TO",o.Lua.ORDER_NONE)||"0")+")",o.Lua.ORDER_HIGH]},o.Lua.math_random_float=function(t){return["math.random()",o.Lua.ORDER_HIGH]},o.Lua.math_atan2=function(t){var e=o.Lua.valueToCode(t,"X",o.Lua.ORDER_NONE)||"0";return["math.deg(math.atan2("+(o.Lua.valueToCode(t,"Y",o.Lua.ORDER_NONE)||"0")+", "+e+"))",o.Lua.ORDER_HIGH]},o.Lua.procedures={},o.Lua.procedures_defreturn=function(t){var e=o.Lua.variableDB_.getName(t.getFieldValue("NAME"),o.PROCEDURE_CATEGORY_NAME),i="";o.Lua.STATEMENT_PREFIX&&(i+=o.Lua.injectId(o.Lua.STATEMENT_PREFIX,t)),o.Lua.STATEMENT_SUFFIX&&(i+=o.Lua.injectId(o.Lua.STATEMENT_SUFFIX,t)),i&&(i=o.Lua.prefixLines(i,o.Lua.INDENT));var n="";o.Lua.INFINITE_LOOP_TRAP&&(n=o.Lua.prefixLines(o.Lua.injectId(o.Lua.INFINITE_LOOP_TRAP,t),o.Lua.INDENT));var r=o.Lua.statementToCode(t,"STACK"),s=o.Lua.valueToCode(t,"RETURN",o.Lua.ORDER_NONE)||"",a="";r&&s&&(a=i),s?s=o.Lua.INDENT+"return "+s+"\n":r||(r="");for(var l=[],c=t.getVars(),u=0;u<c.length;u++)l[u]=o.Lua.variableDB_.getName(c[u],o.VARIABLE_CATEGORY_NAME);return i="function "+e+"("+l.join(", ")+")\n"+i+n+r+a+s+"end\n",i=o.Lua.scrub_(t,i),o.Lua.definitions_["%"+e]=i,null},o.Lua.procedures_defnoreturn=o.Lua.procedures_defreturn,o.Lua.procedures_callreturn=function(t){for(var e=o.Lua.variableDB_.getName(t.getFieldValue("NAME"),o.PROCEDURE_CATEGORY_NAME),i=[],n=t.getVars(),r=0;r<n.length;r++)i[r]=o.Lua.valueToCode(t,"ARG"+r,o.Lua.ORDER_NONE)||"nil";return[e+"("+i.join(", ")+")",o.Lua.ORDER_HIGH]},o.Lua.procedures_callnoreturn=function(t){return o.Lua.procedures_callreturn(t)[0]+"\n"},o.Lua.procedures_ifreturn=function(t){var e="if "+(o.Lua.valueToCode(t,"CONDITION",o.Lua.ORDER_NONE)||"false")+" then\n";return o.Lua.STATEMENT_SUFFIX&&(e+=o.Lua.prefixLines(o.Lua.injectId(o.Lua.STATEMENT_SUFFIX,t),o.Lua.INDENT)),t.hasReturnValue_?(t=o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_NONE)||"nil",e+=o.Lua.INDENT+"return "+t+"\n"):e+=o.Lua.INDENT+"return\n",e+"end\n"},o.Lua.texts={},o.Lua.text=function(t){return[o.Lua.quote_(t.getFieldValue("TEXT")),o.Lua.ORDER_ATOMIC]},o.Lua.text_multiline=function(t){var e=-1!=(t=o.Lua.multiline_quote_(t.getFieldValue("TEXT"))).indexOf("..")?o.Lua.ORDER_CONCATENATION:o.Lua.ORDER_ATOMIC;return[t,e]},o.Lua.text_join=function(t){if(0==t.itemCount_)return["''",o.Lua.ORDER_ATOMIC];if(1==t.itemCount_)return["tostring("+(o.Lua.valueToCode(t,"ADD0",o.Lua.ORDER_NONE)||"''")+")",o.Lua.ORDER_HIGH];if(2==t.itemCount_){var e=o.Lua.valueToCode(t,"ADD0",o.Lua.ORDER_CONCATENATION)||"''";return[e+" .. "+(t=o.Lua.valueToCode(t,"ADD1",o.Lua.ORDER_CONCATENATION)||"''"),o.Lua.ORDER_CONCATENATION]}e=[];for(var i=0;i<t.itemCount_;i++)e[i]=o.Lua.valueToCode(t,"ADD"+i,o.Lua.ORDER_NONE)||"''";return[t="table.concat({"+e.join(", ")+"})",o.Lua.ORDER_HIGH]},o.Lua.text_append=function(t){var e=o.Lua.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME);return e+" = "+e+" .. "+(t=o.Lua.valueToCode(t,"TEXT",o.Lua.ORDER_CONCATENATION)||"''")+"\n"},o.Lua.text_length=function(t){return["#"+(o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_UNARY)||"''"),o.Lua.ORDER_UNARY]},o.Lua.text_isEmpty=function(t){return["#"+(o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_UNARY)||"''")+" == 0",o.Lua.ORDER_RELATIONAL]},o.Lua.text_indexOf=function(t){var e=o.Lua.valueToCode(t,"FIND",o.Lua.ORDER_NONE)||"''",i=o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_NONE)||"''";return[("FIRST"==t.getFieldValue("END")?o.Lua.provideFunction_("firstIndexOf",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(str, substr) ","  local i = string.find(str, substr, 1, true)","  if i == nil then","    return 0","  else","    return i","  end","end"]):o.Lua.provideFunction_("lastIndexOf",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(str, substr)","  local i = string.find(string.reverse(str), string.reverse(substr), 1, true)","  if i then","    return #str + 2 - i - #substr","  end","  return 0","end"]))+"("+i+", "+e+")",o.Lua.ORDER_HIGH]},o.Lua.text_charAt=function(t){var e=t.getFieldValue("WHERE")||"FROM_START",i=o.Lua.valueToCode(t,"AT","FROM_END"==e?o.Lua.ORDER_UNARY:o.Lua.ORDER_NONE)||"1";if(t=o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_NONE)||"''","RANDOM"==e)t=(e=o.Lua.provideFunction_("text_random_letter",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(str)","  local index = math.random(string.len(str))","  return string.sub(str, index, index)","end"]))+"("+t+")";else{if("FIRST"==e)i="1";else if("LAST"==e)i="-1";else if("FROM_START"!=e){if("FROM_END"!=e)throw Error("Unhandled option (text_charAt).");i="-"+i}t=i.match(/^-?\w*$/)?"string.sub("+t+", "+i+", "+i+")":(e=o.Lua.provideFunction_("text_char_at",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(str, index)","  return string.sub(str, index, index)","end"]))+"("+t+", "+i+")"}return[t,o.Lua.ORDER_HIGH]},o.Lua.text_getSubstring=function(t){var e=o.Lua.valueToCode(t,"STRING",o.Lua.ORDER_NONE)||"''",i=t.getFieldValue("WHERE1"),n=o.Lua.valueToCode(t,"AT1","FROM_END"==i?o.Lua.ORDER_UNARY:o.Lua.ORDER_NONE)||"1";if("FIRST"==i)i=1;else if("FROM_START"==i)i=n;else{if("FROM_END"!=i)throw Error("Unhandled option (text_getSubstring)");i="-"+n}if(n=t.getFieldValue("WHERE2"),t=o.Lua.valueToCode(t,"AT2","FROM_END"==n?o.Lua.ORDER_UNARY:o.Lua.ORDER_NONE)||"1","LAST"==n)t=-1;else if("FROM_START"!=n){if("FROM_END"!=n)throw Error("Unhandled option (text_getSubstring)");t="-"+t}return["string.sub("+e+", "+i+", "+t+")",o.Lua.ORDER_HIGH]},o.Lua.text_changeCase=function(t){var e=t.getFieldValue("CASE");if(t=o.Lua.valueToCode(t,"TEXT",o.Lua.ORDER_NONE)||"''","UPPERCASE"==e)var i="string.upper";else"LOWERCASE"==e?i="string.lower":"TITLECASE"==e&&(i=o.Lua.provideFunction_("text_titlecase",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(str)","  local buf = {}","  local inWord = false","  for i = 1, #str do","    local c = string.sub(str, i, i)","    if inWord then","      table.insert(buf, string.lower(c))",'      if string.find(c, "%s") then',"        inWord = false","      end","    else","      table.insert(buf, string.upper(c))","      inWord = true","    end","  end","  return table.concat(buf)","end"]));return[i+"("+t+")",o.Lua.ORDER_HIGH]},o.Lua.text_trim=function(t){var e={LEFT:"^%s*(,-)",RIGHT:"(.-)%s*$",BOTH:"^%s*(.-)%s*$"}[t.getFieldValue("MODE")];return["string.gsub("+(o.Lua.valueToCode(t,"TEXT",o.Lua.ORDER_NONE)||"''")+', "'+e+'", "%1")',o.Lua.ORDER_HIGH]},o.Lua.text_print=function(t){return"print("+(o.Lua.valueToCode(t,"TEXT",o.Lua.ORDER_NONE)||"''")+")\n"},o.Lua.text_prompt_ext=function(t){var e=t.getField("TEXT")?o.Lua.quote_(t.getFieldValue("TEXT")):o.Lua.valueToCode(t,"TEXT",o.Lua.ORDER_NONE)||"''";return e=o.Lua.provideFunction_("text_prompt",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(msg)","  io.write(msg)","  io.flush()","  return io.read()","end"])+"("+e+")","NUMBER"==t.getFieldValue("TYPE")&&(e="tonumber("+e+", 10)"),[e,o.Lua.ORDER_HIGH]},o.Lua.text_prompt=o.Lua.text_prompt_ext,o.Lua.text_count=function(t){var e=o.Lua.valueToCode(t,"TEXT",o.Lua.ORDER_NONE)||"''";return t=o.Lua.valueToCode(t,"SUB",o.Lua.ORDER_NONE)||"''",[o.Lua.provideFunction_("text_count",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(haystack, needle)","  if #needle == 0 then","    return #haystack + 1","  end","  local i = 1","  local count = 0","  while true do","    i = string.find(haystack, needle, i, true)","    if i == nil then","      break","    end","    count = count + 1","    i = i + #needle","  end","  return count","end"])+"("+e+", "+t+")",o.Lua.ORDER_HIGH]},o.Lua.text_replace=function(t){var e=o.Lua.valueToCode(t,"TEXT",o.Lua.ORDER_NONE)||"''",i=o.Lua.valueToCode(t,"FROM",o.Lua.ORDER_NONE)||"''";return t=o.Lua.valueToCode(t,"TO",o.Lua.ORDER_NONE)||"''",[o.Lua.provideFunction_("text_replace",["function "+o.Lua.FUNCTION_NAME_PLACEHOLDER_+"(haystack, needle, replacement)","  local buf = {}","  local i = 1","  while i <= #haystack do","    if string.sub(haystack, i, i + #needle - 1) == needle then","      for j = 1, #replacement do","        table.insert(buf, string.sub(replacement, j, j))","      end","      i = i + #needle","    else","      table.insert(buf, string.sub(haystack, i, i))","      i = i + 1","    end","  end","  return table.concat(buf)","end"])+"("+e+", "+i+", "+t+")",o.Lua.ORDER_HIGH]},o.Lua.text_reverse=function(t){return["string.reverse("+(o.Lua.valueToCode(t,"TEXT",o.Lua.ORDER_NONE)||"''")+")",o.Lua.ORDER_HIGH]},o.Lua.variables={},o.Lua.variables_get=function(t){return[o.Lua.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),o.Lua.ORDER_ATOMIC]},o.Lua.variables_set=function(t){var e=o.Lua.valueToCode(t,"VALUE",o.Lua.ORDER_NONE)||"0";return o.Lua.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME)+" = "+e+"\n"},o.Lua.variablesDynamic={},o.Lua.variables_get_dynamic=o.Lua.variables_get,o.Lua.variables_set_dynamic=o.Lua.variables_set,o.Lua)})),st=G((function(t,e){var o;t.exports=(o=rt,j.Lua=o,o)})),at=G((function(t,e){var o;t.exports=((o=K).Dart=new o.Generator("Dart"),o.Dart.addReservedWords("assert,break,case,catch,class,const,continue,default,do,else,enum,extends,false,final,finally,for,if,in,is,new,null,rethrow,return,super,switch,this,throw,true,try,var,void,while,with,print,identityHashCode,identical,BidirectionalIterator,Comparable,double,Function,int,Invocation,Iterable,Iterator,List,Map,Match,num,Pattern,RegExp,Set,StackTrace,String,StringSink,Type,bool,DateTime,Deprecated,Duration,Expando,Null,Object,RuneIterator,Runes,Stopwatch,StringBuffer,Symbol,Uri,Comparator,AbstractClassInstantiationError,ArgumentError,AssertionError,CastError,ConcurrentModificationError,CyclicInitializationError,Error,Exception,FallThroughError,FormatException,IntegerDivisionByZeroException,NoSuchMethodError,NullThrownError,OutOfMemoryError,RangeError,StackOverflowError,StateError,TypeError,UnimplementedError,UnsupportedError"),o.Dart.ORDER_ATOMIC=0,o.Dart.ORDER_UNARY_POSTFIX=1,o.Dart.ORDER_UNARY_PREFIX=2,o.Dart.ORDER_MULTIPLICATIVE=3,o.Dart.ORDER_ADDITIVE=4,o.Dart.ORDER_SHIFT=5,o.Dart.ORDER_BITWISE_AND=6,o.Dart.ORDER_BITWISE_XOR=7,o.Dart.ORDER_BITWISE_OR=8,o.Dart.ORDER_RELATIONAL=9,o.Dart.ORDER_EQUALITY=10,o.Dart.ORDER_LOGICAL_AND=11,o.Dart.ORDER_LOGICAL_OR=12,o.Dart.ORDER_IF_NULL=13,o.Dart.ORDER_CONDITIONAL=14,o.Dart.ORDER_CASCADE=15,o.Dart.ORDER_ASSIGNMENT=16,o.Dart.ORDER_NONE=99,o.Dart.isInitialized=!1,o.Dart.init=function(t){o.Dart.definitions_=Object.create(null),o.Dart.functionNames_=Object.create(null),o.Dart.variableDB_?o.Dart.variableDB_.reset():o.Dart.variableDB_=new o.Names(o.Dart.RESERVED_WORDS_),o.Dart.variableDB_.setVariableMap(t.getVariableMap());for(var e=[],i=o.Variables.allDeveloperVariables(t),n=0;n<i.length;n++)e.push(o.Dart.variableDB_.getName(i[n],o.Names.DEVELOPER_VARIABLE_TYPE));for(t=o.Variables.allUsedVarModels(t),n=0;n<t.length;n++)e.push(o.Dart.variableDB_.getName(t[n].getId(),o.VARIABLE_CATEGORY_NAME));e.length&&(o.Dart.definitions_.variables="var "+e.join(", ")+";"),this.isInitialized=!0},o.Dart.finish=function(t){t&&(t=o.Dart.prefixLines(t,o.Dart.INDENT)),t="main() {\n"+t+"}";var e,i=[],n=[];for(e in o.Dart.definitions_){var r=o.Dart.definitions_[e];r.match(/^import\s/)?i.push(r):n.push(r)}return delete o.Dart.definitions_,delete o.Dart.functionNames_,o.Dart.variableDB_.reset(),(i.join("\n")+"\n\n"+n.join("\n\n")).replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+t},o.Dart.scrubNakedValue=function(t){return t+";\n"},o.Dart.quote_=function(t){return"'"+(t=t.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/\$/g,"\\$").replace(/'/g,"\\'"))+"'"},o.Dart.multiline_quote_=function(t){return t.split(/\n/g).map(o.Dart.quote_).join(" + '\\n' + \n")},o.Dart.scrub_=function(t,e,i){var n="";if(!t.outputConnection||!t.outputConnection.targetConnection){var r=t.getCommentText();r&&(r=o.utils.string.wrap(r,o.Dart.COMMENT_WRAP-3),n=t.getProcedureDef?n+o.Dart.prefixLines(r+"\n","/// "):n+o.Dart.prefixLines(r+"\n","// "));for(var s=0;s<t.inputList.length;s++)t.inputList[s].type==o.INPUT_VALUE&&(r=t.inputList[s].connection.targetBlock())&&(r=o.Dart.allNestedComments(r))&&(n+=o.Dart.prefixLines(r,"// "))}return t=t.nextConnection&&t.nextConnection.targetBlock(),n+e+(i=i?"":o.Dart.blockToCode(t))},o.Dart.getAdjusted=function(t,e,i,n,r){i=i||0,r=r||o.Dart.ORDER_NONE,t.workspace.options.oneBasedIndex&&i--;var s=t.workspace.options.oneBasedIndex?"1":"0";if(t=i?o.Dart.valueToCode(t,e,o.Dart.ORDER_ADDITIVE)||s:n?o.Dart.valueToCode(t,e,o.Dart.ORDER_UNARY_PREFIX)||s:o.Dart.valueToCode(t,e,r)||s,o.isNumber(t))t=parseInt(t,10)+i,n&&(t=-t);else{if(0<i){t=t+" + "+i;var a=o.Dart.ORDER_ADDITIVE}else 0>i&&(t=t+" - "+-i,a=o.Dart.ORDER_ADDITIVE);n&&(t=i?"-("+t+")":"-"+t,a=o.Dart.ORDER_UNARY_PREFIX),a=Math.floor(a),r=Math.floor(r),a&&r>=a&&(t="("+t+")")}return t},o.Dart.colour={},o.Dart.addReservedWords("Math"),o.Dart.colour_picker=function(t){return[o.Dart.quote_(t.getFieldValue("COLOUR")),o.Dart.ORDER_ATOMIC]},o.Dart.colour_random=function(t){return o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",[o.Dart.provideFunction_("colour_random",["String "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"() {","  String hex = '0123456789abcdef';","  var rnd = new Math.Random();","  return '#${hex[rnd.nextInt(16)]}${hex[rnd.nextInt(16)]}'","      '${hex[rnd.nextInt(16)]}${hex[rnd.nextInt(16)]}'","      '${hex[rnd.nextInt(16)]}${hex[rnd.nextInt(16)]}';","}"])+"()",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.colour_rgb=function(t){var e=o.Dart.valueToCode(t,"RED",o.Dart.ORDER_NONE)||0,i=o.Dart.valueToCode(t,"GREEN",o.Dart.ORDER_NONE)||0;return t=o.Dart.valueToCode(t,"BLUE",o.Dart.ORDER_NONE)||0,o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",[o.Dart.provideFunction_("colour_rgb",["String "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(num r, num g, num b) {","  num rn = (Math.max(Math.min(r, 100), 0) * 2.55).round();","  String rs = rn.toInt().toRadixString(16);","  rs = '0$rs';","  rs = rs.substring(rs.length - 2);","  num gn = (Math.max(Math.min(g, 100), 0) * 2.55).round();","  String gs = gn.toInt().toRadixString(16);","  gs = '0$gs';","  gs = gs.substring(gs.length - 2);","  num bn = (Math.max(Math.min(b, 100), 0) * 2.55).round();","  String bs = bn.toInt().toRadixString(16);","  bs = '0$bs';","  bs = bs.substring(bs.length - 2);","  return '#$rs$gs$bs';","}"])+"("+e+", "+i+", "+t+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.colour_blend=function(t){var e=o.Dart.valueToCode(t,"COLOUR1",o.Dart.ORDER_NONE)||"'#000000'",i=o.Dart.valueToCode(t,"COLOUR2",o.Dart.ORDER_NONE)||"'#000000'";return t=o.Dart.valueToCode(t,"RATIO",o.Dart.ORDER_NONE)||.5,o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",[o.Dart.provideFunction_("colour_blend",["String "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String c1, String c2, num ratio) {","  ratio = Math.max(Math.min(ratio, 1), 0);","  int r1 = int.parse('0x${c1.substring(1, 3)}');","  int g1 = int.parse('0x${c1.substring(3, 5)}');","  int b1 = int.parse('0x${c1.substring(5, 7)}');","  int r2 = int.parse('0x${c2.substring(1, 3)}');","  int g2 = int.parse('0x${c2.substring(3, 5)}');","  int b2 = int.parse('0x${c2.substring(5, 7)}');","  num rn = (r1 * (1 - ratio) + r2 * ratio).round();","  String rs = rn.toInt().toRadixString(16);","  num gn = (g1 * (1 - ratio) + g2 * ratio).round();","  String gs = gn.toInt().toRadixString(16);","  num bn = (b1 * (1 - ratio) + b2 * ratio).round();","  String bs = bn.toInt().toRadixString(16);","  rs = '0$rs';","  rs = rs.substring(rs.length - 2);","  gs = '0$gs';","  gs = gs.substring(gs.length - 2);","  bs = '0$bs';","  bs = bs.substring(bs.length - 2);","  return '#$rs$gs$bs';","}"])+"("+e+", "+i+", "+t+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.lists={},o.Dart.addReservedWords("Math"),o.Dart.lists_create_empty=function(t){return["[]",o.Dart.ORDER_ATOMIC]},o.Dart.lists_create_with=function(t){for(var e=Array(t.itemCount_),i=0;i<t.itemCount_;i++)e[i]=o.Dart.valueToCode(t,"ADD"+i,o.Dart.ORDER_NONE)||"null";return["["+e.join(", ")+"]",o.Dart.ORDER_ATOMIC]},o.Dart.lists_repeat=function(t){var e=o.Dart.valueToCode(t,"ITEM",o.Dart.ORDER_NONE)||"null";return["new List.filled("+(o.Dart.valueToCode(t,"NUM",o.Dart.ORDER_NONE)||"0")+", "+e+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.lists_length=function(t){return[(o.Dart.valueToCode(t,"VALUE",o.Dart.ORDER_UNARY_POSTFIX)||"[]")+".length",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.lists_isEmpty=function(t){return[(o.Dart.valueToCode(t,"VALUE",o.Dart.ORDER_UNARY_POSTFIX)||"[]")+".isEmpty",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.lists_indexOf=function(t){var e="FIRST"==t.getFieldValue("END")?"indexOf":"lastIndexOf",i=o.Dart.valueToCode(t,"FIND",o.Dart.ORDER_NONE)||"''";return e=(o.Dart.valueToCode(t,"VALUE",o.Dart.ORDER_UNARY_POSTFIX)||"[]")+"."+e+"("+i+")",t.workspace.options.oneBasedIndex?[e+" + 1",o.Dart.ORDER_ADDITIVE]:[e,o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.lists_getIndex=function(t){function e(){var t=o.Dart.variableDB_.getDistinctName("tmp_list",o.VARIABLE_CATEGORY_NAME),e="List "+t+" = "+r+";\n";return r=t,e}var i=t.getFieldValue("MODE")||"GET",n=t.getFieldValue("WHERE")||"FROM_START",r=o.Dart.valueToCode(t,"VALUE","RANDOM"==n||"FROM_END"==n?o.Dart.ORDER_NONE:o.Dart.ORDER_UNARY_POSTFIX)||"[]";if(("RANDOM"!=n||"REMOVE"!=i)&&"FROM_END"!=n||r.match(/^\w+$/))switch(n){case"FIRST":if("GET"==i)return[r+".first",o.Dart.ORDER_UNARY_POSTFIX];if("GET_REMOVE"==i)return[r+".removeAt(0)",o.Dart.ORDER_UNARY_POSTFIX];if("REMOVE"==i)return r+".removeAt(0);\n";break;case"LAST":if("GET"==i)return[r+".last",o.Dart.ORDER_UNARY_POSTFIX];if("GET_REMOVE"==i)return[r+".removeLast()",o.Dart.ORDER_UNARY_POSTFIX];if("REMOVE"==i)return r+".removeLast();\n";break;case"FROM_START":if(n=o.Dart.getAdjusted(t,"AT"),"GET"==i)return[r+"["+n+"]",o.Dart.ORDER_UNARY_POSTFIX];if("GET_REMOVE"==i)return[r+".removeAt("+n+")",o.Dart.ORDER_UNARY_POSTFIX];if("REMOVE"==i)return r+".removeAt("+n+");\n";break;case"FROM_END":if(n=o.Dart.getAdjusted(t,"AT",1,!1,o.Dart.ORDER_ADDITIVE),"GET"==i)return[r+"["+r+".length - "+n+"]",o.Dart.ORDER_UNARY_POSTFIX];if("GET_REMOVE"==i||"REMOVE"==i){if(t=r+".removeAt("+r+".length - "+n+")","GET_REMOVE"==i)return[t,o.Dart.ORDER_UNARY_POSTFIX];if("REMOVE"==i)return t+";\n"}break;case"RANDOM":if(o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;","REMOVE"==i)return"int "+(i=o.Dart.variableDB_.getDistinctName("tmp_x",o.VARIABLE_CATEGORY_NAME))+" = new Math.Random().nextInt("+r+".length);\n"+r+".removeAt("+i+");\n";if("GET"==i)return[(i=o.Dart.provideFunction_("lists_get_random_item",["dynamic "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List my_list) {","  int x = new Math.Random().nextInt(my_list.length);","  return my_list[x];","}"]))+"("+r+")",o.Dart.ORDER_UNARY_POSTFIX];if("GET_REMOVE"==i)return[(i=o.Dart.provideFunction_("lists_remove_random_item",["dynamic "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List my_list) {","  int x = new Math.Random().nextInt(my_list.length);","  return my_list.removeAt(x);","}"]))+"("+r+")",o.Dart.ORDER_UNARY_POSTFIX]}else{if("RANDOM"==n)return o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",(t=e())+"int "+(i=o.Dart.variableDB_.getDistinctName("tmp_x",o.VARIABLE_CATEGORY_NAME))+" = new Math.Random().nextInt("+r+".length);\n"+r+".removeAt("+i+");\n";if("REMOVE"==i)return n=o.Dart.getAdjusted(t,"AT",1,!1,o.Dart.ORDER_ADDITIVE),(t=e())+(r+".removeAt(")+r+".length - "+n+");\n";if("GET"==i)return n=o.Dart.getAdjusted(t,"AT",1),[(i=o.Dart.provideFunction_("lists_get_from_end",["dynamic "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List my_list, num x) {","  x = my_list.length - x;","  return my_list[x];","}"]))+"("+r+", "+n+")",o.Dart.ORDER_UNARY_POSTFIX];if("GET_REMOVE"==i)return n=o.Dart.getAdjusted(t,"AT",1),[(i=o.Dart.provideFunction_("lists_remove_from_end",["dynamic "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List my_list, num x) {","  x = my_list.length - x;","  return my_list.removeAt(x);","}"]))+"("+r+", "+n+")",o.Dart.ORDER_UNARY_POSTFIX]}throw Error("Unhandled combination (lists_getIndex).")},o.Dart.lists_setIndex=function(t){function e(){if(r.match(/^\w+$/))return"";var t=o.Dart.variableDB_.getDistinctName("tmp_list",o.VARIABLE_CATEGORY_NAME),e="List "+t+" = "+r+";\n";return r=t,e}var i=t.getFieldValue("MODE")||"GET",n=t.getFieldValue("WHERE")||"FROM_START",r=o.Dart.valueToCode(t,"LIST",o.Dart.ORDER_UNARY_POSTFIX)||"[]",s=o.Dart.valueToCode(t,"TO",o.Dart.ORDER_ASSIGNMENT)||"null";switch(n){case"FIRST":if("SET"==i)return r+"[0] = "+s+";\n";if("INSERT"==i)return r+".insert(0, "+s+");\n";break;case"LAST":if("SET"==i)return(t=e())+(r+"[")+r+".length - 1] = "+s+";\n";if("INSERT"==i)return r+".add("+s+");\n";break;case"FROM_START":if(n=o.Dart.getAdjusted(t,"AT"),"SET"==i)return r+"["+n+"] = "+s+";\n";if("INSERT"==i)return r+".insert("+n+", "+s+");\n";break;case"FROM_END":if(n=o.Dart.getAdjusted(t,"AT",1,!1,o.Dart.ORDER_ADDITIVE),t=e(),"SET"==i)return t+(r+"[")+r+".length - "+n+"] = "+s+";\n";if("INSERT"==i)return t+(r+".insert(")+r+".length - "+n+", "+s+");\n";break;case"RANDOM":if(o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",t=e(),t+="int "+(n=o.Dart.variableDB_.getDistinctName("tmp_x",o.VARIABLE_CATEGORY_NAME))+" = new Math.Random().nextInt("+r+".length);\n","SET"==i)return t+(r+"[")+n+"] = "+s+";\n";if("INSERT"==i)return t+(r+".insert(")+n+", "+s+");\n"}throw Error("Unhandled combination (lists_setIndex).")},o.Dart.lists_getSublist=function(t){var e=o.Dart.valueToCode(t,"LIST",o.Dart.ORDER_UNARY_POSTFIX)||"[]",i=t.getFieldValue("WHERE1"),n=t.getFieldValue("WHERE2");if(e.match(/^\w+$/)||"FROM_END"!=i&&"FROM_START"==n){switch(i){case"FROM_START":var r=o.Dart.getAdjusted(t,"AT1");break;case"FROM_END":r=e+".length - "+(r=o.Dart.getAdjusted(t,"AT1",1,!1,o.Dart.ORDER_ADDITIVE));break;case"FIRST":r="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(n){case"FROM_START":var s=o.Dart.getAdjusted(t,"AT2",1);break;case"FROM_END":s=e+".length - "+(s=o.Dart.getAdjusted(t,"AT2",0,!1,o.Dart.ORDER_ADDITIVE));break;case"LAST":break;default:throw Error("Unhandled option (lists_getSublist).")}t="LAST"==n?e+".sublist("+r+")":e+".sublist("+r+", "+s+")"}else r=o.Dart.getAdjusted(t,"AT1"),s=o.Dart.getAdjusted(t,"AT2"),t=o.Dart.provideFunction_("lists_get_sublist",["List "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List list, String where1, num at1, String where2, num at2) {","  int getAt(String where, num at) {","    if (where == 'FROM_END') {","      at = list.length - 1 - at;","    } else if (where == 'FIRST') {","      at = 0;","    } else if (where == 'LAST') {","      at = list.length - 1;","    } else if (where != 'FROM_START') {","      throw 'Unhandled option (lists_getSublist).';","    }","    return at;","  }","  at1 = getAt(where1, at1);","  at2 = getAt(where2, at2) + 1;","  return list.sublist(at1, at2);","}"])+"("+e+", '"+i+"', "+r+", '"+n+"', "+s+")";return[t,o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.lists_sort=function(t){var e=o.Dart.valueToCode(t,"LIST",o.Dart.ORDER_NONE)||"[]",i="1"===t.getFieldValue("DIRECTION")?1:-1;return t=t.getFieldValue("TYPE"),[o.Dart.provideFunction_("lists_sort",["List "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List list, String type, int direction) {","  var compareFuncs = {",'    "NUMERIC": (a, b) => (direction * a.compareTo(b)).toInt(),','    "TEXT": (a, b) => direction * a.toString().compareTo(b.toString()),','    "IGNORE_CASE": ',"       (a, b) => direction * ","      a.toString().toLowerCase().compareTo(b.toString().toLowerCase())","  };","  list = new List.from(list);","  var compare = compareFuncs[type];","  list.sort(compare);","  return list;","}"])+"("+e+', "'+t+'", '+i+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.lists_split=function(t){var e=o.Dart.valueToCode(t,"INPUT",o.Dart.ORDER_UNARY_POSTFIX),i=o.Dart.valueToCode(t,"DELIM",o.Dart.ORDER_NONE)||"''";if("SPLIT"==(t=t.getFieldValue("MODE")))e||(e="''"),t="split";else{if("JOIN"!=t)throw Error("Unknown mode: "+t);e||(e="[]"),t="join"}return[e+"."+t+"("+i+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.lists_reverse=function(t){return["new List.from("+(o.Dart.valueToCode(t,"LIST",o.Dart.ORDER_NONE)||"[]")+".reversed)",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.logic={},o.Dart.controls_if=function(t){var e=0,i="";o.Dart.STATEMENT_PREFIX&&(i+=o.Dart.injectId(o.Dart.STATEMENT_PREFIX,t));do{var n=o.Dart.valueToCode(t,"IF"+e,o.Dart.ORDER_NONE)||"false",r=o.Dart.statementToCode(t,"DO"+e);o.Dart.STATEMENT_SUFFIX&&(r=o.Dart.prefixLines(o.Dart.injectId(o.Dart.STATEMENT_SUFFIX,t),o.Dart.INDENT)+r),i+=(0<e?"else ":"")+"if ("+n+") {\n"+r+"}",++e}while(t.getInput("IF"+e));return(t.getInput("ELSE")||o.Dart.STATEMENT_SUFFIX)&&(r=o.Dart.statementToCode(t,"ELSE"),o.Dart.STATEMENT_SUFFIX&&(r=o.Dart.prefixLines(o.Dart.injectId(o.Dart.STATEMENT_SUFFIX,t),o.Dart.INDENT)+r),i+=" else {\n"+r+"}"),i+"\n"},o.Dart.controls_ifelse=o.Dart.controls_if,o.Dart.logic_compare=function(t){var e={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[t.getFieldValue("OP")],i="=="==e||"!="==e?o.Dart.ORDER_EQUALITY:o.Dart.ORDER_RELATIONAL;return[(o.Dart.valueToCode(t,"A",i)||"0")+" "+e+" "+(t=o.Dart.valueToCode(t,"B",i)||"0"),i]},o.Dart.logic_operation=function(t){var e="AND"==t.getFieldValue("OP")?"&&":"||",i="&&"==e?o.Dart.ORDER_LOGICAL_AND:o.Dart.ORDER_LOGICAL_OR,n=o.Dart.valueToCode(t,"A",i);if(t=o.Dart.valueToCode(t,"B",i),n||t){var r="&&"==e?"true":"false";n||(n=r),t||(t=r)}else t=n="false";return[n+" "+e+" "+t,i]},o.Dart.logic_negate=function(t){var e=o.Dart.ORDER_UNARY_PREFIX;return["!"+(o.Dart.valueToCode(t,"BOOL",e)||"true"),e]},o.Dart.logic_boolean=function(t){return["TRUE"==t.getFieldValue("BOOL")?"true":"false",o.Dart.ORDER_ATOMIC]},o.Dart.logic_null=function(t){return["null",o.Dart.ORDER_ATOMIC]},o.Dart.logic_ternary=function(t){return[(o.Dart.valueToCode(t,"IF",o.Dart.ORDER_CONDITIONAL)||"false")+" ? "+(o.Dart.valueToCode(t,"THEN",o.Dart.ORDER_CONDITIONAL)||"null")+" : "+(t=o.Dart.valueToCode(t,"ELSE",o.Dart.ORDER_CONDITIONAL)||"null"),o.Dart.ORDER_CONDITIONAL]},o.Dart.loops={},o.Dart.controls_repeat_ext=function(t){var e=t.getField("TIMES")?String(Number(t.getFieldValue("TIMES"))):o.Dart.valueToCode(t,"TIMES",o.Dart.ORDER_ASSIGNMENT)||"0",i=o.Dart.statementToCode(t,"DO");i=o.Dart.addLoopTrap(i,t),t="";var n=o.Dart.variableDB_.getDistinctName("count",o.VARIABLE_CATEGORY_NAME),r=e;return e.match(/^\w+$/)||o.isNumber(e)||(t+="var "+(r=o.Dart.variableDB_.getDistinctName("repeat_end",o.VARIABLE_CATEGORY_NAME))+" = "+e+";\n"),t+"for (int "+n+" = 0; "+n+" < "+r+"; "+n+"++) {\n"+i+"}\n"},o.Dart.controls_repeat=o.Dart.controls_repeat_ext,o.Dart.controls_whileUntil=function(t){var e="UNTIL"==t.getFieldValue("MODE"),i=o.Dart.valueToCode(t,"BOOL",e?o.Dart.ORDER_UNARY_PREFIX:o.Dart.ORDER_NONE)||"false",n=o.Dart.statementToCode(t,"DO");return e&&(i="!"+i),"while ("+i+") {\n"+(n=o.Dart.addLoopTrap(n,t))+"}\n"},o.Dart.controls_for=function(t){var e=o.Dart.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),i=o.Dart.valueToCode(t,"FROM",o.Dart.ORDER_ASSIGNMENT)||"0",n=o.Dart.valueToCode(t,"TO",o.Dart.ORDER_ASSIGNMENT)||"0",r=o.Dart.valueToCode(t,"BY",o.Dart.ORDER_ASSIGNMENT)||"1",s=o.Dart.statementToCode(t,"DO");if(s=o.Dart.addLoopTrap(s,t),o.isNumber(i)&&o.isNumber(n)&&o.isNumber(r)){var a=Number(i)<=Number(n);t="for ("+e+" = "+i+"; "+e+(a?" <= ":" >= ")+n+"; "+e,t=(1==(e=Math.abs(Number(r)))?t+(a?"++":"--"):t+(a?" += ":" -= ")+e)+") {\n"+s+"}\n"}else t="",a=i,i.match(/^\w+$/)||o.isNumber(i)||(t+="var "+(a=o.Dart.variableDB_.getDistinctName(e+"_start",o.VARIABLE_CATEGORY_NAME))+" = "+i+";\n"),i=n,n.match(/^\w+$/)||o.isNumber(n)||(t+="var "+(i=o.Dart.variableDB_.getDistinctName(e+"_end",o.VARIABLE_CATEGORY_NAME))+" = "+n+";\n"),t+="num "+(n=o.Dart.variableDB_.getDistinctName(e+"_inc",o.VARIABLE_CATEGORY_NAME))+" = ",t=(t=o.isNumber(r)?t+(Math.abs(r)+";\n"):t+"("+r+").abs();\n")+"if ("+a+" > "+i+") {\n"+(o.Dart.INDENT+n)+" = -"+n+";\n",t+="}\n",t+="for ("+e+" = "+a+"; "+n+" >= 0 ? "+e+" <= "+i+" : "+e+" >= "+i+"; "+e+" += "+n+") {\n"+s+"}\n";return t},o.Dart.controls_forEach=function(t){var e=o.Dart.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),i=o.Dart.valueToCode(t,"LIST",o.Dart.ORDER_ASSIGNMENT)||"[]",n=o.Dart.statementToCode(t,"DO");return"for (var "+e+" in "+i+") {\n"+(n=o.Dart.addLoopTrap(n,t))+"}\n"},o.Dart.controls_flow_statements=function(t){var e="";if(o.Dart.STATEMENT_PREFIX&&(e+=o.Dart.injectId(o.Dart.STATEMENT_PREFIX,t)),o.Dart.STATEMENT_SUFFIX&&(e+=o.Dart.injectId(o.Dart.STATEMENT_SUFFIX,t)),o.Dart.STATEMENT_PREFIX){var i=o.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(t);i&&!i.suppressPrefixSuffix&&(e+=o.Dart.injectId(o.Dart.STATEMENT_PREFIX,i))}switch(t.getFieldValue("FLOW")){case"BREAK":return e+"break;\n";case"CONTINUE":return e+"continue;\n"}throw Error("Unknown flow statement.")},o.Dart.math={},o.Dart.addReservedWords("Math"),o.Dart.math_number=function(t){if(1/0==(t=Number(t.getFieldValue("NUM")))){t="double.infinity";var e=o.Dart.ORDER_UNARY_POSTFIX}else-1/0==t?(t="-double.infinity",e=o.Dart.ORDER_UNARY_PREFIX):e=0>t?o.Dart.ORDER_UNARY_PREFIX:o.Dart.ORDER_ATOMIC;return[t,e]},o.Dart.math_arithmetic=function(t){var e={ADD:[" + ",o.Dart.ORDER_ADDITIVE],MINUS:[" - ",o.Dart.ORDER_ADDITIVE],MULTIPLY:[" * ",o.Dart.ORDER_MULTIPLICATIVE],DIVIDE:[" / ",o.Dart.ORDER_MULTIPLICATIVE],POWER:[null,o.Dart.ORDER_NONE]}[t.getFieldValue("OP")],i=e[0];e=e[1];var n=o.Dart.valueToCode(t,"A",e)||"0";return t=o.Dart.valueToCode(t,"B",e)||"0",i?[n+i+t,e]:(o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",["Math.pow("+n+", "+t+")",o.Dart.ORDER_UNARY_POSTFIX])},o.Dart.math_single=function(t){var e=t.getFieldValue("OP");if("NEG"==e)return"-"==(t=o.Dart.valueToCode(t,"NUM",o.Dart.ORDER_UNARY_PREFIX)||"0")[0]&&(t=" "+t),["-"+t,o.Dart.ORDER_UNARY_PREFIX];switch(o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",t="ABS"==e||"ROUND"==e.substring(0,5)?o.Dart.valueToCode(t,"NUM",o.Dart.ORDER_UNARY_POSTFIX)||"0":"SIN"==e||"COS"==e||"TAN"==e?o.Dart.valueToCode(t,"NUM",o.Dart.ORDER_MULTIPLICATIVE)||"0":o.Dart.valueToCode(t,"NUM",o.Dart.ORDER_NONE)||"0",e){case"ABS":var i=t+".abs()";break;case"ROOT":i="Math.sqrt("+t+")";break;case"LN":i="Math.log("+t+")";break;case"EXP":i="Math.exp("+t+")";break;case"POW10":i="Math.pow(10,"+t+")";break;case"ROUND":i=t+".round()";break;case"ROUNDUP":i=t+".ceil()";break;case"ROUNDDOWN":i=t+".floor()";break;case"SIN":i="Math.sin("+t+" / 180 * Math.pi)";break;case"COS":i="Math.cos("+t+" / 180 * Math.pi)";break;case"TAN":i="Math.tan("+t+" / 180 * Math.pi)"}if(i)return[i,o.Dart.ORDER_UNARY_POSTFIX];switch(e){case"LOG10":i="Math.log("+t+") / Math.log(10)";break;case"ASIN":i="Math.asin("+t+") / Math.pi * 180";break;case"ACOS":i="Math.acos("+t+") / Math.pi * 180";break;case"ATAN":i="Math.atan("+t+") / Math.pi * 180";break;default:throw Error("Unknown math operator: "+e)}return[i,o.Dart.ORDER_MULTIPLICATIVE]},o.Dart.math_constant=function(t){var e={PI:["Math.pi",o.Dart.ORDER_UNARY_POSTFIX],E:["Math.e",o.Dart.ORDER_UNARY_POSTFIX],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",o.Dart.ORDER_MULTIPLICATIVE],SQRT2:["Math.sqrt2",o.Dart.ORDER_UNARY_POSTFIX],SQRT1_2:["Math.sqrt1_2",o.Dart.ORDER_UNARY_POSTFIX],INFINITY:["double.infinity",o.Dart.ORDER_ATOMIC]};return"INFINITY"!=(t=t.getFieldValue("CONSTANT"))&&(o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;"),e[t]},o.Dart.math_number_property=function(t){var e=o.Dart.valueToCode(t,"NUMBER_TO_CHECK",o.Dart.ORDER_MULTIPLICATIVE);if(!e)return["false",o.Dart.ORDER_ATOMIC];var i=t.getFieldValue("PROPERTY");if("PRIME"==i)return o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",[o.Dart.provideFunction_("math_isPrime",["bool "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(n) {","  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if (n == 2 || n == 3) {","    return true;","  }","  // False if n is null, negative, is 1, or not whole.","  // And false if n is divisible by 2 or 3.","  if (n == null || n <= 1 || n % 1 != 0 || n % 2 == 0 || n % 3 == 0) {","    return false;","  }","  // Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {","    if (n % (x - 1) == 0 || n % (x + 1) == 0) {","      return false;","    }","  }","  return true;","}"])+"("+e+")",o.Dart.ORDER_UNARY_POSTFIX];switch(i){case"EVEN":var n=e+" % 2 == 0";break;case"ODD":n=e+" % 2 == 1";break;case"WHOLE":n=e+" % 1 == 0";break;case"POSITIVE":n=e+" > 0";break;case"NEGATIVE":n=e+" < 0";break;case"DIVISIBLE_BY":if(!(t=o.Dart.valueToCode(t,"DIVISOR",o.Dart.ORDER_MULTIPLICATIVE)))return["false",o.Dart.ORDER_ATOMIC];n=e+" % "+t+" == 0"}return[n,o.Dart.ORDER_EQUALITY]},o.Dart.math_change=function(t){var e=o.Dart.valueToCode(t,"DELTA",o.Dart.ORDER_ADDITIVE)||"0";return(t=o.Dart.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME))+" = ("+t+" is num ? "+t+" : 0) + "+e+";\n"},o.Dart.math_round=o.Dart.math_single,o.Dart.math_trig=o.Dart.math_single,o.Dart.math_on_list=function(t){var e=t.getFieldValue("OP");switch(t=o.Dart.valueToCode(t,"LIST",o.Dart.ORDER_NONE)||"[]",e){case"SUM":e=(e=o.Dart.provideFunction_("math_sum",["num "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List<num> myList) {","  num sumVal = 0;","  myList.forEach((num entry) {sumVal += entry;});","  return sumVal;","}"]))+"("+t+")";break;case"MIN":o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",e=(e=o.Dart.provideFunction_("math_min",["num "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List<num> myList) {","  if (myList.isEmpty) return null;","  num minVal = myList[0];","  myList.forEach((num entry) {minVal = Math.min(minVal, entry);});","  return minVal;","}"]))+"("+t+")";break;case"MAX":o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",e=(e=o.Dart.provideFunction_("math_max",["num "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List<num> myList) {","  if (myList.isEmpty) return null;","  num maxVal = myList[0];","  myList.forEach((num entry) {maxVal = Math.max(maxVal, entry);});","  return maxVal;","}"]))+"("+t+")";break;case"AVERAGE":e=(e=o.Dart.provideFunction_("math_mean",["num "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List myList) {","  // First filter list for numbers only.","  List localList = new List.from(myList);","  localList.removeWhere((a) => a is! num);","  if (localList.isEmpty) return null;","  num sumVal = 0;","  localList.forEach((var entry) {sumVal += entry;});","  return sumVal / localList.length;","}"]))+"("+t+")";break;case"MEDIAN":e=(e=o.Dart.provideFunction_("math_median",["num "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List myList) {","  // First filter list for numbers only, then sort, then return middle value","  // or the average of two middle values if list has an even number of elements.","  List localList = new List.from(myList);","  localList.removeWhere((a) => a is! num);","  if (localList.isEmpty) return null;","  localList.sort((a, b) => (a - b));","  int index = localList.length ~/ 2;","  if (localList.length % 2 == 1) {","    return localList[index];","  } else {","    return (localList[index - 1] + localList[index]) / 2;","  }","}"]))+"("+t+")";break;case"MODE":o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",e=(e=o.Dart.provideFunction_("math_modes",["List "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List values) {","  List modes = [];","  List counts = [];","  int maxCount = 0;","  for (int i = 0; i < values.length; i++) {","    var value = values[i];","    bool found = false;","    int thisCount;","    for (int j = 0; j < counts.length; j++) {","      if (counts[j][0] == value) {","        thisCount = ++counts[j][1];","        found = true;","        break;","      }","    }","    if (!found) {","      counts.add([value, 1]);","      thisCount = 1;","    }","    maxCount = Math.max(thisCount, maxCount);","  }","  for (int j = 0; j < counts.length; j++) {","    if (counts[j][1] == maxCount) {","        modes.add(counts[j][0]);","    }","  }","  return modes;","}"]))+"("+t+")";break;case"STD_DEV":o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",e=(e=o.Dart.provideFunction_("math_standard_deviation",["num "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List myList) {","  // First filter list for numbers only.","  List numbers = new List.from(myList);","  numbers.removeWhere((a) => a is! num);","  if (numbers.isEmpty) return null;","  num n = numbers.length;","  num sum = 0;","  numbers.forEach((x) => sum += x);","  num mean = sum / n;","  num sumSquare = 0;","  numbers.forEach((x) => sumSquare += Math.pow(x - mean, 2));","  return Math.sqrt(sumSquare / n);","}"]))+"("+t+")";break;case"RANDOM":o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",e=(e=o.Dart.provideFunction_("math_random_item",["dynamic "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(List myList) {","  int x = new Math.Random().nextInt(myList.length);","  return myList[x];","}"]))+"("+t+")";break;default:throw Error("Unknown operator: "+e)}return[e,o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.math_modulo=function(t){return[(o.Dart.valueToCode(t,"DIVIDEND",o.Dart.ORDER_MULTIPLICATIVE)||"0")+" % "+(t=o.Dart.valueToCode(t,"DIVISOR",o.Dart.ORDER_MULTIPLICATIVE)||"0"),o.Dart.ORDER_MULTIPLICATIVE]},o.Dart.math_constrain=function(t){return o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",["Math.min(Math.max("+(o.Dart.valueToCode(t,"VALUE",o.Dart.ORDER_NONE)||"0")+", "+(o.Dart.valueToCode(t,"LOW",o.Dart.ORDER_NONE)||"0")+"), "+(t=o.Dart.valueToCode(t,"HIGH",o.Dart.ORDER_NONE)||"double.infinity")+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.math_random_int=function(t){o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;";var e=o.Dart.valueToCode(t,"FROM",o.Dart.ORDER_NONE)||"0";return t=o.Dart.valueToCode(t,"TO",o.Dart.ORDER_NONE)||"0",[o.Dart.provideFunction_("math_random_int",["int "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(num a, num b) {","  if (a > b) {","    // Swap a and b to ensure a is smaller.","    num c = a;","    a = b;","    b = c;","  }","  return new Math.Random().nextInt(b - a + 1) + a;","}"])+"("+e+", "+t+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.math_random_float=function(t){return o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",["new Math.Random().nextDouble()",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.math_atan2=function(t){o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;";var e=o.Dart.valueToCode(t,"X",o.Dart.ORDER_NONE)||"0";return["Math.atan2("+(o.Dart.valueToCode(t,"Y",o.Dart.ORDER_NONE)||"0")+", "+e+") / Math.pi * 180",o.Dart.ORDER_MULTIPLICATIVE]},o.Dart.procedures={},o.Dart.procedures_defreturn=function(t){var e=o.Dart.variableDB_.getName(t.getFieldValue("NAME"),o.PROCEDURE_CATEGORY_NAME),i="";o.Dart.STATEMENT_PREFIX&&(i+=o.Dart.injectId(o.Dart.STATEMENT_PREFIX,t)),o.Dart.STATEMENT_SUFFIX&&(i+=o.Dart.injectId(o.Dart.STATEMENT_SUFFIX,t)),i&&(i=o.Dart.prefixLines(i,o.Dart.INDENT));var n="";o.Dart.INFINITE_LOOP_TRAP&&(n=o.Dart.prefixLines(o.Dart.injectId(o.Dart.INFINITE_LOOP_TRAP,t),o.Dart.INDENT));var r=o.Dart.statementToCode(t,"STACK"),s=o.Dart.valueToCode(t,"RETURN",o.Dart.ORDER_NONE)||"",a="";r&&s&&(a=i),s&&(s=o.Dart.INDENT+"return "+s+";\n");for(var l=s?"dynamic":"void",c=[],u=t.getVars(),h=0;h<u.length;h++)c[h]=o.Dart.variableDB_.getName(u[h],o.VARIABLE_CATEGORY_NAME);return i=l+" "+e+"("+c.join(", ")+") {\n"+i+n+r+a+s+"}",i=o.Dart.scrub_(t,i),o.Dart.definitions_["%"+e]=i,null},o.Dart.procedures_defnoreturn=o.Dart.procedures_defreturn,o.Dart.procedures_callreturn=function(t){for(var e=o.Dart.variableDB_.getName(t.getFieldValue("NAME"),o.PROCEDURE_CATEGORY_NAME),i=[],n=t.getVars(),r=0;r<n.length;r++)i[r]=o.Dart.valueToCode(t,"ARG"+r,o.Dart.ORDER_NONE)||"null";return[e+"("+i.join(", ")+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.procedures_callnoreturn=function(t){return o.Dart.procedures_callreturn(t)[0]+";\n"},o.Dart.procedures_ifreturn=function(t){var e="if ("+(o.Dart.valueToCode(t,"CONDITION",o.Dart.ORDER_NONE)||"false")+") {\n";return o.Dart.STATEMENT_SUFFIX&&(e+=o.Dart.prefixLines(o.Dart.injectId(o.Dart.STATEMENT_SUFFIX,t),o.Dart.INDENT)),t.hasReturnValue_?(t=o.Dart.valueToCode(t,"VALUE",o.Dart.ORDER_NONE)||"null",e+=o.Dart.INDENT+"return "+t+";\n"):e+=o.Dart.INDENT+"return;\n",e+"}\n"},o.Dart.texts={},o.Dart.addReservedWords("Html,Math"),o.Dart.text=function(t){return[o.Dart.quote_(t.getFieldValue("TEXT")),o.Dart.ORDER_ATOMIC]},o.Dart.text_multiline=function(t){var e=-1!=(t=o.Dart.multiline_quote_(t.getFieldValue("TEXT"))).indexOf("+")?o.Dart.ORDER_ADDITIVE:o.Dart.ORDER_ATOMIC;return[t,e]},o.Dart.text_join=function(t){switch(t.itemCount_){case 0:return["''",o.Dart.ORDER_ATOMIC];case 1:return[(o.Dart.valueToCode(t,"ADD0",o.Dart.ORDER_UNARY_POSTFIX)||"''")+".toString()",o.Dart.ORDER_UNARY_POSTFIX];default:for(var e=Array(t.itemCount_),i=0;i<t.itemCount_;i++)e[i]=o.Dart.valueToCode(t,"ADD"+i,o.Dart.ORDER_NONE)||"''";return[t="["+e.join(",")+"].join()",o.Dart.ORDER_UNARY_POSTFIX]}},o.Dart.text_append=function(t){var e=o.Dart.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME);return e+" = ["+e+", "+(t=o.Dart.valueToCode(t,"TEXT",o.Dart.ORDER_NONE)||"''")+"].join();\n"},o.Dart.text_length=function(t){return[(o.Dart.valueToCode(t,"VALUE",o.Dart.ORDER_UNARY_POSTFIX)||"''")+".length",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.text_isEmpty=function(t){return[(o.Dart.valueToCode(t,"VALUE",o.Dart.ORDER_UNARY_POSTFIX)||"''")+".isEmpty",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.text_indexOf=function(t){var e="FIRST"==t.getFieldValue("END")?"indexOf":"lastIndexOf",i=o.Dart.valueToCode(t,"FIND",o.Dart.ORDER_NONE)||"''";return e=(o.Dart.valueToCode(t,"VALUE",o.Dart.ORDER_UNARY_POSTFIX)||"''")+"."+e+"("+i+")",t.workspace.options.oneBasedIndex?[e+" + 1",o.Dart.ORDER_ADDITIVE]:[e,o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.text_charAt=function(t){var e=t.getFieldValue("WHERE")||"FROM_START",i=o.Dart.valueToCode(t,"VALUE","FIRST"==e||"FROM_START"==e?o.Dart.ORDER_UNARY_POSTFIX:o.Dart.ORDER_NONE)||"''";switch(e){case"FIRST":return[i+"[0]",o.Dart.ORDER_UNARY_POSTFIX];case"FROM_START":return[i+"["+(t=o.Dart.getAdjusted(t,"AT"))+"]",o.Dart.ORDER_UNARY_POSTFIX];case"LAST":case"FROM_END":return t=o.Dart.getAdjusted(t,"AT",1),[(e=o.Dart.provideFunction_("text_get_from_end",["String "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String text, num x) {","  return text[text.length - x];","}"]))+"("+i+", "+t+")",o.Dart.ORDER_UNARY_POSTFIX];case"RANDOM":return o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",[(e=o.Dart.provideFunction_("text_random_letter",["String "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String text) {","  int x = new Math.Random().nextInt(text.length);","  return text[x];","}"]))+"("+i+")",o.Dart.ORDER_UNARY_POSTFIX]}throw Error("Unhandled option (text_charAt).")},o.Dart.text_getSubstring=function(t){var e=t.getFieldValue("WHERE1"),i=t.getFieldValue("WHERE2"),n="FROM_END"!=e&&"FROM_START"==i,r=o.Dart.valueToCode(t,"STRING",n?o.Dart.ORDER_UNARY_POSTFIX:o.Dart.ORDER_NONE)||"''";if("FIRST"==e&&"LAST"==i)return[r,o.Dart.ORDER_NONE];if(r.match(/^'?\w+'?$/)||n){switch(e){case"FROM_START":n=o.Dart.getAdjusted(t,"AT1");break;case"FROM_END":n=r+".length - "+(n=o.Dart.getAdjusted(t,"AT1",1,!1,o.Dart.ORDER_ADDITIVE));break;case"FIRST":n="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(i){case"FROM_START":var s=o.Dart.getAdjusted(t,"AT2",1);break;case"FROM_END":s=r+".length - "+(s=o.Dart.getAdjusted(t,"AT2",0,!1,o.Dart.ORDER_ADDITIVE));break;case"LAST":break;default:throw Error("Unhandled option (text_getSubstring).")}t="LAST"==i?r+".substring("+n+")":r+".substring("+n+", "+s+")"}else n=o.Dart.getAdjusted(t,"AT1"),s=o.Dart.getAdjusted(t,"AT2"),t=o.Dart.provideFunction_("text_get_substring",["String "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String text, String where1, num at1, String where2, num at2) {","  int getAt(String where, num at) {","    if (where == 'FROM_END') {","      at = text.length - 1 - at;","    } else if (where == 'FIRST') {","      at = 0;","    } else if (where == 'LAST') {","      at = text.length - 1;","    } else if (where != 'FROM_START') {","      throw 'Unhandled option (text_getSubstring).';","    }","    return at;","  }","  at1 = getAt(where1, at1);","  at2 = getAt(where2, at2) + 1;","  return text.substring(at1, at2);","}"])+"("+r+", '"+e+"', "+n+", '"+i+"', "+s+")";return[t,o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.text_changeCase=function(t){var e={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[t.getFieldValue("CASE")];return t=o.Dart.valueToCode(t,"TEXT",e?o.Dart.ORDER_UNARY_POSTFIX:o.Dart.ORDER_NONE)||"''",[e?t+e:o.Dart.provideFunction_("text_toTitleCase",["String "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String str) {","  RegExp exp = new RegExp(r'\\b');","  List<String> list = str.split(exp);","  final title = new StringBuffer();","  for (String part in list) {","    if (part.length > 0) {","      title.write(part[0].toUpperCase());","      if (part.length > 0) {","        title.write(part.substring(1).toLowerCase());","      }","    }","  }","  return title.toString();","}"])+"("+t+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.text_trim=function(t){var e={LEFT:".replaceFirst(new RegExp(r'^\\s+'), '')",RIGHT:".replaceFirst(new RegExp(r'\\s+$'), '')",BOTH:".trim()"}[t.getFieldValue("MODE")];return[(o.Dart.valueToCode(t,"TEXT",o.Dart.ORDER_UNARY_POSTFIX)||"''")+e,o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.text_print=function(t){return"print("+(o.Dart.valueToCode(t,"TEXT",o.Dart.ORDER_NONE)||"''")+");\n"},o.Dart.text_prompt_ext=function(t){o.Dart.definitions_.import_dart_html="import 'dart:html' as Html;";var e="Html.window.prompt("+(t.getField("TEXT")?o.Dart.quote_(t.getFieldValue("TEXT")):o.Dart.valueToCode(t,"TEXT",o.Dart.ORDER_NONE)||"''")+", '')";return"NUMBER"==t.getFieldValue("TYPE")&&(o.Dart.definitions_.import_dart_math="import 'dart:math' as Math;",e="Math.parseDouble("+e+")"),[e,o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.text_prompt=o.Dart.text_prompt_ext,o.Dart.text_count=function(t){var e=o.Dart.valueToCode(t,"TEXT",o.Dart.ORDER_NONE)||"''";return t=o.Dart.valueToCode(t,"SUB",o.Dart.ORDER_NONE)||"''",[o.Dart.provideFunction_("text_count",["int "+o.Dart.FUNCTION_NAME_PLACEHOLDER_+"(String haystack, String needle) {","  if (needle.length == 0) {","    return haystack.length + 1;","  }","  int index = 0;","  int count = 0;","  while (index != -1) {","    index = haystack.indexOf(needle, index);","    if (index != -1) {","      count++;","     index += needle.length;","    }","  }","  return count;","}"])+"("+e+", "+t+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.text_replace=function(t){return[(o.Dart.valueToCode(t,"TEXT",o.Dart.ORDER_UNARY_POSTFIX)||"''")+".replaceAll("+(o.Dart.valueToCode(t,"FROM",o.Dart.ORDER_NONE)||"''")+", "+(t=o.Dart.valueToCode(t,"TO",o.Dart.ORDER_NONE)||"''")+")",o.Dart.ORDER_UNARY_POSTFIX]},o.Dart.text_reverse=function(t){return["new String.fromCharCodes("+(o.Dart.valueToCode(t,"TEXT",o.Dart.ORDER_UNARY_POSTFIX)||"''")+".runes.toList().reversed)",o.Dart.ORDER_UNARY_PREFIX]},o.Dart.variables={},o.Dart.variables_get=function(t){return[o.Dart.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME),o.Dart.ORDER_ATOMIC]},o.Dart.variables_set=function(t){var e=o.Dart.valueToCode(t,"VALUE",o.Dart.ORDER_ASSIGNMENT)||"0";return o.Dart.variableDB_.getName(t.getFieldValue("VAR"),o.VARIABLE_CATEGORY_NAME)+" = "+e+";\n"},o.Dart.variablesDynamic={},o.Dart.variables_get_dynamic=o.Dart.variables_get,o.Dart.variables_set_dynamic=o.Dart.variables_set,o.Dart)})),lt=G((function(t,e){var o;t.exports=(o=at,j.Dart=o,o)})),ct=G((function(t){var e,o,i,n,r,s,a,l;o=$,i=q,n=tt,r=ot,s=nt,a=st,l=lt,(e=j).setLocale(o),e.Blocks=e.Blocks||{},Object.keys(i).forEach((function(t){e.Blocks[t]=i[t]})),e.JavaScript=n,e.Python=r,e.Lua=a,e.PHP=s,e.Dart=l,t.exports=e})),ut=G((function(t,e){t.exports=ct}));const ht=globalThis.trustedTypes,_t=ht?ht.createPolicy("lit-html",{createHTML:t=>t}):void 0,pt=`lit$${(Math.random()+"").slice(9)}$`,dt="?"+pt,gt=`<${dt}>`,Et=document,Tt=(t="")=>Et.createComment(t),Rt=t=>null===t||"object"!=typeof t&&"function"!=typeof t,ft=Array.isArray,vt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,mt=/-->/g,yt=/>/g,bt=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,It=/'/g,Ot=/"/g,Ct=/^(?:script|style|textarea)$/i,St=Symbol.for("lit-noChange"),Dt=Symbol.for("lit-nothing"),Nt=new WeakMap,At=Et.createTreeWalker(Et,129,null,!1),kt=(t,e)=>{const o=t.length-1,i=[];let n,r=2===e?"<svg>":"",s=vt;for(let e=0;e<o;e++){const o=t[e];let a,l,c=-1,u=0;for(;u<o.length&&(s.lastIndex=u,l=s.exec(o),null!==l);)u=s.lastIndex,s===vt?"!--"===l[1]?s=mt:void 0!==l[1]?s=yt:void 0!==l[2]?(Ct.test(l[2])&&(n=RegExp("</"+l[2],"g")),s=bt):void 0!==l[3]&&(s=bt):s===bt?">"===l[0]?(s=null!=n?n:vt,c=-1):void 0===l[1]?c=-2:(c=s.lastIndex-l[2].length,a=l[1],s=void 0===l[3]?bt:'"'===l[3]?Ot:It):s===Ot||s===It?s=bt:s===mt||s===yt?s=vt:(s=bt,n=void 0);const h=s===bt&&t[e+1].startsWith("/>")?" ":"";r+=s===vt?o+gt:c>=0?(i.push(a),o.slice(0,c)+"$lit$"+o.slice(c)+pt+h):o+pt+(-2===c?(i.push(void 0),e):h)}const a=r+(t[o]||"<?>")+(2===e?"</svg>":"");return[void 0!==_t?_t.createHTML(a):a,i]};class Lt{constructor({strings:t,_$litType$:e},o){let i;this.parts=[];let n=0,r=0;const s=t.length-1,a=this.parts,[l,c]=kt(t,e);if(this.el=Lt.createElement(l,o),At.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(i=At.nextNode())&&a.length<s;){if(1===i.nodeType){if(i.hasAttributes()){const t=[];for(const e of i.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(pt)){const o=c[r++];if(t.push(e),void 0!==o){const t=i.getAttribute(o.toLowerCase()+"$lit$").split(pt),e=/([.?@])?(.*)/.exec(o);a.push({type:1,index:n,name:e[2],strings:t,ctor:"."===e[1]?xt:"?"===e[1]?Ft:"@"===e[1]?Ht:Bt})}else a.push({type:6,index:n})}for(const e of t)i.removeAttribute(e)}if(Ct.test(i.tagName)){const t=i.textContent.split(pt),e=t.length-1;if(e>0){i.textContent=ht?ht.emptyScript:"";for(let o=0;o<e;o++)i.append(t[o],Tt()),At.nextNode(),a.push({type:2,index:++n});i.append(t[e],Tt())}}}else if(8===i.nodeType)if(i.data===dt)a.push({type:2,index:n});else{let t=-1;for(;-1!==(t=i.data.indexOf(pt,t+1));)a.push({type:7,index:n}),t+=pt.length-1}n++}}static createElement(t,e){const o=Et.createElement("template");return o.innerHTML=t,o}}function Pt(t,e,o=t,i){var n,r,s,a;if(e===St)return e;let l=void 0!==i?null===(n=o.i)||void 0===n?void 0:n[i]:o.o;const c=Rt(e)?void 0:e._$litDirective$;return(null==l?void 0:l.constructor)!==c&&(null===(r=null==l?void 0:l.O)||void 0===r||r.call(l,!1),void 0===c?l=void 0:(l=new c(t),l.T(t,o,i)),void 0!==i?(null!==(s=(a=o).i)&&void 0!==s?s:a.i=[])[i]=l:o.o=l),void 0!==l&&(e=Pt(t,l.S(t,e.values),l,i)),e}class Mt{constructor(t,e){this.l=[],this.N=void 0,this.D=t,this.M=e}u(t){var e;const{el:{content:o},parts:i}=this.D,n=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:Et).importNode(o,!0);At.currentNode=n;let r=At.nextNode(),s=0,a=0,l=i[0];for(;void 0!==l;){if(s===l.index){let e;2===l.type?e=new wt(r,r.nextSibling,this,t):1===l.type?e=new l.ctor(r,l.name,l.strings,this,t):6===l.type&&(e=new Ut(r,this,t)),this.l.push(e),l=i[++a]}s!==(null==l?void 0:l.index)&&(r=At.nextNode(),s++)}return n}v(t){let e=0;for(const o of this.l)void 0!==o&&(void 0!==o.strings?(o.I(t,o,e),e+=o.strings.length-2):o.I(t[e])),e++}}class wt{constructor(t,e,o,i){this.type=2,this.N=void 0,this.A=t,this.B=e,this.M=o,this.options=i}setConnected(t){var e;null===(e=this.P)||void 0===e||e.call(this,t)}get parentNode(){return this.A.parentNode}get startNode(){return this.A}get endNode(){return this.B}I(t,e=this){t=Pt(this,t,e),Rt(t)?t===Dt||null==t||""===t?(this.H!==Dt&&this.R(),this.H=Dt):t!==this.H&&t!==St&&this.m(t):void 0!==t._$litType$?this._(t):void 0!==t.nodeType?this.$(t):(t=>{var e;return ft(t)||"function"==typeof(null===(e=t)||void 0===e?void 0:e[Symbol.iterator])})(t)?this.g(t):this.m(t)}k(t,e=this.B){return this.A.parentNode.insertBefore(t,e)}$(t){this.H!==t&&(this.R(),this.H=this.k(t))}m(t){const e=this.A.nextSibling;null!==e&&3===e.nodeType&&(null===this.B?null===e.nextSibling:e===this.B.previousSibling)?e.data=t:this.$(Et.createTextNode(t)),this.H=t}_(t){var e;const{values:o,_$litType$:i}=t,n="number"==typeof i?this.C(t):(void 0===i.el&&(i.el=Lt.createElement(i.h,this.options)),i);if((null===(e=this.H)||void 0===e?void 0:e.D)===n)this.H.v(o);else{const t=new Mt(n,this),e=t.u(this.options);t.v(o),this.$(e),this.H=t}}C(t){let e=Nt.get(t.strings);return void 0===e&&Nt.set(t.strings,e=new Lt(t)),e}g(t){ft(this.H)||(this.H=[],this.R());const e=this.H;let o,i=0;for(const n of t)i===e.length?e.push(o=new wt(this.k(Tt()),this.k(Tt()),this,this.options)):o=e[i],o.I(n),i++;i<e.length&&(this.R(o&&o.B.nextSibling,i),e.length=i)}R(t=this.A.nextSibling,e){var o;for(null===(o=this.P)||void 0===o||o.call(this,!1,!0,e);t&&t!==this.B;){const e=t.nextSibling;t.remove(),t=e}}}class Bt{constructor(t,e,o,i,n){this.type=1,this.H=Dt,this.N=void 0,this.V=void 0,this.element=t,this.name=e,this.M=i,this.options=n,o.length>2||""!==o[0]||""!==o[1]?(this.H=Array(o.length-1).fill(Dt),this.strings=o):this.H=Dt}get tagName(){return this.element.tagName}I(t,e=this,o,i){const n=this.strings;let r=!1;if(void 0===n)t=Pt(this,t,e,0),r=!Rt(t)||t!==this.H&&t!==St,r&&(this.H=t);else{const i=t;let s,a;for(t=n[0],s=0;s<n.length-1;s++)a=Pt(this,i[o+s],e,s),a===St&&(a=this.H[s]),r||(r=!Rt(a)||a!==this.H[s]),a===Dt?t=Dt:t!==Dt&&(t+=(null!=a?a:"")+n[s+1]),this.H[s]=a}r&&!i&&this.W(t)}W(t){t===Dt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class xt extends Bt{constructor(){super(...arguments),this.type=3}W(t){this.element[this.name]=t===Dt?void 0:t}}class Ft extends Bt{constructor(){super(...arguments),this.type=4}W(t){t&&t!==Dt?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)}}class Ht extends Bt{constructor(){super(...arguments),this.type=5}I(t,e=this){var o;if((t=null!==(o=Pt(this,t,e,0))&&void 0!==o?o:Dt)===St)return;const i=this.H,n=t===Dt&&i!==Dt||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,r=t!==Dt&&(i===Dt||n);n&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,t),this.H=t}handleEvent(t){var e,o;"function"==typeof this.H?this.H.call(null!==(o=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==o?o:this.element,t):this.H.handleEvent(t)}}class Ut{constructor(t,e,o){this.element=t,this.type=6,this.N=void 0,this.V=void 0,this.M=e,this.options=o}I(t){Pt(this,t)}}null===(X=(W=globalThis).litHtmlPlatformSupport)||void 0===X||X.call(W,Lt,wt),(null!==(Y=(J=globalThis).litHtmlVersions)&&void 0!==Y?Y:J.litHtmlVersions=[]).push("2.0.0-rc.2");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Vt=1;
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Gt=(t=>(...e)=>({_$litDirective$:t,values:e}))(class extends class{constructor(t){}T(t,e,o){this.dt=t,this.M=e,this.ct=o}S(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}{constructor(t){var e;if(super(t),t.type!==Vt||"style"!==t.name||(null===(e=t.strings)||void 0===e?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce(((e,o)=>{const i=t[o];return null==i?e:e+`${o=o.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${i};`}),"")}update(t,[e]){const{style:o}=t.element;if(void 0===this.St){this.St=new Set;for(const t in e)this.St.add(t);return this.render(e)}this.St.forEach((t=>{null==e[t]&&(this.St.delete(t),t.includes("-")?o.removeProperty(t):o[t]="")}));for(const t in e){const i=e[t];null!=i&&(this.St.add(t),t.includes("-")?o.setProperty(t,i):o[t]=i)}return St}}),Wt=e(v||(v=x`
  .column {
    display: flex;
    flex-direction: column;
  }
  .row {
    display: flex;
    flex-direction: row;
  }
  .center-content {
    align-items: center;
    justify-content: center;
  }

  .placeholder {
    color: rgba(0, 0, 0, 0.6);
  }

  .vertical-divider {
    background-color: grey;
    width: 1px;
    height: 60%;
    opacity: 0.3;
    margin-bottom: 0;
  }
`)),Xt="AgentPubKey",Yt="#ffad42",Jt={type:"create_entry",message0:"create_entry %1",args0:[{type:"input_value",name:"ENTRY",check:"Entry"}],inputsInline:!0,nextStatement:null,previousStatement:null,colour:Yt,tooltip:"Returns number of letters in the provided text.",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};const Kt={type:"create_link",message0:"create_link base %1 target %2 tag %3",args0:[{type:"input_value",name:"BASE",check:["EntryHash",Xt],align:"right"},{type:"input_value",name:"TARGET",check:["EntryHash",Xt],align:"right"},{type:"input_value",name:"TAG",align:"right"}],nextStatement:null,previousStatement:null,colour:Yt,tooltip:"Returns number of letters in the provided text.",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};const zt={type:"get",message0:"get %1",args0:[{type:"input_value",name:"HASH",check:["EntryHash","HeaderHash",Xt]}],inputsInline:!0,output:"Element",colour:Yt,tooltip:"Returns number of letters in the provided text.",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};const jt={type:"hash_entry",message0:"hash_entry %1",args0:[{type:"input_value",name:"ENTRY",check:"Entry"}],inputsInline:!0,output:"EntryHash",colour:Yt,tooltip:"Returns number of letters in the provided text.",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};const $t={type:"agent_info.agent_latest_pubkey",message0:"agent_info.agent_latest_pubkey",args0:[],inputsInline:!0,output:Xt,colour:Yt,tooltip:"Returns number of letters in the provided text.",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};const Zt={type:"get_details",message0:"get_details %1",args0:[{type:"input_value",name:"HASH",check:["EntryHash",Xt]}],inputsInline:!0,output:"EntryDetails",colour:Yt,tooltip:"Returns number of letters in the provided text.",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};const qt={type:"get_links",message0:"get_links base: %1 tag: %2",args0:[{type:"input_value",name:"BASE",check:["EntryHash",Xt]},{type:"input_value",name:"TAG"}],inputsInline:!0,output:"Array",colour:Yt,tooltip:"Returns number of letters in the provided text.",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};const Qt={type:"entry_def",message0:"entry_def id %1 public %2",args0:[{type:"field_input",name:"ENTRY_DEF_ID",check:"String"},{type:"field_checkbox",name:"PUBLIC",checked:!0}],colour:Yt,output:"EntryDef",tooltip:"Creates a new entry with the given entry_def_id and content",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};const te={type:"update_entry",message0:"update_entry original header %1 new entry %2",args0:[{type:"input_value",name:"ORIGINAL_HEADER",check:"HeaderHash"},{type:"input_value",name:"ENTRY",check:"Entry"}],inputsInline:!0,nextStatement:null,previousStatement:null,colour:Yt,tooltip:"Returns number of letters in the provided text.",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};const ee={type:"delete_entry",message0:"delete_entry header_hash%1",args0:[{type:"input_value",name:"HEADER",check:"HeaderHash"}],inputsInline:!0,nextStatement:null,previousStatement:null,colour:Yt,tooltip:"Returns number of letters in the provided text.",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};function oe(t){!function(t){t.defineBlocksWithJsonArray([Jt]),t.JavaScript.create_entry=function(e){const o=t.JavaScript.valueToCode(e,"ENTRY",t.JavaScript.ORDER_ADDITION);if(!o)throw new Error('"create_entry": entry is empty');return`(await hdk.create_entry(${o}));\n`}}(t),function(t){t.defineBlocksWithJsonArray([Kt]),t.JavaScript.create_link=function(e){const o=t.JavaScript.valueToCode(e,"BASE",t.JavaScript.ORDER_ADDITION),i=t.JavaScript.valueToCode(e,"TARGET",t.JavaScript.ORDER_ADDITION),n=t.JavaScript.valueToCode(e,"TAG",t.JavaScript.ORDER_ADDITION)||"null";if(!o)throw new Error('"create_link": base is empty');if(!i)throw new Error('"create_link": target is empty');return`(await hdk.create_link({base: ${o}, target: ${i}, tag: ${n}}));\n`}}(t),function(t){t.defineBlocksWithJsonArray([jt]),t.JavaScript.hash_entry=function(e){const o=t.JavaScript.valueToCode(e,"ENTRY",t.JavaScript.ORDER_ADDITION);if(!o)throw new Error('"hash_entry": entry is empty');return console.log(`(await hdk.hash_entry(${o}))`),[`(await hdk.hash_entry(${o}))`,t.JavaScript.ORDER_FUNCTION_CALL]}}(t),function(t){t.defineBlocksWithJsonArray([zt]),t.JavaScript.get=function(e){const o=t.JavaScript.valueToCode(e,"HASH",t.JavaScript.ORDER_ADDITION);if(!o)throw new Error('"get": hash is empty');return[`(await hdk.get(${o}))`,t.JavaScript.ORDER_FUNCTION_CALL]}}(t),function(t){t.defineBlocksWithJsonArray([$t]),t.JavaScript["agent_info.agent_latest_pubkey"]=function(){return["(await hdk.agent_info()).agent_latest_pubkey",t.JavaScript.ORDER_FUNCTION_CALL]}}(t),function(t){t.defineBlocksWithJsonArray([Zt]),t.JavaScript.get_details=function(e){const o=t.JavaScript.valueToCode(e,"HASH",t.JavaScript.ORDER_ADDITION);if(!o)throw new Error('"get_details": hash is empty');return[`(await hdk.get_details(${o}))`,t.JavaScript.ORDER_FUNCTION_CALL]}}(t),function(t){t.defineBlocksWithJsonArray([qt]),t.JavaScript.get_links=function(e){const o=t.JavaScript.valueToCode(e,"BASE",t.JavaScript.ORDER_ADDITION),i=t.JavaScript.valueToCode(e,"TAG",t.JavaScript.ORDER_ADDITION)||"null";if(!o)throw new Error('"get_links": base hash is empty');return[`(await hdk.get_links(${o}, ${i}))`,t.JavaScript.ORDER_FUNCTION_CALL]}}(t),function(t){t.Blocks.entry_defs={init(){this.setHelpUrl(t.Msg.LISTS_CREATE_WITH_HELPURL),this.setColour(Yt),this.itemCount_=1,this.updateShape_(),this.setMutator(new t.Mutator(["lists_create_with_item"])),this.setTooltip("Entry definitions for this zome")},mutationToDom(){const t=document.createElement("mutation");return t.setAttribute("items",this.itemCount_),t},domToMutation(t){this.itemCount_=parseInt(t.getAttribute("items"),10),this.updateShape_()},decompose(t){const e=t.newBlock("lists_create_with_container");e.initSvg();let o=e.getInput("STACK").connection;for(let e=0;e<this.itemCount_;e++){const e=t.newBlock("lists_create_with_item");e.initSvg(),o.connect(e.previousConnection),o=e.nextConnection}return e},compose(e){let o=e.getInputTargetBlock("STACK");const i=[];for(;o;)i.push(o.valueConnection_),o=o.nextConnection&&o.nextConnection.targetBlock();for(var n=0;n<this.itemCount_;n++){const t=this.getInput(`ADD${n}`).connection.targetConnection;t&&-1==i.indexOf(t)&&t.disconnect()}for(this.itemCount_=i.length,this.updateShape_(),n=0;n<this.itemCount_;n++)t.Mutator.reconnect(i[n],this,`ADD${n}`)},saveConnections(t){let e=t.getInputTargetBlock("STACK"),o=0;for(;e;){const t=this.getInput(`ADD${o}`);e.valueConnection_=t&&t.connection.targetConnection,o++,e=e.nextConnection&&e.nextConnection.targetBlock()}},updateShape_(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(t.Msg.LISTS_CREATE_EMPTY_TITLE);for(var e=0;e<this.itemCount_;e++)if(!this.getInput(`ADD${e}`)){const t=this.appendValueInput(`ADD${e}`).setCheck("EntryDef");0==e&&t.appendField("entry_defs")}for(;this.getInput(`ADD${e}`);)this.removeInput(`ADD${e}`),e++}},t.defineBlocksWithJsonArray([Qt]),t.JavaScript.entry_def=function(e){return[`{id: "${e.getFieldValue("ENTRY_DEF_ID")}", visibility: "${e.getFieldValue("PUBLIC")?"Public":"Private"}"}`,t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.entry_defs=function(e){const o=new Array(e.itemCount_);for(let i=0;i<e.itemCount_;i++)o[i]=t.JavaScript.valueToCode(e,`ADD${i}`,t.JavaScript.ORDER_NONE)||"null";return`export const entry_defs = [${o.join(", ")}]`}}(t),function(t){t.defineBlocksWithJsonArray([te]),t.JavaScript.update_entry=function(e){const o=t.JavaScript.valueToCode(e,"ORIGINAL_HEADER",t.JavaScript.ORDER_ADDITION),i=t.JavaScript.valueToCode(e,"ENTRY",t.JavaScript.ORDER_ADDITION);if(!o)throw new Error('"update_entry": original header is empty');if(!i)throw new Error('"update_entry": entry is empty');return`(await hdk.create_entry(${o}, ${i}));\n`}}(t),function(t){t.defineBlocksWithJsonArray([ee]),t.JavaScript.delete_entry=function(e){const o=t.JavaScript.valueToCode(e,"HEADER",t.JavaScript.ORDER_ADDITION);if(!o)throw new Error('"delete_entry": header_hash is empty');return`(await hdk.delete_entry(${o}));\n`}}(t)}const ie={kind:"categoryToolbox",contents:[{kind:"category",name:"HDK",contents:[{kind:"category",name:"Entries",contents:[]},{kind:"category",name:"CRUD",contents:[{kind:"block",type:"get"},{kind:"block",type:"get_details"},{kind:"block",type:"create_entry"},{kind:"block",type:"update_entry"},{kind:"block",type:"delete_entry"},{kind:"block",type:"hash_entry"}]},{kind:"category",name:"Links",contents:[{kind:"block",type:"get_links"},{kind:"block",type:"create_link"}]},{kind:"category",name:"Information",contents:[{kind:"block",type:"agent_info.agent_latest_pubkey"}]},{kind:"category",name:"Callbacks",contents:[{kind:"block",type:"entry_defs"},{kind:"block",type:"entry_def"}]}]},{kind:"category",name:"Control",contents:[{kind:"block",type:"controls_if"},{kind:"block",type:"controls_whileUntil"},{kind:"block",type:"controls_for"},{kind:"block",type:"controls_forEach"}]},{kind:"category",name:"Logic",contents:[{kind:"block",type:"logic_compare"},{kind:"block",type:"logic_operation"},{kind:"block",type:"logic_boolean"},{kind:"block",type:"logic_ternary"},{kind:"block",type:"logic_null"},{kind:"block",type:"logic_negate"}]},{kind:"category",name:"Math",contents:[{kind:"block",type:"math_number"},{kind:"block",type:"math_number"},{kind:"block",type:"math_trig"},{kind:"block",type:"math_constant"},{kind:"block",type:"math_number_property"},{kind:"block",type:"math_round"},{kind:"block",type:"math_modulo"},{kind:"block",type:"math_constrain"},{kind:"block",type:"math_random_int"},{kind:"block",type:"math_random_float"}]},{kind:"category",name:"Text",contents:[{kind:"block",type:"text"},{kind:"block",type:"text_join"},{kind:"block",type:"text_append"},{kind:"block",type:"text_length"},{kind:"block",type:"text_isEmpty"},{kind:"block",type:"text_indexOf"},{kind:"block",type:"text_charAt"},{kind:"block",type:"text_getSubstring"},{kind:"block",type:"text_changeCase"},{kind:"block",type:"text_trim"}]},{kind:"category",name:"List",contents:[{kind:"block",type:"lists_create_with"},{kind:"block",type:"lists_repeat"},{kind:"block",type:"lists_length"},{kind:"block",type:"lists_isEmpty"},{kind:"block",type:"lists_getSublist"},{kind:"block",type:"lists_getIndex"},{kind:"block",type:"lists_setIndex"},{kind:"block",type:"lists_sort"}]},{kind:"category",name:"Variables",custom:"VARIABLE"},{kind:"category",name:"Functions",custom:"PROCEDURE"}]};async function ne(t){const e=/function (\w*)\(([A-Za-z0-9_,\ ]*)\) \{/g,o=t.replace(e,"export const $1 = (hdk) => async ({ $2 }) => {"),i=t.split(e),n=await import(function(t,...e){let o=t.raw[0];for(let i=0;i<e.length;i++)o+=e[i]+t.raw[i+1];return`data:text/javascript;base64,${btoa(unescape(encodeURIComponent(o)))}`}(m||(m=x`${0}`),o)),r=n.entry_defs;if(!r)throw new Error("There are no entry_defs defined in this zome");if(r.some((t=>null===t)))throw new Error("There are null entry defs");const s={};for(const t of Object.keys(n).filter((t=>"entry_defs"!==t))){const e=i.findIndex((e=>e===t))+1;let o=[];""!==i[e]&&(o=i[e].split(", ").map((t=>({name:t,type:"any"})))),s[t]={arguments:o,call:n[t]}}return{zome_functions:s,entry_defs:r}}function re(t,e){const o=`new ${e}`;if(!t.JavaScript[o]){const i={type:o,message0:`new ${e} %1`,args0:[{type:"input_value",name:"CONTENT",check:"String",align:"right"}],output:"Entry",inputsInline:!0,colour:Yt,tooltip:"Creates a new entry with the given entry_def_id and content",helpUrl:"http://www.w3schools.com/jsref/jsref_length_string.asp"};t.defineBlocksWithJsonArray([i]),t.JavaScript[o]=function(o){return[`{content: ${t.JavaScript.valueToCode(o,"CONTENT",t.JavaScript.ORDER_ADDITION)}, entry_def_id: "${e}"}`,t.JavaScript.ORDER_FUNCTION_CALL]}}return{kind:"block",type:o}}class se extends l{constructor(){super(...arguments),this._checkTimeout=void 0}static get styles(){return[e(y||(y=x`
        :host {
          display: flex;
          flex: 1;
        }
        .blocklyFlyoutButton > .blocklyText {
          fill: white;
        }
      `)),Wt]}updated(t){super.updated(t),(t.has("zome")||t.has("editing"))&&this.zome&&setTimeout((()=>this.setupBlockly()))}firstUpdated(){oe(ut)}setupBlockly(){if(this._workspace&&this._workspace.dispose(),this.zome&&this.zome.entry_defs.forEach((t=>re(ut,t.id))),this._workspace=ut.inject(this.blocklyArea,{toolbox:this.editing?ie:null,shadowRoot:this.shadowRoot}),this.zome.blocklyCode){const t=ut.Xml.textToDom(this.zome.blocklyCode);ut.Xml.domToWorkspace(t,this._workspace)}this.editing&&this._workspace.addChangeListener((async()=>{this._checkTimeout&&clearTimeout(this._checkTimeout),this._checkTimeout=setTimeout((async()=>{if(this.editing)try{const t=await this.getZome(),e=this._workspace.toolbox_.getToolboxItems()[0].getChildToolboxItems()[0],o=t.entry_defs.map((t=>re(ut,t.id)));e.updateFlyoutContents({kind:"category",name:"Entries",contents:o}),this.dispatchEvent(new CustomEvent("zome-edited",{detail:{valid:!0,zome:t}}))}catch(t){this.dispatchEvent(new CustomEvent("zome-edited",{detail:{valid:!1}}))}clearTimeout(this._checkTimeout)}),500)}))}async isValid(){try{return await this.getZome(),!0}catch(t){return!1}}async getZome(){return async function(t,e,o){const i=t.JavaScript.workspaceToCode(e),{zome_functions:n,entry_defs:r}=await ne(i);return{name:o,entry_defs:r,zome_functions:n,validation_functions:{},blocklyCode:t.Xml.domToText(t.Xml.workspaceToDom(e))}}(ut,this._workspace,this.zome.name)}render(){return c(b||(b=x`
      <div
        class="row"
        style=${0}
      >
        <div id="blockly-area" style="flex: 1;"></div>
      </div>
    `),Gt({flex:"1","pointer-events":this.editing?"all":"none"}))}}F([U({type:Object})],se.prototype,"zome",void 0),F([U({type:Boolean})],se.prototype,"editing",void 0),F([
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
function(t,e){return(({finisher:t,descriptor:e})=>(o,i)=>{var n;if(void 0===i){const i=null!==(n=o.originalKey)&&void 0!==n?n:o.key,r=null!=e?{kind:"method",placement:"prototype",key:i,descriptor:e(o.key)}:{...o,key:i};return null!=t&&(r.finisher=function(e){t(e,i)}),r}{const n=o.constructor;void 0!==e&&Object.defineProperty(o,i,e(i)),null==t||t(n,i)}})({descriptor:o=>{const i={get(){var e;return null===(e=this.renderRoot)||void 0===e?void 0:e.querySelector(t)},enumerable:!0,configurable:!0};if(e){const e="symbol"==typeof o?Symbol():"__"+o;i.get=function(){var o;return void 0===this[e]&&(this[e]=null===(o=this.renderRoot)||void 0===o?void 0:o.querySelector(t)),this[e]}}return i}})}("#blockly-area")],se.prototype,"blocklyArea",void 0);class ae extends l{constructor(){super(...arguments),this._selectedZomeIndex=0,this._editingZomes=void 0,this._invalid=!1,this._newZomeCount=0}getActiveDna(){for(const t of this.conductors)for(const e of t.getAllCells())if(e.dnaHash===this.activeDna)return e.getSimulatedDna()}get _editing(){return void 0!==this._editingZomes}get _editZomeEl(){var t;return null===(t=this.shadowRoot)||void 0===t?void 0:t.getElementById("edit-zome")}isDnaValid(){return this._editingZomes&&this._editingZomes.every((t=>t.valid))}async onZomeEdited(t){this.editDna();const e=t.detail.valid;this._editingZomes&&(this._editingZomes[this._selectedZomeIndex].valid=e,e&&(this._editingZomes[this._selectedZomeIndex].zome=t.detail.zome)),this.requestUpdate()}newEditingZome(){return this._newZomeCount++,{valid:!0,zome:{name:`sample${this._newZomeCount}`,entry_defs:[],zome_functions:{},validation_functions:{},blocklyCode:'<xml xmlns="https://developers.google.com/blockly/xml"><block type="entry_defs" id="a{AP^:MzvuAQf6=jI~[2" x="123" y="58"><mutation xmlns="http://www.w3.org/1999/xhtml" items="1"></mutation><value name="ADD0"><block type="entry_def" id="$SQ6P6OQ#1/hfOd4TA=@"><field name="ENTRY_DEF_ID">sample_entry</field><field name="PUBLIC">TRUE</field></block></value></block><block type="procedures_defnoreturn" id="D}syd|^_`$9k%uwyIdSn" x="164" y="126"><field name="NAME">sample function</field><comment pinned="false" h="80" w="160">Describe this function...</comment><statement name="STACK"><block type="create_entry" id="YbSju3KGV0}rR_PP}]b2"><value name="ENTRY"><block type="new sample_entry" id="tQuMSJo,+,v1tN,aAx9z"><field name="CONTENT">Hello world!</field></block></value></block></statement></block></xml>'}}}editDna(){if(!this._editing){const t=this.getActiveDna();this._editingZomes=t?t.zomes.map((t=>({valid:!0,zome:t}))):[this.newEditingZome()],this._editZomeEl.zome=this._editingZomes[this._selectedZomeIndex].zome,this._newZomeCount=0}}isCompileDisabled(){return!this._editing||!this.isDnaValid()}async showZome(t){var e;this._editing&&this._invalid?this.showMessage("Zome code is invalid"):(this._selectedZomeIndex=t,this._editingZomes?this._editZomeEl.zome=this._editingZomes[this._selectedZomeIndex].zome:this._editZomeEl.zome=null===(e=this.getActiveDna())||void 0===e?void 0:e.zomes[this._selectedZomeIndex])}addZome(){this._editingZomes&&(this._editingZomes=[...this._editingZomes,this.newEditingZome()])}getEditingDna(){if(this._editingZomes)return{properties:{},uid:"",zomes:this._editingZomes.map((t=>t.zome))}}removeEditingZome(t){this._editingZomes&&(this._editingZomes.splice(t,1),t===this._selectedZomeIndex&&(this._selectedZomeIndex=0),this.requestUpdate())}updated(t){super.updated(t),t.has("activeDna")&&this.activeDna&&this.showZome(0)}async compileDna(){this._editingZomes&&(this.dispatchEvent(new CustomEvent("dna-compiled",{detail:{dna:this.getEditingDna()},bubbles:!0,composed:!0})),this._editingZomes=void 0,setTimeout((()=>{var t;this._editZomeEl.zome=null===(t=this.getActiveDna())||void 0===t?void 0:t.zomes[this._selectedZomeIndex]})))}async cancelEdit(){this._editingZomes=void 0}renderContent(){const t=this.getEditingDna()||this.getActiveDna();return t?c(O||(O=x`
      <div class="column" style="flex: 1;">
        <div
          class="row"
          style="align-items: center; margin: 0 16px; margin-left: 0;"
        >
          <mwc-tab-bar
            @MDCTabBar:activated=${0}
          >
            ${0}
          </mwc-tab-bar>
          ${0}
          <span style="flex: 1;"></span>
          ${0}
        </div>

        <edit-zome
          id="edit-zome"
          .editing=${0}
          style="flex: 1;"
          @zome-edited=${0}
        ></edit-zome>
      </div>
    `),(t=>this.showZome(t.detail.index)),t.zomes.map(((t,e)=>c(C||(C=x`
                <mwc-tab label=${0}> </mwc-tab>

                ${0}
              `),t.name,this._editing?c(S||(S=x`<mwc-icon-button
                        icon="delete"
                        style="opacity: 0.5; --mdc-icon-button-size: 36px; align-self: center; margin-right: 16px;"
                        @click=${0}
                      ></mwc-icon-button>
                      <span
                        class="vertical-divider"
                        style="align-self: center;"
                      ></span> `),(()=>this.removeEditingZome(e))):c(D||(D=x``))))),this._editing?c(N||(N=x`
                <mwc-button
                  label="Add zome"
                  icon="add"
                  @click=${0}
                ></mwc-button>
              `),(()=>this.addZome())):c(A||(A=x``)),this._editing?c(k||(k=x`
                <mwc-button
                  label="CANCEL"
                  style="margin-right: 16px;"
                  @click=${0}
                ></mwc-button>
                <mwc-button
                  label="COMPILE"
                  raised
                  .disabled=${0}
                  @click=${0}
                ></mwc-button>
              `),(()=>this.cancelEdit()),this.isCompileDisabled(),(()=>this.compileDna())):c(L||(L=x`
                <mwc-button
                  label="EDIT"
                  @click=${0}
                ></mwc-button>
              `),(()=>this.editDna())),this._editing,(t=>this.onZomeEdited(t))):c(I||(I=x`<div class="row center-content" style="flex: 1;">
        <span>There is no active Dna</span>
      </div>`))}render(){return c(P||(P=x`
      <mwc-card style="width: auto; flex: 1">
        <div class="column" style="flex: 1;">
          <span style="font-size: 20px; margin: 16px;" class="row"
            >Dna
            Code${0}</span
          >
          ${0}
        </div>
      </mwc-card>
    `),this.activeDna?c(M||(M=x`
                  <span class="placeholder row">
                    , for Dna
                    <copyable-hash
                      .hash=${0}
                      style="margin-left: 8px;"
                    ></copyable-hash>
                  </span>
                `),this.activeDna):c(w||(w=x``)),this.renderContent())}}ae.styles=[e(B||(B=x`
      :host {
        display: flex;
      }
    `)),Wt],ae.elementDefinitions={"edit-zome":se,"copyable-hash":o,"mwc-tab-bar":i,"mwc-tab":n,"mwc-button":r,"mwc-icon-button":s,"mwc-card":a},F([U({type:Number})],ae.prototype,"_selectedZomeIndex",void 0),F([U({type:Array})],ae.prototype,"_editingZomes",void 0),F([U({type:Boolean})],ae.prototype,"_invalid",void 0);const le={name:"blockly-happ",description:"",slots:{default:{deferred:!1,dna:{properties:{},uid:"",zomes:[{name:"demo_entries",entry_defs:[{id:"sample_entry",visibility:"Public"}],blocklyCode:'<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="_?2#8+sn=^`fqd%E/Ffz">hash</variable><variable id="}+4NT8PIh-H~3?/]i:pq">contents</variable></variables><block type="entry_defs" id="Jjc~6G6Ezu-d^-@em_yh" x="115" y="28"><mutation xmlns="http://www.w3.org/1999/xhtml" items="1"></mutation><value name="ADD0"><block type="entry_def" id=":we9$r=tpV.ce6FC0$a@"><field name="ENTRY_DEF_ID">sample_entry</field><field name="PUBLIC">TRUE</field></block></value></block><block type="procedures_defreturn" id="M}4W;Z$EW[%Js=y4-XWx" x="208" y="111"><mutation><arg name="hash" varid="_?2#8+sn=^`fqd%E/Ffz"></arg></mutation><field name="NAME">get</field><comment pinned="false" h="80" w="160">Describe this function...</comment><value name="RETURN"><block type="get" id=";rtPS/KcSZp8;VN{1uKM"><value name="HASH"><block type="variables_get" id=")BCBF(.]MvZh6-XA]Y1*"><field name="VAR" id="_?2#8+sn=^`fqd%E/Ffz">hash</field></block></value></block></value></block><block type="procedures_defreturn" id="l-jj!v]JU[3gtFFrKl{)" x="118" y="256"><mutation><arg name="contents" varid="}+4NT8PIh-H~3?/]i:pq"></arg></mutation><field name="NAME">create_entry</field><comment pinned="false" h="80" w="160">Describe this function...</comment><statement name="STACK"><block type="create_entry" id=":Sgxw5iCag?!f,R$yHK5"><value name="ENTRY"><block type="new sample_entry" id="Vxav^_6z|in9trwJmorD"><value name="CONTENT"><block type="variables_get" id="a3-sS1)%cGR`5q4VuB:E"><field name="VAR" id="}+4NT8PIh-H~3?/]i:pq">contents</field></block></value></block></value></block></statement><value name="RETURN"><block type="hash_entry" id="@yEoC$H__6#Ql:m6%FBg"><value name="ENTRY"><block type="new sample_entry" id="IF[Lz57}#@!b3z/~-A6O"><value name="CONTENT"><block type="variables_get" id="wc1vbieNkjxWJ21[E;?z"><field name="VAR" id="}+4NT8PIh-H~3?/]i:pq">contents</field></block></value></block></value></block></value></block></xml>',validation_functions:{},zome_functions:{create_entry:{call:({hash_entry:t,create_entry:e})=>async({content:o})=>(await e({content:o,entry_def_id:"sample_entry"}),t({content:o})),arguments:[{name:"content",type:"any"}]},get:{call:({get:t})=>({hash:e})=>t(e),arguments:[{name:"hash",type:"any"}]}}}]}}}};let ce,ue=t=>t;customElements.define("holochain-playground-container",u),customElements.define("entry-graph",h),customElements.define("entry-contents",_),customElements.define("call-zome-fns",p),customElements.define("source-chain",d),customElements.define("dht-cells",g),customElements.define("dna-code",ae),customElements.define("select-active-dna",E);const he=()=>t(ce||(ce=ue`
    <holochain-playground-container
      .numberOfSimulatedConductors=${0}
      .simulatedHapp=${0}
      @ready=${0}
    >
      <div
        style="display: flex; flex-direction: row; margin-bottom: 20px; height: 600px;"
      >
        <dna-code
          style="flex: 1; margin-right: 20px;"
          @dna-compiled=${0}
        ></dna-code>
        <div style="display: flex; flex-direction: column; flex: 1;">
          <select-active-dna
            style="margin-bottom: 20px; flex-grow: 0;"
          ></select-active-dna>
          <dht-cells id="dht-cells" style="flex:1;" hide-filter hide-time-controller></dht-cells>
        </div>
      </div>
      <div
        style="display: flex; flex-direction: row; margin-bottom: 20px; height: 350px;"
      >
        <call-zome-fns
          id="call-zome"
          style="margin-right: 20px; flex: 1;"
          hide-agent-pub-key
        >
        </call-zome-fns>
        <entry-graph
          show-entry-contents
          .excludedEntryTypes=${0}
          style="flex: 1;"
        >
        </entry-graph>
      </div>
    </holochain-playground-container>
  `),4,le,(t=>{const e=t.detail.conductors[0].getAllCells()[0].cellId;console.log(t.target,e),t.target.activeAgentPubKey=e[1]}),(async t=>{const e=t.target,o=e.activeAgentPubKey,i=T(e.activeDna,o,e.conductors);await i.conductor.installHapp({name:`blockly-happ${Date.now()}`,description:"",slots:{default:{deferred:!1,dna:t.detail.dna}}},{});const n=R(t.detail.dna,f.DNA);e.updatePlayground({activeDna:n})}),["Agent"]),_e=document,pe=[{key:"Simple",story:he}];let de=!1;for(const t of pe){const e=_e.querySelector(`[mdjs-story-name="${t.key}"]`);e&&(e.story=t.story,e.key=t.key,de=!0,Object.assign(e,{}))}de&&(customElements.get("mdjs-preview")||import("./7010af11.js"),customElements.get("mdjs-story")||import("./be63f4b9.js"));export{he as Simple};
